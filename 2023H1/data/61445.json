{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I3b4c81eb02fa22c5af72f3203040a2d1f424df19",
    "number": 61445,
    "subject": "architecture: propose d-bus-based Redfish logging",
    "owner": {
        "name": "DelphineCCChiu",
        "email": "Delphine_CC_Chiu@wiwynn.com",
        "username": "DelphineCCChiu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/61445",
    "hashtags": [],
    "createdOn": 1678070762,
    "lastUpdated": 1679982408,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1678070762,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1678070790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678070790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1678071346,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/62137/ : FAILURE"
        },
        {
            "timestamp": 1678071533,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1678071559,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678071559,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1678071584,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62138/ : SUCCESS"
        },
        {
            "timestamp": 1678071731,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 2:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1678370831,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1678370911,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1678398138,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1678439176,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1679627786,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1679982408,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Abandoned\n\nWe decided not to use messageId and messageArgs for more flexible event logging."
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "bb96dafea86d9dc883fbe1a3e93938f186d4b23b",
            "parents": [
                "223193951d3c45670a8a415ac0e87b5ea97e71fb"
            ],
            "ref": "refs/changes/45/61445/1",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1678070762,
            "author": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "architecture/redfish-logging-in-bmcweb.md",
                    "type": "MODIFIED",
                    "insertions": 72,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 93,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "f3877a8704c0c1a463e0d6ec09aa3acefd10e3c8",
            "parents": [
                "223193951d3c45670a8a415ac0e87b5ea97e71fb"
            ],
            "ref": "refs/changes/45/61445/2",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1678071533,
            "author": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Adding Matt as one of the phosphor-logging maintainers (who was missing from the review)."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Thanks for proposing this!\n\nAt a core level, this design doesn't seem workable.  It pushes Redfish specifics throughout the system, doesn't integrate with the existing EventService or logging registry implementations, makes no mention of how message registries are constructed, and is missing large details about how this feature will work.  Even the code samples are incomplete.  If you really think this design is workable, it would be best to document a solution that:\n\n1. Creates a correct message registry from the existing phosphor-dbus-logging events.  If you're completely replacing the events or mapping them to the existing registry, that needs discussed in much more detail about how that works, and what part in the system owns that mapping.  Each individual daemon mapping logging-id to redfish id is error prone, and difficult to maintain.\n2. Doesn't require every daemon to understand the full structure of Redfish URIs, given they don't have dependencies for parsing dbus entries in to http uris and Ids.  in bmcweb, we quite often have to change the ID generation scheme for a collection, and every collection uses a different ID generation scheme, so it's not clear to me how this would work at any kind of scale.\n\nLooking forward to seeing your additions."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Thanks for reviewing. We are thinking more reliable way for implementation."
                },
                {
                    "file": "architecture/redfish-logging-in-bmcweb.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "We definitely shouldn't be pushing ResourceEvent items anywhere outside of bmcweb.  Doing this requires ALL daemons in the bmc to understand how to construct a Redfish URI and ID, which changes over time, and is largely specified by code, so the likelihood that individual daemons can get it correct over time is basically nil.  It should also be noted that a redfish resource is not generated by a single dbus interface or object in all cases, so for any non trivial example, this doesnt work.\n\nI suspect what we need to do is add a mapping from phosphor-logging event, into either a new \"OpenbmcDbus\" registry, or new entries within the existing message registry."
                },
                {
                    "file": "architecture/redfish-logging-in-bmcweb.md",
                    "line": 179,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This is not workable.  I don't want to see details of Redfish spread across every application.  There is no reason for any particular daemon to be tied to any particular management protocol.  Otherwise, we're going to start seeing IPMI_ARGS and PLDM_ARGS and ...\n\nIn my opinion, the REDFISH_MESSAGE_ID should be able to be generated from the phosphor-logging event type.  The MESSAGE_ARGS should simply be _all_ of the arguments of the phosphor-logging event type."
                },
                {
                    "file": "architecture/redfish-logging-in-bmcweb.md",
                    "line": 179,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Thanks for reviewing. We are thinking more reliable way for implementation."
                },
                {
                    "file": "architecture/redfish-logging-in-bmcweb.md",
                    "line": 222,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I see no mention of how the message registry for this will be constructed, and the code samples have significant missing code.  Please add a real example, including constructing the message args."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "architecture/redfish-logging-in-bmcweb.md",
                    "type": "MODIFIED",
                    "insertions": 70,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 91,
            "sizeDeletions": 0
        }
    ]
}
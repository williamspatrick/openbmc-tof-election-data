{
    "project": "openbmc/obmc-console",
    "branch": "master",
    "id": "I055f2a95c515636b38a694bf565b71aa648fe7b7",
    "number": 63864,
    "subject": "Add new D-Bus UART interface",
    "owner": {
        "name": "Jonathan Doman",
        "email": "jonathan.doman@intel.com",
        "username": "jonathan-doman"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/obmc-console/+/63864",
    "hashtags": [],
    "createdOn": 1685569612,
    "lastUpdated": 1685957179,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1685569612,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1685569641,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1685569641,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1685569658,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/67734/ : FAILURE"
        },
        {
            "timestamp": 1685570296,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1685570326,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1685570326,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1685570354,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/67736/ : SUCCESS"
        },
        {
            "timestamp": 1685579582,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1685579826,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1685586308,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1685590052,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1685641415,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1685641465,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1685641465,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1685641492,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/67832/ : SUCCESS"
        },
        {
            "timestamp": 1685642021,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1685649638,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1685650686,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1685652421,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1685652426,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1685665169,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1685734218,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1685734232,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1685734232,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1685734260,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/67957/ : SUCCESS"
        },
        {
            "timestamp": 1685734310,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1685925504,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1685957174,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1685957179,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "fcf99de87c77c9ea9c6b7173e9d162c8a26f14ca",
            "parents": [
                "bd992c9f62dbf127a21de26714662f92eabd0156"
            ],
            "ref": "refs/changes/64/63864/1",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1685569612,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "console-dbus.c",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -25
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 25
        },
        {
            "number": 2,
            "revision": "be5e8305dad4e1d545d042b961fe89ea9625ebda",
            "parents": [
                "bd992c9f62dbf127a21de26714662f92eabd0156"
            ],
            "ref": "refs/changes/64/63864/2",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1685570296,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I realise I'm giving you a bit of a run-around here. Apologies in advance.\n\nHowever, can we please separate out the addition of the new interface from the removal of the old interface, in that order? We should add entries to `CHANGELOG.md` also.\n\nOnce the new interface is added I'll create a release (really just munging `CHANGELOG.md` and creating a tag). Once the release is created we can merge the patch removing the old interface. This at least provides any users of the old interface with a path for transition at the intermediate point where both interfaces are exposed."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Replying partially to un-mark this as resolved, but I'll also take the opportunity to say thanks for putting in the effort to clean up this crusty problem \ud83d\ude0a"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "Sure, I can do that and I agree with the principle.\n\nI'm pretty sure this code in ipmid is (or will be) the only consumer of the interface: https://gerrit.openbmc.org/c/openbmc/phosphor-host-ipmid/+/63783"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "> Sure, I can do that and I agree with the principle.\n\nThanks \ud83d\ude0a"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "console-dbus.c",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -25
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 25
        },
        {
            "number": 3,
            "revision": "ed33a09620a7b46c860e43b89ba809f7cabc013a",
            "parents": [
                "bd992c9f62dbf127a21de26714662f92eabd0156"
            ],
            "ref": "refs/changes/64/63864/3",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1685641415,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "console-dbus.c",
                    "line": 103,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "Should we call sd_bus_reply_method_error()? Same for all return types."
                },
                {
                    "file": "console-dbus.c",
                    "line": 103,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "Not necessary, as sd-bus does it for us. And I confirm it works by trying to set an invalid value.\n\n> If a callback was invoked to handle a request that expects a reply and the callback returns a negative value, the value is interpreted as a negative errno-style error code and sent back to the caller as a D-Bus error as if sd_bus_reply_method_errno(3) was called.\n\nhttps://www.freedesktop.org/software/systemd/man/sd_bus_add_object_vtable.html#"
                },
                {
                    "file": "console-dbus.c",
                    "line": 103,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "Ack"
                },
                {
                    "file": "console-dbus.c",
                    "line": 202,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Could be an opportunity to use the `SD_BUS_VTABLE_DEPRECATED` flag.\n\nSee `SD_BUS_VTABLE_START(flags)` in https://www.man7.org/linux/man-pages/man3/SD_BUS_VTABLE_START.3.html#DESCRIPTION\n\nBut I'm not fussed. I'm happy with this patch as is, I'll just wait for your response."
                },
                {
                    "file": "console-dbus.c",
                    "line": 202,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "Added the deprecated flag to the old interface, as well as the emits_change flag (and signal) to the new property."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "console-dbus.c",
                    "type": "MODIFIED",
                    "insertions": 78,
                    "deletions": -1
                },
                {
                    "file": "CHANGELOG.md",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 113,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "9598b866d8e2189b0f426e8a384f2e20dc4d732c",
            "parents": [
                "bd992c9f62dbf127a21de26714662f92eabd0156"
            ],
            "ref": "refs/changes/64/63864/4",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1685734218,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "console-dbus.c",
                    "type": "MODIFIED",
                    "insertions": 80,
                    "deletions": -2
                },
                {
                    "file": "CHANGELOG.md",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 115,
            "sizeDeletions": 2
        }
    ]
}
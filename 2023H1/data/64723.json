{
    "project": "openbmc/google-misc",
    "branch": "master",
    "id": "I9637ac4d84b82931f107946ff53e7ef16a965d25",
    "number": 64723,
    "subject": "bare-metal-espi: Add systemd unit to disable eSPI",
    "owner": {
        "name": "John Wedig",
        "email": "johnwedig@google.com",
        "username": "johnwedig"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/google-misc/+/64723",
    "hashtags": [],
    "createdOn": 1688760901,
    "lastUpdated": 1689037063,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1688760901,
            "reviewer": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1688760928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1688760928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1688761027,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/70405/ : FAILURE"
        },
        {
            "timestamp": 1688761150,
            "reviewer": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1688762920,
            "reviewer": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1688762958,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1688762958,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1688763097,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/70410/ : SUCCESS"
        },
        {
            "timestamp": 1688766679,
            "reviewer": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "message": "Uploaded patch set 3: New patch set was added with same tree, parent tree, and commit message as Patch Set 2.\n\nCopied Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1688766718,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1688766718,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1688767004,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/70424/ : SUCCESS"
        },
        {
            "timestamp": 1689030351,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1689032344,
            "reviewer": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1689033600,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1689035037,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1689036827,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1689037063,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c4fa2922c7a9a3c327644303bb01b8586d5e714b",
            "parents": [
                "2be45238f16157c7e92d877a0af6408b905ab7e9"
            ],
            "ref": "refs/changes/23/64723/1",
            "uploader": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "createdOn": 1688760901,
            "author": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "John Wedig",
                        "email": "johnwedig@google.com",
                        "username": "johnwedig"
                    },
                    "message": "This review supersedes one I previously opened in google-ipmi-sys: https://gerrit.openbmc.org/c/openbmc/google-ipmi-sys/+/64688"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "bare-metal-espi",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/meson.build",
                    "type": "ADDED",
                    "insertions": 35,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/gbmc-disable-espi.service.in",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "type": "ADDED",
                    "insertions": 208,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 280,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "a449ed2b930451f1f03f49031b61bd2df3922ac5",
            "parents": [
                "04794283a1d135070e12280840acbbc3f94566ab"
            ],
            "ref": "refs/changes/23/64723/2",
            "uploader": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "createdOn": 1688762920,
            "author": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "bare-metal-espi",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/meson.build",
                    "type": "ADDED",
                    "insertions": 35,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/gbmc-disable-espi.service.in",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "type": "ADDED",
                    "insertions": 208,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 281,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "42a811dc5b56afbed846e47b0cd29e0903ddb470",
            "parents": [
                "580abaffe1d68987eef95037e993d46fed07ae28"
            ],
            "ref": "refs/changes/23/64723/3",
            "uploader": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "createdOn": 1688766679,
            "author": {
                "name": "John Wedig",
                "email": "johnwedig@google.com",
                "username": "johnwedig"
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I guess - would it make sense to rename this to be more generic since other platforms for other usage may be able utilize this to disable espi? (in that case, we should probably take out the service that heavily associates this with bare metal service)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "John Wedig",
                        "email": "johnwedig@google.com",
                        "username": "johnwedig"
                    },
                    "message": "In addition to this executable, I also need to introduce another service to monitor the Post Complete GPIO, to enable/disable eSPI when appropriate. I was planning to put that in the same bare-metal-espi directory. Are recommending I create an additional subdirectory in google-misc for that?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "If both are generic executables, could we perhaps consolidate / use them as we see fit in the meta-google layer change instead for the BM case?"
                },
                {
                    "file": "subprojects/bare-metal-espi/meson.build",
                    "line": 5,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "0.63.0"
                },
                {
                    "file": "subprojects/bare-metal-espi/meson.build",
                    "line": 5,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "It matches the top level right now"
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "line": 87,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "`static_cast<uintptr_t>`"
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "line": 91,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "`reinterpret_cast<volatile uint32_t*>`"
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "line": 113,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "I would wrap all of this logic in a sub function so you can wrap all of it in a larger try { } catch { } block for when the fd operations throw."
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "line": 124,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "Don't save it as an xvalue reference. Just prefer auto really."
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "line": 194,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "do we need delays in between setting the registers? Does the sequence always work?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "bare-metal-espi",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/meson.build",
                    "type": "ADDED",
                    "insertions": 35,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/gbmc-disable-espi.service.in",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "subprojects/bare-metal-espi/npcm7xx_espi_control.cpp",
                    "type": "ADDED",
                    "insertions": 208,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 281,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/phosphor-ipmi-flash",
    "branch": "master",
    "id": "Id734f6a92625bc6a1256fea010fb4b068f7bf1d5",
    "number": 61663,
    "subject": "Add retry to sendFile handler",
    "owner": {
        "name": "Willy Tu",
        "email": "wltu@google.com",
        "username": "wltu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-ipmi-flash/+/61663",
    "hashtags": [],
    "createdOn": 1678869565,
    "lastUpdated": 1678923770,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1678869565,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1678869603,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678869603,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1678870032,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62689/ : SUCCESS"
        },
        {
            "timestamp": 1678907048,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1678909964,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1678910056,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1678911683,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1678911990,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1678912344,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1678912360,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678912361,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1678912410,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1678912423,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1678912451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678912451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1678912452,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/62734/ : ABORTED"
        },
        {
            "timestamp": 1678912519,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1678912882,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62735/ : SUCCESS"
        },
        {
            "timestamp": 1678913202,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1678918718,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1678920453,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1678920489,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1678920661,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1678923770,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3: Code-Review+2"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "eeb7d7a76c8a42cd70d0b9e336cfe49203b8eb1f",
            "parents": [
                "64a23b26eac12d609f88f0550116a123dd738df6"
            ],
            "ref": "refs/changes/63/61663/1",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1678869565,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tools/handler.cpp",
                    "line": 92,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "The loop should not have a termination condition if it has to exit through the points within it. Returning success at `i == retryCount` would be a bug."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 92,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "oh, how come success on `i == retryCount` is a bug?"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 92,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "since I removed the termination condition, I am guessing that this is fine.\n\nI'll remove for now."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "So we only retry on tool exception? Should we bother retrying on blob exception as well?"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "I actually don't think we will hit that issue anymore.\n\n\n```\n    catch (const ipmiblob::BlobException& b)\n    {\n        progress->abort();\n        return false;\n    }\n```\n\nin net.cpp and others always catches it.\n\nSo maybe we can just remove that catch."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Oh ok - I think better to be safe and just leave this but sounds like we don't need to retry."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "Prefer `throw;` over `throw t;` to avoid copies."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Good catch"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": -4
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 95,
            "sizeDeletions": 19
        },
        {
            "number": 2,
            "revision": "38182100f20f4780f95e52115f23d45fdb46073f",
            "parents": [
                "64a23b26eac12d609f88f0550116a123dd738df6"
            ],
            "ref": "refs/changes/63/61663/2",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1678912344,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": -4
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 97,
            "sizeDeletions": 19
        },
        {
            "number": 3,
            "revision": "1b23b77285ae55eb570218f1d4634fb57aede5f0",
            "parents": [
                "64a23b26eac12d609f88f0550116a123dd738df6"
            ],
            "ref": "refs/changes/63/61663/3",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1678912410,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Would like William to +2 since he brought up some comments"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Seems like this is blocking a release - will +2 and submit for now, we can fix any nits in the future revision"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": -4
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 98,
            "sizeDeletions": 19
        }
    ]
}
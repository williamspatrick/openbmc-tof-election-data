{
    "project": "openbmc/phosphor-gpio-monitor",
    "branch": "master",
    "id": "Ib929bbf7bddb47af97324abd77a0ff430f906b1e",
    "number": 58895,
    "subject": "phosphor-gpio-monitor: GPIO status Dbus registration",
    "owner": {
        "name": "BonnieLo-wiwynn",
        "email": "Bonnie_Lo@wiwynn.com",
        "username": "BonnieLo"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-gpio-monitor/+/58895",
    "hashtags": [],
    "createdOn": 1670388972,
    "lastUpdated": 1678235417,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1670388972,
            "reviewer": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1670388986,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1670388986,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1670389003,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/56904/ : FAILURE"
        },
        {
            "timestamp": 1670462126,
            "reviewer": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1670462146,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1670462146,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1670462223,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/57005/ : SUCCESS"
        },
        {
            "timestamp": 1670462523,
            "reviewer": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "message": "Uploaded patch set 3: Commit message was updated."
        },
        {
            "timestamp": 1670462538,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1"
        },
        {
            "timestamp": 1670462551,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1670462551,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1670462628,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/57006/ : SUCCESS"
        },
        {
            "timestamp": 1670516762,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1670578747,
            "reviewer": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "message": "Uploaded patch set 4: Commit message was updated."
        },
        {
            "timestamp": 1670578758,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1"
        },
        {
            "timestamp": 1670578766,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1670578766,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1670578848,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/57360/ : SUCCESS"
        },
        {
            "timestamp": 1670578879,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1670862484,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1671097463,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1671108342,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4: Code-Review-2\n\n(1 comment)"
        },
        {
            "timestamp": 1671108436,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1671442252,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1671499908,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1671689080,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1678235417,
            "reviewer": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "message": "Abandoned\n\nThis design is not be accepted and we have alternative solution."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "83ce34a757d23da74aad20dfbd562db5b0a4ae83",
            "parents": [
                "b5bd88532ccef5e82810a1472af3d8a9213873ae"
            ],
            "ref": "refs/changes/95/58895/1",
            "uploader": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "createdOn": 1670388972,
            "author": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "gpioMonMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -1
                },
                {
                    "file": "gpioMon.hpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -2
                },
                {
                    "file": "gpioMon.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "57c31146a2551341e151b577ba827dad3c1327fc",
            "parents": [
                "b5bd88532ccef5e82810a1472af3d8a9213873ae"
            ],
            "ref": "refs/changes/95/58895/2",
            "uploader": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "createdOn": 1670462126,
            "author": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "gpioMonMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -1
                },
                {
                    "file": "gpioMon.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -4
                },
                {
                    "file": "gpioMon.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 5
        },
        {
            "number": 3,
            "revision": "6ae36f39b998a5cc47f7cb5e014585e98995f174",
            "parents": [
                "b5bd88532ccef5e82810a1472af3d8a9213873ae"
            ],
            "ref": "refs/changes/95/58895/3",
            "uploader": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "createdOn": 1670462523,
            "author": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Hi, could you add some example D-Bus output?  And also, what it's going to be used for."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "We add example in commit message.\n\nThe purpose of this Dbus is for those gpios which are needed to be monitored and must be initialized in phosphor-gpio-monitor"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "gpioMonMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -1
                },
                {
                    "file": "gpioMon.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -4
                },
                {
                    "file": "gpioMon.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 5
        },
        {
            "number": 4,
            "revision": "73c64a9a331fed0153f9b366e7368270bd159916",
            "parents": [
                "b5bd88532ccef5e82810a1472af3d8a9213873ae"
            ],
            "ref": "refs/changes/95/58895/4",
            "uploader": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "createdOn": 1670578747,
            "author": {
                "name": "BonnieLo-wiwynn",
                "email": "Bonnie_Lo@wiwynn.com",
                "username": "BonnieLo"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 22,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Usually it's asked that a YAML definition of the D-Bus interface is submitted to phosphor-dbus-interfaces so it can have officially documented types.\n\nHow this is defined now though it can't be done, since the property names are dynamic.  \n\nCould you instead put the GPIO name into a 'Name' property, and then submit the interface YAML to phosphor-dbus-interfaces for review?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 22,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "We will discuss and provide our idea later."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 22,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Dynamic property names like this violate dbus conventions anyhow.  The expectation is that any dbus interface (like ...GpioStatus) would be the same in every single object path and process where it exists."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This approach has been proposed so many times already that we've documented an anti-pattern on why it is not accepted.\n\nhttps://github.com/openbmc/docs/blob/f4febd002df578bad816239b70950f84ea4567e8/anti-patterns.md#dbus-interface-representing-gpios"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "According to our understanding, phosphor-gpio-monitor is used to handle GPIO interrupt.\n\nThus, if we couldn't register these gpios which should be mointored here.\n\nWhere could we handle these GPIOs?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Hi Patrick,\n\nPlease ignore the previous reply.\n\nAnd here is the situation.\n\nWe must monitor these gpios to set the current host state.\nhttps://gerrit.openbmc.org/c/openbmc/openbmc/+/58896/11/meta-facebook/meta-greatlakes/recipes-phosphor/gpio/phosphor-gpio-monitor/phosphor-multi-gpio-monitor.json\n\nHowever,  if BMC monitors these gpios, then the resources are occupied causing that BMC could not use gpioget tool anywhere.\nhttps://github.com/openbmc/openbmc/blob/master/meta-facebook/recipes-phosphor/state/phosphor-state-manager/greatlakes/chassis-poweroff#L17\n\nIn that case, BMC should have another method to get current 12V state, so we recommend a design that register gpio values on Dbus so that BMC could get 12V state anywhere."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Hi Patrick,\n\nAfter survey the phosphor-power repo, we found out that current design couldn't support multi-host pgood on Dbus in phosphor-power-sequencer.\n\nWe think each pgood information for each slot should be displayed on different Dbus for multi-host architecture.\n\nMoreover, we shuold provide a option in meson file for different projects to use different ways to monitor these pgood gpios.\n\nCurrent design uses call back function in a timer to monitor pgood gpio.\nHowever, the timer polling time is 3 seconds now and maybe too long.\n\nThus, we propose another method that we could register gpio interrupt in phosphor-gpio-monitor for these pgood gpios and start corresponding targets to set pgood property on Dbus.\n\nBy adding this option in meson file, different projects could decide their own method to monitor pgood gpios. \n\nIf some projects insist to use the call back function in timer to monitor pgood state, the function is still workable.\n\nIf some projects disable this option, they could use their own method to monitor pgood state like registering gpio interrupt."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "gpioMonMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -1
                },
                {
                    "file": "gpioMon.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -4
                },
                {
                    "file": "gpioMon.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 74,
            "sizeDeletions": 5
        }
    ]
}
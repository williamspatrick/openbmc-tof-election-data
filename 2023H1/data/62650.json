{
    "project": "openbmc/obmc-console",
    "branch": "master",
    "topic": "meson",
    "id": "I67c158b411f1533ca3b5a62803116e95907e8c5b",
    "number": 62650,
    "subject": "obmc-console: Fix bugprone-narrowing-conversions",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@aj.id.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/obmc-console/+/62650",
    "hashtags": [],
    "createdOn": 1681876870,
    "lastUpdated": 1682040808,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1681876870,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1681876907,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1681876907,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1681876935,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/64416/ : SUCCESS"
        },
        {
            "timestamp": 1681890220,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1681963108,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1681963437,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1681963479,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1681963480,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1681963592,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/64544/ : SUCCESS"
        },
        {
            "timestamp": 1681966242,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1681968252,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1681968343,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1682035201,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1682035218,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1682035218,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1682035250,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/64637/ : SUCCESS"
        },
        {
            "timestamp": 1682035999,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1682039193,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1682039212,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1682040808,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d8f2f1c40d8fdaebb5deaa780e3c6e45c71d3b75",
            "parents": [
                "ffac50c09ba68fc2bce7ef7818eddcb1d762752b"
            ],
            "ref": "refs/changes/50/62650/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1681876870,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "console-socket.c",
                    "line": 64,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Oog...is there some awful trap for the unwary that makes limits.h/SSIZE_MAX not an option here?"
                },
                {
                    "file": "console-socket.c",
                    "line": 64,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Well, not an awful trap, but as far as I can tell it's thanks to `-pedantic` \ud83d\ude0a"
                },
                {
                    "file": "console-socket.c",
                    "line": 64,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "I don't follow...from what I can see in the docs (https://www.gnu.org/software/libc/manual/html_node/Constants-for-Sysconf.html) it appears that this sysconf call is a runtime way to retrieve the same value that `SSIZE_MAX` should provide at compile-time, no?  So what I'm wondering is why we want to use sysconf() instead of the simple constant from limits.h."
                },
                {
                    "file": "console-socket.c",
                    "line": 64,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "```\n3 14:51:57 andrew@fedora:~/src/openbmc/obmc-console (meson) $ \\\n> gcc -pedantic -Wall -Werror -std=c17 -o ssizemax -x c - \\\n> <<< '#include <limits.h>^Mint main(void) { return 0 == SSIZE_MAX; }'\n<stdin>:1:20: error: extra tokens at end of #include directive [-Werror]\n<stdin>:3: error: ISO C forbids an empty translation unit [-Werror=pedantic]\ncc1: all warnings being treated as errors\n3 14:52:10 andrew@fedora:~/src/openbmc/obmc-console (meson) $ \n```\n\nBut I wonder why it's not using `-std=gnu17`, which works."
                },
                {
                    "file": "console-socket.c",
                    "line": 64,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Ugh, copied the wrong chunk out of my terminal.\n\n```\n3 14:53:57 andrew@fedora:~/src/openbmc/obmc-console (meson) $ \\\n> gcc -Wall -Werror -std=c17 -o ssizemax -x c - \\\n> <<< '#include <limits.h>^Mint main(void) { return 0 == SSIZE_MAX; }'\n<stdin>: In function \u2018main\u2019:\n<stdin>:2:30: error: \u2018SSIZE_MAX\u2019 undeclared (first use in this function)\n<stdin>:2:30: note: each undeclared identifier is reported only once for each function it appears in\n```"
                },
                {
                    "file": "console-socket.c",
                    "line": 64,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I've fixed this up, I got myself into a confused state. I wrote the meson build with `c_std=c17` originally and then later switched to `c_std=gnu17`, which resolves the problem above _after_ also adding `#include <limits.h>`."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -4
                },
                {
                    "file": "ringbuffer.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/ringbuffer-test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/test-client-escape.c",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -5
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -12
                },
                {
                    "file": "console-client.c",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "console-socket.c",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -2
                },
                {
                    "file": "config.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 80,
            "sizeDeletions": 27
        },
        {
            "number": 2,
            "revision": "00bee7ee68568c70c841a6b53ceed71f7bc8244c",
            "parents": [
                "fd883a881dfc21443cd5c5f1a32002bbf53040f8"
            ],
            "ref": "refs/changes/50/62650/2",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1681963437,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -4
                },
                {
                    "file": "ringbuffer.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/ringbuffer-test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/test-client-escape.c",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -5
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -12
                },
                {
                    "file": "console-client.c",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "console-socket.c",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -2
                },
                {
                    "file": "config.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 80,
            "sizeDeletions": 27
        },
        {
            "number": 3,
            "revision": "5c359cc6ab8a0d40c86556ea37378c4a73d8200b",
            "parents": [
                "fd883a881dfc21443cd5c5f1a32002bbf53040f8"
            ],
            "ref": "refs/changes/50/62650/3",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1682035201,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -4
                },
                {
                    "file": "ringbuffer.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/ringbuffer-test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/test-client-escape.c",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -5
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -12
                },
                {
                    "file": "console-client.c",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "console-socket.c",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -2
                },
                {
                    "file": "config.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 68,
            "sizeDeletions": 27
        }
    ]
}
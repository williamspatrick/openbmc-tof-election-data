{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I20ba60ee39bac11ffb3fe1768cec6299cf9ee13e",
    "number": 60727,
    "subject": "Only parse to the depth requested",
    "owner": {
        "name": "Ed Tanous",
        "email": "ed@tanous.net",
        "username": "edtanous"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/60727",
    "hashtags": [],
    "createdOn": 1675793089,
    "lastUpdated": 1678828902,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1675793089,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1675793121,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675793121,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1675793151,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/60416/ : FAILURE"
        },
        {
            "timestamp": 1675798245,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1675798261,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675798261,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1675798786,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/60419/ : FAILURE"
        },
        {
            "timestamp": 1675800858,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1675806725,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1675807154,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1675807158,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1675807207,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675807207,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1675807999,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/60422/ : SUCCESS"
        },
        {
            "timestamp": 1675834162,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1675834193,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675834193,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1675834433,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1675834548,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/60457/ : FAILURE"
        },
        {
            "timestamp": 1675882984,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1677891359,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1677891391,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1677891391,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1677892558,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62122/ : SUCCESS"
        },
        {
            "timestamp": 1677893030,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1677895535,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1677895568,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1677895568,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1677895610,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 6:\n\n(4 comments)"
        },
        {
            "timestamp": 1677896697,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 6:\n\n(2 comments)"
        },
        {
            "timestamp": 1677896721,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62129/ : SUCCESS"
        },
        {
            "timestamp": 1677897778,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1677898662,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Uploaded patch set 7.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1677898677,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 7:\n\n(2 comments)"
        },
        {
            "timestamp": 1677898702,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1677898702,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1677899938,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62130/ : SUCCESS"
        },
        {
            "timestamp": 1678817822,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 8: Patch Set 7 was rebased\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1678817846,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678817846,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: -Ok-To-Test"
        },
        {
            "timestamp": 1678819011,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62648/ : SUCCESS"
        },
        {
            "timestamp": 1678820434,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9: Patch Set 8 was rebased\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1678820451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1678820451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: -Ok-To-Test"
        },
        {
            "timestamp": 1678820468,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9: Code-Review+1"
        },
        {
            "timestamp": 1678820472,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9: Code-Review+2"
        },
        {
            "timestamp": 1678821905,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/62650/ : SUCCESS"
        },
        {
            "timestamp": 1678828902,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "8ac55898f58f44be7f22ebeb9e3699ae3c933278",
            "parents": [
                "72fff0a87162a166a7d7ea721dbfeeaf567d8670"
            ],
            "ref": "refs/changes/27/60727/1",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1675793089,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -8
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 56,
            "sizeDeletions": 21
        },
        {
            "number": 2,
            "revision": "13114d91a75e266488bd58ada38d81a8791242e1",
            "parents": [
                "72fff0a87162a166a7d7ea721dbfeeaf567d8670"
            ],
            "ref": "refs/changes/27/60727/2",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1675798245,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Hmm, why do we +1 here?"
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Because we're in a resource, and we should only be expanding one level of resource.  If it's an autoexpand resource, or a resource that's already had its query params applied, we don't want to expand it again."
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Marking resolved since incrementing that variable has been removed from the latest patchset.  We do now decrement newDepth for related reasons.  Comments have been added explaining why."
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 613,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Depth is no longer being used in the latest patchset to stop traversal.  I'm assuming you still want this call wrapped inside of \"if (newDepth >= 0)\" from the initial patchset.  You may also want to reintroduce the code just before this call\n\nif (!localInLinks)\n{\n    // A links object doesn't count as a depth traversal\n    newDepth--;\n}"
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 613,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Yeah.  I just pushed what I had, which is a step backwards from what was there previously.  Will get it fixed."
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 613,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -7
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 54,
            "sizeDeletions": 20
        },
        {
            "number": 3,
            "revision": "5ae5cf5dd3d1a0ac55b2241f31e60153e9491deb",
            "parents": [
                "72fff0a87162a166a7d7ea721dbfeeaf567d8670"
            ],
            "ref": "refs/changes/27/60727/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1675807158,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -8
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 21
        },
        {
            "number": 4,
            "revision": "36deac84ae8438e0fbd0a1a46c23bbf8b9b7dcc4",
            "parents": [
                "5b5574ace856c7f787528ab8f5e5352a90f2a6cb"
            ],
            "ref": "refs/changes/27/60727/4",
            "uploader": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "createdOn": 1675834162,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "I added some tests to check aggregation use cases.  It seems to be traversing the already expanded response from a satellite BMC."
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 743,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "This test fails"
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 743,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Ack"
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 785,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "This test fails.  I think it's also returning \"/redfish/v1/Chassis/5B247A_Sat1/Sensors\""
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 785,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -8
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 102,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 142,
            "sizeDeletions": 21
        },
        {
            "number": 5,
            "revision": "1a6224a5d52dac34d2d9836ba45efab791886f3a",
            "parents": [
                "5877867e0059f79e53e19f623b6f81fd69e69acf"
            ],
            "ref": "refs/changes/27/60727/5",
            "uploader": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "createdOn": 1677891359,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Note that I changed the approach to rely on the existence of the resource identifier \"@odata.id\" to denote when we've stepped into a resource that was previously expanded.  I think that's fine because the former would not be recognized as valid json response so we shouldn't worry about trying to $expand it.\n\nFor the sake of consistency I also updated the existing $expand unit tests so that they also now include \"@odata.id\": \"{URI}\".  A test response that was previously:\n{\n  \"Foo\": {\n    \"/foobar\"\n  }\n}\n\nIs now:\n{\n  \"@odata.id\": \"/redfish/v1\",\n  \"Foo\": {\n    \"/foobar\"\n  }\n}\n\nNote that single level expand will still work correctly on non-aggregated responses that do not include \"@odata.id\".  It's when the response has already been expanded that our expand handler code can't figure out the appropriate depth without using \"@odata.id\"."
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Isn't this branch already covered on 594?"
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "I'll double check, but I don't think so.  Let's say we have this object in obj:\n{\n  \"@odata.id\": \"/redfish/v1\",\n  \"Chassis\": {\n    \"@odata.id\": \"/redfish/v1/Chassis\"\n}\n\nIf we don't include this skip then we'd call findNavigationReferencesRecursive() on the \"@odata.id\": \"/redfish/v1\" element, as well as the \"Chassis\" element.  Then at the beginning of findNavigationReferencesRecursive() starting at 570 we'd end up matching and add \"/redfish/v1\" as a URI that we should expand.\n\n\nNow let's say we're doing a single level expand and the original object is\n{\n  \"@odata.id\": \"/redfish/v1\",\n  \"Chassis\": {\n    \"@odata.id\": \"/redfish/v1/Chassis\",\n    \"Members\": [\n      {\n        \"@odata.id\": \"/redfish/v1/Chassis/Foo\"\n      }\n    ]\n  }\n}\n\nIn that scenario we shouldn't expand anything.  The check on 594 will decrement the depth to \"0\" when first parse the object.  594 later catches when obj becomes\n{\n  \"@odata.id\": \"/redfish/v1/Chassis\",\n  \"Members\": [\n    {\n      \"@odata.id\": \"/redfish/v1/Chassis/Foo\"\n    }\n  ]\n}\n\nIf we don't stop traversal at that point then we'll fall into the for loop on 602 and end up returning \"/redfish/v1/Chassis/Foo\" as a URI that needs to be expanded."
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "The tests still passed after I commented it out.  I was confused until I realized what was going on. In the for loop we only pass element.second.  That means when the element is the resource identifier we'll only pass the URI which is a string.  That means we'll fail the check on 565 after attempting to read it as an nlohmann::json::object_t.  \n\nThis check on 604 then ends up just saving us an attempt at parsing a string as array_t and then object_t.  I'll go ahead and remove it so that we don't have to do this check on every single element."
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 610,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "line": 640,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "TLDR; I think https://gerrit.openbmc.org/c/openbmc/bmcweb/+/60556 won't play well with $expand and we should disable forwarding query params to satellite BMCs when the URI is up tree from a top level collection.  Think '/redfish/v1?$expand=.($levels=1)', '/redfish/v1/UpdateService?$expand=.(levels=2)', etc.\n\n\n=============\nSomething to keep an eye on whenever that patch lands.  When it does then let's say we receive the request '/redfish/v1/UpdateService?$expand=.($levels=2)', the satellite supports $expand, and we forward the request as-is.\n\nThe satellite response would be expanded such that the FirmwareInventory entries /redfish/v1/UpdateService/FirmwareInventory/{id} are expanded in the Members array of /redfish/v1/UpdateService/FirmwareInventory.\n\nThe initial response from the aggregating BMC would only be for /redfish/v1/UpdateService.\n\nThe aggregator has to combine them into a single response.  The processing code does not consider that the satellite response may have been expanded.  It only transfers properties from the satellite response if they do not already exist in the aggregator's response and have the form:\n\n\"Property\": {\n  \"@odata.id\": {top level collection URI}\n}\n\nMy guess is none of that would get copied over and thus the satellite performing $expand is wasted.  If the Property is associated with a resource that is only supported on the satellite then the link wouldn't get added at all.\n\nIt'd be a major headache if we had to support selectively combining responses at differing levels of $expand.  In the example, the initial response will look like the multi-level $expand has been performed, but it will only contain FirmwareInventory entries from the satellite since the aggregating BMC has not actually had a chance to locally generate a response for /redfish/v1/UpdateService/FirmwareInventory.  It'll be even more difficult to do all of that whenever we add support for aggregating multiple satellite BMCs.\n\nIn the $expand code whenever we hit a top level collection we'd have to make sure we have entries from all known satellites as well as the aggregating BMC.  If we don't then we'd have to somehow query that top level collection, but only on whatever expected entities are not represented in the Members array since they potentially haven't had a chance to be expanded yet.\n\nI think the best approach by far would be to remove the query params from forwarded requests if the resource is uptree from a top level collection.  Once we reach a top level collection we'll begin including the query params since it'll work correctly from that point."
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 659,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Nit, can you either append to the existing string, or break apart the construction here?  Doing both makes this code hard to read."
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 659,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Sure will do"
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "line": 659,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 36,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -9
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 161,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 240,
            "sizeDeletions": 22
        },
        {
            "number": 6,
            "revision": "f06386da4993d039ec43bf0027934951b41f8d5f",
            "parents": [
                "5877867e0059f79e53e19f623b6f81fd69e69acf"
            ],
            "ref": "refs/changes/27/60727/6",
            "uploader": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "createdOn": 1677895535,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 36,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -9
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 160,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 239,
            "sizeDeletions": 22
        },
        {
            "number": 7,
            "revision": "d8fcb9f5eaf3d1b969edddda64c0265513efeda7",
            "parents": [
                "5877867e0059f79e53e19f623b6f81fd69e69acf"
            ],
            "ref": "refs/changes/27/60727/7",
            "uploader": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "createdOn": 1677898662,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 36,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -9
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 162,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 234,
            "sizeDeletions": 25
        },
        {
            "number": 8,
            "revision": "0dcebf829a861d8b449171478c025633d5e0e842",
            "parents": [
                "60948a9f057c610ed0d8ec92a01d641bcac33f2f"
            ],
            "ref": "refs/changes/27/60727/8",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1678817822,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 36,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -9
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 162,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 234,
            "sizeDeletions": 25
        },
        {
            "number": 9,
            "revision": "ad595fa64f619124eadcdfc2af259a1975136399",
            "parents": [
                "5315c1b149b724d0395f42ca75d4660aaecdf351"
            ],
            "ref": "refs/changes/27/60727/9",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1678820434,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 36,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/utils/query_param.hpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -9
                },
                {
                    "file": "test/redfish-core/include/utils/query_param_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 162,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 234,
            "sizeDeletions": 25
        }
    ]
}
{
    "project": "openbmc/phosphor-dbus-interfaces",
    "branch": "master",
    "topic": "Add FreeInstanceId",
    "id": "Id932e0926f8e5b6425e4545b2acb5eef9828d868",
    "number": 62052,
    "subject": "pldm: requester: Add FreeInstanceId method",
    "owner": {
        "name": "Thu Nguyen",
        "email": "thu@os.amperecomputing.com",
        "username": "ThuBaNguyen"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/62052",
    "hashtags": [],
    "createdOn": 1680161198,
    "lastUpdated": 1680321403,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1680161198,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1680161227,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1680161227,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1680161603,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/63369/ : SUCCESS"
        },
        {
            "timestamp": 1680161919,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Topic set to Add FreeInstanceId"
        },
        {
            "timestamp": 1680204537,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1680204646,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1680223873,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1680223920,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1680223921,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1680223931,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1680224301,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/63457/ : SUCCESS"
        },
        {
            "timestamp": 1680224701,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680225552,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680226060,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680233705,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2: Code-Review-2\n\n(1 comment)"
        },
        {
            "timestamp": 1680321403,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Abandoned\n\nThere is new proposal for managing the instanceId https://amboar.github.io/notes/2023/03/29/a-global-pldm-instance-id-allocator-for-libpldm.html\nhttps://amboar.github.io/notes/2023/03/28/motivating-a-new-scheme-for-pldm-instance-id-management-in-openbmc.html"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "fadf45d7ad2297d136f78a988788a3717f273f6c",
            "parents": [
                "a1b26a4bdf606df141695561a92a4f060cdd0156"
            ],
            "ref": "refs/changes/52/62052/1",
            "uploader": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "createdOn": 1680161198,
            "author": {
                "name": "dcao-ampere",
                "email": "dung@os.amperecomputing.com",
                "username": "dcao-ampere"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Adding PLDM maintainers here."
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 55,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "How do you know that the instance ID being freed wasn't allocated to a different process?  This doesn't seem like a great API."
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 55,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "The maximum number of instanceID is 32, the allocated instanceID thru getInstanceID will only be free by requester interface after 6 seconds. When there is more than 32 pldmtool commands in 6 seconds, no more instanceID."
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 55,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "You haven\u2019t given more information than what is already in the commit message. \n\nHow do you know that whoever calls this new API still has the reservation from the previous \u201cget\u201d call?  This API seems very bug prone."
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 55,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "This API just provides the utility to allow one service which uses GetInstanceID to free the granted instanceID actively instead of waiting for the requester interface to free that id.\nMoreover, each PLDM request has to finish after (1 + number-of-request-retries)*response-time-out seconds and it usually not more than 6 seconds.\nI will also update the pldm code handle this method by checking the free status of the pair eid and instanceId."
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 55,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "Update the pldm code:\nhttps://gerrit.openbmc.org/c/openbmc/pldm/+/62054/2..3/pldmd/dbus_impl_requester.cpp#35"
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 64,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Instance (spelling)"
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "line": 64,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "Updated."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 34,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "66f8cd71e1ccce5f67d6cd94860a075549c70103",
            "parents": [
                "a1b26a4bdf606df141695561a92a4f060cdd0156"
            ],
            "ref": "refs/changes/52/62052/2",
            "uploader": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "createdOn": 1680223873,
            "author": {
                "name": "dcao-ampere",
                "email": "dung@os.amperecomputing.com",
                "username": "dcao-ampere"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Please no. See the following blog posts:\n\n* https://amboar.github.io/notes/2023/03/28/motivating-a-new-scheme-for-pldm-instance-id-management-in-openbmc.html\n* https://amboar.github.io/notes/2023/03/29/a-global-pldm-instance-id-allocator-for-libpldm.html"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/PLDM/Requester.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 34,
            "sizeDeletions": 0
        }
    ]
}
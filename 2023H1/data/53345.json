{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I1d016126a2cf89091d5ed152b08f62af9f8ed0ec",
    "number": 53345,
    "subject": "Apply async dbus API",
    "owner": {
        "name": "Przemyslaw Czarnowski",
        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
        "username": "phawryle"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/53345",
    "hashtags": [],
    "createdOn": 1651160825,
    "lastUpdated": 1677274610,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1651160825,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1651160848,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651160848,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1651161609,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/42212/ : SUCCESS"
        },
        {
            "timestamp": 1651271893,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Patch Set 1 was rebased"
        },
        {
            "timestamp": 1651271908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651271908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1651272070,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Patch Set 2 was rebased"
        },
        {
            "timestamp": 1651272083,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651272084,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1651272089,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/42373/ : ABORTED"
        },
        {
            "timestamp": 1651272382,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1651273363,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1 Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/42376/ : SUCCESS"
        },
        {
            "timestamp": 1651749815,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1652201136,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1654253550,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1654253582,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1654253583,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1654253607,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/44350/ : FAILURE"
        },
        {
            "timestamp": 1654254913,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1654254963,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1654254963,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1654255664,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/44359/ : SUCCESS"
        },
        {
            "timestamp": 1677274610,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\nDuplicate of https://gerrit.openbmc.org/c/openbmc/bmcweb/+/60208"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "8427dec00c6cd52e1241acdcb337a849842e5688",
            "parents": [
                "5c97807bc3f27d8f8fb8d7a8e5a8007cc9a71d88"
            ],
            "ref": "refs/changes/45/53345/1",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1651160825,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 202,
                    "deletions": -42
                }
            ],
            "sizeInsertions": 223,
            "sizeDeletions": 42
        },
        {
            "number": 2,
            "revision": "1e824dfa5e9c38ed8a4adc354c157133469c1b77",
            "parents": [
                "4677dd4db05bea72810ed916c91e6e35a83ea770"
            ],
            "ref": "refs/changes/45/53345/2",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1651271893,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 202,
                    "deletions": -42
                }
            ],
            "sizeInsertions": 223,
            "sizeDeletions": 42
        },
        {
            "number": 3,
            "revision": "a1d3ef0d90210ceaa8be9833fd134557fcdc58b4",
            "parents": [
                "652b5b53916101f4a5c286643e0392b34f087db4"
            ],
            "ref": "refs/changes/45/53345/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1651272070,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "In other places in Redfish that take a long time we've relied on task service, which in the specification is intended for this exact use case.  Can you speak to why that wasn't usable in this case?  We already have quite a bit of infrastructure, including the signal listener, for handling that, and it gives clients a better way to wait for their operation to complete, so unless there's a good reason to avoid it in this case, I'd really like to reuse what we have."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Przemyslaw Czarnowski",
                        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                        "username": "phawryle"
                    },
                    "message": "The reason for async backend is that nbd device backend sometimes stalls for some reason. This caused dbus transaction timeout and that's why dbus api has changed. But this is just a corner case when user does more actions one after another (actually revealed during automated functional tests).\nI think redfish tasks are quite heavy and not essential at the moment. But I will take a look if some code could be used/borrowed. For full tasks implementation - this could be done later on, when actual need will rise. This very change is essential to make VM part work with service being upstreamed now."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> The reason for async backend is that nbd device backend sometimes stalls for some reason.\n\nSo, can we just fix that in the nbd backend?  It shouldn't be stalling for long periods of time, and the fact that it does implies that we need some blocking calls broken out into a separate thread/task.\n\n> This caused dbus transaction timeout and that's why dbus api has changed. But this is just a corner case when user does more actions one after another (actually revealed during automated functional tests).\n> I think redfish tasks are quite heavy and not essential at the moment.\n\nWhat does \"heavy\" mean in this context?  In terms of code/cpu cycles, they're basically the same as what you just implemented, they host a match expression and wait for the results.\n\n> But I will take a look if some code could be used/borrowed. For full tasks implementation - this could be done later on, when actual need will rise. This very change is essential to make VM part work with service being upstreamed now."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "A little more details would be good here.  \"Manually\" doesn't really describe the test.  Did you mount/unmount things?  Did you require patches to any other daemons?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Przemyslaw Czarnowski",
                        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                        "username": "phawryle"
                    },
                    "message": "Ok, I will elaborate a little with next commit"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 202,
                    "deletions": -42
                }
            ],
            "sizeInsertions": 223,
            "sizeDeletions": 42
        },
        {
            "number": 4,
            "revision": "174e2d09a51c7f21feface16cb4072b0e3365a4c",
            "parents": [
                "1ed254460515b1e4d6fbb043bde8596c71d67088"
            ],
            "ref": "refs/changes/45/53345/4",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1654253550,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 184,
                    "deletions": -32
                }
            ],
            "sizeInsertions": 205,
            "sizeDeletions": 32
        },
        {
            "number": 5,
            "revision": "ec2e8bc830777f45389c881fa23f52f96ef0f7c2",
            "parents": [
                "1ed254460515b1e4d6fbb043bde8596c71d67088"
            ],
            "ref": "refs/changes/45/53345/5",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1654254913,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 187,
                    "deletions": -36
                }
            ],
            "sizeInsertions": 208,
            "sizeDeletions": 36
        }
    ]
}
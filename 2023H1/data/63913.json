{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I19ff994e712bcfaf827a5f8dd02a752a6ab92214",
    "number": 63913,
    "subject": "Add AccountTypes in POST Accounts service",
    "owner": {
        "name": "Ninad Palsule",
        "email": "ninad@linux.ibm.com",
        "username": "ninadpalsule"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/63913",
    "hashtags": [],
    "createdOn": 1685657221,
    "lastUpdated": 1686090782,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1685657221,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1685657262,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1685657262,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1685658526,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/67874/ : FAILURE"
        },
        {
            "timestamp": 1685662004,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1685664607,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1685664676,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1685706562,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1685711791,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1685711818,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1685711834,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1685711834,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1685712922,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/67929/ : SUCCESS"
        },
        {
            "timestamp": 1685978775,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1685993240,
            "reviewer": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1686090741,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1686090775,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1686090776,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1686090782,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 9ba73934501fc4bfe8edf74b8a0211701b6d58ca"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "2f30b85e4bb71d2ded408c3986ead9ea41e322bc",
            "parents": [
                "f02e69aa0af2937749b0b35177fa2c89623ca00b"
            ],
            "ref": "refs/changes/13/63913/1",
            "uploader": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "createdOn": 1685657221,
            "author": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1886,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Isn't this duplicated with other code?"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1886,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "I think other code just need to drop those groups and in this case we need to fail the command. Also we are building the group list in other case here we already have list. I will see what I can do."
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1886,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1926,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Is there any way to make this take the same path as the below?  I'm worried about completely ignoring the AllGroups could cause inconsistencies in the future."
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1926,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "I was trying to avoid group query as we know the list of groups. If we are ok with all group query then I can pass one more group list and make the code common."
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1926,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "If we can drop the all group query, lets just drop it for everything?"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1926,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "In that case we will have to make the accountType as required parameter. Let me try to restructure and use the all group query and see."
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1926,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 106,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 47,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 153,
            "sizeDeletions": 6
        },
        {
            "number": 2,
            "revision": "5cae56fecc42a257336c05e9f31d9a54938b1381",
            "parents": [
                "2b65025e730725c3449bf58078d52b6d39b40f35"
            ],
            "ref": "refs/changes/13/63913/2",
            "uploader": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "createdOn": 1685711791,
            "author": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1889,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I think - empty() check is not needed as it will be iterated in groups,\nand also this seems trying to check whether 'grp' is in accountTypeUserGroups.\n\nThis can be simplified like\n\n```\n    for (const auto& grp : allGroupsList)\n    {\n        // If user specified the account type then only accept groups which are\n        // in the account types group list.\n        if(accountTypeUserGroups.find(grp) == accountTypeUserGroups.end())\n        {\n              continue;\n        }\n        \n        // Console access is provided to the user who is a member of\n        // hostconsole group and has a administrator role. So, set\n        // hostconsole group only for the administrator.\n        if ((grp == \"hostconsole\") && (roleId != \"priv-admin\"))\n        {\n            // NOTE: accountTypeUserGroups is not empty as 'grp' is in the list\n            BMCWEB_LOG_ERROR\n                    << \"Only administrator can get HostConsole access\";\n            asyncResp->res.result(boost::beast::http::status::bad_request);\n            return;\n        }\n        userGroups.emplace_back(grp);\n   }\n```"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1889,
                    "reviewer": {
                        "name": "Ninad Palsule",
                        "email": "ninad@linux.ibm.com",
                        "username": "ninadpalsule"
                    },
                    "message": "This logic doesn't work for two reasons, 1) there is no find method in std:vector and 2) If account type is not specified then we will try to create user with no groups."
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1889,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I think what you'd probably do is \n\nstd::find(accountTypeUserGroups.begin(), accountTypeUserGroups.end())\n\nFine either way if you want to do that."
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1889,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "If you want to simplify, please send it as another patch."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 106,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 61,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 167,
            "sizeDeletions": 10
        },
        {
            "number": 3,
            "revision": "9ba73934501fc4bfe8edf74b8a0211701b6d58ca",
            "parents": [
                "583458567282adc738ce937fe956c1fb54ed7987"
            ],
            "ref": "refs/changes/13/63913/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1686090782,
            "author": {
                "name": "Ninad Palsule",
                "email": "ninad@linux.ibm.com",
                "username": "ninadpalsule"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 106,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 61,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 167,
            "sizeDeletions": 10
        }
    ]
}
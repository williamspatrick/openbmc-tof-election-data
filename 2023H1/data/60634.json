{
    "project": "openbmc/openbmc",
    "branch": "master",
    "topic": "no-rootfs",
    "id": "Ic7e6d1ba8ab01b047efcb3ac53e16667e9ac82eb",
    "number": 60634,
    "subject": "meta-phosphor: preinit-mounts: shellcheck and prettysh",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/60634",
    "hashtags": [],
    "createdOn": 1675652388,
    "lastUpdated": 1677086170,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1675652388,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1675652578,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675652578,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1675653769,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1675653867,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675653868,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1675656292,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/15811/"
        },
        {
            "timestamp": 1675656928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/15811/ : FAILURE"
        },
        {
            "timestamp": 1675693102,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Verified\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/15821/"
        },
        {
            "timestamp": 1675694149,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/15821/ : SUCCESS"
        },
        {
            "timestamp": 1675694161,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1675695366,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1675833004,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "mdmii@outlook.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1675880169,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1675884361,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "mdmii@outlook.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1675884678,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1675969748,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1675969944,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1675969944,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1675973901,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/15910/"
        },
        {
            "timestamp": 1675974981,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/15910/ : SUCCESS"
        },
        {
            "timestamp": 1675974990,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1675978200,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Failed \n\nIBM Hardware CI : witherspoon hardware test failed"
        },
        {
            "timestamp": 1676035461,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4: Patch Set 3 was rebased\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1676035552,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1676035552,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1676035559,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/15937/"
        },
        {
            "timestamp": 1676036292,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/15937/ : SUCCESS"
        },
        {
            "timestamp": 1676036304,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1676037538,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1676046808,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "mdmii@outlook.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1677008123,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1677011715,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1677086163,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1677086170,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 6764c56f08bdd95ee1bb38a634ef2c9a61f66265"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "800d2122aac85d664f35db8842d19ad18c7130ea",
            "parents": [
                "a88cad6eb14f2b5d98156f14061e9dbb20a0ac47"
            ],
            "ref": "refs/changes/34/60634/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1675652388,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -35
                },
                {
                    "file": "meta-phosphor/scripts/run-repotest",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 36
        },
        {
            "number": 2,
            "revision": "cf702a2dc8bdbb27fbf1bd2206f43b065f7deada",
            "parents": [
                "c79625efa598e48bc441e15365691848c53d1ef0"
            ],
            "ref": "refs/changes/34/60634/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1675653769,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "line": 12,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "while I understand that the cd is unchecked, exit is not a good choice for the init program\n\n\nthis script is pid 1 and an attempt to exit will lead to an immediate kernel panic.   and the condition is likely to repeat so this results in a broken system\n\n\nwe should evaluate what recovery is available even if it's discarding var or etc back to a factory reset type state.\n\nor maybe the function can be refactored to not use cd"
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "line": 12,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I was attempting to blindly follow the advice of shellcheck.  I think if we cannot `cd` to root we probably have pretty serious problems.  I may either change this to a `|| true` or, as you said, rewrite the function to not require a change to root.\n\nI believe after reading it a bit, the switch to root is to confirm we are not in a directory which is going to be unmounted."
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "line": 12,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "note there is a second cd to not root that is more likely to fail.  also cd is state in the process and the cd back is to undo that, hence the statement about rewriting"
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "line": 12,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Ack"
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "line": 43,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "here's the other cd"
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "line": 43,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yep.  Got it under control.  Re-wrote this to not use a `cd`."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -35
                },
                {
                    "file": "meta-phosphor/scripts/run-repotest",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 36
        },
        {
            "number": 3,
            "revision": "37ee87545a8751f6386cd213fe352a1ef5ba5055",
            "parents": [
                "d8ef1621fc35b8f180b254f3ee74e474074287d2"
            ],
            "ref": "refs/changes/34/60634/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1675969748,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -36
                },
                {
                    "file": "meta-phosphor/scripts/run-repotest",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 37
        },
        {
            "number": 4,
            "revision": "cd0439c790212288a0f9eaee710b829492b69c7b",
            "parents": [
                "ddaffb3f38875d89fe0c92eb440cf495060a52f0"
            ],
            "ref": "refs/changes/34/60634/4",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1676035461,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "This addresses my previous comment but we need to test this change still addresses the original needs of the code.\n\nthe automatic ci is insufficient to test this."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Tested on p10bmc."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Verified there were no errors displayed from the serial console on simulation and HW when the init script ran, that the partitions were mounted as expected when the bmc booted, and the software manager dbus objects showed the 2 fw versions."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -36
                },
                {
                    "file": "meta-phosphor/scripts/run-repotest",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 37
        },
        {
            "number": 5,
            "revision": "6764c56f08bdd95ee1bb38a634ef2c9a61f66265",
            "parents": [
                "7f95dae13b419922c827a965b49e3d220527d4fd"
            ],
            "ref": "refs/changes/34/60634/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1677086170,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/preinit-mounts/preinit-mounts/init",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -36
                },
                {
                    "file": "meta-phosphor/scripts/run-repotest",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 37
        }
    ]
}
{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "I2f651b15b1e1d04c62107709df5888abf7f9c046",
    "number": 58458,
    "subject": "add support for hpe's gxpfans",
    "owner": {
        "name": "Christopher Sides",
        "email": "christopher.sides@hpe.com",
        "username": "csides-hpe"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/58458",
    "hashtags": [],
    "createdOn": 1667503463,
    "lastUpdated": 1680727005,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1667503463,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1667503519,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1667503519,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1667503537,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/54613/ : FAILURE"
        },
        {
            "timestamp": 1667504337,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1667504414,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1667504414,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1667504426,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/54616/ : FAILURE"
        },
        {
            "timestamp": 1667504681,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Uploaded patch set 3: Commit message was updated."
        },
        {
            "timestamp": 1667504702,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1"
        },
        {
            "timestamp": 1667504716,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1667504744,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1667504744,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1667504833,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Patch Set 5: Commit message was updated."
        },
        {
            "timestamp": 1667504909,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1667504910,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/54617/ : ABORTED"
        },
        {
            "timestamp": 1667504914,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1 -Ok-To-Test"
        },
        {
            "timestamp": 1667505145,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/54618/ : SUCCESS"
        },
        {
            "timestamp": 1667863106,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1667872898,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1667875512,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1668715460,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1668717396,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1668723153,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1668726852,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1668728804,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1680553761,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1680727005,
            "reviewer": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "message": "Abandoned\n\nThis change has been superceeded by a new version that builds off the of_node/compatible suggestion made in the comments of this review."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "eb10cdd7b9c4695d58b85fcb33633e6ad467fd22",
            "parents": [
                "3fe3f54e8d57794f78662ad27517c24ead288142"
            ],
            "ref": "refs/changes/58/58458/1",
            "uploader": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "createdOn": 1667503463,
            "author": {
                "name": "Chris Sides",
                "email": "Christopher.Sides@hpe.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 20,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "7042f3aef1ef29fab7009d7b7ad7e82b42e361b9",
            "parents": [
                "3fe3f54e8d57794f78662ad27517c24ead288142"
            ],
            "ref": "refs/changes/58/58458/2",
            "uploader": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "createdOn": 1667504337,
            "author": {
                "name": "Chris Sides",
                "email": "Christopher.Sides@hpe.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 5
        },
        {
            "number": 3,
            "revision": "684ad73657dc1813a151bf09d6b4ec5d22c02f3b",
            "parents": [
                "3fe3f54e8d57794f78662ad27517c24ead288142"
            ],
            "ref": "refs/changes/58/58458/3",
            "uploader": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "createdOn": 1667504681,
            "author": {
                "name": "Chris Sides",
                "email": "Christopher.Sides@hpe.com",
                "username": ""
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 5
        },
        {
            "number": 4,
            "revision": "c2b3ad7d33c4fcc4e9e3e448666abba33a03732a",
            "parents": [
                "3fe3f54e8d57794f78662ad27517c24ead288142"
            ],
            "ref": "refs/changes/58/58458/4",
            "uploader": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "createdOn": 1667504716,
            "author": {
                "name": "Chris Sides",
                "email": "Christopher.Sides@hpe.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 5
        },
        {
            "number": 5,
            "revision": "f7736cbbc27e48ba14b48fb1a5ccf1f60b64e60d",
            "parents": [
                "3fe3f54e8d57794f78662ad27517c24ead288142"
            ],
            "ref": "refs/changes/58/58458/5",
            "uploader": {
                "name": "Christopher Sides",
                "email": "christopher.sides@hpe.com",
                "username": "csides-hpe"
            },
            "createdOn": 1667504833,
            "author": {
                "name": "Chris Sides",
                "email": "Christopher.Sides@hpe.com",
                "username": ""
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Christopher Sides",
                        "email": "christopher.sides@hpe.com",
                        "username": "csides-hpe"
                    },
                    "message": "looking into implementing a suggested non-HEP-specific change in fan handling..."
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Okay, so warning, this is entirely a drive-by comment as I haven't poked at the fan code much. However:\n\nI'd *much* prefer we query compatible attribute through the of_node symlink instead of using arbitrary driver name voodoo. As such it's not really a comment against this patch specifically as it just follows the pattern of the existing code, but I still think we can do better. I'd prefer we fix the approach first and *then* add support for the GXP fan controller using the fixed approach.\n\nThat said, it's also concerning that we need to know the type of the fan controller..."
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> That said, it's also concerning that we need to know the type of the fan controller...\n\nhttps://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/50430\n\nWe don't actually use it for anything.  \"Aspeed\" was just a naming poor choice made in EM to differentiate the built-in PWM drivers from say, a MAX3318,  Really we should've called it SOC or something.\n\nNot sure if we want to try to fix it here though."
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "> Aspeed\" was just a naming poor choice made in EM to differentiate the built-in PWM drivers from say, a MAX3318,  Really we should've called it SOC or something.\n\nEven then it doesn't feel quite right? I suspect what we care about is the controller's association with specific fans in the cooling zone topology, not whether it's a controller in the SoC or hanging off some I2C bus?"
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Christopher Sides",
                        "email": "christopher.sides@hpe.com",
                        "username": "csides-hpe"
                    },
                    "message": "Thanks for the commentary! I've been digging deeper some of the details on sensor handling, and started looking into what it would take to switch to using of_node/comparability checks as suggested.\n\nOne issue I'm running into: I'm not having much luck so far figuring out what 'compatible' string we'd want to check to identify Aspeed and Nuvoton devices.\n\nFor GXP fans, the compatible string is called out with an obviously named \"hpe,gxp-fan-ctrl\" inside a GXP.dts \n\nAny thoughts on where I should be looking to find compatibility info for Aspeed and Nuvoton?"
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Christopher Sides",
                        "email": "christopher.sides@hpe.com",
                        "username": "csides-hpe"
                    },
                    "message": "Followup: my current assumption is that anything with \"Aspeed,*\" would be considered Aspeed. \n\nI'm basing this one the usages of \"Aspeed, *\" here;\nhttps://github.com/openbmc/meta-bytedance/blob/master/meta-g220a/recipes-kernel/linux/linux-aspeed/0004-ARM-dts-aspeed-Add-uart-routing-node.patch\n\nWould \"Nuvoton, *\" handle for Nuvoton devices?\n\nbut clearly I'm still missing some pieces re: usage of Aspeed and Nuvoton naming, so any links to more info on the subject are also appreciated!"
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Another option is name property, example /sys/class/hwmon/xxx/name"
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "> Any thoughts on where I should be looking to find compatibility info for Aspeed and Nuvoton?\n\nSure, this is in the devicetree binding documentation, which is required for every piece of devicetree-supported hardware that has a kernel driver:\n\n* https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/devicetree/bindings/hwmon/aspeed-pwm-tacho.txt?h=v6.1-rc5#n22\n\n* https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/devicetree/bindings/hwmon/npcm750-pwm-fan.txt?h=v6.1-rc5#n9\n\n> Another option is name property, example /sys/class/hwmon/xxx/name\n\nI strongly prefer we don't do this. The name is arbitrarily chosen by the driver[1], compatible strings are well-defined and always identify the hardware, which seems to be what we're trying to do here.\n\n[1] https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/ABI/testing/sysfs-class-hwmon?h=v6.1-rc5#n1"
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Christopher Sides",
                        "email": "christopher.sides@hpe.com",
                        "username": "csides-hpe"
                    },
                    "message": "That's very helpful, thanks! (both for the links, and the discussion on the whys or why nots for alternative paths)"
                },
                {
                    "file": "src/FanMain.cpp",
                    "line": 78,
                    "reviewer": {
                        "name": "Christopher Sides",
                        "email": "christopher.sides@hpe.com",
                        "username": "csides-hpe"
                    },
                    "message": "I've created a proposed change to using of_node/compatible here: https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/62006\n\nAny further suggestions or thoughts are extremely welcome- figuring out how all this works in the context of openbmc has been a fantastic learning experience :)"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 5
        }
    ]
}
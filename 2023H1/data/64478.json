{
    "project": "openbmc/libpldm",
    "branch": "main",
    "topic": "ndebug-if-release",
    "id": "I24e05c09023a9fcf7eee9e79668c552f08b4b6dd",
    "number": 64478,
    "subject": "bios_table: Introduce pldm_bios_table_append_pad_checksum_check()",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@aj.id.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/libpldm/+/64478",
    "hashtags": [],
    "createdOn": 1687921622,
    "lastUpdated": 1688622212,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1687921622,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1687921646,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1687921646,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1687922401,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/69712/ : SUCCESS"
        },
        {
            "timestamp": 1687937166,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1687937193,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1687937194,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1687937454,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/69744/ : SUCCESS"
        },
        {
            "timestamp": 1688092818,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1688092841,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1688092842,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1688092926,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1688093219,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/69892/ : SUCCESS"
        },
        {
            "timestamp": 1688427871,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1688429687,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1688429712,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1688429712,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1688430088,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/69992/ : SUCCESS"
        },
        {
            "timestamp": 1688475342,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688527105,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688533125,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688535551,
            "reviewer": {
                "name": "sagar srinivas",
                "email": "sagar.srinivas@ibm.com",
                "username": "sagisin"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688535618,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688537199,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688540436,
            "reviewer": {
                "name": "sagar srinivas",
                "email": "sagar.srinivas@ibm.com",
                "username": "sagisin"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1688540859,
            "reviewer": {
                "name": "sagar srinivas",
                "email": "sagar.srinivas@ibm.com",
                "username": "sagisin"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1688548921,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1688554264,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1688554285,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1688554285,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1688554669,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/70142/ : SUCCESS"
        },
        {
            "timestamp": 1688618969,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1688621791,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1688622212,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "1c5dba7b112e779ce2fcf3fa60dc60c8ae48ce4f",
            "parents": [
                "902723f1a09b1f2d507bc92876a9a190df6ba31c"
            ],
            "ref": "refs/changes/78/64478/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1687921622,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -10
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 12
        },
        {
            "number": 2,
            "revision": "7daa21c7ec3c465f80716f60dab9f4c0dba68ae2",
            "parents": [
                "902723f1a09b1f2d507bc92876a9a190df6ba31c"
            ],
            "ref": "refs/changes/78/64478/2",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1687937166,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -10
                },
                {
                    "file": "CHANGELOG.md",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 12
        },
        {
            "number": 3,
            "revision": "73c82bc564e6f3a552f697644a47d143b22de387",
            "parents": [
                "0088a6ae4cec3eb2e8e4dece6fb54e535111790c"
            ],
            "ref": "refs/changes/78/64478/3",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1688092818,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 666,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Not correct. This should be:\n\n> PLDM_SUCCESS on success."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 666,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -10
                },
                {
                    "file": "CHANGELOG.md",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 12
        },
        {
            "number": 4,
            "revision": "bd2012f8a0039459272c8eaca6e0e2dabe0bd826",
            "parents": [
                "0088a6ae4cec3eb2e8e4dece6fb54e535111790c"
            ],
            "ref": "refs/changes/78/64478/4",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1688429687,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 659,
                    "reviewer": {
                        "name": "ManojKiran Eda",
                        "email": "manojkiran.eda@gmail.com",
                        "username": "manojkiraneda"
                    },
                    "message": "we need to also update the doxygen to reflect the new changes (if they are needed)."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 659,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Ah yep. Good catch."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 659,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/bios_table.c",
                    "line": 920,
                    "reviewer": {
                        "name": "sagar srinivas",
                        "email": "sagar.srinivas@ibm.com",
                        "username": "sagisin"
                    },
                    "message": "are we still asserting?"
                },
                {
                    "file": "src/bios_table.c",
                    "line": 920,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "For `pldm_bios_table_append_pad_checksum()` yes, because we must maintain its behaviour, which is to `assert()` on error.\n\nWe define a new function, `pldm_bios_table_append_pad_checksum_check()` which does not assert(), and implement `pldm_bios_table_append_pad_checksum()` in terms of `pldm_bios_table_append_pad_checksum_check()`. That means asserting that the result of `pldm_bios_table_append_pad_checksum_check()` is success, because if it isn't then the previous implementation of `pldm_bios_table_append_pad_checksum()` would have asserted.\n\nConsumers of libpldm that don't want the `assert()` behaviour of `pldm_bios_table_append_pad_checksum()` must migrate to using `pldm_bios_table_append_pad_checksum_check()` instead.\n\nHowever, note that all `assert()` calls are elided by passing `-DNDEBUG` in `CFLAGS` (which is how `meson` configures the build if you pass `-Db_ndebug=true` to `meson setup`). See `man 3 assert`:\n\n> If the macro NDEBUG is defined at the moment <assert.h> was last\n> included, the macro assert() generates no code, and hence does\n> nothing at all.  It is not recommended to define NDEBUG if using\n> assert() to detect error conditions since the software may behave\n> non-deterministically.\n\nhttps://www.man7.org/linux/man-pages/man3/assert.3.html\n\nIf `pldm_bios_table_append_pad_checksum()` is invoked on a build where `-DNDEBUG` was passed then the behaviour will be undefined as the application won't be prevented from using an invalid result. Previously the assert() would have prevented that, but it will have been removed during pre-processing.\n\nSo before we can set `b_ndebug=if-release` in `meson.build` we must tag a release of libpldm where all the `*_check()` functions have been stabilised, all users in the OpenBMC ecosystem have been migrated to the `*_check()` functions, and all the deprecated \"unchecked\" functions have been removed. Once that's done we can merge the patch to set `b_ndebug=if-release` by default as there can no longer be any users relying on `assert()` in libpldm to avoid erroneous results."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 920,
                    "reviewer": {
                        "name": "sagar srinivas",
                        "email": "sagar.srinivas@ibm.com",
                        "username": "sagisin"
                    },
                    "message": "the previous assert was if `size >= total_length` but now the behaviour has changed to assert if `rc == PLDM_SUCCESS` thats not the same as the previous behaviour?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -10
                },
                {
                    "file": "CHANGELOG.md",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 67,
            "sizeDeletions": 12
        },
        {
            "number": 5,
            "revision": "044ee19a7a07f450204159b97373a80321cfe2dc",
            "parents": [
                "0088a6ae4cec3eb2e8e4dece6fb54e535111790c"
            ],
            "ref": "refs/changes/78/64478/5",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1688554264,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -10
                },
                {
                    "file": "CHANGELOG.md",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 69,
            "sizeDeletions": 14
        }
    ]
}
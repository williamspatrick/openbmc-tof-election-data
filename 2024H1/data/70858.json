{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Icdd7507683935678e725a90d6ab17fa3761d536d",
    "number": 70858,
    "subject": "Allow setup script to follow symlinked layers.",
    "owner": {
        "name": "Ian Woloschin",
        "email": "ian.woloschin@hpe.com",
        "username": "iwoloschin"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/70858",
    "hashtags": [],
    "createdOn": 1713293746,
    "lastUpdated": 1713393021,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1713293746,
            "reviewer": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1713293790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1713293790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1713293799,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/22612/"
        },
        {
            "timestamp": 1713295128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/22612/ : SUCCESS"
        },
        {
            "timestamp": 1713295137,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1713296576,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1713299786,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1713300443,
            "reviewer": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1713300906,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1713302298,
            "reviewer": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1713303831,
            "reviewer": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1713303931,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1713303931,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1713303940,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/22616/"
        },
        {
            "timestamp": 1713307170,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/22616/ : SUCCESS"
        },
        {
            "timestamp": 1713307178,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1713308626,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1713311930,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1713312089,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1713362465,
            "reviewer": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1713392763,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1713393021,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "59d37eae109b04a33f0ea911269d6cd722f7e27c",
            "parents": [
                "5f725958b7d5c0d59c3802d1dd0468f70097ddc8"
            ],
            "ref": "refs/changes/58/70858/1",
            "uploader": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "createdOn": 1713293746,
            "author": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "What is the utility of doing this?  We don't have any symlinks."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ian Woloschin",
                        "email": "ian.woloschin@hpe.com",
                        "username": "iwoloschin"
                    },
                    "message": "For better or worse HPE is using symlinks to organize layers that at this time cannot be upstreamed. Allowing the setup script to follow symlinks would help us, and potentially others in the same situation. The alternative is that we fork this script (essentially what has been done already), something I'd like to pull back on whenever possible in an effort to make upstreaming easier as we get approval to do so (that topic is a separate discussion)."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Symlinks to where?  Outside the repo?\n\nMaybe you can add some of these details into the commit message."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ian Woloschin",
                        "email": "ian.woloschin@hpe.com",
                        "username": "iwoloschin"
                    },
                    "message": "I've got a repo that has a few layers that cannot be upstreamed at this time, but potentially could in the future. The OpenBMC repo is included as a git submodule, with symlinks created inside the submodule to the external layers. A modified version of the setup script is also copied in to handle the symlinks.\n\nI'm sure this is not the best way to organize OpenBMC & external layers, but it is the way my project is currently set up.\n\nI'll add something to the commit message describe this."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Hmm, that seems a bit inverted from what I would have expected -- when I was temporarily pulling in a third-party meta-layer for Rust support before it was added upstream, I kept the extra yocto layer as a submodule of the OpenBMC repo rather than the other way around.  (I realize switching is likely non-trivial and of course don't know the exact details of your scenario, but maybe something to consider?)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ian Woloschin",
                        "email": "ian.woloschin@hpe.com",
                        "username": "iwoloschin"
                    },
                    "message": "@Zev,\n\nI think the difference is that in your case, you were (presumably!) not doing any work in the meta-rust layer? I did something similar in that timeframe myself (and back then I was doing my work in a local-only branch of OpenBMC which had another set of fun issues...). The scenario now is that work is being done in the superproject and OpenBMC itself is being pinned as a dependency. I agree this is not ideal, but it is the current scenario that I must work with."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Ah, yeah I suppose if you're editing the external layers a lot more frequently than you're updating the openbmc repo itself then the constant submodule updates would add a lot of overhead, so I can see how that might not work so well."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "setup",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 20,
            "sizeDeletions": 5
        },
        {
            "number": 2,
            "revision": "71cf70003ce8e1448309e6f193fc4f2882b13276",
            "parents": [
                "5f725958b7d5c0d59c3802d1dd0468f70097ddc8"
            ],
            "ref": "refs/changes/58/70858/2",
            "uploader": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "createdOn": 1713303831,
            "author": {
                "name": "Ian Woloschin",
                "email": "ian.woloschin@hpe.com",
                "username": "iwoloschin"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Since they seem entirely orthogonal, I think it'd be preferable to do the `command -v` change and the `find -L` change in separate commits.  (For example, so if one turns out to be buggy for some reason or something we can revert it without affecting the other.)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Hmm, though regarding the `command -v` bit, it occurs to me now that this will break if the user sourcing the script happens to have any of the commands it's used on set as aliases in their shell...\n\n```\n$ command -v cat\n/usr/bin/cat\n$ command -v ls\nalias ls='ls --color=auto'\n```"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ian Woloschin",
                        "email": "ian.woloschin@hpe.com",
                        "username": "iwoloschin"
                    },
                    "message": "I can remove the `command -v` bits. I wasn't going \"fix\" that but in a private discussion with another maintainer they suggested \"fixing\" both issues at once.\n\nI don't use aliases myself so I hadn't even thought to test that."
                },
                {
                    "file": "setup",
                    "line": 48,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Hmm...not sure it'd ever be likely to matter much, but if `-H` would work instead of `-L` it seems like it'd be a slightly smaller change in behavior, less of a big-hammer?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "setup",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 22,
            "sizeDeletions": 5
        }
    ]
}
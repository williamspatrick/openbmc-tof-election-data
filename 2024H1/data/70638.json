{
    "project": "openbmc/phosphor-user-manager",
    "branch": "master",
    "id": "I124bed51e6e7652d648c3d20319e99ef48dde46e",
    "number": 70638,
    "subject": "user-mgr: Allow non-IPMI usernames with dot '.' character",
    "owner": {
        "name": "Marco Kawajiri",
        "email": "kawajirimarco@googlemail.com",
        "username": "kawmarco"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-user-manager/+/70638",
    "hashtags": [],
    "createdOn": 1712343487,
    "lastUpdated": 1713759101,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1712343487,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1712343516,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712343516,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1712343530,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/82000/ : FAILURE"
        },
        {
            "timestamp": 1712343551,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1712343600,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712343600,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1712343922,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/82001/ : SUCCESS"
        },
        {
            "timestamp": 1712349061,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1712349066,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1712351275,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1712351303,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1712351341,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712351341,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1712351676,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/82007/ : SUCCESS"
        },
        {
            "timestamp": 1712530798,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1713201863,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1713201987,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1713280492,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1713539379,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1713539414,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1713539414,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1713539604,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/83102/ : SUCCESS"
        },
        {
            "timestamp": 1713543233,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1713543377,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1713544816,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1713759101,
            "reviewer": {
                "name": "Ratan Gupta",
                "email": "ratankgupta31@gmail.com",
                "username": "ratagupt"
            },
            "message": "Patch Set 4: Code-Review+2"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f9177734871588d58e3a2f163b92fef9d807d6ad",
            "parents": [
                "6a7c937267d52f31252a157154b90e53c22e9cd4"
            ],
            "ref": "refs/changes/38/70638/1",
            "uploader": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "createdOn": 1712343487,
            "author": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 37,
                    "deletions": 0
                },
                {
                    "file": "user_mgr.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -4
                },
                {
                    "file": "test/user_mgr_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 61,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "405fbad89b2b6f5d7ca7b70a394497f713eb7cac",
            "parents": [
                "6a7c937267d52f31252a157154b90e53c22e9cd4"
            ],
            "ref": "refs/changes/38/70638/2",
            "uploader": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "createdOn": 1712343551,
            "author": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "user_mgr.cpp",
                    "line": 128,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "nit: auto?"
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 128,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajirimarco@googlemail.com",
                        "username": "kawmarco"
                    },
                    "message": "Done"
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 235,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "One question I had when reading this is \"what if we change the group membership to include IPMI afterwards\".  Looks like this is covered already by line 530ish.\n\nI'm a little surprised that that code has an explicit check for ipmi before calling this one, but maybe there is some historical reason why."
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 239,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "nit: This could be implemented as:\n\n`bool isIpmiUser = std::ranges::contains(gruopNames, \"ipmi\")`"
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 239,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajirimarco@googlemail.com",
                        "username": "kawmarco"
                    },
                    "message": "Done"
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 263,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I wonder why the original author used `c_str()` here.  It doesn't seem necessary."
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 263,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajirimarco@googlemail.com",
                        "username": "kawmarco"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 37,
                    "deletions": 0
                },
                {
                    "file": "user_mgr.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -4
                },
                {
                    "file": "test/user_mgr_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 61,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "cfc9738f691ed43ae4e68aaed686eadfad40f64c",
            "parents": [
                "6a7c937267d52f31252a157154b90e53c22e9cd4"
            ],
            "ref": "refs/changes/38/70638/3",
            "uploader": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "createdOn": 1712351275,
            "author": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "How does this get encoded in the dbus path?\n\nFrom the dbus spec for object paths.\n\"Each element must only contain the ASCII characters \"[A-Z][a-z][0-9]_\"\n\nsdbusplus has mechanisms for doing encoding, but in testing we should be verifying correct encoding of these in dbus paths."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajirimarco@googlemail.com",
                        "username": "kawmarco"
                    },
                    "message": "Checking `dbus-monitor --system` output on `GET /redfish/v1/AccountService/Account/user_with.dot` shows:\n\n```\n...\n    dict entry(\n         object path \"/xyz/openbmc_project/user/_75ser_5fwith_2edot\"\n         array [\n            dict entry(\n               string \"org.freedesktop.DBus.Peer\"\n               array [\n               ]\n            )\n...\n```\n\nCompared to a user without dot:\n```\n      dict entry(\n         object path \"/xyz/openbmc_project/user/user_kawajiri\"\n```\n\nI'm still familiarising myself with dbus but it looks like it's escaping usernames with the dot character"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Right.....  but now you've tested that \ud83d\ude0a\n\nWe should probably test that Redfish AccountService/SessionService works correctly too.  Based on coding standards, I'd assume it does, but we don't want to break anything.  If that's not something you can test, I can pull this down and try it."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 26,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Please test some non conforming names.  The code has a bug that (assuming I read the code right) would've been apparent if we'd done some negative testing on this."
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 128,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": ". in this context means any character, which I'm certain you didn't intend.  I'm guessing you intended to escape it to mean literal period."
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 128,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Should we put variables inline in the code, so we're compiling the regex on the first time we need it, rather than on every startup (when we'd like daemon startup to be \"fast\")."
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 128,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajirimarco@googlemail.com",
                        "username": "kawmarco"
                    },
                    "message": "> . in this context means any character\n\nIt's in a character set scope `[]`, so it matches a literal dot character. I'll add some unit tests/cases in the Testing section to make this clearer though.\n\n> Should we put variables inline in the code, so we're compiling the regex on the first time we need it, rather than on every startup \n\nFair, will change \ud83d\udc4d"
                },
                {
                    "file": "user_mgr.cpp",
                    "line": 128,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Ah, good point on the character class.  I missed that."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 37,
                    "deletions": 0
                },
                {
                    "file": "user_mgr.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -4
                },
                {
                    "file": "test/user_mgr_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 4
        },
        {
            "number": 4,
            "revision": "fe73ae8b829796093162429071dc085b38bd7545",
            "parents": [
                "6a7c937267d52f31252a157154b90e53c22e9cd4"
            ],
            "ref": "refs/changes/38/70638/4",
            "uploader": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "createdOn": 1713539379,
            "author": {
                "name": "Marco Kawajiri",
                "email": "kawajirimarco@googlemail.com",
                "username": "kawmarco"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 43,
                    "deletions": 0
                },
                {
                    "file": "user_mgr.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -4
                },
                {
                    "file": "test/user_mgr_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 81,
            "sizeDeletions": 4
        }
    ]
}
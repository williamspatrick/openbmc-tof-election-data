{
    "project": "openbmc/webui-vue",
    "branch": "master",
    "id": "I83c47128bf440d7e279765382d7f0a4da514f73c",
    "number": 69137,
    "subject": "Add kvm connection retries",
    "owner": {
        "name": "Konstantin Maskov",
        "email": "sulwirld@gmail.com",
        "username": "BlueSnake00"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/webui-vue/+/69137",
    "hashtags": [],
    "createdOn": 1706789496,
    "lastUpdated": 1714642332,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1706789496,
            "reviewer": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1706789525,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1706789790,
            "reviewer": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1706789818,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1707745434,
            "reviewer": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1707745445,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707745445,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1707745531,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79108/ : SUCCESS"
        },
        {
            "timestamp": 1708544263,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1709536726,
            "reviewer": {
                "name": "Konstantin Maskov",
                "username": "kmaskov"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1709536914,
            "reviewer": {
                "name": "Konstantin Maskov",
                "username": "kmaskov"
            },
            "message": "Patch Set 4: Commit message was updated.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709536947,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709536947,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1709537044,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80112/ : SUCCESS"
        },
        {
            "timestamp": 1709537305,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709537305,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1709537305,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709537305,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1709537406,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80113/ : SUCCESS"
        },
        {
            "timestamp": 1709538992,
            "reviewer": {
                "name": "Michael Xie",
                "email": "xiexinnan@bytedance.com",
                "username": "MichaelXie98"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1709539236,
            "reviewer": {
                "name": "Konstantin Maskov",
                "username": "kmaskov"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1709545502,
            "reviewer": {
                "name": "Michael Xie",
                "email": "xiexinnan@bytedance.com",
                "username": "MichaelXie98"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1709888039,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1710202837,
            "reviewer": {
                "name": "Ivan Mikhaylov",
                "email": "fr0st61te@gmail.com",
                "username": "fr0st61te"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1710332265,
            "reviewer": {
                "name": "Konstantin Maskov",
                "username": "kmaskov"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1714642259,
            "reviewer": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1714642309,
            "reviewer": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1714642332,
            "reviewer": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "message": "Abandoned"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "30e032fa9da95acad40fd4468a5d219f6515f9c1",
            "parents": [
                "1b417cd406ce65401dcb8d695fe5424287092cb1"
            ],
            "ref": "refs/changes/37/69137/1",
            "uploader": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "createdOn": 1706789496,
            "author": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "src/views/Operations/Kvm/KvmConsole.vue",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -22
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 22
        },
        {
            "number": 2,
            "revision": "d826f19aa8ecc5baeded81bd0042a5ef38fa77d0",
            "parents": [
                "1b417cd406ce65401dcb8d695fe5424287092cb1"
            ],
            "ref": "refs/changes/37/69137/2",
            "uploader": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "createdOn": 1706789790,
            "author": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "src/views/Operations/Kvm/KvmConsole.vue",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -22
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 22
        },
        {
            "number": 3,
            "revision": "e89c64e8a1d8485c7769d84b73e82919f11de35b",
            "parents": [
                "1b417cd406ce65401dcb8d695fe5424287092cb1"
            ],
            "ref": "refs/changes/37/69137/3",
            "uploader": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "createdOn": 1707745434,
            "author": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "How was 5 chosen? \nWhy isn't it always successful ?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Konstantin Maskov",
                        "username": "kmaskov"
                    },
                    "message": "Sometimes web interface couldn't connect to kvm from first attempt, and we're trying to reconnect for isolating this problem.\n\nNumber of reconnection attempts is discussable.\nAll of this just about guaranty of accessibility of kvm from first attempt."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Michael Xie",
                        "email": "xiexinnan@bytedance.com",
                        "username": "MichaelXie98"
                    },
                    "message": "I also encountered kvm connection fail. But it seems kvm fail has something to do with obmc-ikvm and libvncserver. I am getting some rfb error from chrome. I'm curious what kind of behavior you saw."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Konstantin Maskov",
                        "username": "kmaskov"
                    },
                    "message": "yeah, same errors."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Michael Xie",
                        "email": "xiexinnan@bytedance.com",
                        "username": "MichaelXie98"
                    },
                    "message": "I am sure that this problem occurs when the kvm client is opened or when the resolution is changed. There are two possible cause: \n1. There are two threads in obmc-ikvm that will modify cl->updatebuf at the same time, resulting in some incorrect data. I am sure this will cause obmc-ikvm to crash. But I am not sure this will cause the front end to disconnect kvm.\n2. obmc-ikvm send new frame too quickly after send resolution change to front-end. I am not sure what happened in front-end because I do not know anything about js/vus.\n\nAfter add thread protection for cl->updatebuf and skipping few frames when resizing and opening new client I can not see any kvm disconnect."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ivan Mikhaylov",
                        "email": "fr0st61te@gmail.com",
                        "username": "fr0st61te"
                    },
                    "message": "Is it already fixed? cl->updatebuff is part of obmc-ikvm code?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Konstantin Maskov",
                        "username": "kmaskov"
                    },
                    "message": "Can you give us code snippet where you added thread protection?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "src/views/Operations/Kvm/KvmConsole.vue",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -22
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 22
        },
        {
            "number": 4,
            "revision": "f7c448d8bc504e9f01d0430f1b809f4c3fa0ad8f",
            "parents": [
                "1b417cd406ce65401dcb8d695fe5424287092cb1"
            ],
            "ref": "refs/changes/37/69137/4",
            "uploader": {
                "name": "Konstantin Maskov",
                "username": "kmaskov"
            },
            "createdOn": 1709536914,
            "author": {
                "name": "Konstantin Maskov",
                "email": "sulwirld@gmail.com",
                "username": "BlueSnake00"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "Can you answer here why we need this?\nHow was 5 chosen? How was the 2 second retry chosen?\nWhy isn't KVM always successful?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Konstantin Maskov",
                        "email": "sulwirld@gmail.com",
                        "username": "BlueSnake00"
                    },
                    "message": "I will resubmit this change due to issues with my gerrit account and local repo.\nhttps://gerrit.openbmc.org/c/openbmc/webui-vue/+/71225\n\nNumber of retries and the timeout are discussible.\nIt's all just about reconnecting to Kvm if the connection is failed for whatever reason."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Konstantin Maskov",
                        "email": "sulwirld@gmail.com",
                        "username": "BlueSnake00"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "src/views/Operations/Kvm/KvmConsole.vue",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -22
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 22
        }
    ]
}
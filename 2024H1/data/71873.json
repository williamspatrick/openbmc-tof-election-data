{
    "project": "openbmc/sdbusplus",
    "branch": "master",
    "id": "I75deec77f4434e671fe5028cad14fd9998cf9b40",
    "number": 71873,
    "subject": "Use asio object_server without boost::coroutine",
    "owner": {
        "name": "Ed Tanous",
        "email": "ed@tanous.net",
        "username": "edtanous"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/sdbusplus/+/71873",
    "hashtags": [],
    "createdOn": 1717721072,
    "lastUpdated": 1718753258,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1717721072,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1717721110,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1717721111,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1717721283,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/85597/ : FAILURE"
        },
        {
            "timestamp": 1717724286,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1717724316,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1717724316,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1717724722,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/85602/ : SUCCESS"
        },
        {
            "timestamp": 1717726847,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/85603/ : SUCCESS"
        },
        {
            "timestamp": 1717743213,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717878192,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718056660,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1718078052,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718078511,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718088945,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718126087,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718670860,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718676229,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718753253,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1718753258,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 03b2c26c8d0b97e943a0418378abbe4828184423"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d5b9e46f93751bfd0f8a6573753bfe12666c4467",
            "parents": [
                "1a39b64fafa18f03c62e5cbc6cd0d2da2cc6ed6d"
            ],
            "ref": "refs/changes/73/71873/1",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1717721072,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "75aa316d2542b06d6050cf64813d4e80786bba67",
            "parents": [
                "1a39b64fafa18f03c62e5cbc6cd0d2da2cc6ed6d"
            ],
            "ref": "refs/changes/73/71873/2",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1717724286,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "A quick question: where is this `SDBUSPLUS_DISABLE_BOOST_COROUTINES` defined?\nIt's not in sdbusplus repo, but I find it in bmcweb.\n\nWhat will happen if sdbusplus does not define the macro, and a user like bmcweb defines the macro?"
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> A quick question: where is this `SDBUSPLUS_DISABLE_BOOST_COROUTINES` defined?\n\nIn any repo that wants to avoid the cotourine dependency.\n\n> It's not in sdbusplus repo, but I find it in bmcweb.\n> \n> What will happen if sdbusplus does not define the macro, and a user like bmcweb defines the macro?\n\nThen the feature will be disabled, coroutine support will not be available."
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "nitpick: Usually I prefer the \"positive\" macro names instead of \"negative\" ones.\nSo suggest\n1. Defining `SDBUSPLUS_ENABLE_BOOST_COROUTINES` and enable it by default;\n2. Document it;\n3. Users of sdbusplus could un-define it if it does not want it.\n\n\n`#ifdef SDBUSPLUS_ENABLE_BOOST_COROUTINES` reads more straightforward than `#ifndef SDBUSPLUS_DISABLE_BOOST_COROUTINES`."
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> nitpick: Usually I prefer the \"positive\" macro names instead of \"negative\" ones.\n> So suggest\n> 1. Defining `SDBUSPLUS_ENABLE_BOOST_COROUTINES` and enable it by default;\n> 2. Document it;\n> 3. Users of sdbusplus could un-define it if it does not want it.\n> \n> \n> `#ifdef SDBUSPLUS_ENABLE_BOOST_COROUTINES` reads more straightforward than `#ifndef SDBUSPLUS_DISABLE_BOOST_COROUTINES`.\n\nThat's a fair comment about Enable being easier to read;  Unfortunately SDBUSPLUS_DISABLE_BOOST_COROUTINES already exists in the codebase.  It would be a refactor to all coroutine daemons to go add an enable flag, which we could do, I just don't think it's worth the effort.\n\nWhat do you think?\n\nWhat kind of documentation were you looking for?  I was trying to avoid writing:\n\nSDBUSPLUS_DISABLE_BOOST_COROUTINES: Disables support for boost coroutines.\n\nbecause that seemed redundant."
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": ">  It would be a refactor to all coroutine daemons to go add an enable flag, which we could do, I just don't think it's worth the effort.\n\nIf the only user for now is `bmcweb` (which is what I see), I think it's easy to update both bmcweb and sdbusplus.\nIf there are other users, then I guess we have to keep the current code to keep compatibility."
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Inverting this flag would require setting this in all daemons that use coroutines.  I can take that under advisement, but that would be a very different change than just extending this flag.\n\nAgain, this flag is already supported:\nhttps://github.com/openbmc/sdbusplus/blob/1a39b64fafa18f03c62e5cbc6cd0d2da2cc6ed6d/include/sdbusplus/asio/connection.hpp#L28\n\nThis change just allows it to apply to more headers.  Inverting it IMO should go into a different patch, because it would change the default.  I do agree that this coroutine stuff should probably be disabled by default, but I'm not prepared to push that change at this time."
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "@Lei?  Does the above make sense to you?"
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "It's OK to merge this as-is.\nBut I would suggest introducing future changes to change the config to something like `SDBUSPLUS_ENABLE_BOOST_COROUTINES` in both `sdbusplus` and `bmcweb`."
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "If we did that, bmcweb wouldn't be involved, but a number of other repos would be involved.  i will keep that in mind.\n\nThank you for the review."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "03b2c26c8d0b97e943a0418378abbe4828184423",
            "parents": [
                "3baa3045a4467d4326474dcc0ebdd53d2c31c02f"
            ],
            "ref": "refs/changes/73/71873/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1718753258,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/asio/object_server.hpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 0
        }
    ]
}
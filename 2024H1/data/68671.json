{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Id3c40beda9f290d36565f0e8e146be772c9a9983",
    "number": 68671,
    "subject": "meta-facebook: fix ipv6-ll address",
    "owner": {
        "name": "PL",
        "email": "potin.lai@quantatw.com",
        "username": "potinlai"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/68671",
    "hashtags": [],
    "createdOn": 1704802187,
    "lastUpdated": 1705609131,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1704802187,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1704802252,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1704802252,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1704802258,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/21162/"
        },
        {
            "timestamp": 1704804116,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/21162/ : SUCCESS"
        },
        {
            "timestamp": 1704804128,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1704805224,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Failed \n\nIBM Hardware CI : witherspoon hardware test failed"
        },
        {
            "timestamp": 1704807904,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1704828031,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1704849107,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1704954318,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1704954383,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1704954384,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1704954390,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/21198/"
        },
        {
            "timestamp": 1704955478,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/21198/ : SUCCESS"
        },
        {
            "timestamp": 1704955491,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1704956309,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\nThis change is ready for review."
        },
        {
            "timestamp": 1704956822,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1704994911,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1705388200,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1705388267,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1705388267,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1705388273,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/21269/"
        },
        {
            "timestamp": 1705389106,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/21269/ : SUCCESS"
        },
        {
            "timestamp": 1705389117,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1705390472,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1705609121,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1705609125,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1705609131,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as aaa738530c395bb050994301074d591c6eb97f4a"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "69eaea88cc1a47d2ce1ae947b2e4df3ed6174d2a",
            "parents": [
                "a271c7c192b9630a0d2fa1ed6813e3c1bd9ed0c4"
            ],
            "ref": "refs/changes/71/68671/1",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1704802187,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This seems like it would be an issue that affect all NC-SI NICs, not just Harma, right?\n\nI suspect this is the same problem as was fixed upstream in the kernel under https://lore.kernel.org/all/20230828101151.684010399@linuxfoundation.org/ .  I don't know if this is back-ported to 6.6, but if it is, I also sent support for NC-SI 1.3 upstream (in 6.7 now, I think) but didn't add the equivalent fix as this.  Can you see if this can all be fixed in the kernel?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "The patch you mentioned is already back ported\nhttps://github.com/openbmc/linux/commit/790071347a0a1a89e618eedcd51c687ea783aeb3\n\nWe saw the MAC address is assigned correctlly, but ipv6-ll address is not regenerated when MAC address changed, this is why we need this workaround to fix ipv6-ll address."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "@Patrick, I moved the changes to facebook common layer because I think this is needed by both harma and yosemitev4."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> The patch you mentioned is already back ported\n\nThe OEM NC-SI handling path has support (the backport) but the new NC-SI 1.3 path does not.  We probably still need some kernel change there.\n\n> We saw the MAC address is assigned correctlly, but ipv6-ll address is not regenerated when MAC address changed, this is why we need this workaround to fix ipv6-ll address.\n\nWe could reach out to the contributor, but my understanding was that the MAC was updated, but it wasn't properly causing the notifications that eventually go to userspace.\n\nWhat code _should_ be responsible for updating the LL address?  Should this be in the kernel or in the systemd-networkd?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 46,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-harma/network-wait-ipv6-ll/network-wait-ipv6-ll/network-wait-ipv6-ll@.service",
                    "type": "ADDED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-harma/network-wait-ipv6-ll/network-wait-ipv6-ll_0.1.bb",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-harma/network-wait-ipv6-ll/network-wait-ipv6-ll/check-ipv6-ll",
                    "type": "ADDED",
                    "insertions": 71,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/images/fb-harma-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 158,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "f24ad71a91540c09456571a5fd326a064e100092",
            "parents": [
                "3edfe0f03278a8f19bb0cda078461a4e0b915ed8"
            ],
            "ref": "refs/changes/71/68671/2",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1704954318,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 46,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll/check-ipv6-ll",
                    "type": "ADDED",
                    "insertions": 71,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/conf/machine/include/facebook-ncsi-nic.inc",
                    "type": "ADDED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll_0.1.bb",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-phosphor/images/fb-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/conf/machine/harma.conf",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll/network-wait-ipv6-ll@.service",
                    "type": "ADDED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 158,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "ff83f9ebd96b3ef3635f083015adcebb244b700e",
            "parents": [
                "8a4267b756cd3dadf58a01d1c96764f8d80077ee"
            ],
            "ref": "refs/changes/71/68671/3",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1705388200,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'd like us to still investigate how to do this properly.  It seems to me like something is missing at a kernel or systemd-networkd level.  Merging this as-is for now."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 46,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll/check-ipv6-ll",
                    "type": "ADDED",
                    "insertions": 71,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/conf/machine/include/facebook-ncsi-nic.inc",
                    "type": "ADDED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll_0.1.bb",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-phosphor/images/fb-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/conf/machine/harma.conf",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll/network-wait-ipv6-ll@.service",
                    "type": "ADDED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 158,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "aaa738530c395bb050994301074d591c6eb97f4a",
            "parents": [
                "f528fa431e650c1084b2faeae5e6abce97a051b0"
            ],
            "ref": "refs/changes/71/68671/4",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1705609131,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 46,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll/check-ipv6-ll",
                    "type": "ADDED",
                    "insertions": 71,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/conf/machine/include/facebook-ncsi-nic.inc",
                    "type": "ADDED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll_0.1.bb",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-phosphor/images/fb-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/conf/machine/harma.conf",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/recipes-fb/network-wait-ipv6-ll/network-wait-ipv6-ll/network-wait-ipv6-ll@.service",
                    "type": "ADDED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 158,
            "sizeDeletions": 0
        }
    ]
}
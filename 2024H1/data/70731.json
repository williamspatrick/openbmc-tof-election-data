{
    "project": "openbmc/pldm",
    "branch": "master",
    "id": "Ied6f1942c52210124c20d807be70843a3c5fe721",
    "number": 70731,
    "subject": "fw_update: Support discover Downstream Devices",
    "owner": {
        "name": "DelphineCCChiu",
        "email": "Delphine_CC_Chiu@wiwynn.com",
        "username": "DelphineCCChiu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/pldm/+/70731",
    "hashtags": [],
    "createdOn": 1712758070,
    "lastUpdated": 1723619920,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1712758070,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1712758102,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712758102,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1712758121,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/82344/ : FAILURE"
        },
        {
            "timestamp": 1712759651,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1712759681,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712759682,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1712759733,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/82348/ : FAILURE"
        },
        {
            "timestamp": 1712765558,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1718963803,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1718963826,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1718963826,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1718963845,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/86578/ : FAILURE"
        },
        {
            "timestamp": 1718964215,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1718964241,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1718964241,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1718964302,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/86581/ : FAILURE"
        },
        {
            "timestamp": 1723104060,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1723104099,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1723104099,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1723104167,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/89385/ : FAILURE"
        },
        {
            "timestamp": 1723109160,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1723109404,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1723602489,
            "reviewer": {
                "name": "Chris Wang",
                "email": "chris.wang.wiwynn@gmail.com",
                "username": "chris-fs-wang"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1723619920,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0e205aff5177a824156f158f8a9d0bd095cd4632",
            "parents": [
                "cfefc15d0a19954eecd4691ec34de04436c2879c"
            ],
            "ref": "refs/changes/31/70731/1",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1712758070,
            "author": {
                "name": "Chris Wang",
                "email": "Chris_Wang@wiwynn.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "fw-update/test/inventory_manager_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 47,
                    "deletions": -1
                },
                {
                    "file": "fw-update/manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -1
                },
                {
                    "file": "fw-update/inventory_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 49,
                    "deletions": 0
                },
                {
                    "file": "common/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "fw-update/inventory_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 301,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 428,
            "sizeDeletions": 25
        },
        {
            "number": 2,
            "revision": "28dbf4a77906a2f1230c2a2236aa917a00271ca8",
            "parents": [
                "cfefc15d0a19954eecd4691ec34de04436c2879c"
            ],
            "ref": "refs/changes/31/70731/2",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1712759651,
            "author": {
                "name": "Chris Wang",
                "email": "Chris_Wang@wiwynn.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "This code has dependency to `https://gerrit.openbmc.org/c/openbmc/libpldm/+/70728`, please review the commit first."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "fw-update/test/inventory_manager_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 47,
                    "deletions": -1
                },
                {
                    "file": "fw-update/manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -1
                },
                {
                    "file": "fw-update/inventory_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 49,
                    "deletions": 0
                },
                {
                    "file": "common/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "fw-update/inventory_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 307,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 434,
            "sizeDeletions": 25
        },
        {
            "number": 3,
            "revision": "fc66e15895542172f945c69d40bab22e6c87e595",
            "parents": [
                "06b443ec20f0e9f6b268b46a422c9f6803e6ed5a"
            ],
            "ref": "refs/changes/31/70731/3",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1718963803,
            "author": {
                "name": "Chris Wang",
                "email": "Chris_Wang@wiwynn.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "fw-update/test/inventory_manager_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 47,
                    "deletions": -1
                },
                {
                    "file": "fw-update/manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -1
                },
                {
                    "file": "fw-update/inventory_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 54,
                    "deletions": 0
                },
                {
                    "file": "common/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "fw-update/inventory_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 307,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 439,
            "sizeDeletions": 25
        },
        {
            "number": 4,
            "revision": "3b3670b1544e85d00063308a1e7d9b64f0baeec1",
            "parents": [
                "06b443ec20f0e9f6b268b46a422c9f6803e6ed5a"
            ],
            "ref": "refs/changes/31/70731/4",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1718964215,
            "author": {
                "name": "Chris Wang",
                "email": "Chris_Wang@wiwynn.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "fw-update/test/inventory_manager_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 47,
                    "deletions": -1
                },
                {
                    "file": "fw-update/manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -1
                },
                {
                    "file": "fw-update/inventory_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 54,
                    "deletions": 0
                },
                {
                    "file": "common/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "fw-update/inventory_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 309,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 441,
            "sizeDeletions": 25
        },
        {
            "number": 5,
            "revision": "568820f7e1fbe0f3880a52cbdbc91b2b02172364",
            "parents": [
                "3c5486d41105d4ac7a84fbf36973b52059d9b6b6"
            ],
            "ref": "refs/changes/31/70731/5",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1723104060,
            "author": {
                "name": "Chris Wang",
                "email": "chris.wang.wiwynn@gmail.com",
                "username": "chris-fs-wang"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "Can we support checking whether the endpoint support PLDM Firmware Update type and Fru commands before call?\nIn the current implementation, the `discoverFDs` is always called regardless the terminus support Firmware Update type or not."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "About this commit, `QueryDownstreamDevices` is optional command as table `Table 16 \u2013 PLDM for Firmware Update Command Codes` in DSP0267 1.3.0. It is better to check the supported status of terminus for this type of command before calling."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Chris Wang",
                        "email": "chris.wang.wiwynn@gmail.com",
                        "username": "chris-fs-wang"
                    },
                    "message": "In my knowledge, the only way to check if the terminus supports the command is sending the command to it and check the CC it returned (please let me know if I was wrong). So I directly return the response if the CC was `PLDM_ERROR_UNSUPPORTED_PLDM_CMD`.\n\nPlease see the highlight comment I left with word \"Here\"."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Chris Wang",
                        "email": "chris.wang.wiwynn@gmail.com",
                        "username": "chris-fs-wang"
                    },
                    "message": "Hi, thanks for the review first.\n\nDo you mean it should check the supportness for the two types by send command `GetPLDMTypes` in PLDM base spec?\n\nAlso, it seems that the inventory_manager would not send any commands in PLDM for Fru spec (DSP0257), could you please let me know why we should check the supportness of Fru commands in here?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "The PLDM Base command GetPLDMTypes and GetPLDMCommands can be used to identify the supported PLDM types and supported PLDM commands supported by terminus.\nThose commands are mandatory so we can always know if the terminus support PLDM Fw update or not.\nWith that we don't need to send the fw commands if the terminus does not support the commands."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "> Hi, thanks for the review first.\n> \n> Do you mean it should check the supportness for the two types by send command `GetPLDMTypes` in PLDM base spec?\n\nYes. `GetPLDMTypes` and `GetPLDMCommands`, you can check these code https://github.com/openbmc/pldm/blob/3166ef23d9ffdc47d09afcea68d7a934c61a9f6c/platform-mc/terminus_manager.cpp#L303\n> \n> Also, it seems that the inventory_manager would not send any commands in PLDM for Fru spec (DSP0257), could you please let me know why we should check the supportness of Fru commands in here?"
                },
                {
                    "file": "fw-update/inventory_manager.cpp",
                    "line": 225,
                    "reviewer": {
                        "name": "Chris Wang",
                        "email": "chris.wang.wiwynn@gmail.com",
                        "username": "chris-fs-wang"
                    },
                    "message": "Here"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "fw-update/test/inventory_manager_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 47,
                    "deletions": -1
                },
                {
                    "file": "fw-update/manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -1
                },
                {
                    "file": "fw-update/inventory_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 54,
                    "deletions": 0
                },
                {
                    "file": "common/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "fw-update/inventory_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 309,
                    "deletions": -22
                }
            ],
            "sizeInsertions": 441,
            "sizeDeletions": 24
        }
    ]
}
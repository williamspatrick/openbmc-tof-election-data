{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I3599bb8419604d71684ce61ca992f4b87c1d3fa5",
    "number": 73203,
    "subject": "Fix 404 on Hypervisor Reset",
    "owner": {
        "name": "Gunnar Mills",
        "email": "gunnar@gmills.xyz",
        "username": "gtmills"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/73203",
    "hashtags": [],
    "createdOn": 1722371313,
    "lastUpdated": 1722445760,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1722371313,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1722371341,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Topic set to WIP"
        },
        {
            "timestamp": 1722371358,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1722371358,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1722371785,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1722373047,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/88871/ : SUCCESS"
        },
        {
            "timestamp": 1722373370,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1722373724,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nCopied Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR **changekind:NO_CODE_CHANGE** OR changekind:TRIVIAL_REBASE OR is:MIN\")\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1722373733,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Topic WIP removed"
        },
        {
            "timestamp": 1722373743,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1722373743,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1722375353,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/88877/ : SUCCESS"
        },
        {
            "timestamp": 1722443932,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1722445760,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d32ee477982109accc36a3cff4d776d73faa8e2c",
            "parents": [
                "fa2d6ae7034875a61314380295a88dc8abaa34a1"
            ],
            "ref": "refs/changes/03/73203/1",
            "uploader": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "createdOn": 1722371313,
            "author": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "This would be one of overlapping route cases.\nIt looks good to me."
                },
                {
                    "file": "redfish-core/lib/systems.hpp",
                    "line": 2874,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This is missing checks so it only gets enabled on IBM systems."
                },
                {
                    "file": "redfish-core/lib/systems.hpp",
                    "line": 2874,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "We don't have checks for \n\n    if (systemName == \"hypervisor\")\n    {\n        handleHypervisorSystemGet(asyncResp);\n        return;\n    }\n\n\nhttps://github.com/openbmc/bmcweb/blob/master/redfish-core/lib/systems.hpp#L3022 \n\nhypervisor isn't behind a compile flag.\n\nThis isn't putting out a link (that is done in hypervisor system), this is calling the correct function if the post is called on /redfish/v1/Systems/hypervisor/Actions/ComputerSystem.Reset/\n\nWe could \n1) follow the handleHypervisorSystemGet, and if /redfish/v1/Systems/hypervisor/ is requested, call that function. This seems reasonable to me.  \n2) have some call to \n```\n        *crow::connections::systemBus, \"xyz.openbmc_project.Settings\",\n        \"/xyz/openbmc_project/network/hypervisor\",\n        \"xyz.openbmc_project.Network.SystemConfiguration\", \n```\nto determine if this is a 404 or should call that method. Have an extra D-Bus call in there and extra code for I don't see much value.  \n3) Move the hypervisor under a meson option. I feel we move back and forth on this. Should the Redfish Tree be dynamically determined in cases like this? That was the original thought behind the call to Settings to determine if a hypervisor system should be there. \n\nI prefer #1, it is simpler and follows the dynamically building the tree."
                },
                {
                    "file": "redfish-core/lib/systems.hpp",
                    "line": 2874,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Should the Redfish Tree be dynamically determined in cases like this?\n\nTo be clear on the ideal, the Redfish tree should be determined for all resources of a type using the dbus inventory tree.  This is essentially what the multi-host guys are trying to do right now, but to my knowledge, that code doesn't exist, and I'm assuming nobody has the desire to make it happen.\n\nThe problem here is that the hypervisor stuff copy/pasted a bunch of code, (especially from ethernet), and didn't really handle the collection with inventory interfaces the way that would let us use the same code for both.  It does a check of a \"hostname\" property in settingsd instead of inventory, so it's not really something we can add to every single handler, nor is it something that scales beyond N = 1 hypervisor.\n\n\nFor #1, what happens if that is called on a non ibm system?  I'm assuming it returns 500 internal error, which per the guidelines is always a bug.\n\n\nI think for now we go with #3, with the stated desire that we'd like to converge at some point, but that probably won't happen until after multihost happens."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/hypervisor_system.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "redfish-core/lib/systems.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 11
        },
        {
            "number": 2,
            "revision": "b954af96361b9c9d866be60053ace2f5d01ccfe0",
            "parents": [
                "fa2d6ae7034875a61314380295a88dc8abaa34a1"
            ],
            "ref": "refs/changes/03/73203/2",
            "uploader": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "createdOn": 1722373724,
            "author": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 28,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/hypervisor_system.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "redfish-core/lib/systems.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 11
        }
    ]
}
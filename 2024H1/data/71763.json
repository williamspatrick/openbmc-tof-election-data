{
    "project": "openbmc/libpldm",
    "branch": "main",
    "id": "I7b7cb97a1d8b96ec0fec1c0a5fbd8503da834d86",
    "number": 71763,
    "subject": "dsp: base: Rework {un,}pack_pldm_header() error handling",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@codeconstruct.com.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/libpldm/+/71763",
    "hashtags": [],
    "createdOn": 1717426787,
    "lastUpdated": 1717654875,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1717426787,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1717426837,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1717426837,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1717427117,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/85272/ : SUCCESS"
        },
        {
            "timestamp": 1717484660,
            "reviewer": {
                "name": "Tal Yacobi",
                "email": "talycb8@gmail.com",
                "username": "tal-yac"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1717485412,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1717486323,
            "reviewer": {
                "name": "Tal Yacobi",
                "email": "talycb8@gmail.com",
                "username": "tal-yac"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1717566097,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithrabarithaya07@gmail.com",
                "username": "Pavithrab7"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1717575465,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1717644029,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1717649886,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nCopied Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR **changekind:TRIVIAL_REBASE** OR is:MIN\")\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1717649932,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1717649932,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1717650203,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/85516/ : SUCCESS"
        },
        {
            "timestamp": 1717654164,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithrabarithaya07@gmail.com",
                "username": "Pavithrab7"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1717654854,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1717654875,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "73529033511e3a0bc05ba0773106e7202fc1392b",
            "parents": [
                "62c174a5f05623a8c9f5715b23b8b1d359e4bc60"
            ],
            "ref": "refs/changes/63/71763/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "createdOn": 1717426787,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Pavithra Barithaya",
                        "email": "pavithrabarithaya07@gmail.com",
                        "username": "Pavithrab7"
                    },
                    "message": "Andrew, so any error handling APIs should go into src/dsp/<....h> file from now on?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Well, we need to be careful with that statement. The existence of the header is driven by me trying to sort out some error handling stuff, but the purpose of the header is not for error handling. Specifically:\n\nThe header is under `src/` and not `include/` so it's not part of the public API of the library. We need the functions declared in a header because they're used elsewhere in the libpldm implementation, but at the moment it's most sensible for their definitions to live in `src/dsp/base.c`. Further, because the function implementations in `src/dsp/base.c` are not annotated with one of the `LIBPLDM_ABI_*` macros they will never be visible to the dynamic linker. An internal header is the right place for the declarations.\n\nThe same goes for any other internal-only declarations we need. We should just drop a header under `src/` alongside the `.c` file where the things are defined, and go from there.\n\nDoes that make sense?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Pavithra Barithaya",
                        "email": "pavithrabarithaya07@gmail.com",
                        "username": "Pavithrab7"
                    },
                    "message": "Yes Andrew, Thank you!"
                },
                {
                    "file": "src/api.h",
                    "line": 36,
                    "reviewer": {
                        "name": "Tal Yacobi",
                        "email": "talycb8@gmail.com",
                        "username": "tal-yac"
                    },
                    "message": "Is this here to guard against addition of other errno values in APIs without adding them here? If so, I feel like the 2 lines after it should be removed."
                },
                {
                    "file": "src/api.h",
                    "line": 36,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "The concern with that is that they are not unreachable - libpldm is by default configured with `-Db_ndebug=if-release`. That is, if you `meson setup --buildtype=release ...` then `-DNDEBUG` is added to `CFLAGS`."
                },
                {
                    "file": "src/api.h",
                    "line": 36,
                    "reviewer": {
                        "name": "Tal Yacobi",
                        "email": "talycb8@gmail.com",
                        "username": "tal-yac"
                    },
                    "message": "In this case it's fine as is."
                },
                {
                    "file": "src/dsp/base.c",
                    "line": 14,
                    "reviewer": {
                        "name": "Tal Yacobi",
                        "email": "talycb8@gmail.com",
                        "username": "tal-yac"
                    },
                    "message": "Should this (and unpack) be marked as stable/testing?"
                },
                {
                    "file": "src/dsp/base.c",
                    "line": 14,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "I didn't yet provide an annotation as I didn't want to expose them to the dynamic linker at all - for now they're just for the internal link.\n\nI want to bikeshed the name for the new API a bit; my preference is `int pldm_pack_header()` and `int pldm_unpack_header()`, returning the negative errno. I was concerned that was too confusing, and I'm half-wondering whether we can get away without them altogether, so punted it to later (as it's not urgent). I would like to deprecate `{un,}pack_pldm_header()` though (but again, can do that later)."
                },
                {
                    "file": "src/dsp/base.c",
                    "line": 14,
                    "reviewer": {
                        "name": "Tal Yacobi",
                        "email": "talycb8@gmail.com",
                        "username": "tal-yac"
                    },
                    "message": "ACK"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "src/api.h",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "src/dsp/base.h",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/msgbuf.h",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/dsp/base.c",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 152,
            "sizeDeletions": 13
        },
        {
            "number": 2,
            "revision": "d861a6814a304081d1f96976a575a64ece3dfcd5",
            "parents": [
                "48761c62012fe197a26266bab4dd7a82e4d9c1bb"
            ],
            "ref": "refs/changes/63/71763/2",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "createdOn": 1717649886,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "src/api.h",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "src/dsp/base.h",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/msgbuf.h",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/dsp/base.c",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 152,
            "sizeDeletions": 13
        }
    ]
}
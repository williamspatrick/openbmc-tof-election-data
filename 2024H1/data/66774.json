{
    "project": "openbmc/phosphor-led-manager",
    "branch": "master",
    "id": "I86b977d7c746ef436e0a644f8805193a7a89ee58",
    "number": 66774,
    "subject": "Select config json based on device tree",
    "owner": {
        "name": "SunnySrivastava",
        "email": "sunnsr25@in.ibm.com",
        "username": "SunnySrivastava1984"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-led-manager/+/66774",
    "hashtags": [],
    "createdOn": 1695650128,
    "lastUpdated": 1705593301,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1695650128,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1695650159,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1695650159,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1695650180,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/74464/ : FAILURE"
        },
        {
            "timestamp": 1695651366,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1695651395,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1695651395,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1695651472,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/74467/ : SUCCESS"
        },
        {
            "timestamp": 1695689779,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1695796677,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Patch Set 3: Commit message was updated.\n\nCopied Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1695796737,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1695796737,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1695796818,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/74503/ : SUCCESS"
        },
        {
            "timestamp": 1695797022,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1696370359,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(2 comments)"
        },
        {
            "timestamp": 1696413452,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1696436944,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1696477092,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\n(6 comments)"
        },
        {
            "timestamp": 1696478283,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1696479882,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1696513344,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1697003009,
            "reviewer": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1697075209,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1705593301,
            "reviewer": {
                "name": "Anupama B R",
                "email": "anupama.b.r1@ibm.com",
                "username": "branupama"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "833cd850ab32d099e315d7b610db7afa7aedbe8a",
            "parents": [
                "4549fb052f8d1948eb77fdbd0307b8c4ff57a69b"
            ],
            "ref": "refs/changes/74/66774/1",
            "uploader": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "createdOn": 1695650128,
            "author": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "manager/json-config.hpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -1
                },
                {
                    "file": "configs/config-map.json",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 82,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "b336326ca389b4781ba72c553eb37128872f3623",
            "parents": [
                "4549fb052f8d1948eb77fdbd0307b8c4ff57a69b"
            ],
            "ref": "refs/changes/74/66774/2",
            "uploader": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "createdOn": 1695651366,
            "author": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "probability?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "SunnySrivastava",
                        "email": "sunnsr25@in.ibm.com",
                        "username": "SunnySrivastava1984"
                    },
                    "message": "Done"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "LGTM\nAfter adding this method, can ledManager and EntityManager be decoupled?\nThe premise is to ensure that the configuration in devtree matches the key value of config-map.json."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 202,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "Nit: Can you write this as a separate method?"
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 202,
                    "reviewer": {
                        "name": "SunnySrivastava",
                        "email": "sunnsr25@in.ibm.com",
                        "username": "SunnySrivastava1984"
                    },
                    "message": "As this API is to get the file conf file path and the implementation done is a subset of that, I thought of adding the details here itself.\nAlso, all the multiple scenarios to get the conf file is handled under this api itself I thought of keeping it aligned with the current way of implementation.\nIn case you have a different thought process behind moving this implementation to another function, please do let me know."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "manager/json-config.hpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "configs/config-map.json",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 82,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "c6ea2606f0ec60c1b6dfc7d5ef4689f893f3cd4c",
            "parents": [
                "4549fb052f8d1948eb77fdbd0307b8c4ff57a69b"
            ],
            "ref": "refs/changes/74/66774/3",
            "uploader": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "createdOn": 1695796677,
            "author": {
                "name": "SunnySrivastava",
                "email": "sunnsr25@in.ibm.com",
                "username": "SunnySrivastava1984"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Please avoid phrases like \"this commit implements a change to\", as it's self-evident that we're discussing the commit. Removing the phrase leaves us with the same information:\n\n> Read the machine model from the `/sys` path and pick a config json based on that."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Can you please give a concrete example of a bug you observed that's solved by this patch?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 18,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Again a concrete example would be helpful here."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 24,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "What happens to phosphor-logging's need to light an LED in this case?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Hi Sunny. I'm a little concerned with the the proliferation of this solution. I also think the motivation is a little unclear at this point, and we could do with some more concrete examples."
                },
                {
                    "file": "configs/config-map.json",
                    "line": 10,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Why are we inventing yet another way to specify this?  We already have this dbus interface: https://github.com/openbmc/phosphor-dbus-interfaces/blob/262b9220e59434f8031d9dc24e481b28f420c73a/yaml/xyz/openbmc_project/Inventory/Decorator/Compatible.interface.yaml#L6\n\nEntity-manager should be exposing this Inventory.Decorator as appropriate."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Nope.  This is specific to your implementation.  I'm not going to accept code all over the organization that randomly looks at device-tree entries.\n\nIf you want to have entity-manager be able to look at device-tree entries as a Probe, please take it up with them.  We should keep this in one spot."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "SunnySrivastava",
                        "email": "sunnsr25@in.ibm.com",
                        "username": "SunnySrivastava1984"
                    },
                    "message": "The requirement driving this change was to bring led-manager up without waiting for Entity manager.\nThe amount of time in getting the signal \"interfaceAdded\" under entity manager is causing a delay in launching led-manager which in turn is causing us loose LEDs glow, which are required in case of some very early fault in BMC boot.\n\nAlso, the code is already probing some of the hard coded paths for conf file other than Entity manager. Why is this case different?"
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> The requirement driving this change was to bring led-manager up without waiting for Entity manager.\n\nThis might be a requirement you have floating around in your head but you haven't expressed it anywhere.  I would argue that isn't even a requirement but an example of an XY problem : https://en.wikipedia.org/wiki/XY_problem .\n\n> Also, the code is already probing some of the hard coded paths for conf file other than Entity manager. Why is this case different?\n\nUse of undocumented dbus interfaces that I've been asking to have refactored for 2 years isn't an example of behavior that should be further enhanced.  Do you have something specific you'd like to point out as reference code?"
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "> The amount of time in getting the signal \"interfaceAdded\" under entity manager is causing a delay in launching led-manager which in turn is causing us loose LEDs glow, which are required in case of some very early fault in BMC boot.\n\nThis sounds like you should be addressing a performance issue by measurement and optimisation. What numbers have you captured that demonstrate it's not possible to move EM/PLM initialisation earlier in the boot sequence? How early is early enough? What is it that forces us to accept a solution like what's in this patch?"
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "SunnySrivastava",
                        "email": "sunnsr25@in.ibm.com",
                        "username": "SunnySrivastava1984"
                    },
                    "message": "> Use of undocumented dbus interfaces that I've been asking to have refactored for 2 years isn't an example of behavior that should be further enhanced. Do you have something specific you'd like to point out as reference code?\n\nOh, I was not aware of the fact that there are code upstream which are under dispute. I assumed since it has been up-streamed it must have been accepted and can be taken as a reference.\nNevertheless, X&Y w.r.t the patch set was driven by the team facing problem while handling early boot errors. Lets see if they can weigh in here for their Y.\n\n> This sounds like you should be addressing a performance issue by measurement and optimisation.\nThis is more of a dependency problem where led-manager needs the interface to be added under entity manager to get the conf file."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "right, but why doesn't the interface get added early enough?"
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Sunny, maybe you can try to take out all of the delay timers in EM and see what happens early in the boot.  Theoretically EM will then put interfaces on D-Bus faster, but I'm not sure of other performance implications since it will now be running continuously with a lot more D-Bus activity instead of just periodically."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "SunnySrivastava",
                        "email": "sunnsr25@in.ibm.com",
                        "username": "SunnySrivastava1984"
                    },
                    "message": "Matt, this may work or may not work. Doing such change will need more of community approval as delay timer may have other uses.\nWe could look into this."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Hi Sunny,\n\n> Matt, this may work or may not work. Doing such change will need more of community approval as delay timer may have other uses.\n\nMatt (a maintainer of EM, someone who is an essential part of the community) was asking you to run an experiment to determine the affects. What were the results?\n\nCan you please be specific and enumerate your concrete concerns? Your response feels too vague to be actionable. I feel like that might stall the suggested avenue of investigation with a motivation of continuing to push for this patch to be merged."
                },
                {
                    "file": "manager/json-config.hpp",
                    "line": 25,
                    "reviewer": {
                        "name": "Anupama B R",
                        "email": "anupama.b.r1@ibm.com",
                        "username": "branupama"
                    },
                    "message": "Hi Andrew,\n    \n           I have observed there is 17-30sec delay in IBM systems for EntityManager to create an interface from its launching.\n\nThere is 5sec delay in EntityManager\u2019s propertiesChangedCallback() api, I checked the system by reducing timer.expires_after() to 500ms, \nwith this EntityManager has not taken any delay in creating new interfaces for matching probes.\n\nis it fine to reduce the expire time in propertiesChangedCallback() in EntityManager ?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "manager/json-config.hpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "configs/config-map.json",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 82,
            "sizeDeletions": 0
        }
    ]
}
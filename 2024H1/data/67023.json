{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "I0eccb572c61ce3a800d2a189e9d84eb36ff592e7",
    "number": 67023,
    "subject": "dropbear SSH server: update security options",
    "owner": {
        "name": "Joseph Reynolds",
        "email": "joseph.reynolds1@ibm.com",
        "username": "joseph-reynolds"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/67023",
    "hashtags": [],
    "createdOn": 1697044884,
    "lastUpdated": 1708460440,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1697044884,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1697044916,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1697044916,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1697044922,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20039/"
        },
        {
            "timestamp": 1697045011,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1697045424,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1697045593,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20039/ : SUCCESS"
        },
        {
            "timestamp": 1697045603,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1697045686,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1697046923,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1697067265,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1697068520,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1705693762,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1705695310,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1705888743,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1705961553,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1708457035,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1708457214,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1708457214,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1708457343,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1708457770,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/21792/"
        },
        {
            "timestamp": 1708457938,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1708458655,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/21792/ : SUCCESS"
        },
        {
            "timestamp": 1708458665,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1708459804,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1708460440,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "af5b13004870ec1cd793d3256a3d18ab0f41f391",
            "parents": [
                "312d61307afdc47acbe9087534c69e55c7054fac"
            ],
            "ref": "refs/changes/23/67023/1",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "createdOn": 1697044884,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Doing some testing with this, it appears to me that the localoptions.h currently has no effect because it's not been installed in the dropbear build directory as instructed in the dropbear repo.\n\nThere was an early attempt to add a yocto task to copy this file to the build directory but was rejected due to being overly complex: https://gerrit.openbmc.org/c/openbmc/meta-phosphor/+/20507\n\nI'm able to make it work by using do_configure instead, and have verified the options now take effect:\n\n| +do_configure:append() {\n| +    install -m 0644 ${WORKDIR}/localoptions.h ${B}\n| +}\n\nIf there are no objections I'll submit a patch with the above change, otherwise the localoptions.h changes are a no-op."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Wow.  When you said \"rejected due to being overly complex\" I was expecting something ... more.  Unfortunate this hasn't been taken care of yet.\n\nYes, I think the do_configure:append is fine.  I'm not 100% it is completely ok from an sstate perspective but people change that file so infrequently that it's probably acceptable even if we don't get it right."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "For the next Dropbear release I'll make it also recognise src/distrooptions.h in the source directory, that should be simpler to patch.\n\nhttps://github.com/mkj/dropbear/pull/274"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I guess I meant \"overkill\" more than \"complex\" since we shouldn't need to create a yocto task to be able to configure source code.\n\nChange here: https://gerrit.openbmc.org/c/openbmc/openbmc/+/68982\n\nThanks Matt, I added in the commit msg that we can transition to distrooptions.h once that's merged."
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/localoptions.h",
                    "line": 3,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph.reynolds1@ibm.com",
                        "username": "joseph-reynolds"
                    },
                    "message": "Since the last time we looked a this, the dropbear project changed the way to disable HMAC SHA1.  See the default SSH server options here: https://github.com/mkj/dropbear/blob/master/src/default_options.h\n\nI'm not sure the right approach for OpenBMC to configure dropbear, given https://github.com/ibm-openbmc/openbmc/blob/master/poky/meta/recipes-core/dropbear/dropbear/dropbear-disable-weak-ciphers.patch\nand I am looking for direction."
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/localoptions.h",
                    "line": 3,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "Adding this localoptions.h is the right approach. It should also have `#define DROPBEAR_DH_GROUP14_SHA1 1` in the list, then there won't be any SHA1 use."
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/localoptions.h",
                    "line": 3,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "Sorry, that should be `#define DROPBEAR_DH_GROUP14_SHA1 0` rather. \n\nI doubt there would be compatibility issues with disabling DH-group14-sha1, OpenSSH has had it disabled since 8.2 (2020-02-14), I'll be disabling it upstream soon."
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/localoptions.h",
                    "line": 3,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/localoptions.h",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/options.patch",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -33
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 37
        },
        {
            "number": 2,
            "revision": "e71e7778d61b38cde9e2bef1ab72320a45cc2b2d",
            "parents": [
                "22f682c653ad51d5f5c1ac8a7acd73c44f8b291b"
            ],
            "ref": "refs/changes/23/67023/2",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1708457035,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Helping Joseph test this change. Updated commit msg with the test results."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/localoptions.h",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "meta-phosphor/recipes-core/dropbear/dropbear/options.patch",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -33
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 37
        }
    ]
}
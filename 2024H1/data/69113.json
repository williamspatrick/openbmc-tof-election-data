{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Ia0f0e22a78e63bd71a2ddbbb76e44f52ad051401",
    "number": 69113,
    "subject": "meta-facebook: harma: add power log",
    "owner": {
        "name": "PeterYinGit",
        "email": "peter.yin@quantatw.com",
        "username": "PeterYinGit"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/69113",
    "hashtags": [],
    "createdOn": 1706687809,
    "lastUpdated": 1712496264,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1706687809,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1706687908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1706687908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1706687917,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/21496/"
        },
        {
            "timestamp": 1706688674,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/21496/ : SUCCESS"
        },
        {
            "timestamp": 1706688684,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1706688930,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Patch Set 1:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1706690033,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1706695610,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707272681,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1708310130,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1708610535,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1708610635,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1708610635,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1708610643,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/21817/"
        },
        {
            "timestamp": 1708611161,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/21817/ : SUCCESS"
        },
        {
            "timestamp": 1708611173,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1708612109,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1709042111,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1709226823,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1709227419,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1709390944,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1709677720,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1712496264,
            "reviewer": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "message": "Abandoned"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "2f3a1e39960fb79dc56731c63adfb605991c5425",
            "parents": [
                "a24caf9010b502b218b2e83d3b43db9a839a90d0"
            ],
            "ref": "refs/changes/13/69113/1",
            "uploader": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "createdOn": 1706687809,
            "author": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PeterYinGit",
                        "email": "peter.yin@quantatw.com",
                        "username": "PeterYinGit"
                    },
                    "message": "It is currently defined, but some of the definitions do not match our system. Can we redefine them?\n\nOn & ForceOn --> xyz.openbmc_project.State.Host.Transition.On \nForceOff --> xyz.openbmc_project.State.Chassis.Transition.Off \nForceRestart --> xyz.openbmc_project.State.Host.Transition.ForceWarmReboot \nGracefulShutdown --> xyz.openbmc_project.State.Host.Transition.Off \nGracefulRestart --> xyz.openbmc_project.State.Host.Transition.GracefulWarmReboot \nPowerCycle --> xyz.openbmc_project.State.Host.Transition.Reboot \n\n\nForceOff --> force host power off\nForceRestart --> host reset\nGracefulRestart --> the same ForceRestart"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> It is currently defined, but some of the definitions do not match our system. Can we redefine them?\n\nIs this directed at someone?  I'm not sure what the question is."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PeterYinGit",
                        "email": "peter.yin@quantatw.com",
                        "username": "PeterYinGit"
                    },
                    "message": "Hi Patrick,\n\nThe default behavior of Redfish(Systems/system/Actions/ComputerSystem.Reset) does not align with our design. Do you agree that we should redefine it?\n\nThe behavior should change as follows:\n\n\nOn & ForceOn --\u3009host power on\nForceOff --> Force host power off\nForceRestart --> Host reset\nGracefulRestart --> Same as ForceRestart\nPowerCycle --> host on/off"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-poweroff@.service",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/chassis-powercycle",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -23
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-powercycle",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager_%.bbappend",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -2
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-force-poweroff",
                    "type": "ADDED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/power-cmd",
                    "type": "MODIFIED",
                    "insertions": 54,
                    "deletions": -6
                },
                {
                    "file": "meta-facebook/recipes-fb/obmc_functions/files/fb-common-functions",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-force-poweroff@.service",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/sel-logger/phosphor-sel-logger_%.bbappend",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 120,
            "sizeDeletions": 33
        },
        {
            "number": 2,
            "revision": "288cb60d9afbb4ea81ae80002ece5feb30831d77",
            "parents": [
                "06bb15953c93a710c8494806b7242509cdcceb18"
            ],
            "ref": "refs/changes/13/69113/2",
            "uploader": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "createdOn": 1708610535,
            "author": {
                "name": "PeterYinGit",
                "email": "peter.yin@quantatw.com",
                "username": "PeterYinGit"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Why isn't this behavior handled in phosphor-state-manager directly?  This doesn't seem like something that should be system-specific."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PeterYinGit",
                        "email": "peter.yin@quantatw.com",
                        "username": "PeterYinGit"
                    },
                    "message": "It is redfish defined behavior.\n\nForceOff Turn off the unit immediately (non-graceful shutdown).\nForceOn Turn on the unit immediately.\nForceRestart Shut down immediately and non-gracefully and restart the system.\nGracefulRestart Shut down gracefully and restart the system.\nGracefulShutdown Shut down gracefully and power off.\n\n\nexample:\nThe 'Force Off' behavior is to turn off the chassis, which in our system means standby power. We can't just turn off the standby power without powering it on. In PSM, 'Restart' is considered as power off/on not platform reset. We're not sure how other platforms use it. I think it's better to modify 'harma' or modify it in 'meta-facebook/meta-facebook/recipes-phosphor/state/phosphor-state-manager' for a single host. Alternatively, can you define the expected behavior when sending  Redfish command to control power?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Hi Peter.  I feel like we're talking past each other and I'm not understanding what you're trying to accomplish.\n\n> It is redfish defined behavior.\n\nThe title of this commit message is \"add power log\".  Specific events being recorded is not \"redfish defined behavior\".\n\n> We're not sure how other platforms use it. I think it's better to modify 'harma' or modify it in 'meta-facebook/meta-facebook/recipes-phosphor/state/phosphor-state-manager' for a single host.\n\nWe want to try to minimize as much of the machine-specific or meta-facebook-only changes.  If this is behavior that might be applicable to other machines we should get it improved in the base code.\n\n> The 'Force Off' behavior is to turn off the chassis, which in our system means standby power. We can't just turn off the standby power without powering it on.\n\nI'm not following what the problem is with this statement.  PSM doesn't define what 'Force Off' turns off; that's up to your scripts.  We obviously don't want that to do a full sled power off.  What is the concern about it doing a \"standby power off\"?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PeterYinGit",
                        "email": "peter.yin@quantatw.com",
                        "username": "PeterYinGit"
                    },
                    "message": "Hi Patrick,\n  Let me explain my intention,\nthis PR aims to achieve two things:\n\n1.To avoid logging fake logs, I must remove the original DC/on-off logs and place the logs in the script that actually has hardware changes. If we put the logs in the common PSM, it will be the same as now, where BMC reboots will also be logged because PSM only handles states.\n\n2.There are two types of shutdowns for X86 host off: 1-second grace shutdown and 4-second force shutdown. However, the current definition of Redfish\u2019s force off is to call chassis off, so I want to change the definition; otherwise, we won\u2019t have the host force off function. The restart is similar; the original definition of Redfish restart is more like a DC cycle, so I want to change the behavior to host reset."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> 1.To avoid logging fake logs, I must remove the original DC/on-off logs and place the logs in the script that actually has hardware changes. If we put the logs in the common PSM, it will be the same as now, where BMC reboots will also be logged because PSM only handles states.\n\nThis still sounds like a bug in PSM.  \"logging fake logs\".\n\nI don't think this is something that has to be fixed immediately.  Let's start a discussion with the maintainers of PSM.\n\n> However, the current definition of Redfish\u2019s force off is to call chassis off, so I want to change the definition; otherwise, we won\u2019t have the host force off function. The restart is similar; the original definition of Redfish restart is more like a DC cycle, so I want to change the behavior to host reset.\n\nDoes it really matter?  What is the concern/issue if we do a \"DC cycle\" in order to accomplish a force host reboot?\n\nI suspect this is another topic we need to raise with the PSM maintainers.  I think we have a similar problem on Yv4."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-poweroff@.service",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/chassis-powercycle",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -23
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-powercycle",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager_%.bbappend",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -4
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-force-poweroff",
                    "type": "ADDED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/power-cmd",
                    "type": "MODIFIED",
                    "insertions": 54,
                    "deletions": -6
                },
                {
                    "file": "meta-facebook/recipes-fb/obmc_functions/files/fb-common-functions",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/state/phosphor-state-manager/host-force-poweroff@.service",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-harma/recipes-phosphor/sel-logger/phosphor-sel-logger_%.bbappend",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 122,
            "sizeDeletions": 35
        }
    ]
}
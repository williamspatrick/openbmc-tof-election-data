{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I40a5cc224c1d12e6ee65c99963b9bc6b46379226",
    "number": 70355,
    "subject": "Use shared_ptr for request body",
    "owner": {
        "name": "Myung Bae",
        "email": "myungbae@us.ibm.com",
        "username": "baemyung"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/70355",
    "hashtags": [],
    "createdOn": 1711730501,
    "lastUpdated": 1714432279,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1711730501,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1711730617,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711730617,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1711730684,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81511/ : FAILURE"
        },
        {
            "timestamp": 1711730827,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711730935,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711730935,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1711731010,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81512/ : FAILURE"
        },
        {
            "timestamp": 1711731383,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 3: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711731518,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711731518,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1711731673,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81515/ : FAILURE"
        },
        {
            "timestamp": 1711736782,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711736898,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711736899,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1711737220,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81522/ : FAILURE"
        },
        {
            "timestamp": 1711737884,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 5: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711738004,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711738004,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1711738349,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81523/ : FAILURE"
        },
        {
            "timestamp": 1711740032,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(5 comments)"
        },
        {
            "timestamp": 1711740147,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1711740664,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1711743265,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711743380,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711743380,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1711743549,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81526/ : FAILURE"
        },
        {
            "timestamp": 1711835788,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Patch Set 6:\n\n(10 comments)\n\nThis change is ready for review."
        },
        {
            "timestamp": 1711835830,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 7.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711835964,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711835964,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1711836033,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81555/ : FAILURE"
        },
        {
            "timestamp": 1711837194,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 8: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711837255,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711837256,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: -Ok-To-Test"
        },
        {
            "timestamp": 1711837327,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81556/ : FAILURE"
        },
        {
            "timestamp": 1711837561,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Uploaded patch set 9: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1711837663,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1711837663,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: -Ok-To-Test"
        },
        {
            "timestamp": 1711837828,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/81557/ : FAILURE"
        },
        {
            "timestamp": 1711909739,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9:\n\n(1 comment)"
        },
        {
            "timestamp": 1711911377,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9:\n\n(4 comments)"
        },
        {
            "timestamp": 1711979071,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Patch Set 9:\n\n(3 comments)"
        },
        {
            "timestamp": 1711990808,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9:\n\n(2 comments)"
        },
        {
            "timestamp": 1713378915,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9:\n\n(1 comment)"
        },
        {
            "timestamp": 1714141940,
            "reviewer": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "message": "Patch Set 9:\n\n(1 comment)"
        },
        {
            "timestamp": 1714432279,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\nsuperceeded by https://gerrit.openbmc.org/c/openbmc/bmcweb/+/71006"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ed20b55c0be395637ec26103b99c24dc9f5932bd",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/1",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711730501,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 94,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -20
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 134,
            "sizeDeletions": 46
        },
        {
            "number": 2,
            "revision": "fbfb2ed08f8c8dd57404e896012d3c0acd2087b2",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/2",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711730827,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 94,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -20
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 134,
            "sizeDeletions": 46
        },
        {
            "number": 3,
            "revision": "9b18ad2dbb4692a7c49b967f9da081673960440b",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/3",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711731383,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 95,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -20
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 135,
            "sizeDeletions": 46
        },
        {
            "number": 4,
            "revision": "5caba75920b85033324af0d00ca1cfb64c4ba2dc",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/4",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711736782,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 95,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -18
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 138,
            "sizeDeletions": 44
        },
        {
            "number": 5,
            "revision": "2ebde16133c7407ba10f0e1c2f231e0b242d16d1",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/5",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711737884,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 30,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "In this example you gave, req is of type Request, but you've made a shared pointer of boost::beast::http::request<bmcweb::HttpBody> (which is also called Request::req, so the confusion is warranted).\n\nWhy does making a member pointer shared help us here?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 30,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "The current code is already using the same naming.\n\nCurrent code:\n\n```\nstruct Request\n{\n      boost::beast::http::request<bmcweb::HttpBody> req;\n}\n```\nMany parts use `req` for `crow::Request` which makes `req.req` to be used.\n\nI think I'll not create `req()` but use only `req` as `Request` (and all internal body references are limited inside `Request`.\n\n```\nstruct Request\n{\n      std::shared_ptr<boost::beast::http::request<bmcweb::HttpBody>> reqPtr;\n}\n```\n\n> Why does making a member pointer shared help us here?\n\nSame as using `std::shared_ptr<crow::Request>`, this allows the content to be valid until all Requests are needed.\n\n```\nClass Connection\n{\n   crow::Request req;\n\n...\n  void handle()\n  {\n    req = crow::Request(parser->release(), reqEc);\n    \n    ....many depths...\n     crow::connections::systemBus->async_method_call(\n        [req, asyncResp, &rule, ...]() {\n              ... (B) this part will still need <req>\n        });\n    ...\n    (A)\n    .... req may be no longer used (e.g. req.clear()).\n  }\n}\n ```\n\nIf not using `shared_ptr<>` (either in Request or its body), (B) would need a deep copy of Request (i.e. body will need to be kept)."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 57,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "But it's still a copy.  Why are we making a copy at all?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 57,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I meant - there are places that use copy operations of `Request` to keep the content valid for all related logics are done.\n(I think we've tried to use &req, or std::move(req), but those are not sufficiently covering all cases).\n\nIf so, it is better to make Request to be less overhead (esp, for the cases that have a larger content - e.g. code update image).\n\nFor it, this commit is suggesting to use shared_ptr<> in the body (`req`) of `Request`.\n\n```\nstruct Request\n{\n-    boost::beast::http::request<bmcweb::HttpBody> req;\n+    std::shared_ptr<boost::beast::http::request<bmcweb::HttpBody>> reqPtr;\n}\n```\n\nWith previous code, copy of Request is expensive, but copy of Request with the new code is not (as it is only incrementing a ref count of a shared_ptr).\n\nI'll rephrase the commit message."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 82,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "What is \"audit\"?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 82,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I meant it as a logging inside `completeRequest()` in our downstream.\nI'll remove this."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 84,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "what is stmt?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 84,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I meant it as Debug logging statement"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 88,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "We're making a pretty core change here, so in terms of testing I would expect:\n1. Redfish protocol validator to have no regressions (after a few patches get on master it's failing one test, that's fine).\n2. Redfish service validator to pass\n3. Http1 and Http2 requests to pass for GET/PATCH/POST\n4. the Webui to load without any new errors and work properly.\n5. KVM (Or some other websocket thing) to be working.\n\nThat seems like the minimum set of tests for a change this core."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 88,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I've tried \n- redfish service validator\n- http1/http2 GET/PATCH/POST\n- Webui\n\nI'll further look at the others."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 88,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Redfish protocol validator is going to be important here.  It tests 404 handler, if-match handlers, and a bunch of other stuff."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "We already went through this same thing with Response, when we changed from everywhere using\n\nResponse&\n\nto\n\nstd::shared_ptr<Response>\n\nI'm not sure why we're proposing something different here, where the internals make copies of objects instead of the externals.  We shouldn't be making copies at all (unless a copy is explicitly required)."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I haven't investigated `Response` handling and I haven't changed it.  (I also did not observed the issue related to it).\n\nWhat I found is `Request` which seems copying & moving depending on the flows.\nIn one case, it causes the invalid content of it (i.e. `completeRequest()` esp on PATCH) as it is moved to `validatePrivilege()` async-call.\n\nAlthough the issue can be avoided by copying it, but it becomes too costly especially when `Request.req` is large (i.e. Code update)."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> I haven't investigated `Response` handling and I haven't changed it.  (I also did not observed the issue related to it).\n\nRight, because it was fixed a long time ago, but Response had this same lifetime problem, but to a much larger degree.\n\n> \n> What I found is `Request` which seems copying & moving depending on the flows.\n> In one case, it causes the invalid content of it (i.e. `completeRequest()` esp on PATCH) as it is moved to `validatePrivilege()` async-call.\n> \n> Although the issue can be avoided by copying it, but it becomes too costly especially when `Request.req` is large (i.e. Code update).\n\nYep, so make everywhere that needs a copy use\n\nstd::shared_ptr<crow::Request>\n\nand the issue is solved."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "I agree.  I'll work on it"
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Why would we make this a pointer instead of Request?"
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "You mean - `std::shared_ptr<crow::Request>` and use it at the references areas.\nI have thought it, but there are so many places to change.\n\nChanging its body of Request to shared_ptr would cause less code change impacts to code change, but have the same/similar effects.\n\nIf we change to `std::shared_ptr<crow::Request>`, the code changes would be\n- all or most `crow::Request&` (esp on function args) would need to be changed to `std::shared_ptr<crow::Request>&`'.\n- the code that use `req.` would need to be like `req->`.\n\nIf that's still preferred, I think we can do it after this."
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> You mean - `std::shared_ptr<crow::Request>` and use it at the references areas.\n\nYes, very similar to what's been done with Response.\n\n> I have thought it, but there are so many places to change.\n\nIn theory none of the handlers have to change, right?  Just the core code?\n\n> \n> Changing its body of Request to shared_ptr would cause less code change impacts to code change, but have the same/similar effects.\n\nNo, it doesn't have similar effects, because it's still making a copy of Request for every invocation.  When we use shared_ptr, we make no copies.\n\n> \n> If we change to `std::shared_ptr<crow::Request>`, the code changes would be\n> - all or most `crow::Request&` (esp on function args) would need to be changed to `std::shared_ptr<crow::Request>&`'.\n> - the code that use `req.` would need to be like `req->`.\n\nOnly in the core, not in handlers, right?\n\n> \n> If that's still preferred, I think we can do it after this.\n\nIf we do shared_ptr<Request>, this change isn't required at all."
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": ">Yes, very similar to what's been done with Response.\n\nRight. It will be similar to asyncResp.\n\n>Only in the core, not in handlers, right?\n\nNot the main logics, but the places would be the area to hold it, and the areas of passing args etc.\n\n>If we do shared_ptr<Request>, this change isn't required at all.\n\nYou mean - the change of body as shared_ptr is not needed if we do change req to shared_ptr.\nYes, I agree.  That was my original thought too. (I just chose this to reduce the total code changes).\n\nI'll work on making it as shared_ptr<crow::Request>."
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> >Yes, very similar to what's been done with Response.\n> \n> Right. It will be similar to asyncResp.\n> \n> >Only in the core, not in handlers, right?\n> \n> Not the main logics, but the places would be the area to hold it, and the areas of passing args etc.\n> \n> >If we do shared_ptr<Request>, this change isn't required at all.\n> \n> You mean - the change of body as shared_ptr is not needed if we do change req to shared_ptr.\n> Yes, I agree.  That was my original thought too. (I just chose this to reduce the total code changes).\n> \n\nLets focus on making sure the end code is as correct as we can make it, not reducing the total # of lines changed.\n\n> I'll work on making it as shared_ptr<crow::Request>.\n\nSounds good."
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "this is going to force a malloc every clear, which isn't the intent of clear().  Maybe you want reqPtr->clear()?"
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "This semantic of `clear()` is to release the original Request in this current flow of the logic.\nHowever, if there are references of it, the content will need be available for those.\nSo, reqPtr->clear() would not be correct as it will clear out its content for all references. (It may become same as simple pointer reference - &Request).\n\nSo, I've changed to do reqPtr=nullptr (although reqPtr=std::make_shared() is correct).  (By doing it, the other referencing code will still have the valid content - e..g above (B)).\n\n```\n   reqPtr = nullptr;\n```\n\nThis would be similar to do like if we do\n\n```\n   std::shared_ptr<crow::Request> req;\n    ...\n   req = nullptr;\n```"
                },
                {
                    "file": "http/http_request.hpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> This semantic of `clear()` is to release the original Request in this current flow of the logic.\n> However, if there are references of it, the content will need be available for those.\n> So, reqPtr->clear() would not be correct as it will clear out its content for all references. (It may become same as simple pointer reference - &Request).\n\nIn the context that clear is called, there should be no references.  Arguably, we could check if use_count > 1, and close the connection if the request is still being used after the request is complete to denote that someone extended the lifetime of Request beyond what they should've.\n\n> \n> So, I've changed to do reqPtr=nullptr (although reqPtr=std::make_shared() is correct).  (By doing it, the other referencing code will still have the valid content - e..g above (B)).\n\nIt's still going to require a second malloc, which defeats the intent of reusing the object in most cases.\n\n> \n> ```\n>    reqPtr = nullptr;\n> ```\n> \n> This would be similar to do like if we do\n> \n> ```\n>    std::shared_ptr<crow::Request> req;\n>     ...\n>    req = nullptr;\n> ```"
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "line": 77,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This should be using req.method()"
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "line": 77,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "It was originally `req.req.method()` and I replaced to map it to *req.reqPtr [i.e., req.req()] .\n\nSince `method()` is also under `req.method()`, it makes sense to change `req.method()`.\nI'll make those changes."
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "line": 77,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Lets just do that in another patch ahead of this one, as that's arguably a cleanup."
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "line": 77,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "Ok, I'll do."
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "line": 564,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This doesn't have to be a copy anymore, right?"
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "line": 564,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "Looking at the logic again, I think we can share thisReq?\nSo, I'll make the changes accordingly."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 95,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -18
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 138,
            "sizeDeletions": 44
        },
        {
            "number": 6,
            "revision": "c1d0b34fc69321b499c6ade6de3a50f160aef28e",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/6",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711743265,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 95,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -18
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 137,
            "sizeDeletions": 44
        },
        {
            "number": 7,
            "revision": "0e5979c35bda5fa63d5c7c23b0204e85c6ff6583",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/7",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711835830,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 104,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -18
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -22
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 168,
            "sizeDeletions": 55
        },
        {
            "number": 8,
            "revision": "47d95196821468fa23c602c6ede6b324e207731b",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/8",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711837194,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 105,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -18
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -22
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 169,
            "sizeDeletions": 55
        },
        {
            "number": 9,
            "revision": "5a4894229324b94a5a1788767fbbb74f408a04f3",
            "parents": [
                "1847f2a0c517df6a7439b9bd491afbf6b2302a92"
            ],
            "ref": "refs/changes/55/70355/9",
            "uploader": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "createdOn": 1711837561,
            "author": {
                "name": "Myung Bae",
                "email": "myungbae@us.ibm.com",
                "username": "baemyung"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "in the future, when making large c"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "FYI: https://gerrit.openbmc.org/c/openbmc/bmcweb/+/70850"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Myung Bae",
                        "email": "myungbae@us.ibm.com",
                        "username": "baemyung"
                    },
                    "message": "It looks like - https://gerrit.openbmc.org/c/openbmc/bmcweb/+/71006 seems covering what's left from this attempt.\nSo, https://gerrit.openbmc.org/c/openbmc/bmcweb/+/71006 may be the direction to do."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 108,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/utils/json_utils_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "http/http_request.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -18
                },
                {
                    "file": "http/http2_connection.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/include/query.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -22
                },
                {
                    "file": "include/dbus_privileges.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "http/websocket.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 172,
            "sizeDeletions": 55
        }
    ]
}
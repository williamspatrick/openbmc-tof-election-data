{
    "project": "openbmc/libpldm",
    "branch": "main",
    "id": "I152fce5dff0c285daf25dd43233a6cb9a35fcc75",
    "number": 69875,
    "subject": "bios: Support Attribute Boot Config Settings",
    "owner": {
        "name": "DelphineCCChiu",
        "email": "Delphine_CC_Chiu@wiwynn.com",
        "username": "DelphineCCChiu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/libpldm/+/69875",
    "hashtags": [],
    "createdOn": 1709718937,
    "lastUpdated": 1709885398,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1709718937,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1709718961,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709718961,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1709719030,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/80236/ : FAILURE"
        },
        {
            "timestamp": 1709781548,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709781580,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709781580,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1709781637,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/80267/ : FAILURE"
        },
        {
            "timestamp": 1709802266,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 3: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709802291,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709802291,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1709802646,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80282/ : SUCCESS"
        },
        {
            "timestamp": 1709852636,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\n(20 comments)"
        },
        {
            "timestamp": 1709877424,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 4: New patch set was added with same tree, parent tree, and commit message as Patch Set 3.\n\nCopied Votes:\n* Verified+1 (copy condition: \"**changekind:NO_CHANGE**\")\n"
        },
        {
            "timestamp": 1709877451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709877451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1709877535,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1709877683,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80321/ : SUCCESS"
        },
        {
            "timestamp": 1709885398,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "dd0ebac7468c5f04ec02824c392ccfb26880c52b",
            "parents": [
                "819f138a9b1f9757fecd3b72887adb1e8102778a"
            ],
            "ref": "refs/changes/75/69875/1",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1709718937,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios.h",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 241,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 152,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 415,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "9a6ccaf13147121bec3e94ff30a35582a1305035",
            "parents": [
                "819f138a9b1f9757fecd3b72887adb1e8102778a"
            ],
            "ref": "refs/changes/75/69875/2",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1709781548,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios.h",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 241,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 152,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 415,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "37ca415f2a9331b359a5bb7d1f0dc9ee0993dc01",
            "parents": [
                "819f138a9b1f9757fecd3b72887adb1e8102778a"
            ],
            "ref": "refs/changes/75/69875/3",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1709802266,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Can you please mention which specification and the relevant section in the description here?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Hello. Overall I have quite a few comments with some diversity of concerns. I've addressed them inline where necessary.\n\nA couple of further things are missing:\n\n1. Unit tests covering the code-paths of all new functionality\n2. An update to the changelog detailing the new APIs."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Hi, first, thank you for all the reviews.\n\nI'll improve the code based on your suggestion. About the 2nd missing part.\n> 2. An update to the changelog detailing the new APIs.\n\nDo you mean that adding a new minor version at (https://github.com/openbmc/libpldm/blob/main/CHANGELOG.md) and mark what I've added, am I correct? If so, since the lastest version is 0.3.0, I plan to add version 0.4.0 and mark the details of the new APIs."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "> Do you mean that adding a new minor version at (https://github.com/openbmc/libpldm/blob/main/CHANGELOG.md) and mark what I've added, am I correct?\n\n- In CHANGELOG.md: Yes, thanks\n- Mark what you've added: Yes, please list what you've added in an entry under the `Added` subheader\n- Adding a new minor version: No, please don't. There's an `[Unreleased]` section near the top of the file under which you should add your entries:\n\nhttps://github.com/openbmc/libpldm/blob/main/CHANGELOG.md#unreleased\n\n> since the lastest version is 0.3.0\n\nCan you unpack how you've come to that conclusion? The latest tag is v0.7.0:\n\nhttps://github.com/openbmc/libpldm/releases/tag/v0.7.0\n\nThe changelog lists it here:\n\nhttps://github.com/openbmc/libpldm/blob/main/CHANGELOG.md#070---2023-08-29\n\n> I plan to add version 0.4.0\n\nPlease do not invent new sections or add to sections of already tagged releases.\nIf you read through the file you should find it is organised from the newest release at the top to the oldest at the bottom."
                },
                {
                    "file": "include/libpldm/bios.h",
                    "line": 70,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Please don't add more structs with flexible arrays of size 1. This is leads to undefined behaviour in both C and C++ (as it is not a flexible array by definition, it's an array of size 1, and you must not generate pointers beyond one-past-the-end). It also breaks the calculation of `sizeof()` for the structure to-boot.\n\nInstead, please use:\n\n```\nstruct pldm_bios_boot_config_setting_attr_val_entry {\n    ...\n    #ifndef __cplusplus\n    uint8_t boot_sources_index[]\n    #endif\n};\n\nuint8_t *pldm_bios_boot_config_setting_attr_val_entry_boot_sources_index(struct pldm_bios_boot_config_setting_attr_val_entry *entry);\n```\n\nAnd then in the `.c` file provide the implementation:\n\n```\nuint8_t *pldm_bios_boot_config_setting_attr_val_entry_boot_sources_index(struct pldm_bios_boot_config_setting_attr_val_entry *entry)\n{\n    return entry->boot_sources_index;\n}\n```\n\nThis way the C code can just access the flexible array member directly, while in C++ we can invoke the accessor function to maintain valid behaviour (as the function is compiled with a C compiler that has access to the flexible array member)."
                },
                {
                    "file": "include/libpldm/bios.h",
                    "line": 71,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "I realise all the other structs have `__attribute__((packed))`, but can you please justify why it's necessary, or if you cannot, please remove it.\n\nUltimately none of the structs defined in the public APIs should require it."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 444,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "I don't think the descriptions from the inline doxygen comments are really adding any value here over the member names. Can you either write the comments such that they have context for how the members are used, or remove them altogether."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 468,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "While there are many other functions that have the `_check` suffix, please don't add new functions with it. The `_check` suffix was used to migrate functions using `assert()` as error handling to returning error codes. New APIs should be designed correctly from the outset.\n\nPlease audit the rest of the functions added in the patch against this comment."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 469,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "`void *` is a last resort. It should be avoided, or if it cannot be, you must justify its use in comments in the code.\n\nPlease audit the rest of the functions added in the patch against this comment."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 473,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "What does it mean to check it? What happens if we don't? How do we react to the result of the check? Answers should be provided in the doxygen description for the function.\n\nPlease audit the rest of the functions added in the patch against this comment."
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "line": 539,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Why are we adding a function to check each member of `struct pldm_bios_table_attr_entry_boot_config_setting_info` to the public library API? This seems excessive. Please discuss what other approaches may be used."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 316,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "APIs must not be added directly to the stable category. This must be `LIBPLDM_ABI_TESTING` for now.\n\nSee:\n\nhttps://gerrit.openbmc.org/plugins/gitiles/openbmc/libpldm/+/refs/heads/main/README.md#development\n\nPlease audit the rest of the functions added in the patch against this comment."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 329,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "This feels a little tedious. Is there a better way?"
                },
                {
                    "file": "src/bios_table.c",
                    "line": 342,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "While it's not ideal, functions for encoding and decoding PLDM messages:\n\n1. Don't have a `pldm_` prefix to the symbol\n2. Start with `encode_` or `decode_`\n\nSee:\n\nhttps://gerrit.openbmc.org/plugins/gitiles/openbmc/libpldm/+/refs/heads/main/README.md#libpldm\n\nAt this point consistency of the API is more important than namespacing. Fixing the namespacing is on the todo list.\n\nPlease rename the encoding/decoding functions for consistency with the rest of the libpldm API.\n\nPlease audit the rest of the added functions in the patch against this comment."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 382,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Please implement this in terms of the `msgbuf` APIs.\n\nhttps://gerrit.openbmc.org/plugins/gitiles/openbmc/libpldm/+/refs/heads/main/src/msgbuf.h\n\nHere's an example implementation:\n\nhttps://gerrit.openbmc.org/plugins/gitiles/openbmc/libpldm/+/refs/heads/main/src/platform.c#1003"
                },
                {
                    "file": "src/bios_table.c",
                    "line": 404,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "`const` in C means 'memory that cannot be written', which is not the same as a compile-time constant. This should probably be a `#define`."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 405,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Where is the check that this array access is not out-of-bounds?\n\nWhy are we indexing into metadata this way? Much better would be to use the `msgbuf` APIs to handle this safely (as they do all the necessary bounds checking)."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 411,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "The alignment of `struct pldm_bios_attr_table_entry` is 1, which means this access may be unaligned. Unaligned accesses can generate traps in freestanding contexts.\n\nPlease try to exploit the `msbguf` APIs, which correctly handle issues with alignment and also perform the endian conversion for you.\n\nFinally, please integrate assertions that demonstrate that this calculation can't overflow."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 473,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Why are all of these individual accessor functions?"
                },
                {
                    "file": "src/bios_table.c",
                    "line": 918,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "There's no bounds checking in any of this. Please use the `msgbuf` APIs."
                },
                {
                    "file": "src/bios_table.c",
                    "line": 1035,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Why are we subtracting one here?"
                },
                {
                    "file": "src/bios_table.c",
                    "line": 1073,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Please implement this in terms of the `msgbuf` APIs."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios.h",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 241,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 152,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 415,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "2818a3d55f6c791ec0098690ba3895eeb8c9e1db",
            "parents": [
                "819f138a9b1f9757fecd3b72887adb1e8102778a"
            ],
            "ref": "refs/changes/75/69875/4",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1709877424,
            "author": {
                "name": "Chris Wang",
                "email": "Chris_Wang@wiwynn.com",
                "username": ""
            },
            "kind": "NO_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios.h",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/bios_table.c",
                    "type": "MODIFIED",
                    "insertions": 241,
                    "deletions": 0
                },
                {
                    "file": "include/libpldm/bios_table.h",
                    "type": "MODIFIED",
                    "insertions": 152,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 415,
            "sizeDeletions": 0
        }
    ]
}
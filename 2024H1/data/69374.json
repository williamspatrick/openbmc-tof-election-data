{
    "project": "openbmc/phosphor-state-manager",
    "branch": "master",
    "id": "I873d738e4271a969c5d6f95e8f4bdffade730cc6",
    "number": 69374,
    "subject": "meson: Install fmt wrap and re-order dependencies",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@codeconstruct.com.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/69374",
    "hashtags": [],
    "createdOn": 1707814237,
    "lastUpdated": 1707951296,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1707814237,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1707814249,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707814249,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1707814269,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1707814398,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79159/ : SUCCESS"
        },
        {
            "timestamp": 1707814851,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1707845201,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707847998,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707848831,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707865314,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1707866652,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707866899,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707868096,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707870333,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707947313,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707951296,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Abandoned\n\nReplaced by [prefer std::format over fmt](https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/69382)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c0ddb770f60f39c127eb2d78c7436c47969e3ced",
            "parents": [
                "e9040bb8b2d3be3c9ce968c04e43dcadeb284edd"
            ],
            "ref": "refs/changes/74/69374/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "createdOn": 1707814237,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Thanks for the patch, I don't utilize these much, but is there any reason to not just use a simpler file like https://grok.openbmc.org/xref/openbmc/phosphor-power/subprojects/fmt.wrap?r=888bebde?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "How about this instead?  I doubt there is really any good reason for us to use the fmt library anymore instead of the std::format ones.  We're not doing anything needing that level of complexity.\n\nremote:   https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/69382 prefer std::format over fmt [NEW]"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "The `fmt.wrap` file I've committed here is the result of running `meson wrap install fmt`, which I feel is easier than manually managing wrap files? The resulting file might be more complex, but we don't have to care about the content so much as long as we trust the contributors to the meson wrapdb."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Sure, we can do that too. I'll defer to Andrew on how to move forward."
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't really understand why moving them was helpful?  The lines right above also add dependencies, so why does it matter if this block is at the top or the bottom of the \"complex dependencies\"?"
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "It happens to be the case that neither `CLI11` nor `cereal` depend on `fmt`. However, `sdeventplus` depends on `stdplus`, which depends on `fmt`, so we need to specify `fmt` at least before `sdeventplus` for `phosphor-state-manager` to control the dependency. I moved the entire block so that the direct dependencies with the smallest transitive dependency tree are ordered first. It could be done more precisely."
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Is that a problem with those other repos?  We should be able to sort the dependencies alphabetically (which is what I typically do) and Meson will do the right thing. This is assuming that the consuming repos aren't broken on their own."
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Is there documentation somewhere that states that meson will \"do the right thing\" if the dependencies are sorted alphabetically? That hasn't been my experience, particularly around dependency version constraints. See e.g:\n\n[meson: Order dependencies as an approximate in-order tree traversal](https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/68618)\n\n(Note that I said `in-order` there where I should have said `pre-order`)."
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Meson will always attempt to resolve subproject dependencies from the subprojects themselves. That's why you end up with indirect wrap files in some cases.\n\nMy reading of your problem is that some subprojects are depending on fmt without providing it. We probably should just get rid of fmt in those too, I guess. I went on a tear removing a lot of them when GCC 13 first came out but didn't do everything I guess."
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "Yes, that would also be an option"
                },
                {
                    "file": "meson.build",
                    "line": 116,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah thanks for keeping PSM honest guys! I went ahead and merged the change from Patrick to get rid of fmt (https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/69382)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "subprojects/fmt.wrap",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 8
        }
    ]
}
{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "topic": "code-update",
    "id": "Id11823ca0ff62e76595aa4ad33212a2a2428c261",
    "number": 69783,
    "subject": "start-update-interface: add the new app",
    "owner": {
        "name": "Jagpal S Gill",
        "email": "paligill@gmail.com",
        "username": "jagpalgill"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/69783",
    "hashtags": [],
    "createdOn": 1709248821,
    "lastUpdated": 1718827914,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1709248821,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1709248833,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709248833,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1709248924,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80052/ : SUCCESS"
        },
        {
            "timestamp": 1709250388,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1709252821,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709252849,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709252849,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1709252867,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 1:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1709252867,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1709252934,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80053/ : SUCCESS"
        },
        {
            "timestamp": 1709260227,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1709260574,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1709682497,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709682518,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709682518,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1709682747,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80204/ : SUCCESS"
        },
        {
            "timestamp": 1709745307,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1709747884,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1710203661,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1710232546,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1711376858,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1711385858,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1711387480,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1711398691,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(4 comments)"
        },
        {
            "timestamp": 1711398775,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1711565867,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1711566730,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1712560394,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1712560422,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712560422,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1712560508,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/82113/ : SUCCESS"
        },
        {
            "timestamp": 1712560693,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 4:\n\n(6 comments)"
        },
        {
            "timestamp": 1712560796,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Topic set to code-update"
        },
        {
            "timestamp": 1713467230,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1715003222,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1715801736,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1716684966,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1716685010,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1716685010,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1716685097,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/84867/ : SUCCESS"
        },
        {
            "timestamp": 1716687256,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1716687287,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1716687287,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1716687367,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/84871/ : SUCCESS"
        },
        {
            "timestamp": 1717086282,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1717135249,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1717155448,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1717458813,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 6:\n\n(4 comments)"
        },
        {
            "timestamp": 1718827898,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1718827914,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Change has been successfully rebased and submitted as cc49878d8f7c29d1b05a27106b4ab1427c8f41a2"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ad03abcff4d7dc71619517a92afa9554e45a0767",
            "parents": [
                "85c71a13e0938cc4d36caf6b8e735e9740b2e351"
            ],
            "ref": "refs/changes/83/69783/1",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1709248821,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 17,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "73bc1b9b6d6c62d1a9bb00863cd791cca3da6bb8",
            "parents": [
                "85c71a13e0938cc4d36caf6b8e735e9740b2e351"
            ],
            "ref": "refs/changes/83/69783/2",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1709252821,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "I would expect some related changes in meson.build as well to use the new option."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "+1"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 16,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "813ffba88389a0d66f53bd7271b9576277eabb20",
            "parents": [
                "85c71a13e0938cc4d36caf6b8e735e9740b2e351"
            ],
            "ref": "refs/changes/83/69783/3",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1709682497,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "More details needed.  One sentence of description is rarely enough detail for a commit message."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Done"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Addressed. Thanks"
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "line": 6,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "?  Why are we making a total new app?  The design is just changing some dbus APIs, it shouldn't be designing a whole new daemon?"
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "line": 6,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "\"just\".  I think the motivation here was that there actually are a good amount of changes since the effectively image-manager goes away and trying to do all this in a single daemon would require a messy `#ifdef CONFIG` tree.\n\nIsn't it cleaner to have a new daemon, trying to refactor and/or reuse pieces of code as much as possible?  We can likely run both daemons at the same time, so you have the old code working until we fully switch over and then remove the old daemon?\n\nI wouldn't call this file/daemon \"new\" though.  That's just asking for it to still be listed as \"new\" 2-6 years from now."
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "line": 6,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> \"just\".  I think the motivation here was that there actually are a good amount of changes since the effectively image-manager goes away and trying to do all this in a single daemon would require a messy `#ifdef CONFIG` tree.\n\nThat needs captured in the commit message, but even with that, I still don't think a completely different app is warranted.  if you want to immediately make main call a different code path, that's a lot easier to do, and doesn't involve having to clean up the \"old app\" later.\n\n> \n> Isn't it cleaner to have a new daemon, trying to refactor and/or reuse pieces of code as much as possible?  We can likely run both daemons at the same time, so you have the old code working until we fully switch over and then remove the old daemon?\n\nI don't really think so, as it implies that we're not going to reuse code as much as possible.  As a trivial example, main() is identical between the implementations.  presumably signal handling, dbus connection startup, and other things will be identical between the implementations.\n\nWith all that said, i'm not the maintainer here, so I'll defer to whatever they want.\n\n> \n> I wouldn't call this file/daemon \"new\" though.  That's just asking for it to still be listed as \"new\" 2-6 years from now."
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "line": 6,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "There was a discussion with the maintainers on the workflow for making this change and they were fine with adding new files as it involved significant changes. At the same time, i have also refactored out the code so it can be reused in both old and new daemons. Both the daemons and flow will co-exist at runtime until the old flow is deprecated and removed after fully testing the new one."
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "line": 6,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I'm ok starting up with a new app and see where that takes us even if it duplicates logic initially, since like Patrick mentioned, we're attempting to combine the 'image manager' and the 'updater' app into a single binary ('software manager' seems to be the proposed name).\n\nPlease describe in to the commit msg like Ed mentioned the addition of the new app and the motivations behind it (converging 2 apps into 1 app) and the desire to run both new and old temporarily."
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "line": 6,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Done"
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "can we get a better name than \"NEW\". In a few months it won't be \"new\" so lets be descriptive of what's it's doing."
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "\ud83d\udc4d"
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Sure, changed to \"start-update-dbus-interface\"."
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Do you mind changing it to 'software-update-dbus-interface'? Reason is that the new interface is Software.Update,  StartUpdate is just a method, there could be more methods and properties added later to the new interface."
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Done"
                },
                {
                    "file": "meson.build",
                    "line": 260,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't think this should be an either-or for the time being.  We should start with a separate daemon because otherwise we're going to end up with a case where the old code isn't compiled in CI and we don't catch failures until we get to the Yocto side of the process."
                },
                {
                    "file": "meson.build",
                    "line": 260,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "I have modified this patch and removed the meson option all together. The interface change is not that complex that we have to preserve two flows in parallel and we can make the change in the base code itself. Soon, i would raise the patch prototyping this and will see what's the feedback."
                },
                {
                    "file": "meson.build",
                    "line": 260,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "I don't see the new patchset ?"
                },
                {
                    "file": "meson.build",
                    "line": 260,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "+1, I don't see the change."
                },
                {
                    "file": "meson.build",
                    "line": 260,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Please refer to the patch stack."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "Why enabled by default?"
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Why not?  Our default policy should be that all code compiles in CI and is optionally disabled via bitbake recipes as needed."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "This is different than what we have done in bmcweb.\n \nMy main concern here is consistency across the repos. \nA 2nd concern is companies knowing how to disable this.\nA 3rd concern is since most layers use the default, non production-ready features will be enabled.\n\nOnly later, after a feature is \"ready for production\" in bmcweb, have we enabled it by default.  https://github.com/openbmc/bmcweb/commit/8615915cc51a468c1c0b6eabb684616d0f2abe0f\n\nFrom a tested in CI, it makes sense our default policy should enabled.\n\nHow should companies/layers know to disable new options? Options like this might not be production-ready. Should options that are more company\u2014or architecture-specific also be enabled by default?\n\nIn bmcweb, should features like aggregation, experimental-redfish-multi-computer-system, and experimental-http2 be enabled by default?\nhttps://github.com/openbmc/bmcweb/blob/master/meson_options.txt#L284\n\nThose options are still under development, they aren't a full fledged feature. aggregation I might support enabling by default. \n\nWhat about more company or architecture-specific like ibm-management-console, redfish-dump, and crashdump?\n\ncrashdump calls com.intel.crashdump so I would say no, same with ibm-management-console. \n\nredfish-dump uses phosphor-debug-collector so I would support that being enabled by default."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> This is different than what we have done in bmcweb.\n\nHonestly, bmcweb is the \"weird one\" in this context.  Almost every other repository we have taken the opposite stance.  Anytime I come across one doing it backwards, I usually try to fix it (which usually happens when I fix something and then only realize that the \"OEM\" side is broken due to a Yocto config in meta-ibm/meta-openpower).\n\n> A 2nd concern is companies knowing how to disable this.\n\nThis is on the person owning the meson.option and the maintainer to ensure that there is a PACKAGECONFIG added for it at the same time and disabled by default.\n\n> A 3rd concern is since most layers use the default, non production-ready features will be enabled.\n\nSee my response to 2nd concern.  It is the same answer.\n\n> From a tested in CI, it makes sense our default policy should enabled.\n\nNo.  Tested in CI should be the maximal amount of code tested.  Otherwise you end up with (and we've had this exact problem) code that is only even compiled by Yocto-integration-time and is broken.  I kept having this problem with PLDM specifically in the recent past.\n\n> In bmcweb, should features like aggregation, experimental-redfish-multi-computer-system, and experimental-http2 be enabled by default?\n\nI'm not going to discuss bmcweb policy in a change in a different repository.  We can discuss this elsewhere.\n\n> What about more company or architecture-specific like ibm-management-console, redfish-dump, and crashdump?\n\nThere are examples of exactly this in many other repositories.  In CI for the repository we enable all OEM paths; in meta-phosphor we disable them.  See phosphor-dbus-interfaces, pldm, etc."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> This is different than what we have done in bmcweb.\n\nI think you two will actually agree, but there's a nuance to what Gunnar said that I don't think comes though in the text unless you understand bmcweb.  In bmcweb:\n1. All code is compiled in all modes.  Unit tests are run for code that isn't neccesarily enabled the build.\n2. Only the user-facing BEHAVIOR is changed (usually through a minor constexpr if so we're testing the negative paths syntax as well) if the option is enabled.\n\nThat way we get CI coverage, everyone is running all the unit tests, but we can keep reasonable defaults at the same time.  In this patchset, I think we can get the same behavior by:\n- keep the existing app (don't invent a new main()).\n- Where it makes sense in the existing app, put\n\n```\nif constexpr(do_new_thing){\n    new_thing();\n} else {\n    old_thing();\n}\n```\n\nI thought we were keeping the old behavior temporarily, so maybe the old_thing() needs to go in an unconditional bracket, but you get the point.  We're not selectively compiling code, we're selectively enabling branches until the existing uses of the old interfaces are brought up to date.\n\n> In bmcweb, should features like aggregation, experimental-redfish-multi-computer-system, and experimental-http2 be enabled by default?\n\nNote, that in bmcweb, http2 is COMPILED and TESTED regardless of if the option is enabled.  This technically meets Patricks ask that we test as much as possible, and Gunnars ask that we don't functionally break things in existing systems (both of which I think are reasonable and accomplishable in one patchset).\n\nhttps://github.com/openbmc/bmcweb/blob/d0eb0e7303744d03aaa6f994bbbcdd6dc92bab13/http/http_connection.hpp#L193\n\n\n\n> A 2nd concern is companies knowing how to disable this.\n\nThis isn't going to be something we support for more than the O(months) it takes to get the new code in place, and my assumption was that we wouldn't need an option at all, we just expose the new interface, move things over, then delete the old interface.  Companies are free to manage their rebase however they like, but we're not going to maintain 2 firmware update DBus APIs just because people don't want to change their downstream patches.  The intent is that this new design is better for everything.  If there's functional problems with what's been proposed, NOW is the time to voice them, not after we get a bunch of patches in.\n\n\n> A 3rd concern is since most layers use the default, non production-ready features will be enabled.\n\nI think the concern here is really, \"this patchset as written breaks working platforms\".  That needs fixed in this series.  Maybe that's the intent of this patch, but that wasn't captured in the one sentence commit message.  In terms of \"production readiness\" that's not really something openbmc has a definition of, so holding this patchset to some arbitrary guidelines seems ill advised.  Lets make sure this patch series is as functionally correct as we can make it before it merges, and when/if there are regression bugs, they should be minor and we can ask Jagpal to fix them."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> Only the user-facing BEHAVIOR is changed (usually through a minor constexpr if so we're testing the negative paths syntax as well) if the option is enabled.\n\nI'm not sure constexpr-enable works the way you are intending.  You can create non-compiling code in the false-branch of a constexpr and the compiler won't even care.  This is the \"modern\" SFINAE approach.\n\nI highly suspect someone can add non-compiling code and you won't even know until someone turns on the feature."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> > Only the user-facing BEHAVIOR is changed (usually through a minor constexpr if so we're testing the negative paths syntax as well) if the option is enabled.\n> \n> I'm not sure constexpr-enable works the way you are intending.  You can create non-compiling code in the false-branch of a constexpr and the compiler won't even care.  This is the \"modern\" SFINAE approach.\n\nYes, in the actual if constexpr branch, you can create code that doesn't compile (although it does need to pass syntax).  But if you're immediately calling two functions that are both compiled in all cases, the likelihood that you break the code in a way that isn't trivial to fix is greatly reduced.\n\n> \n> I highly suspect someone can add non-compiling code and you won't even know until someone turns on the feature.\n\nyes, it's not perfect, we can come up with examples of how it could be broken, but in practice, it tends to not happen, because old_thing() is just a method call.\n\nCertainly it's a lot more error-proof than what's proposed in this patchset, where the new application isn't even built if the option is enabled."
                },
                {
                    "file": "meson.options",
                    "line": 28,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Please refer to the latest patch. Both new and old daemons will be built and co-exist at runtime."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -4
                },
                {
                    "file": "image_manager_main_new.cpp",
                    "type": "ADDED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 39,
            "sizeDeletions": 4
        },
        {
            "number": 4,
            "revision": "6ff7d71366c6960e154d13f83522c3da9ab2ea53",
            "parents": [
                "85c71a13e0938cc4d36caf6b8e735e9740b2e351"
            ],
            "ref": "refs/changes/83/69783/4",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1712560394,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Addressed the comments. Please review."
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Let's remove this variable until it's actually used."
                },
                {
                    "file": "meson.build",
                    "line": 71,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Done"
                },
                {
                    "file": "xyz.openbmc_project.Software.Manager.service.in",
                    "line": 9,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'm quite confused by this.  I see we have a bunch of these service files that all use BUSNAME but there isn't a single `meson.build` setting for BUSNAME:\n\n```\nmeson.build\n29:conf.set_quoted('BUSNAME_UPDATER', 'xyz.openbmc_project.Software.BMC.Updater')\n30:conf.set_quoted('DOWNLOAD_BUSNAME', 'xyz.openbmc_project.Software.Download')\n33:conf.set_quoted('MAPPER_BUSNAME', 'xyz.openbmc_project.ObjectMapper')\n37:conf.set_quoted('SYSTEMD_BUSNAME', 'org.freedesktop.systemd1')\n40:conf.set_quoted('VERSION_BUSNAME', 'xyz.openbmc_project.Software.Version')\n```\n\nHow does this work?  I suspect there is a more fundamental flaw in the whole repository."
                },
                {
                    "file": "xyz.openbmc_project.Software.Manager.service.in",
                    "line": 9,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Seems it's defined by the meta-phosphor/classes/obmc-phosphor-dbus-service.bbclass in openbmc/openbmc. Probably some very early design implementation that could be changed across subrepos if we want to move away from what dbus-service provides."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "software_manager.cpp",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "xyz.openbmc_project.Software.Manager.service.in",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "e3b5c3ab269a77b984136cc922432a2c3a921b41",
            "parents": [
                "30352a66bed92bbc1b12a2468d3ccb5eea500004"
            ],
            "ref": "refs/changes/83/69783/5",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1716684966,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "software_manager.cpp",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "xyz.openbmc_project.Software.Manager.service.in",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 0
        },
        {
            "number": 6,
            "revision": "d3424b7e8f2a14289e48c41e27eda82e20a05ffc",
            "parents": [
                "30352a66bed92bbc1b12a2468d3ccb5eea500004"
            ],
            "ref": "refs/changes/83/69783/6",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1716687256,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "@Adriana, Can you please merge this patch if there are no further comments? Thanks"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "software_manager.cpp",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "xyz.openbmc_project.Software.Manager.service.in",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 0
        },
        {
            "number": 7,
            "revision": "cc49878d8f7c29d1b05a27106b4ab1427c8f41a2",
            "parents": [
                "19dd56be1df79ec47bcffa621c610da5dfbf4bf6"
            ],
            "ref": "refs/changes/83/69783/7",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1718827914,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "software_manager.cpp",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "xyz.openbmc_project.Software.Manager.service.in",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 0
        }
    ]
}
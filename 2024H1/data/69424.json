{
    "project": "openbmc/entity-manager",
    "branch": "master",
    "id": "I4c502017a66567a4284ade5bef1d868736697451",
    "number": 69424,
    "subject": "configurations: add config file for OCP CX7 NIC",
    "owner": {
        "name": "PL",
        "email": "potin.lai@quantatw.com",
        "username": "potinlai"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/entity-manager/+/69424",
    "hashtags": [],
    "createdOn": 1707982866,
    "lastUpdated": 1708994342,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1707982866,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1707982898,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707982898,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1707983156,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79312/ : SUCCESS"
        },
        {
            "timestamp": 1707992683,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1707992704,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707992704,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1707993092,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79324/ : SUCCESS"
        },
        {
            "timestamp": 1707997210,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 2:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1708005895,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1708011689,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1708011954,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1708012320,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1708014124,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1708017238,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1708017834,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1708139451,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1708495387,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1708495426,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1708495426,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1708495684,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79579/ : SUCCESS"
        },
        {
            "timestamp": 1708522886,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1708533773,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1708538637,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1708612728,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1708735621,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1708979379,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1708994342,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Change has been successfully rebased and submitted as ae326c7881aacd3c9b889e787ab9c9f09548cb83"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "27075a6eb815da41d5ff169867d5312b29b76dcc",
            "parents": [
                "618c151c770de166895a9037af6afc8898420b57"
            ],
            "ref": "refs/changes/24/69424/1",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1707982866,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "configurations/cx7.json",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "40b11d989b84634d51d178804698d9f361e89fc2",
            "parents": [
                "618c151c770de166895a9037af6afc8898420b57"
            ],
            "ref": "refs/changes/24/69424/2",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1707992683,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I assume this isn't a proprietary card?  How about a pointer to the datasheeet or 1 pager for this form factor.  just googling 'cx-7 mezz' failed me.  I see several form factors listed at https://docs.nvidia.com/networking/display/connectx7vpi but none of them say 'mezz'."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Deepak - Would you want anyone from NV to weigh in on this?  I don't know if we need to have any more specifics to differentiate from other variants of CX7."
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 15,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Any reason we're not making human readable names here?\n\nAt the very least you can remove \"TEMP_C\" the units and type are already specified in a different interface that you get by default with TMP421"
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 15,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "For better or worse, at Meta we have a \"common sensor naming\" schema that we'd like to continue to follow, which puts units like this in the names.  I foresee this being a problem when we have non-Meta devices (like this CX7) that other people decide they want a _different_ sensor naming schema on.  I'm sort of kicking that can down the road for a few months (~6)."
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 15,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Understood.  It'll be interesting what we do when two companies want to use this same card and have different naming schemes, but we'll cross that lava when we come to it."
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 15,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yep, exactly.  I'm sure it will come up in the not too distant future.  That's what I'd like to get in front of in the next 6 months."
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 15,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Thanks Patrick for the explanation, yes, the current name was based on Meta's sensor naming rule.\n\nBecause Patrick mentioned that will be a feature for renaming sensors, I will just put a common sensor name for now.\n\nHi @Ed, could you help confirm the sensor name below looks OK?\n```\n\"Name\": \"NIC Temp $bus\",\n\"Name1\": \"NIC Temp $bus\",\n```"
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "just googling around, it seems to have an operational temperature limit of 55C, assuming I found the right card.\n\n https://docs.nvidia.com/networking/display/connectx7vpi/specifications"
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yeah, this is exactly my concerns.  There are different form factors of CX7 cards.  The one you linked to here is listed as an OSFP form factor, but I'm pretty sure ours are an OCP form factor (https://www.servethehome.com/ocp-nic-3-0-form-factors-quick-guide-intel-broadcom-nvidia-meta-inspur-dell-emc-hpe-lenovo-gigabyte-supermicro/).  I don't know what in the EEPROM identifies the form-factor, but we probably need to get that figured out and add it to this JSON.\n\nI found this when I searched for \"cx7 ocp nic\":\nhttps://docs.nvidia.com/networking/display/connectx7vpiocp3"
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "\"operational temperature\" is ... \"what is the environment where this product is allowed to be used\".  It is not \"what is allowed the T_junction of the chip.\""
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "oh, right. thanks."
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 37,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Presumably we need a manufacturer match here as well?   I would assume that the PCIe add in card ConnectX-7 has the same model as the mezz card, but they need different entity files (given they're physically different formfactors)."
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 37,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "@PL can you elaborate on the form factor here?  You've used the word \"mezz\", which to me indicates a riser card of some sort, but a riser doesn't have the temperature sensor (the NIC itself does).  Isn't this just an OCP NIC form factor card?\n\nhttps://www.servethehome.com/ocp-nic-3-0-form-factors-quick-guide-intel-broadcom-nvidia-meta-inspur-dell-emc-hpe-lenovo-gigabyte-supermicro/"
                },
                {
                    "file": "configurations/cx7.json",
                    "line": 37,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "@Ed\nThe \"BOARD_PRODUCT_NAME\" of the NIC in my hand is \"Nvidia ConnectX-7 OCP3.0\", should I just use entire \"Nvidia ConnectX-7 OCP3.0\" for probing?\nAnd rename the config file to \"cx7_ocp.json\" because you mentioned PCIe CX7 card need different config file?\n\n@Patrick\nThank you for the information, so I think I should change the name to \"OCP CX7 NIC $bus\"? Is it looks OK for you?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "configurations/cx7.json",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "ba12ca6feda0864f92b05f718808d8410c6a68f1",
            "parents": [
                "618c151c770de166895a9037af6afc8898420b57"
            ],
            "ref": "refs/changes/24/69424/3",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1708495387,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "configurations/cx7_ocp.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "as I think I mentioned earlier, wasn't listed as 55 in the card documentation?"
                },
                {
                    "file": "configurations/cx7_ocp.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Replied elsewhere.\n\nI _do_ think it is possible that we end up having system-specific valid temperature ranges for hardware, like this.  I don't know how to reconcile that yet with EM, but I guess we cross that bridge when we get there.\n\nAs an example one system might have a heat diffuser on the NIC that allows the temperature at this sensor to be pushed higher, or someone else might want a more conservative setting.  Right now this number is really \"Meta wants to run their configuration of CX7 on the Harma system at up to 105C\"."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "configurations/cx7_ocp.json",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "ae326c7881aacd3c9b889e787ab9c9f09548cb83",
            "parents": [
                "ec458a8035afa191803d963aa4f12d55870e3ddd"
            ],
            "ref": "refs/changes/24/69424/4",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1708994342,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "configurations/cx7_ocp.json",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/webui-vue",
    "branch": "master",
    "id": "If17d06bf0b8a372acd1980f6777227e25d9c78d8",
    "number": 70758,
    "subject": "Allow to log in when using remote authentication",
    "owner": {
        "name": "Paul Fertser",
        "email": "fercerpav@gmail.com",
        "username": "paulfertser"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/webui-vue/+/70758",
    "hashtags": [],
    "createdOn": 1712834882,
    "lastUpdated": 1716920581,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1712834882,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1712834941,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1712834941,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1712835024,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/82416/ : SUCCESS"
        },
        {
            "timestamp": 1713952041,
            "reviewer": {
                "name": "Nikhil Ashoka",
                "email": "a.nikhil@ibm.com",
                "username": "Nikhil-Ashoka"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1713953099,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1713953732,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1714657124,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1714657148,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1714657148,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1714657257,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/83739/ : SUCCESS"
        },
        {
            "timestamp": 1714657515,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714667799,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714667879,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1714717263,
            "reviewer": {
                "name": "Nikhil Ashoka",
                "email": "a.nikhil@ibm.com",
                "username": "Nikhil-Ashoka"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1714737193,
            "reviewer": {
                "name": "Kiran Kumar Ballapalli",
                "email": "kirankumarb@ami.com",
                "username": "kirankumarb07"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714737943,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714743614,
            "reviewer": {
                "name": "Kiran Kumar Ballapalli",
                "email": "kirankumarb@ami.com",
                "username": "kirankumarb07"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714754779,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714756289,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1714939495,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 2: Code-Review+2\n\n(2 comments)"
        },
        {
            "timestamp": 1714939552,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1715627247,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1715631609,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1715634120,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1715669656,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1716916926,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1716920581,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0ee67fb9a7219ef24b488ec810301b7cc832e547",
            "parents": [
                "0ad8b851afa045f51a667cde6b44f213e34bfac0"
            ],
            "ref": "refs/changes/58/70758/1",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1712834882,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 76,
                    "reviewer": {
                        "name": "Nikhil Ashoka",
                        "email": "a.nikhil@ibm.com",
                        "username": "Nikhil-Ashoka"
                    },
                    "message": "Setting remote user privilege will allow the user to navigate,But, Is it the right credential to give as administrator?"
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 76,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Yes, since we can not know the real role we have to assume the role with everything allowed, i.e. Administrator. Before Ibcee18bd92d97c34414ecaf2caf6af28070c5538 there were no front-end side restrictions at all, so for the cases where back end doesn't tell us the role we basically need to revert to the old unrestricted behaviour. Unless, of course, the probing as outlined by Ed is implemented but that's certainly outside the scope of this patch. Here I'm not giving anybody any real credentials, just changing the internal front end variable to let it try doing anyting that an administrator can do. Actual credentials and enforcement is always done by the back end anyway.\nPlease note that without the change I'm proposing it's not possible to use the web interface at all anyhow for users authenticated with LDAP. Even though everything needed is in place.\nDoes this clarify your question?"
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 76,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> Before Ibcee18bd92d97c34414ecaf2caf6af28070c5538\n\nThat should have been converted to a hyper link to https://gerrit.openbmc.org/c/openbmc/webui-vue/+/58883 automatically.\n\nI suggest Gerrit admins to consider adding\n```\n[commentlink \"githash\"]\n        match = \\\\s([0-9a-f]{40})\n        link = \"/q/$1\"\n[commentlink \"gitshorthash\"]\n        match = \\\\s([0-9a-f]{12}\\\\b)\n        link = \"/q/$1\"\n[commentlink \"changeid\"]\n        match = (I[0-9a-f]{8,40})\n        link = \"/q/$1\"\n```\nto `gerrit.config`. Can you please pass this idea to whomever is in charge of this Gerrit instance?"
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 76,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "> Here I'm not giving anybody any real credentials, just changing the internal front end variable to let it try doing anyting that an administrator can do. Actual credentials and enforcement is always done by the back end anyway.\n\nThis seems reasonable to me."
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 76,
                    "reviewer": {
                        "name": "Nikhil Ashoka",
                        "email": "a.nikhil@ibm.com",
                        "username": "Nikhil-Ashoka"
                    },
                    "message": "Does this clarify your question?\n\nYes."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "src/router/routes.js",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 2
        },
        {
            "number": 2,
            "revision": "2b33526c41c23217365e8eb0523d182bcdee622a",
            "parents": [
                "01492c3dcbdba6b463ecef63f4c769520432d829"
            ],
            "ref": "refs/changes/58/70758/2",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1714657124,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can someone please report this as a bug with steps to reproduce?  This is fine that we're working around this in the webui, but this is a failure on the Redfish interface, so it effects users beyond just the webui, and ideally should be fixed in bmcweb or ldap implementations"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Hello Ed,\n\nCan anyone suggest which Redfish interface specifically is supposed to be good for the purpose?\n\nCurrently webui asks for `/redfish/v1/AccountService/Accounts/${username}` and by definition it's something described by \"The ManagerAccount schema [which] defines the user accounts that are owned by a manager.\" But LDAP and other remote accounts are not owned by a manager, and they can not be part of the collection (as there might be no way to enumerate them all even).\n\nDo you think bmcweb might need to special-case requests for that endpoint when currently logged in user is requested and return RoleId even if it's not owned by the local manager and not present in the Accounts collection? This seems to be against what Redfish dictates."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "/redfish/v1/AccountService/Accounts/${username}\n\nIs not an appropriate way to access a redfish resource.  Navigating to /redfish/v1 -> AccountService -> Accounts and enumerating the resources, or using a filter query to find a given resource is the \"correct\" way.  Some implementations likely use UUIDs, numbers, or other things in their URL.  Even bmcweb at some point needs to move away from username, because changing the username via patch ends up changing the URL, which is a problem for implementations that expect the Accounts to be relatively immutable.\n\n\n> But LDAP and other remote accounts are not owned by a manager, and they can not be part of the collection (as there might be no way to enumerate them all even).\n\n> Do you think bmcweb might need to special-case requests for that endpoint when currently logged in user is requested and return RoleId \n\nNo, I think that bmcweb should just return the RoleId as part of the session that's created.  https://redfish.dmtf.org/schemas/v1/Session_v1.xml V1.7 includes Roles that can be used on a session, and is pretty trivial to implement I would think (we already have to do a role lookup on login).  Then after that, the UI shouldn't assume the person logged into the BMC has a user account at all, because it might not.\n\nFWIW, it's these kinds of answers which is why I really wish people would loop in Redfish maintainers when they hit walls like this, instead of implementing things like getting a ManagerAccount that might not exist, using bmcweb-specific implementation details.  (to be clear, I'm not frustrated with you for trying to fix it, I'm frustrated with the person that implemented this way initially without asking).  This seems pretty doable to fix using Session, and avoiding getting Account altogether."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": ">> /redfish/v1/AccountService/Accounts/${username}\n> \n> Is not an appropriate way to access a redfish resource.\n>...\n\nIndeed.\n\n> > Do you think bmcweb might need to special-case requests for that endpoint when currently logged in user is requested and return RoleId \n> \n> No, I think that bmcweb should just return the RoleId as part of the session that's created.\n\nYes, I see. And it is not a single role even but a set of them.\n \n> FWIW, it's these kinds of answers which is why I really wish people would loop in Redfish maintainers when they hit walls like this, instead of implementing things like getting a ManagerAccount that might not exist\n\nFor the reference, it was initially implemented for a very different purpose: to see if the interface needs to redirect user to the password change page, as no other action is possible with an expired password, see https://gerrit.openbmc.org/c/openbmc/webui-vue/+/33955 .\n\nRe getting Redfish maintainers in the loop, do you have a practical advice for the webui-vue maintainers, should it be codified somewhere?\n\n> This seems pretty doable to fix using Session, and avoiding getting Account altogether.\n\nYes, this looks like a correct and straightforward way. But what to do with the expired passwords? It should rather be fixed too along the way I guess?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Re getting Redfish maintainers in the loop, do you have a practical advice for the webui-vue maintainers\n\nConsidering Gunnar and I are active on pretty much every communications mechanism the project has, and those flows are documented in the docs folder, I don't think this needs documented further, just that we need to get folks reading the standard and understanding when they're deviating from it."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Just rebased it on top of current master so that Gerrit would report it as mergeabl e.\nIs anything else missing, have I answered all the review comments?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "Added Damian."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Kiran Kumar Ballapalli",
                        "email": "kirankumarb@ami.com",
                        "username": "kirankumarb07"
                    },
                    "message": "Partial agree on these code changes. We are knowingly allowing all remote users as Admin even if we can configure those users as Operator/Readonly as part of Role Group. Is that correct? This may lead to displaying incorrect privilege details."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> We are knowingly allowing all remote users as Admin even if we can configure those users as Operator/Readonly as part of Role Group.\n\nYes, e.g. LDAP mapping allows to map LDAP groups to Redfish groups so the remote user can be in Readonly group but we have no way to know currently. And without this change logging in is not possible at all, that's a regression (!) compared to the situation before routing restrictions were added.\n\n> This may lead to displaying incorrect privilege details.\n\nWhich part of webui displays privilege details for remote users? The remote users are not listed in the \"User management\" table at all because Redfish server can not provide a list anyway."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Kiran Kumar Ballapalli",
                        "email": "kirankumarb@ami.com",
                        "username": "kirankumarb07"
                    },
                    "message": "Yes. Currently we are not displaying privilege information in web ui but in future, we may need to display privilege information under Profile Settings for reference.\n\nYes, e.g. LDAP mapping allows to map LDAP groups to Redfish groups so the remote user can be in Readonly group but we have no way to know currently. And without this change logging in is not possible at all, that's a regression (!) compared to the situation before routing restrictions were added.\n\n[Kiran]. Ok.Understand. If others are ok,then we can proceed further."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> Currently we are not displaying privilege information in web ui but in future, we may need to display privilege information under Profile Settings for reference.\n\nGood point. So probably instead of storing fake role we should just leave it as `null` and instead modify the router restrictions? It looks like the code to filter navigation items is already handling this case.\n\nThis seems to be a neater approach, I'll check and get back to you, thank you."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> So probably instead of storing fake role we should just leave it as `null`\n\nNo, this won't work nicely because the router will try to request it again and again on any transition thinking it might be not set because we just refreshed the page (so we have the cookies, the user is logged in but the store is empty).\n\nSo I can store role `Unknown` instead and then special-case it in `allowRouterToNavigate()` and `filteredNavItem()`.\n\nWhich approach do you prefer, fake `Administrator` role (current patch as is) or special-casing for `Unknown` (the complexity will increase a bit)? Given that currently the role is not shown anywere and hopefully in the future either the web ui will get the probing functionality or at least bmcweb will start reporting real role for remote users I'd be tempted to keep the current patch."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "Acknowledged"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "I don't see any opposition to going with this and this fixes https://github.com/openbmc/webui-vue/issues/110. \nThis has sat long enough."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Filed three tickets:\n\n1. bmcweb `Roles` handling https://github.com/openbmc/bmcweb/issues/275\n2. Webui-vue coordination with Redfish maintainers https://github.com/openbmc/webui-vue/issues/117\n3. Webui-vue Redfish-correct way of handling expired passwords/accounts https://github.com/openbmc/webui-vue/issues/118"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "src/router/routes.js",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 2
        }
    ]
}
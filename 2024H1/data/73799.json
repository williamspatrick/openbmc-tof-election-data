{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "Ia33ece024c58e9d32f5815b2c69e8ab62c0c2127",
    "number": 73799,
    "subject": "Filter out query parameters in searchCollectionsArray",
    "owner": {
        "name": "Joonwon Kang",
        "email": "joonwonkang@google.com",
        "username": "make-things-better"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/73799",
    "hashtags": [],
    "createdOn": 1724047708,
    "lastUpdated": 1724163828,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1724047708,
            "reviewer": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1724048085,
            "reviewer": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "message": "Uploaded patch set 2: New patch set was added with same tree, parent tree, and commit message as Patch Set 1."
        },
        {
            "timestamp": 1724048293,
            "reviewer": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "message": "Uploaded patch set 3: New patch set was added with same tree, parent tree, and commit message as Patch Set 2."
        },
        {
            "timestamp": 1724070786,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1724083468,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1724083931,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724083944,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Ok-To-Test+1"
        },
        {
            "timestamp": 1724083974,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/90040/ : FAILURE"
        },
        {
            "timestamp": 1724083988,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724090536,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724092417,
            "reviewer": {
                "name": "Carson",
                "email": "clabrado@google.com",
                "username": "carsonlab"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1724092817,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724160069,
            "reviewer": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Ok-To-Test+1 (copy condition: \"changekind:NO_CHANGE\")\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1724160104,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1724161480,
            "reviewer": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "message": "Uploaded patch set 5: New patch set was added with same tree, parent tree, and commit message as Patch Set 4."
        },
        {
            "timestamp": 1724161510,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1724161538,
            "reviewer": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1724163742,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6: Commit message was updated."
        },
        {
            "timestamp": 1724163744,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1724163748,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6: Ok-To-Test+1"
        },
        {
            "timestamp": 1724163789,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724163789,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1724163792,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/90144/ : ABORTED"
        },
        {
            "timestamp": 1724163828,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6:\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/90145/ : FAILURE"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "5b51c34daadd4cd00bdab40daf23d3d2723399e4",
            "parents": [
                "bd79bce8c3f1deb1fb2773868b9ece25233cf27b"
            ],
            "ref": "refs/changes/99/73799/1",
            "uploader": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "createdOn": 1724047708,
            "author": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/redfish_aggregator_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 6
        },
        {
            "number": 2,
            "revision": "f6e9f2f4db5d81117f124e60f357f025660b8605",
            "parents": [
                "bd79bce8c3f1deb1fb2773868b9ece25233cf27b"
            ],
            "ref": "refs/changes/99/73799/2",
            "uploader": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "createdOn": 1724048085,
            "author": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "kind": "NO_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/redfish_aggregator_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 6
        },
        {
            "number": 3,
            "revision": "0252f115d91a203f10d076cf41ad4fe6b9c19ae8",
            "parents": [
                "bd79bce8c3f1deb1fb2773868b9ece25233cf27b"
            ],
            "ref": "refs/changes/99/73799/3",
            "uploader": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "createdOn": 1724048293,
            "author": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "You may also want to ask about getting added to the CLA list.  I don't know who the current Google CLA owner is these days.  Maybe @Carson knows?\n\nI've triggered CI manually for this patch for the moment."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Would doing something like this:\nhttps://github.com/openbmc/bmcweb/commit/6e544fb40201c53dd6377c62e37df71d24586bac\n\nGet us the same result without manual string parsing?  It seems to pass unit tests, but I remember there being subtleties here.  @Carson?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "There were subtleties that prevented us from using the existing URI helper functions.  That's why we needed this new search function.\n\nI recall issues around handling trailing '/' and then also for a given URI we had to determine if it was for any of these 3 cases:\n1. Aggregated resource\n2. Top level collection\n3. Uptree from top level collection\n\nIt turns out there was a testing gap for the last entry in the Collections array when also using query params.\n\nI tried to have pretty good coverage in the unit tests.  Your suggestion passes the unit tests so I'm good with doing that version instead."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Carson",
                        "email": "clabrado@google.com",
                        "username": "carsonlab"
                    },
                    "message": "I'm not sure, but my guess would be benjaminfair@google.com"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "That was my recollection as well.  I wasn't sure if there was something that wasn't covered by unit tests, but they seemed pretty good.  I know we had subtleties around segments_ref and segments_view that got hairy, and I know boost url changes some of those when it was included in \"real\" boost, but I think that patchset covers all the cases.\n\nif Joonwon is good with that too, lets get this patchset updated and we should be good to go."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Joonwon Kang",
                        "email": "joonwonkang@google.com",
                        "username": "make-things-better"
                    },
                    "message": "Thanks for the history that I wasn't aware of very much, and also the great suggestion. I have refactored the code and kept the empty segment check as in the original code."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Joonwon Kang",
                        "email": "joonwonkang@google.com",
                        "username": "make-things-better"
                    },
                    "message": "What do you mean by \"CLA\"? Is it Contributor License Agreement? If so, can I just ask @benjaminfair@google.com to add me in the CLA list to get the right?"
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "We parse the url into a proper object on line 86, which implements support for handling the query param using a proper parser (rather than using find, which can be error prone, and might not implement the URL parsing spec properly).\n\nIs there any way we can just move the line 81 to after we parse the URI, and operate on parsedUrl->segments.last() instead?  That would ensure that we're still parsing the URL properly."
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Joonwon Kang",
                        "email": "joonwonkang@google.com",
                        "username": "make-things-better"
                    },
                    "message": "Thanks for a better solution. Have updated the code according to your suggestion."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/redfish_aggregator_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 6
        },
        {
            "number": 4,
            "revision": "b5d7c030d5fe92a210d65c6727d20c3ab058d920",
            "parents": [
                "bd79bce8c3f1deb1fb2773868b9ece25233cf27b"
            ],
            "ref": "refs/changes/99/73799/4",
            "uploader": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "createdOn": 1724160069,
            "author": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/redfish_aggregator_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -32
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 32
        },
        {
            "number": 5,
            "revision": "5258df2998d3dea3ee061d74b1f545b0ba3b974c",
            "parents": [
                "bd79bce8c3f1deb1fb2773868b9ece25233cf27b"
            ],
            "ref": "refs/changes/99/73799/5",
            "uploader": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "createdOn": 1724161480,
            "author": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "kind": "NO_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/redfish_aggregator_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -32
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 32
        },
        {
            "number": 6,
            "revision": "4912735adb43c7ad421ff782a36617da65ea18ae",
            "parents": [
                "bd79bce8c3f1deb1fb2773868b9ece25233cf27b"
            ],
            "ref": "refs/changes/99/73799/6",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1724163742,
            "author": {
                "name": "Joonwon Kang",
                "email": "joonwonkang@google.com",
                "username": "make-things-better"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/include/redfish_aggregator_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/include/redfish_aggregator.hpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -32
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 32
        }
    ]
}
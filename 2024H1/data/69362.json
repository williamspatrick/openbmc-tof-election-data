{
    "project": "openbmc/phosphor-dbus-interfaces",
    "branch": "master",
    "topic": "AllowedPowerModes",
    "id": "I4b8285adaabb2aa42592e73f259d9636832f904b",
    "number": 69362,
    "subject": "Control.Power.Mode: Add AllowedPowerModes property",
    "owner": {
        "name": "Chris Cain",
        "email": "cjcain@us.ibm.com",
        "username": "cjcain"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/69362",
    "hashtags": [],
    "createdOn": 1707765860,
    "lastUpdated": 1708355690,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1707765860,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1707765882,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707765887,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1707766210,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79122/ : SUCCESS"
        },
        {
            "timestamp": 1707768741,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1707768755,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1707769875,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1707769956,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 2: Published edit on patch set 1.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1707769982,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707769982,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1707770355,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79133/ : SUCCESS"
        },
        {
            "timestamp": 1707770977,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1707771143,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1707777331,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 3: Published edit on patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1707777346,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1707777358,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707777358,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1707777695,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79139/ : SUCCESS"
        },
        {
            "timestamp": 1707844189,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1707849176,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1707866810,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 4: Published edit on patch set 3.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1707866839,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1707866839,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1707867229,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/79206/ : SUCCESS"
        },
        {
            "timestamp": 1707867550,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1707867930,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1707946112,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Topic set to AllowedPowerModes"
        },
        {
            "timestamp": 1708119253,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1708355685,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1708355690,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as fdcdfbef30771a422e0d170e56fd14ed1b7a11f0"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "718a338ad5fdf61c229ac190cfd03de42eea4606",
            "parents": [
                "e0466093ab40f57a409c6d1d21043cb7506b3405"
            ],
            "ref": "refs/changes/62/69362/1",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1707765860,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Who should additionally review this?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 5,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Should this have a default value of \"Static\"?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 5,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "I don't think it is something we would want to default. If not set, then I would assume they do not support/use a PowerMode. (IBM uses this, but does not use Static by default)"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 5,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "But that is an implementation choice, isn't it?  Your implementation can use something other than static as a default.  Putting static as the default here just says \"if the implementation doesn't set this properly, then 'static' because the initial value in the bindings\"."
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 5,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 22,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "set"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 22,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Is set replacing array? or is there some distinction? I only see one other use of set (vs others using array)?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 22,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gunnar@gmills.xyz",
                        "username": "gtmills"
                    },
                    "message": "https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/68933/7/yaml/xyz/openbmc_project/State/Host.interface.yaml is an array. I would think it should match?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 22,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 22,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "'set' is newer in sdbusplus.  Some of the existing interfaces use 'array' because no one has put in the effort to fix it.\n\nThey both go across dbus the same (as an array) but in generated code you get `std::set` instead of `std::array` which means automatic duplicate removal and easy `foo.contains(bar)` kind of lookup instead of `std::find(...)`."
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 29,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Should this have a default value of \"[Static]\"?  I'm not positive if that is even possible for array/sets (in the YAML)."
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 29,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "I don't think we need a default. This property is intended for Redfish, so if not defined/set, Redfish would not publish the property.  (Currently the default in bmcweb is MaximumPerformance,Static,PowerSaver)"
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 29,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "There is no such thing as an optional property in dbus.  If you don't put something here, the default binding implementation will generate a literal empty array as the values.  This doesn't seem appropriate when every machine should support at least Static (as by definition that means effectively none).\n\nI'm somewhat ok with an empty array based on the comment you added in description, but I am leaving as unresolved for your confirmation."
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 29,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Acknowledged"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 34,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "4f4a8fc36044d1c6da0e469fbc2dbf10519fe31a",
            "parents": [
                "e0466093ab40f57a409c6d1d21043cb7506b3405"
            ],
            "ref": "refs/changes/62/69362/2",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1707769956,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 28,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "It would be good to put in writing what is expected to happen if the property is left empty, as my guess would have been you couldn't set a power mode at all."
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 28,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 34,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "022e30c96c0d97feee2c46c1656383ff772214b7",
            "parents": [
                "e0466093ab40f57a409c6d1d21043cb7506b3405"
            ],
            "ref": "refs/changes/62/69362/3",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1707777331,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 28,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "There is no such thing as \"not specified\" in dbus."
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "line": 28,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "7a0835547545a60f025e55bffdda6f8b17d7fcb8",
            "parents": [
                "e0466093ab40f57a409c6d1d21043cb7506b3405"
            ],
            "ref": "refs/changes/62/69362/4",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1707866810,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "fdcdfbef30771a422e0d170e56fd14ed1b7a11f0",
            "parents": [
                "308004bcafc31ffa6cf895c9e04613482592459c"
            ],
            "ref": "refs/changes/62/69362/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1708355690,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/Control/Power/Mode.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 0
        }
    ]
}
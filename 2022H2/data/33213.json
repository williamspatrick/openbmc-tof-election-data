{
    "project": "openbmc/sdbusplus",
    "branch": "master",
    "id": "I240e871da1fb56bb55bf2bb98d73e77747a0f645",
    "number": 33213,
    "subject": "build: Prefer installed native sdbus++ tools",
    "owner": {
        "name": "William A. Kennington III",
        "email": "wak@google.com",
        "username": "wak-google"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/sdbusplus/+/33213",
    "hashtags": [],
    "createdOn": 1591264264,
    "lastUpdated": 1662338351,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1591264264,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1591264292,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1591264304,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1:\n\nBuild Started https://openpower.xyz/job/openbmc-repository-ci/50920/"
        },
        {
            "timestamp": 1591264419,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1591264446,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1591264456,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://openpower.xyz/job/openbmc-repository-ci/50920/ : ABORTED"
        },
        {
            "timestamp": 1591264468,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2:\n\nBuild Started https://openpower.xyz/job/openbmc-repository-ci/50925/"
        },
        {
            "timestamp": 1591265380,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://openpower.xyz/job/openbmc-repository-ci/50925/ : SUCCESS"
        },
        {
            "timestamp": 1591270026,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1591302535,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1591309273,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1591309310,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1591309347,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 3:\n\nBuild Started https://openpower.xyz/job/openbmc-repository-ci/51000/"
        },
        {
            "timestamp": 1591310352,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://openpower.xyz/job/openbmc-repository-ci/51000/ : SUCCESS"
        },
        {
            "timestamp": 1591327071,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1591327403,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1591330358,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1591567739,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1591567803,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1591567813,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 4:\n\nBuild Started https://openpower.xyz/job/openbmc-repository-ci/51172/"
        },
        {
            "timestamp": 1591567838,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://openpower.xyz/job/openbmc-repository-ci/51172/ : FAILURE"
        },
        {
            "timestamp": 1662338351,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Abandoned"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "db6a7fc7508a114d9b979ca3619412a75705c426",
            "parents": [
                "7f99709b7e7c04a602084efbcad48b3cf3c6db2b"
            ],
            "ref": "refs/changes/13/33213/1",
            "uploader": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "createdOn": 1591264264,
            "author": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "tools/meson.build",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -2
                },
                {
                    "file": "example/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "a97b7389d72a0e5e9a8b6442059063b9a4a16f0a",
            "parents": [
                "7f99709b7e7c04a602084efbcad48b3cf3c6db2b"
            ],
            "ref": "refs/changes/13/33213/2",
            "uploader": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "createdOn": 1591264419,
            "author": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "meson.build",
                    "line": 33,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Thanks for this comment.  I understand the situation a lot better after reading this.\n\nI'm concerned about a frustrating experience for someone who might be using the SDK or something like the openbmc-test docker image to do development on this repository.  It is fairly non-obvious to be using tools from outside the repository when they exist in the repository.\n\nIs there something we can do instead to detect a cross-compile situation and only do that in that case?  I think meson gives us that facility.\n\n(I am curious where you ran into this though because we didn't have the problem with the Yocto build)"
                },
                {
                    "file": "meson.build",
                    "line": 33,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "I think the frustrating experience is something one would end up experiencing with any out of date dependencies. I can see how this is more annoying with repos like sdbusplus in which we iterate our tooling more frequently. However, I think this is mitigated as users stop using the SDK environment and just start running directly with meson on their system or through the CI environment. If they are using bitbake directly the dependencies will always be kept in sync here. In general we should discourage users from installing openbmc dependencies in their build environments unless they are automatically managed, to prevent this kind of staleness.\n\nIt is annoying to have to deal with this in python because python doesn't really have a concept of packages per architecture. So it is preferred to separate native tooling and isolate its usage of python packages, allowing the build to have its own python packages that are intended to allow references in installed scripting. I'm not 100% sure why this doesn't affect yocto, but I think it is lax in that it allows native and cross python dependencies to be mixed as long as they end up working."
                },
                {
                    "file": "meson.build",
                    "line": 33,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "My 2 cents with sdbusplus:\nFor automation, I always use docker from openbmc-test-automation.\nFor development, I'd like to use OpenBMC SDK whenever possible\nIn some cases where SDK does not work, I have to work in yocto environment (e.g. devtool xxx)\n\nBut I know there are projects outside openbmc are using sdbusplus as well, so I am OK with changes that helps others as long as it does not break the SDK/yocto environment."
                },
                {
                    "file": "meson.build",
                    "line": 33,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "You can definitely still use the SDK environment if you want, you just can't let the version of sdbus++ lag far enough behind that it breaks your development version of openbmc. We could probably add something to detect that environment if it really bothers people and always uses the vendored copy of sdbus++.\n\nOnce all of the patches on top go in, you won't really even need the SDK to develop sdbusplus. You can just use meson locally. stdplus, sdeventplus, gpioplus have almost all their dependencies substitutable in meson so you can typically just run `meson build` `meson test -C build` and the tests just build and run."
                },
                {
                    "file": "meson.build",
                    "line": 33,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "The \"you can use meson directly\" assumes that your localhost's compiler is sufficiently advanced enough to compile sdbusplus.  Some people on the project don't have that luxury and rely on things like docker containers and SDKs to get them a compiler that is \"advanced enough\".\n\n>  I'm not 100% sure why this doesn't affect yocto, but I think it is lax in that it allows native and cross python dependencies to be mixed as long as they end up working.\n\nWith Yocto we explicitly use the python3-native bbclass, which sets up your path so that `python3` is the Yocto-compiled nativepython.\n\n> You can definitely still use the SDK environment if you want, you just can't let the version of sdbus++ lag far enough behind that it breaks your development version of openbmc.\n\nMy concern isn't about the SDK being out of date with the repository.  My concern is that someone doing sdbusplus/sdbus++ development in an SDK ends up being very confused and frustrated why the changes they are making to sdbus++ (and associated templates) are not taking affect.  Right now we're not giving any obvious way to identify and \"fix up\" that scenario.\n\n\nCan you restate the case where this ends up being a problem?  Since it isn't a problem in Yocto due to nativepython, I'm having trouble understanding what other cases there are when we want the build to use the native-python but it ends up using the target-python.  If it really is a problem exclusively with cross-compiling, can't we use 'meson.is_cross_build()' to identify this case and choose the non-local version only under that condition?  Though without experimentation, I'm not convinced that actually helps out the poor SDK user..."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "tools/meson.build",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -2
                },
                {
                    "file": "example/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 29,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "a1b60b747670adebcd8b48710bb648182a4bb5fb",
            "parents": [
                "7f664254a4365612b82db2fd8fb82798686e777b"
            ],
            "ref": "refs/changes/13/33213/3",
            "uploader": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "createdOn": 1591309273,
            "author": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "tools/meson.build",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -2
                },
                {
                    "file": "example/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 29,
            "sizeDeletions": 4
        },
        {
            "number": 4,
            "revision": "6378e6346bd91bfa04491f4fd12dec48640bda77",
            "parents": [
                "6b9d4a7944378354e3c54f604602090815c8b715"
            ],
            "ref": "refs/changes/13/33213/4",
            "uploader": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "createdOn": 1591567739,
            "author": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "tools/meson.build",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -2
                },
                {
                    "file": "example/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 29,
            "sizeDeletions": 4
        }
    ]
}
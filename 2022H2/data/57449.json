{
    "project": "openbmc/obmc-ikvm",
    "branch": "master",
    "id": "I0b0c51dac1c3c572c79d8b3dd8ed925b2e4eff7e",
    "number": 57449,
    "subject": "Add socket file to KVMIP service",
    "owner": {
        "name": "Snehalatha Venkatesh",
        "email": "snehalathax.v@intel.com",
        "username": "Snehalatha44"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/obmc-ikvm/+/57449",
    "hashtags": [],
    "createdOn": 1664264143,
    "lastUpdated": 1667535867,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1664264143,
            "reviewer": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1664264256,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664264261,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1664264284,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52481/ : SUCCESS"
        },
        {
            "timestamp": 1664265644,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1664268439,
            "reviewer": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1664268479,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1"
        },
        {
            "timestamp": 1664268520,
            "reviewer": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1664268521,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664268522,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1664268553,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52484/ : SUCCESS"
        },
        {
            "timestamp": 1664309617,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1664935203,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1665001475,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1665041420,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1665200829,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1665200943,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1665399757,
            "reviewer": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1665399800,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1"
        },
        {
            "timestamp": 1665399877,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1665399878,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1665400014,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/53228/ : SUCCESS"
        },
        {
            "timestamp": 1667535867,
            "reviewer": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "message": "Abandoned\n\nAbandoning as this change is not required."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d3b8294f01016e02ec6cb9f094558111eef98914",
            "parents": [
                "9d545472be11795239a6cdf736d44a50dde9289a"
            ],
            "ref": "refs/changes/49/57449/1",
            "uploader": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "createdOn": 1664264143,
            "author": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Could you provide some more info on the motivation here?  (i.e. what functionality is missing that this provides, etc.)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Snehalatha Venkatesh",
                        "email": "snehalathax.v@intel.com",
                        "username": "Snehalatha44"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "I'm afraid this doesn't really make things much clearer to me...I am admittedly missing some background on Redfish, but at least a brief summary of what NetworkProtocol is or does would be good.  Is there some end-user functionality that this enables?  Is it just for redfish spec compliance?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm assuming the motivation is that to change the port, today we rely on service files.\n\nI'm still not really sure why we would do this.  The KVM doesn't directly support authentication, so you really shouldn't be exposing the socket outside of the BMC, which would mean that it shoudln't really be in Redfish."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "I don't know the redfish details here (adding Ed to the CC list in case he wants to chime in), but is this meant to imply that an external client should expect to be able to reach the service on port 5900?  The daemon only listens for localhost connections, so I'm not sure it's a service we should really be advertising -- and even if we were to expose it, I believe it's RFC-non-compliant in some fairly critical ways that mean a lot of generic VNC/RFB clients wouldn't be able to interoperate with it anyway."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> I don't know the redfish details here (adding Ed to the CC list in case he wants to chime in), but is this meant to imply that an external client should expect to be able to reach the service on port 5900?\n\nYes\n\n>  The daemon only listens for localhost connections,\n\nThat's the intent, but if I'm reading this correctly, I think this changes that behavior.\n\n\n> so I'm not sure it's a service we should really be advertising -- and even if we were to expose it, I believe it's RFC-non-compliant in some fairly critical ways that mean a lot of generic VNC/RFB clients wouldn't be able to interoperate with it anyway.\n\nI thought it was RFB compliant (when we use it in the webui, we use the standard component) but just didn't have security."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "> I thought it was RFB compliant\n\nA while back I was playing around with a toy client I wrote and ran into problems with negotiating the framebuffer update format/encoding...since it was a very dumb, simple client I had it sending a SetEncodings message specifying only the raw format, and the server appeared to accept that, but then carried on sending TightJPEG encoded updates instead -- I think that stems from some of the hard-coding going on here: https://github.com/openbmc/obmc-ikvm/blob/9d545472be11795239a6cdf736d44a50dde9289a/ikvm_server.cpp#L163-L166 (And that in turn I think is likely a side-effect of it being the format provided by the Aspeed video hardware.)\n\nFor clients that support that encoding and send it in their SetEncodings message (which might be fairly common) that part at least should work without a problem, but I also have some vague recollection of running into problems trying various existing (\"real\") VNC clients against obmc-ikvm (via an SSH port forward), though I don't recall the details..."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "> That's the intent, but if I'm reading this correctly, I think this changes that behavior.\n\nThough actually...does it?  It adds a socket file, which I guess has systemd listen on port 5900, but wouldn't it also need some changes to the daemon itself to use that mechanism?  (i.e. sd_listen_fds() or similar I guess, looking at corresponding code in bmcweb.)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "Jiaqing Zhao",
                        "email": "jiaqing.zhao@intel.com",
                        "username": "jiaqingz-intel"
                    },
                    "message": "Agreed, obmc-ikvm does not use the socket provided by systemd, it hardcodes 5900."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "start-ipkvm.socket",
                    "type": "ADDED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "a17bcd269d58a3b13548d8676431da1bbbfdc66a",
            "parents": [
                "9d545472be11795239a6cdf736d44a50dde9289a"
            ],
            "ref": "refs/changes/49/57449/2",
            "uploader": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "createdOn": 1664268439,
            "author": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "This isn't the kind of information we generally put in commit messages.  Also, the second link is to a private repo, so it isn't really useful to anyone outside of Intel.  (And if this patch really does depend on Intel-internal stuff, why are we trying to upstream it?)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "+1.  I'm assuming this meant to point at the upstream equivalent?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jiaqing Zhao",
                        "email": "jiaqing.zhao@intel.com",
                        "username": "jiaqingz-intel"
                    },
                    "message": "Pasting my comments at https://gerrit.openbmc.org/c/openbmc/bmcweb/+/57447 here\n\n\nWhy we need this port for KVM? Port 5900 only accepts connections from localhost (BMC itself). It is unusable by users.\n\nIn our case, bmcweb will act as a proxy which passes the requests/responses between its kvm websocket and port 5900 (where libvncserver listens, since it cannot listen a unix socket, we have to do so).\n\nAnd, enabling/disabling KVM makes no sense from my point. Unlike java-based one which has another port and some private protocol (maybe unencrypted?), OpenBMC's kvm is just a payload of HTTPS/WSS, it won't bring extra security issues."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "start-ipkvm.socket",
                    "type": "ADDED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "07e3938ce46f4a42db696c5914a18b77743e0e68",
            "parents": [
                "9d545472be11795239a6cdf736d44a50dde9289a"
            ],
            "ref": "refs/changes/49/57449/3",
            "uploader": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "createdOn": 1665399757,
            "author": {
                "name": "Snehalatha Venkatesh",
                "email": "snehalathax.v@intel.com",
                "username": "Snehalatha44"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "start-ipkvm.socket",
                    "type": "ADDED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/pldm",
    "branch": "master",
    "id": "I86b2c056ea6628ed4dffeb7ad754bdd1ba295f42",
    "number": 57078,
    "subject": "PLDM : Changes in setDateTime command",
    "owner": {
        "name": "Pavithra Barithaya",
        "email": "pavithra.b@ibm.com",
        "username": "Pavithrab7"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/pldm/+/57078",
    "hashtags": [],
    "createdOn": 1662980005,
    "lastUpdated": 1664338941,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1662980005,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1663063906,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1663063965,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663063966,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1663064396,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50679/ : SUCCESS"
        },
        {
            "timestamp": 1663248724,
            "reviewer": {
                "name": "Tom Joseph",
                "email": "rushtotom@gmail.com",
                "username": "tomjoseph83"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1663249818,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1663302220,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1663302247,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1663302329,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663302329,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1663302703,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50818/ : SUCCESS"
        },
        {
            "timestamp": 1663316451,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1663318406,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1663565085,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1663575895,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1663577130,
            "reviewer": {
                "name": "Tom Joseph",
                "email": "rushtotom@gmail.com",
                "username": "tomjoseph83"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1663578793,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1663824325,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1664190502,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1664190569,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664190569,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1664191006,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52428/ : SUCCESS"
        },
        {
            "timestamp": 1664191057,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1664191191,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1664191352,
            "reviewer": {
                "name": "ManojKiran Eda",
                "email": "manojkiran.eda@gmail.com",
                "username": "manojkiraneda"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1664238119,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1664264232,
            "reviewer": {
                "name": "Tom Joseph",
                "email": "rushtotom@gmail.com",
                "username": "tomjoseph83"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1664265553,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1664338941,
            "reviewer": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "message": "Change has been successfully rebased and submitted as 297720aa6a0bdf60ace81b30c196e9c04471e5d4"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "a62326174560d0f08abbccbe9c3322664ba05326",
            "parents": [
                "36ee6f80289a27f6ef9fedc1bcd6670e42b01700"
            ],
            "ref": "refs/changes/78/57078/1",
            "uploader": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "createdOn": 1662980005,
            "author": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 40,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "7342b21c4ef3f5cd6e7f3b8334ab5047ca4373eb",
            "parents": [
                "36ee6f80289a27f6ef9fedc1bcd6670e42b01700"
            ],
            "ref": "refs/changes/78/57078/2",
            "uploader": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "createdOn": 1663063906,
            "author": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Tom Joseph",
                        "email": "rushtotom@gmail.com",
                        "username": "tomjoseph83"
                    },
                    "message": "Looks good to me. Lei Yu any comments?"
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 175,
                    "reviewer": {
                        "name": "Tom Joseph",
                        "email": "rushtotom@gmail.com",
                        "username": "tomjoseph83"
                    },
                    "message": "Do we want to log this informational trace?"
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 175,
                    "reviewer": {
                        "name": "ManojKiran Eda",
                        "email": "manojkiran.eda@gmail.com",
                        "username": "manojkiraneda"
                    },
                    "message": "+1, looks like an informational trace. please make it a cout."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 175,
                    "reviewer": {
                        "name": "Pavithra Barithaya",
                        "email": "pavithra.b@ibm.com",
                        "username": "Pavithrab7"
                    },
                    "message": "Done"
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 182,
                    "reviewer": {
                        "name": "ManojKiran Eda",
                        "email": "manojkiran.eda@gmail.com",
                        "username": "manojkiraneda"
                    },
                    "message": "would be good to add additional details like the property name/ interface/object path here."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 182,
                    "reviewer": {
                        "name": "Pavithra Barithaya",
                        "email": "pavithra.b@ibm.com",
                        "username": "Pavithrab7"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 41,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "209c009a64ae3a6becc887f736e6f5994792a940",
            "parents": [
                "7961231977fe132da914c128012c00ce62aea603"
            ],
            "ref": "refs/changes/78/57078/3",
            "uploader": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "createdOn": 1663302220,
            "author": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "As long as https://github.com/openbmc/openbmc/issues/3459 or https://github.com/systemd/systemd/issues/11420 is \"really\" fixed, this change will not be needed.\n\nFor now I have no strong opinion of this change and I'm OK with it."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "ManojKiran Eda",
                        "email": "manojkiran.eda@gmail.com",
                        "username": "manojkiraneda"
                    },
                    "message": "> this change will not be needed.\n\nI am not sure how the issues mentioned above are related\n\n#11420 - talks about two issues:\n1. Not being able to set the manual time for sometime after disabling the NTP mode\n2. Being able to set the manual time for some time after enabling the NTP mode\n\nThe current commit :\nchecks if we are in NTP mode - and \n- returns to host without actually setting the time (if in NTP mode).\n- it sets the time and returns to host (if it in Manual mode).\n\nDespite above issues being fixed, this commit is needed in order to prevent host and BMC(in NTP) to set the time and mess up generating a time drift. Which is what we are trying to avoid by this commit."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "This doesn't completely solve your problem:\nBecause, if you change from NTP mode to Manual mode, the NTP service will take a period of time to stop. During this period, the Manual default is seen on DBus, but it is still NTP, so we still have this problem when calling the setTime method.\n\n@Lei, What do you think?"
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "ManojKiran Eda",
                        "email": "manojkiran.eda@gmail.com",
                        "username": "manojkiraneda"
                    },
                    "message": "> This doesn't completely solve your problem:\n> Because, if you change from NTP mode to Manual mode, the NTP service will take a period of time to stop. During this period, the Manual default is seen on DBus, but it is still NTP, so we still have this problem when calling the setTime method.\n> \n> @Lei, What do you think?\n\n@George - not sure I am getting how this is related to a problem in PLDM.\nWhen host sets time \n```\nif(ntp mode) -> don't set the time again\nif not -> set th time\n```\n\nI think the problem that you are mentioning should be fixed in the time manager or systems-timesyncd to make sure you still return the result as NTP until we completely move to manual mode."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "This really depends on the requirement about if you allow setting time when NTP is enabled or not.\n\nThe issue mentioned by George is the use case that user sets BMC time when the sync method is changed from NTP to Manual.\n\nWe have a downstream patch in time-manager that allows setting time in NTP, and it resolves such issues.\n\n@George @ManojKiran I think it could be discussed in the mailing list and see the community feedback.\nIf it's accepted that settings time in NTP mode is allowed (and the time set will be \"reverted\" if NTP is synced again), then I could send the downstream patch to upstream."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "> This really depends on the requirement about if you allow setting time when NTP is enabled or not.\n> \n> The issue mentioned by George is the use case that user sets BMC time when the sync method is changed from NTP to Manual.\n> \n> We have a downstream patch in time-manager that allows setting time in NTP, and it resolves such issues.\n> \n> @George @ManojKiran I think it could be discussed in the mailing list and see the community feedback.\n> If it's accepted that settings time in NTP mode is allowed (and the time set will be \"reverted\" if NTP is synced again), then I could send the downstream patch to upstream.\n\nOkay, I will send an email to discuss this issue, but for now I agree with the current way, we can update it later if there are changes."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "Tom Joseph",
                        "email": "rushtotom@gmail.com",
                        "username": "tomjoseph83"
                    },
                    "message": "@Lei Yu, are you suggesting we don't need this check, if your patches are accepted?"
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "> @Lei Yu, are you suggesting we don't need this check, if your patches are accepted?\n\n@Tom, I sent an email, welcome to leave your suggestion \nhttps://lore.kernel.org/openbmc/CANFuQ7DkAwQqLZoOMPmTURUWDdk=Kfx1xTFN2jE9VQQH-wmhSA@mail.gmail.com/T/#u"
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 173,
                    "reviewer": {
                        "name": "Pavithra Barithaya",
                        "email": "pavithra.b@ibm.com",
                        "username": "Pavithrab7"
                    },
                    "message": "This discussion might be going on in that mail chain and is related to time-manager repo but this commit is needed in order to prevent host and BMC(in NTP) to set the time and mess up generating a time drift."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 175,
                    "reviewer": {
                        "name": "Tom Joseph",
                        "email": "rushtotom@gmail.com",
                        "username": "tomjoseph83"
                    },
                    "message": "IPMI SetSELTime used to be send by host firmware at a frequency of a minute on certain platforms, we certainly don't want informational traces to flood journal."
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "line": 175,
                    "reviewer": {
                        "name": "Pavithra Barithaya",
                        "email": "pavithra.b@ibm.com",
                        "username": "Pavithrab7"
                    },
                    "message": "Done\nremoved the trace"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 4
        },
        {
            "number": 4,
            "revision": "d101c8f289bf2547df98ea890e5c05411ceb92a3",
            "parents": [
                "6289ea1bf855fa63ba38bc6721bfe2471a7a9196"
            ],
            "ref": "refs/changes/78/57078/4",
            "uploader": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "createdOn": 1664190502,
            "author": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 4
        },
        {
            "number": 5,
            "revision": "297720aa6a0bdf60ace81b30c196e9c04471e5d4",
            "parents": [
                "e7cc869022631c6e728cdc531d9a6dda3b43f81f"
            ],
            "ref": "refs/changes/78/57078/5",
            "uploader": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "createdOn": 1664338941,
            "author": {
                "name": "Pavithra Barithaya",
                "email": "pavithra.b@ibm.com",
                "username": "Pavithrab7"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "libpldmresponder/bios.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 4
        }
    ]
}
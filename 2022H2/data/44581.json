{
    "project": "openbmc/docs",
    "branch": "master",
    "topic": "design",
    "id": "I8751a9d19cfd7425d5efb8f61c1f506e2db4b3d2",
    "number": 44581,
    "subject": "designs: rsyslog modular configuration",
    "owner": {
        "name": "Benjamin Fair",
        "email": "benjaminfair@google.com",
        "username": "BenjaminFair"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/44581",
    "hashtags": [],
    "createdOn": 1625006146,
    "lastUpdated": 1665657929,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1625006146,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1625006158,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Topic set to designs"
        },
        {
            "timestamp": 1625006178,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Topic designs removed"
        },
        {
            "timestamp": 1625006182,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Topic set to design"
        },
        {
            "timestamp": 1625006464,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 1:\n\nCurrent version of the changes from this design: https://gerrit.openbmc-project.xyz/q/topic:%22rsyslog-refactor%22+(status:open%20OR%20status:merged)"
        },
        {
            "timestamp": 1625071234,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1640116428,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 1:\n\n(3 comments)\n\nI would like to push this proposal a bit, because it covers really annoying problem."
        },
        {
            "timestamp": 1640127022,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1640127370,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1640154049,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)\n\nThere still a space to improve proposal, but we stuck for a half year without any ideas. Let's move forward."
        },
        {
            "timestamp": 1640178466,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1640178600,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1641800933,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1641855349,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1641879358,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1665657929,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Abandoned\n\nclose due to inactivity"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "9cca861a129daae40f6461d5fe2fba80c8a522df",
            "parents": [
                "5357b00be20d3b2cb686bdfb45dd91c2e1cf47fc"
            ],
            "ref": "refs/changes/81/44581/1",
            "uploader": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "createdOn": 1625006146,
            "author": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 51,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Why wouldn't these go in phosphor-sel-logger as well?  Isn't it \"in charge\" of the rsyslog config?  Today bmcweb doesn't take a dependency on rsyslog at all, I'm not sure I want to start with this change."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 51,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "\"redfish\"-logs do nothing with \"SEL\" - I don't see any reasons to go there. \nbmcweb work with /var/log/redfish log file, generated by rsyslog. Nothing else currently use this file, it fully owned by bmcweb, so it sounds reasonable that bmcweb would provide rules on how to generate the log.\nOther hand, /var/log/ipmi_sel, actually, also used by bmcweb - here more hard to ind responsible."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 51,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "This was my thinking too. At some point, we may want to drop IPMI support (including IPMI SEL and therefore phosphor-sel-logger as a whole), but still allow Redfish and application crash logs to be generated"
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can we give this an openbmc specific name?  \"rsyslog\" in the context of yocto could mean a lot of thing."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "+1"
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "PACKAGECONFIGs are scoped only to each recipe, and these are OpenBMC recipes already, so it seems redundant to include \"openbmc\" in the config name.\n\nThe concept represented here is \"should this OpenBMC daemon include support for rsyslog?\", just like how other recipes use PACKAGECONFIG to turn features on or off."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I would suggest using a DISTROFEATURE instead.  At a recipe level it can be configured using PACKAGECONFIG but that should be automatic with a DISTRO or MACHINE feature."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "What about another alternative: to keep all modules in rsyslog_%.bbappend and provide configuration options to enable required?"
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "This would work, but goes against the common OpenBMC design goal of having application-specific config files be stored and managed within the repos for those applications (see systemd service files as an example).\n\nI'll add it to this section as an alternative though"
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "Right, but this case it's not so easy to determine \"those applications\". For logs we have two types of applications, related on this logs - producers and consumers:\n* For IPMI SEL producer is phosphor-sel-logger and consumers are phosphor-host-ipmid, intel-ipmi-oem and bmcweb.\n* For \"redfish\" logs there are open list of producers (phosphor-sel-logger, entity-manager, dbus-sensors, x86-power-control, telemetry, phosphor-post-code-manager, phosphor-net-ipmid, pfr-manager, estoraged, host-error-monitor, intel-ipmi-oem, ...) and only one consumer - bmcweb. \n\nI don't know, how does it work for crashdumps, but for both other `phosphor-sel-logger` appears in producers list and `bmcweb` - in consumers list, so it seems to be not logical to place one to sel-logger and other - to bmcweb...\n\nAnyway, this is much better approach then what we have today, so I gonna give +1 here."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Shouldn't it always go with the \"producer\"?"
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "As I said, for \"redfish\" logs there a lot of producers."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> As I said, for \"redfish\" logs there a lot of producers.\n\nThis is partially why this entire design is garbage to begin with but I know that isn't the fault of you or the author of this proposal.\n\nIs the rsyslog config for bmcweb common across all these producers or do they each contribute a subset of the \"these are the magic flags you should look for from me in order to write to the bmcweb.log file\"?\n\nI guess the important thing is to put the configuration in the \"most common repository\" no matter if that is the producer or consumer."
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "> Is the rsyslog config for bmcweb common across all these producers or do they each contribute a subset of the \"these are the magic flags you should look for from me in order to write to the bmcweb.log file\"?\n\nThey have very common format, see here:\nhttps://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/44113/3/rsyslog/50-redfish.conf#16\n\n> I guess the important thing is to put the configuration in the \"most common repository\" no matter if that is the producer or consumer.\n\nI believe exactly the same logic had Benjamin putting it to bmcweb repo."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "type": "ADDED",
                    "insertions": 82,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "0588ebbf37a50f3466cec303ee3c279772d05a91",
            "parents": [
                "f257823b95ed7295bebf36fce929262f54f8042e"
            ],
            "ref": "refs/changes/81/44581/2",
            "uploader": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "createdOn": 1640127370,
            "author": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/rsyslog-conf.md",
                    "type": "ADDED",
                    "insertions": 88,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 102,
            "sizeDeletions": 0
        }
    ]
}
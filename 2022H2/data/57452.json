{
    "project": "openbmc/obmc-console",
    "branch": "master",
    "topic": "sysrq",
    "id": "I5d67611788d2e9d60195219b2d3cfd7fb715eca4",
    "number": 57452,
    "subject": "obmc-console: Add sysrq handle in sol socket handle.",
    "owner": {
        "name": "Chen Tingting",
        "email": "chentingting.2150@bytedance.com",
        "username": "chen2150"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/obmc-console/+/57452",
    "hashtags": [],
    "createdOn": 1664274531,
    "lastUpdated": 1665961965,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1664274531,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1664274597,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664274597,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1664274627,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52488/ : SUCCESS"
        },
        {
            "timestamp": 1664274827,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1664292616,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Topic set to sysrq"
        },
        {
            "timestamp": 1664292784,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1664322536,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1664444398,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1664444437,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664444437,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1664444462,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52636/ : SUCCESS"
        },
        {
            "timestamp": 1664444552,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1664444596,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1664444862,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1664444942,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664444942,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1664445044,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52637/ : SUCCESS"
        },
        {
            "timestamp": 1664941961,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1665199442,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1665199516,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1665199516,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1665199540,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/53177/ : SUCCESS"
        },
        {
            "timestamp": 1665199584,
            "reviewer": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "1fbbcf177c42de1920eeb9a1ff79c83bfae6722f",
            "parents": [
                "bbc95526c6b612ec42f45e3d554d01324477c4e7"
            ],
            "ref": "refs/changes/52/57452/1",
            "uploader": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "createdOn": 1664274531,
            "author": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Looks great! A couple of suggestions inline."
                },
                {
                    "file": "console-server.c",
                    "line": 67,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "moving this form the .c to the .h seems unrelated?"
                },
                {
                    "file": "console-server.c",
                    "line": 67,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Move this form the .c to the .h since we need use \"sh->console->tty_fd\" in socket-handle.c."
                },
                {
                    "file": "console-server.c",
                    "line": 67,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Ah, sorry, I missed that!\n\nIn that case, I'd prefer to keep the encapsulation as-is, and just add a small helper in console.c to perform the tcsendbreak(); say, console_send_break()."
                },
                {
                    "file": "console-server.c",
                    "line": 67,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Changed as your suggestion.Thanks~"
                },
                {
                    "file": "socket-handler.c",
                    "line": 252,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "I'd suggest making this conditional on at least some portion of the received data; For example: you could define an OOB byte of 0x01 to signify the break, and then we have a facility to add further out-of-band actions later."
                },
                {
                    "file": "socket-handler.c",
                    "line": 252,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Changed as your suggestion, thanks~"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -1
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -21
                },
                {
                    "file": "console-server.h",
                    "type": "MODIFIED",
                    "insertions": 20,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 23
        },
        {
            "number": 2,
            "revision": "42a751017cb32c286eac4d8b02f82d36e3ab6d3b",
            "parents": [
                "bbc95526c6b612ec42f45e3d554d01324477c4e7"
            ],
            "ref": "refs/changes/52/57452/2",
            "uploader": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "createdOn": 1664444398,
            "author": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -1
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "console-server.h",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "8c21ada146c4f3352bc45982a49354c745438d93",
            "parents": [
                "bbc95526c6b612ec42f45e3d554d01324477c4e7"
            ],
            "ref": "refs/changes/52/57452/3",
            "uploader": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "createdOn": 1664444862,
            "author": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Joel Stanley",
                        "email": "joel@jms.id.au",
                        "username": "shenki"
                    },
                    "message": "Some minor code style feedback, and a question about the recv call with MSG_OOB"
                },
                {
                    "file": "console-server.h",
                    "line": 68,
                    "reviewer": {
                        "name": "Joel Stanley",
                        "email": "joel@jms.id.au",
                        "username": "shenki"
                    },
                    "message": "nit: put a line of whitespace below this"
                },
                {
                    "file": "console-server.h",
                    "line": 68,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Done"
                },
                {
                    "file": "socket-handler.c",
                    "line": 244,
                    "reviewer": {
                        "name": "Joel Stanley",
                        "email": "joel@jms.id.au",
                        "username": "shenki"
                    },
                    "message": "Reading the manpage:\n\n       MSG_DONTWAIT (since Linux 2.2)\n              Enables  nonblocking operation; if the operation would block, the call fails with the error EAGAIN or EWOULDBLOCK. \n\nAs you don't have MSG_DONTWAIT set, I'm not sure that you need to check for these values?\n\nHowever, I think you do want to set MSG_OOB|MSG_DONTWAIT ?"
                },
                {
                    "file": "socket-handler.c",
                    "line": 244,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Done"
                },
                {
                    "file": "socket-handler.c",
                    "line": 251,
                    "reviewer": {
                        "name": "Joel Stanley",
                        "email": "joel@jms.id.au",
                        "username": "shenki"
                    },
                    "message": "nit: follow the style of the existing code:\n\n /* Send break to the OS. The data needs to match what the SoL client sends. */\n if (buf[0] == 72) {\n    console_send_break(sh->console);\n }\n \nNote the change of spacing, where the brace is, etc."
                },
                {
                    "file": "socket-handler.c",
                    "line": 251,
                    "reviewer": {
                        "name": "Chen Tingting",
                        "email": "chentingting.2150@bytedance.com",
                        "username": "chen2150"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -1
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "console-server.h",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 2
        },
        {
            "number": 4,
            "revision": "63a25d8c1ff43f9ac99032aa7a98ccf6019a4b6a",
            "parents": [
                "bbc95526c6b612ec42f45e3d554d01324477c4e7"
            ],
            "ref": "refs/changes/52/57452/4",
            "uploader": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "createdOn": 1665199442,
            "author": {
                "name": "Chen Tingting",
                "email": "chentingting.2150@bytedance.com",
                "username": "chen2150"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "socket-handler.c",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -1
                },
                {
                    "file": "console-server.c",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "console-server.h",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 1
        }
    ]
}
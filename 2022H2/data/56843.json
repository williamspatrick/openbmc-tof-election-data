{
    "project": "openbmc/phosphor-user-manager",
    "branch": "master",
    "id": "I57fb63dcf3adf2f047a842b455ec1abd5bb557ff",
    "number": 56843,
    "subject": "user manager: use event loop",
    "owner": {
        "name": "Nan Zhou",
        "email": "nanzhoumails@gmail.com",
        "username": "FighterNan"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-user-manager/+/56843",
    "hashtags": [],
    "createdOn": 1661795166,
    "lastUpdated": 1662004277,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1661795166,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1661795218,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1661795218,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1661795596,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50030/ : SUCCESS"
        },
        {
            "timestamp": 1661809399,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661814254,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661815500,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661815713,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661816074,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661816381,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661817492,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661823776,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1661823796,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Abandoned\n\nwrong direction"
        },
        {
            "timestamp": 1661824182,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1662004277,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "362350b8db850a54893e7d80ae52a0946fd87498",
            "parents": [
                "fba4bb174a33b78074578f2b42749dd0fad15272"
            ],
            "ref": "refs/changes/43/56843/1",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1661795166,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This isn't really true and seems a like a whole lot of work to avoid a 'while(true)', isn't it?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "I thought event loop is cleaner. WDYT?\n\n\"a whole lot of work\" has been done by me. What's the downside of accepting this?\n\nIf this wording is not proper, I can change it."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "It adds a dependency on a new repo for no good purpose. Linking with a new library just to replace 2 lines of a while loop is slower, bigger, and worse for development."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "If it is really interesting to remove the whole loop, why not add a function in sdbusplus which is the whole loop?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "> for no good purpose\n\nWait, the good purpose is that I hope this eliminates manually calling |process_discard| and |wait|.\n\n> Linking with a new library just to replace 2 lines of a while loop is slower, bigger, and worse for development.\nDoes most system have steventplus already? phosphor-user-manager relies on certificate-manager, which relies on steventplus already.\n\nSo the best practise is to use while loop?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "> If it is really interesting to remove the whole loop, why not add a function in sdbusplus which is the whole loop?\n\nSure, if that is cleaner, I can do that. I just came across this while loop, compared it with what I saw in https://github.com/search?p=5&q=org%3Aopenbmc+attach_event&type=Code\n\nIt's not a big deal for me to abandon these two patches."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> Wait, the good purpose is that I hope this eliminates manually calling |process_discard| and |wait|.\n\nI'm completely flabbergasted that you think that two lines of a while loop is _worse_ than that boilerplate of getting the sd_event and the priority parameters.  I don't even know what to say.\n\nThe process_discard loop is also used all over the codebase and it is documented in the examples in sdbusplus.\n\nhttps://github.com/search?q=org%3Aopenbmc+process_discard&type=code\n\nYou should really only be using sdevent if you have extra needs that only sdevent can satisfy (such as wanting to poll a network socket at the same time).\n\n> Does most system have sdeventplus already? phosphor-user-manager relies on certificate-manager, which relies on sdeventplus already.\n\nI think you are confusing library dependencies and dbus dependencies.  Certainly the sdeventplus library is loaded on the _system_, such as the example you point to.  It is not loaded into any phosphor-user-manager _processes_ because it doesn't link against the library directly.  When P-U-M makes calls across dbus to services that happen to be using sdeventplus, this has no impact on the performance of P-U-M itself.\n\n> Sure, if that is cleaner, I can do that.\n\nThat is up to you.  I don't really find the boilerplate of the while loop all that offensive.  If you do, go ahead and simplify it.  Switching it to sdeventplus is _not_ a simplification (and is quite the opposite to my eyes)."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "> I'm completely flabbergasted that you think that two lines of a while loop is _worse_ than that boilerplate of getting the sd_event and the priority parameters.  I don't even know what to say. \n\nYou are the expert of sdbusplus while I am only a user of that library. And it shows in https://github.com/search?p=5&q=org%3Aopenbmc+attach_event&type=Code\n that many other users misunderstood this library as well.\n\n> I don't even know what to say.\n\nThis sounds a little offensive to me.. \ud83d\ude10 I am just trying to help clean this PUM repo. So that my future codes can get through easier.\n\n> You should really only be using sdevent if you have extra needs that only sdevent can satisfy (such as wanting to poll a network socket at the same time).\n\nThis what I need to learn from this code review."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "The other part of your comment makes sense to me and thanks for the information."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "https://gerrit.openbmc.org/c/openbmc/sdbusplus/+/56891\n\nPTAL"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "configure.ac",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "Makefile.am",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "subprojects/sdeventplus.wrap",
                    "type": "ADDED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "mainapp.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 40,
            "sizeDeletions": 6
        }
    ]
}
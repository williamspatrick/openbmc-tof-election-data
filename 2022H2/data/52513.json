{
    "project": "openbmc/phosphor-hwmon",
    "branch": "master",
    "id": "I892a1c953231123aa5407b388ff9133882d80feb",
    "number": 52513,
    "subject": "sdbusplus: object: don't use 'bool' argument constructor",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-hwmon/+/52513",
    "hashtags": [],
    "createdOn": 1648695369,
    "lastUpdated": 1668557754,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1648695369,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1648695378,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1648695378,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1648695413,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/40195/ : FAILURE"
        },
        {
            "timestamp": 1648696246,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1648729664,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1648729670,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1648729681,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1648729681,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1648729718,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/40240/ : FAILURE"
        },
        {
            "timestamp": 1648743379,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1648813317,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1648813318,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1648813720,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/40310/ : SUCCESS"
        },
        {
            "timestamp": 1648836497,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1648837193,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1648837402,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1648840598,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1648841636,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1648842811,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1648847032,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully pushed."
        },
        {
            "timestamp": 1648847141,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1648847910,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "996dc38b48c018918975490417967befc8dfc263",
            "parents": [
                "d54618168d143988d183af831228a3a88e7c615b"
            ],
            "ref": "refs/changes/13/52513/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1648695369,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This whole commit will fail CI until I finish a commit in sdbusplus to add the enum.  I'll resubmit Jenkins when that happens and clean up any additional failures."
                },
                {
                    "file": "thresholds.hpp",
                    "line": 132,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Thanks for the cleanup Patrick! Looks like we can actually clean this bool up as well."
                },
                {
                    "file": "thresholds.hpp",
                    "line": 132,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "fan_speed.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                },
                {
                    "file": "thresholds.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "sensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -6
                },
                {
                    "file": "fan_pwm.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 9
        },
        {
            "number": 2,
            "revision": "b8d333ea94d0833f229de530cf29c5e89fc7bf22",
            "parents": [
                "d54618168d143988d183af831228a3a88e7c615b"
            ],
            "ref": "refs/changes/13/52513/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1648729670,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Sounds good, I'll +2 once this passes"
                },
                {
                    "file": "fan_pwm.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Could you straighten me out on why you aren't using defer_emit here too?"
                },
                {
                    "file": "fan_pwm.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Good catch, I guess throughout the file, sometimes defer_emit is used vs emit_no_signals"
                },
                {
                    "file": "fan_pwm.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yes, it is purposeful... I'm in the middle of writing a blog post about the rationale and then you'll be able to re-review, I guess. \ud83d\ude04"
                },
                {
                    "file": "fan_pwm.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I had to walk through to confirm, but `emit_no_signals` is appropriate for all the classes except Value, which uses `defer_emit`.  The reason is this line of code:\n\nhttps://github.com/openbmc/phosphor-hwmon/blob/b8d333ea94d0833f229de530cf29c5e89fc7bf22/mainloop.cpp#L297\n\nWhat happens is that we create the Value object (with defer) and then we create an optional set of subclasses (thresholds, Fan*, etc).  In the `mainloop` case, we always create these as `bool defer = true`, which makes sense because we want to delay the \"InterfacesAdded\" until the whole set is constructed.\n\nFor the subclasses we want to do `emit_no_signals` because Value handles the `emit_object_added` call on that line 297, which as a side-effect advertises _all_ the interfaces that have been created at that object path.  \n\nThe distinction between `emit_no_signals` and `deferred_emit` is going to mainly be on the destructor path in an upcoming sdbusplus change.  For an object with `deferred_emit` the `emit_object_removed` will be called on the destructor even if `emit_object_added` was never called (this behavior doesn't happen today).  For an object with `emit_no_signals`, it does exactly that.\n\nIf classes like FanPwm were set to `defer_emit` we'd end up with multiple \"InterfacesRemoved\" signals being sent for the same object path when the object(s) are destructed.\n\nI'm working on a post for it which goes into more details but I think these are the parts that are appropriate for this repository.\n\nI don't know if there is a better way to \"document\" this in the code change.  I'm open to ideas."
                },
                {
                    "file": "fan_pwm.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "How about just something in the commit message that mentions the signals for those are being handled elsewhere"
                },
                {
                    "file": "fan_pwm.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Done."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "fan_speed.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                },
                {
                    "file": "thresholds.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "sensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -6
                },
                {
                    "file": "fan_pwm.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 10
        },
        {
            "number": 3,
            "revision": "d273b1e06d8d68f60aac3139e5c83f884416c537",
            "parents": [
                "d54618168d143988d183af831228a3a88e7c615b"
            ],
            "ref": "refs/changes/13/52513/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1648847032,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I messed up.  I guess I was made a Gerrit admin and there are no safeguards for me pushing directly to HEAD.  \n\nI took care of updating the commit message Matt.  Let me know if there are any other fix ups needed and I'll get them in immediately."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "no problem, it all looks good to me."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "fan_speed.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                },
                {
                    "file": "thresholds.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "sensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -6
                },
                {
                    "file": "fan_pwm.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 10
        }
    ]
}
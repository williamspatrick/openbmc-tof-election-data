{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I3bd8bfa8573c0bca1ca642c342b508217fcdea7a",
    "number": 21195,
    "subject": "OpenBMC Security modes design document",
    "owner": {
        "name": "Richard Marian Thomaiyar",
        "email": "richard.marian.thomaiyar@linux.intel.com",
        "username": "rthomaiy"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/21195",
    "hashtags": [],
    "createdOn": 1557156130,
    "lastUpdated": 1665658035,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1557156130,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1558040066,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1560376948,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1560508506,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1560508517,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1560548971,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nCan the proposed RestrictionMode=Provisioning be used to help ensure no BMCs are deployed with default passwords?  For example, if the BMC cannot operate its host while in RestrictionMode=Provisioning, and the BMC will not leave RestrictionMode=Provisioning until the BMC no longer has its default password, will that satisfy, for example, section 1798.91.04.b.2 of CA Law SB-327 (https://leginfo.legislature.ca.gov/faces/billTextClient.xhtml?bill_id=201720180SB327)?"
        },
        {
            "timestamp": 1560564169,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1560786808,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1560788516,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1560912203,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1561071722,
            "reviewer": {
                "name": "Terry Duncan",
                "email": "terry.s.duncan@intel.com",
                "username": "tsdunc"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1562227981,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1562228007,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1562599072,
            "reviewer": {
                "name": "Michael Walsh",
                "email": "micwalsh@us.ibm.com",
                "username": "micwalsh"
            },
            "message": "Removed reviewer Michael Walsh."
        },
        {
            "timestamp": 1563540398,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 3:\n\nLet me know if there are any comments or can it go in ?"
        },
        {
            "timestamp": 1564095625,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(12 comments)\n\nI just started from draft 3 and did not review the prior discussion."
        },
        {
            "timestamp": 1589765294,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 3:\n\nStill trying ot get this in?"
        },
        {
            "timestamp": 1592112392,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 3:\n\n(6 comments)"
        },
        {
            "timestamp": 1665658035,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Abandoned\n\nclose due to inactivity"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "8d03c74feb043e67dd01ffd80896c6e54bca3103",
            "parents": [
                "a76b0fc50b8e675772454799b7eb14e2e9e5f280"
            ],
            "ref": "refs/changes/95/21195/1",
            "uploader": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "createdOn": 1557156130,
            "author": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "security_modes_design_doc.md",
                    "line": 1,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "Why not make this a proper design doc and have it live in https://github.com/openbmc/docs/tree/master/designs?"
                },
                {
                    "file": "security_modes_design_doc.md",
                    "line": 1,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "I agree with Gunnar.  Also, text in your commit message would be valuable to see in the design itself."
                },
                {
                    "file": "security_modes_design_doc.md",
                    "line": 1,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "Done"
                },
                {
                    "file": "security_modes_design_doc.md",
                    "line": 34,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Does \"non-persistent\" mean SpecialMode changes to None when the BMC reboots?"
                },
                {
                    "file": "security_modes_design_doc.md",
                    "line": 34,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Does \"restricted\" mean these interfaces require admin authority?"
                },
                {
                    "file": "security_modes_design_doc.md",
                    "line": 34,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "More than admin authority actually. Recommendation is not to provide any commands directly to update this value, but instead updating these using special privileges, which will be available during debug / validation etc."
                },
                {
                    "file": "security_modes_design_doc.md",
                    "line": 34,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "Yes. We will not store this value, reason being to return back to original state after some operations are done.\n\nNote: We can enter to this mode in automatic manner too, say based on certificate / key we can assume we are in manufacturing mode or using some other condition, but that condition will be evaluated for every boot.\nOr it  can be something like setting the value through busctl through SSH"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "security_modes_design_doc.md",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "3f99499198de87df829b51eadf9f9a21c379cd12",
            "parents": [
                "73266974f2d7904ea5132f11f18393e8acccacb1"
            ],
            "ref": "refs/changes/95/21195/2",
            "uploader": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "createdOn": 1560508517,
            "author": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/security-modes-design.md",
                    "line": 41,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Is there a Redfish API which corresponds to this?"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 41,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "if your question is whether to update this property, yes we can add one Redfish API, but if it is for usage, currently\nRedfish API's doesn't need to be blocked, as these modes restricts the execution of Host interface and Redfish currently doesn't have any host interface"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 41,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Thanks."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 46,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "What operations are to be performed when the BMC is in Provisioning mode?  Is this for network settings, adding certificates, adding and removing accounts, changing default passwords, etc?  What is the BMC NOT allowed to do while in this mode?  Is it not allowed to boot the host?"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 46,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "This mode has to be treated as deployment or customer configuration modes, where end-users are allowed to configure / perform some operation, but once they have moved to ProvisionedXXXMode, then restrictions will be in place and won't allow certain activity in Host interface"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 46,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "I got it; thanks.  I was thinking of a new RestrictionMode=SetupAccess which: \n(1) requires users to set up their credentials (at least: remove the default password) before they can leave that mode, and\n(2) does not let the user do anything else, including other provisioning.\nHowever, it seems like the present design (21195) is not the same as what I am thinking.  So ... I'll drop the question from this review."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 46,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "Yes, Limitations apply from Host interface point of it only. Still commands will be executed or allowed from LAN session\n\nBut, in order to make the LAN interface to work, they need to configure their first user account through Host interface only (when there are no default enabled accounts - say root /0penBmc in our case)."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 46,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Got, thanks again.  My understanding is this design affects only the BMC's host-facing interfaces.\n\nIs this one way to securely provision the BMC?\n1. Install a new BMC and turn it on.  It might have no network users defined.\n2. Boot the host (power button?).\n3. Provision the BMC via host interfaces (per this design).\nIs that correct?  Is there other ways?"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 46,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "RestrictionMode (should be HostIntfRestrictionMode but can't rename this now.) affects the commands executed through Host interface. \n1. Install a new BMC and turn it on (It can be default in provisioning - allowing all system interface commands) (or can be in any other mode, as desired by the vendor).\n2. Boot the host(power button), configure all the things needed, included users (if needed), and update the RestrictionMode property to a new mode (ProvionedHostWhitelist or ProvisionedHostDisabled). Going forward, system interface commands will be restricted based on this setting."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 65,
                    "reviewer": {
                        "name": "Terry Duncan",
                        "email": "terry.s.duncan@intel.com",
                        "username": "tsdunc"
                    },
                    "message": "It may be worth mentioning that if no network users are created before leaving provisioning mode, provisioning is now locked out because only authenticated network sessions may be used to re-enter provisioning mode (same would apply if only admin user were to forget his credentials). In this case a method would be provided where the system owner could demonstrate ownership or physical presence with a jumper setting, etc. to enable a KCS command to re-enter provisioning mode."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 65,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "designs/security-modes-design.md",
                    "type": "ADDED",
                    "insertions": 98,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 117,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "790ad1673950c65c96cc84f80cdda63727cc37ce",
            "parents": [
                "73266974f2d7904ea5132f11f18393e8acccacb1"
            ],
            "ref": "refs/changes/95/21195/3",
            "uploader": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "createdOn": 1562228007,
            "author": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/security-modes-design.md",
                    "line": 10,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "what trusts the Host executed commands?"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 12,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "The operating system?  Some operating systems?\nThe kernel and/or its drivers I would consider to be part of any operating systems.\nThe user space may not be restricted by the operating system / kernel depending on the OS design."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 14,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "commands."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 15,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "should only be executed ?   \nAlso , decapitolize Manufacturing and consider expanding E.g. to For example."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 20,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "remove comma after functions"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 21,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "some (vs one)?   Sounds like two issues.\nremove comma before which"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 29,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "remove comma before which"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 31,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "presumably unauthenticated access?\n\nFirst sentence sounds like a goal or mission vs a requirement."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 37,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "Again, why is Manufacturing mode capitolized?  Why are they validatoin based commands here vs just validatoin commands?"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 49,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "Why not put None at the top instead of taling about not removing it).."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 54,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "until (not till)\nafter which only commands"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "and remove only from this line."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I disagree.  u-boot should not be used for random modes. and the reset to default action should not be accessible in a locked down environment."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 62,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "Should this require admin?  Or unauthenticaed but only downgrading  permission?"
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 69,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "This seems to imply required some level of authenticated access...."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 88,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I don't think we cancurrently differentiate uid 0 over busctl from any other dbus access as all our agents are still running as root last I understood."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 93,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "All host interfaces can be blocked by stopping the ipmi-host service.\nA version of whitelist already exists."
                },
                {
                    "file": "designs/security-modes-design.md",
                    "line": 103,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I assert CI will be required."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "designs/security-modes-design.md",
                    "type": "ADDED",
                    "insertions": 103,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 122,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/phosphor-pid-control",
    "branch": "master",
    "id": "I759387b97af3ce93a76459faf5e9e7be3474016e",
    "number": 59721,
    "subject": "Fix interval calculation bug and D-Bus init",
    "owner": {
        "name": "Josh Lehan",
        "email": "krellan@google.com",
        "username": "Krellan"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-pid-control/+/59721",
    "hashtags": [],
    "createdOn": 1671097945,
    "lastUpdated": 1671151973,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1671097945,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1671097974,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1671097975,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1671098067,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/57834/ : FAILURE"
        },
        {
            "timestamp": 1671098284,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1671098325,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1671098325,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1671098813,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/57835/ : SUCCESS"
        },
        {
            "timestamp": 1671106727,
            "reviewer": {
                "name": "Harvey Wu",
                "email": "Harvey.Wu@quantatw.com",
                "username": "harveyquta"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1671134074,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1671134098,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1671134098,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1671134124,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1671134587,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/57867/ : SUCCESS"
        },
        {
            "timestamp": 1671139005,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1671139840,
            "reviewer": {
                "name": "Gaurav Gandhi",
                "email": "gauravgandhi@google.com",
                "username": "gauravgandhi70"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1671151691,
            "reviewer": {
                "name": "Harvey Wu",
                "email": "Harvey.Wu@quantatw.com",
                "username": "harveyquta"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1671151956,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1671151969,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1671151973,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c54260ea5fdc5d793e09ca004022e7a82bd1ff37",
            "parents": [
                "c612c051a5c414180f8ebe273c24543ab95d16ee"
            ],
            "ref": "refs/changes/21/59721/1",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1671097945,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "pid/buildjson.cpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -16
                },
                {
                    "file": "pid/pidloop.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -6
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 87,
            "sizeDeletions": 22
        },
        {
            "number": 2,
            "revision": "cc6aa786bc19dd626fa17f5bd90204661bcb4546",
            "parents": [
                "c612c051a5c414180f8ebe273c24543ab95d16ee"
            ],
            "ref": "refs/changes/21/59721/2",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1671098284,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Updated some things to be a little more clear. Made sure that the number from configuration is at least 1.0 before casting it to integer. Cleaned up timer logic even more.\n"
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "line": 585,
                    "reviewer": {
                        "name": "Harvey Wu",
                        "email": "Harvey.Wu@quantatw.com",
                        "username": "harveyquta"
                    },
                    "message": "The first word need to capitalize for D-Bus config.\nhttps://gerrit.openbmc.org/c/openbmc/entity-manager/+/58897"
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "line": 585,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Wow, thanks, good catch! Fixed."
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "line": 607,
                    "reviewer": {
                        "name": "Harvey Wu",
                        "email": "Harvey.Wu@quantatw.com",
                        "username": "harveyquta"
                    },
                    "message": "Same here."
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "line": 607,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Fixed."
                },
                {
                    "file": "pid/pidloop.cpp",
                    "line": 121,
                    "reviewer": {
                        "name": "Harvey Wu",
                        "email": "Harvey.Wu@quantatw.com",
                        "username": "harveyquta"
                    },
                    "message": "Why use minus UpdateThermalsCycle instead of setting it as 0 like before?\nBecause cycleCnt is uint64, when msPerThermalCycle bigger than cycleCnt, cycleCnt will become a large value."
                },
                {
                    "file": "pid/pidloop.cpp",
                    "line": 121,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "This is intentional. If the configured thermal cycle time is not an exact multiple of the configured fan cycle time, there will be a remainder left over. This allows the timing to be correct, as the delay will carry over into the next period, keeping timing accurate.\n\nThere is a bounds check on line 119. It will keep the unsigned value from wrapping around. The subtraction will not be performed unless \"cycleCnt\" is already large enough to accept the subtraction without going negative (wrapping around)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "pid/buildjson.cpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -16
                },
                {
                    "file": "test/pid_json_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -3
                },
                {
                    "file": "pid/pidloop.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -6
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 88,
            "sizeDeletions": 25
        },
        {
            "number": 3,
            "revision": "9f9a06aa9c4d49749c2d94164ed00c6ef706e04f",
            "parents": [
                "c612c051a5c414180f8ebe273c24543ab95d16ee"
            ],
            "ref": "refs/changes/21/59721/3",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1671134074,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Tested more here: https://gist.github.com/Krellan/e8769d8006742c693632f310c276b145\n\nI tried leaving the settings at the default, setting them to 100 and 1000, and setting them to 300 and 1100 (intentionally using intervals that are not a clean multiple of each other).\n\nIt worked. The thermal interval ticks were staggered appropriately amongst the fan interval ticks.\n"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Giving +2 to myself, as others have already given +1\n"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "pid/buildjson.cpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -16
                },
                {
                    "file": "test/pid_json_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -3
                },
                {
                    "file": "pid/pidloop.cpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -6
                },
                {
                    "file": "dbus/dbusconfiguration.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 101,
            "sizeDeletions": 25
        }
    ]
}
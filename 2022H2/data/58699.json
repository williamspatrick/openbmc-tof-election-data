{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "id": "I064115ee1e966a0a1b3ce7ec246c1f88f0bd87f7",
    "number": 58699,
    "subject": "u-boot mirroring support",
    "owner": {
        "name": "Lakshmi Yadlapati",
        "email": "lakshmiy@us.ibm.com",
        "username": "Lakshmi-y"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/58699",
    "hashtags": [],
    "createdOn": 1668557907,
    "lastUpdated": 1672954908,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1668557907,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1668558004,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1668559161,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1668577268,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1668577353,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1668577530,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1668718784,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1668732507,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1669087516,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1669759200,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1670304454,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1670304485,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1670304486,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1670304500,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/56756/ : FAILURE"
        },
        {
            "timestamp": 1670304604,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1670305036,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1670305055,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1670305055,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1670305132,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/56757/ : SUCCESS"
        },
        {
            "timestamp": 1670309624,
            "reviewer": {
                "name": "Gokul Sanker V G",
                "email": "gokul.sanker.v.g@intel.com",
                "username": "gokulsvg"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1670328515,
            "reviewer": {
                "name": "Gokul Sanker V G",
                "email": "gokul.sanker.v.g@intel.com",
                "username": "gokulsvg"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1670364941,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1672866121,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1672869333,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1672869367,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1672869368,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1672869387,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/58576/ : FAILURE"
        },
        {
            "timestamp": 1672870172,
            "reviewer": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1672870203,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1672870203,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1672870280,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/58578/ : SUCCESS"
        },
        {
            "timestamp": 1672954903,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1672954908,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "4e76a51daff00aa241bffd666f8ad9b4ee3d2742",
            "parents": [
                "deb86b4a16b0a4cb7b83420f7f4b864db3ae2717"
            ],
            "ref": "refs/changes/99/58699/1",
            "uploader": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "createdOn": 1668557907,
            "author": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "Please remove indent"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Lakshmi Yadlapati",
                        "email": "lakshmiy@us.ibm.com",
                        "username": "Lakshmi-y"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "as above:\nTested:"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Lakshmi Yadlapati",
                        "email": "lakshmiy@us.ibm.com",
                        "username": "Lakshmi-y"
                    },
                    "message": "Done"
                },
                {
                    "file": "obmc-flash-bmc",
                    "line": 636,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "Please keep 2spaces indented, like L:652"
                },
                {
                    "file": "obmc-flash-bmc",
                    "line": 636,
                    "reviewer": {
                        "name": "Lakshmi Yadlapati",
                        "email": "lakshmiy@us.ibm.com",
                        "username": "Lakshmi-y"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -1
                },
                {
                    "file": "obmc-flash-bmc",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "8635ddee8c0bda2e510dcb51df248a9b6d2d604d",
            "parents": [
                "deb86b4a16b0a4cb7b83420f7f4b864db3ae2717"
            ],
            "ref": "refs/changes/99/58699/2",
            "uploader": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "createdOn": 1668577268,
            "author": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "line": 76,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "This blocks the whole service for 3 seconds, and how do you make sure 3s is enough for the u-boot mirror finishes?\n\nIt could be better to handle the finish in the match callback like other services do."
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "line": 76,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "That's a good point. Since the concern is to prevent a code update if the mirroring is in progress, perhaps it'd work to add a \"After=obmc-flash-mmc-mirroruboot\" to the \"mmc/obmc-flash-mmc@.service.in\" service so that the mmc update waits for the mirror to complete. It'll need to be tested to verify that if the mirror service is started, and while it's running the obmc-flash-mmc service is started, that this service waits for the mirror to complete."
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "line": 76,
                    "reviewer": {
                        "name": "Lakshmi Yadlapati",
                        "email": "lakshmiy@us.ibm.com",
                        "username": "Lakshmi-y"
                    },
                    "message": "Comments about needing to sleep were not applicable. Removed the comments and sleep."
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "line": 76,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I can see how it'd be difficult to start a new code update right when the the BMC reconnects after a reboot from a previous update and start the activation while the u-boot mirroring is still in progress. We don't have a sleep or any checks in the u-boot mirror service for ubi and no issues have been seen."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -1
                },
                {
                    "file": "obmc-flash-bmc",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "f3439323ac7023e5ba79175349368b4b8edf7154",
            "parents": [
                "a8ebf9622562caf3d6ea74edfad42cfed4171999"
            ],
            "ref": "refs/changes/99/58699/3",
            "uploader": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "createdOn": 1670304454,
            "author": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "obmc-flash-bmc",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "bc8adea41e56bdff2a6e6ab2b356d7c7262ec9da",
            "parents": [
                "a8ebf9622562caf3d6ea74edfad42cfed4171999"
            ],
            "ref": "refs/changes/99/58699/4",
            "uploader": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "createdOn": 1670305036,
            "author": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Can a rebase be done? There were some formatting changes done project-wise that's causing the merge conflict."
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "line": 5,
                    "reviewer": {
                        "name": "Gokul Sanker V G",
                        "email": "gokul.sanker.v.g@intel.com",
                        "username": "gokulsvg"
                    },
                    "message": "if we use oneshot type and the service is taking too much time to complete, it can impact the booting time of the BMC\n \nin that case we can use \"simple\" type"
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "line": 5,
                    "reviewer": {
                        "name": "Gokul Sanker V G",
                        "email": "gokul.sanker.v.g@intel.com",
                        "username": "gokulsvg"
                    },
                    "message": "> if we use oneshot type and the service is taking too much time to complete, it can impact the booting time of the BMC\n>  \n> in that case we can use \"simple\" type\n\nignore i could see that this service is invoked from another service during fwu"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "obmc-flash-bmc",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 1
        },
        {
            "number": 5,
            "revision": "b85ebcd5139e901175ff6b0c1d9d1ee1dd1b31df",
            "parents": [
                "d97d3b9f502fa35a9bcefd3c6249a7586d2ce5fe"
            ],
            "ref": "refs/changes/99/58699/5",
            "uploader": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "createdOn": 1672869333,
            "author": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "obmc-flash-bmc",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 1
        },
        {
            "number": 6,
            "revision": "87c5b5bdfabea3739c261c311d21a9e855a6534d",
            "parents": [
                "d97d3b9f502fa35a9bcefd3c6249a7586d2ce5fe"
            ],
            "ref": "refs/changes/99/58699/6",
            "uploader": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "createdOn": 1672870172,
            "author": {
                "name": "Lakshmi Yadlapati",
                "email": "lakshmiy@us.ibm.com",
                "username": "Lakshmi-y"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "obmc-flash-bmc",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "mmc/obmc-flash-mmc-mirroruboot.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 1
        }
    ]
}
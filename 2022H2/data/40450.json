{
    "project": "openbmc/entity-manager",
    "branch": "master",
    "id": "I446f9c08a23582317dd7d48f677430c58f17d582",
    "number": 40450,
    "subject": "entity-manager: add 'EnableNode' internal option",
    "owner": {
        "name": "Andrei Kartashev",
        "email": "a.kartashev@yadro.com",
        "username": "alatarum"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/entity-manager/+/40450",
    "hashtags": [],
    "createdOn": 1612906206,
    "lastUpdated": 1658720806,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1612906206,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1612906217,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612906536,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12198/ : SUCCESS"
        },
        {
            "timestamp": 1612946717,
            "reviewer": {
                "name": "Alexander Amelkin",
                "email": "a.amelkin@yadro.com",
                "username": "AlexanderAmelkin"
            },
            "message": "Patch Set 1: Code-Review+1\n\nA very useful change!"
        },
        {
            "timestamp": 1612956861,
            "reviewer": {
                "name": "Alexander Filippov",
                "email": "a.filippov@yadro.com",
                "username": "nest1ing"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1616780548,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1616780562,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1616780754,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14436/ : SUCCESS"
        },
        {
            "timestamp": 1616782000,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Uploaded patch set 3: New patch set was added with same tree, parent, and commit message as Patch Set 2."
        },
        {
            "timestamp": 1616782019,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1616782027,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1616782220,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14440/ : SUCCESS"
        },
        {
            "timestamp": 1616782928,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\nThat would be great if you could add this to the appropriate documentation in the repo so others can know how to use it."
        },
        {
            "timestamp": 1616784246,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 3:\n\n> Patch Set 3:\n> \n> That would be great if you could add this to the appropriate documentation in the repo so others can know how to use it.\n\nGood point, will add."
        },
        {
            "timestamp": 1616787144,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1616787156,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1616787474,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14443/ : SUCCESS"
        },
        {
            "timestamp": 1616964927,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1617348983,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 5: Commit message was updated."
        },
        {
            "timestamp": 1617348996,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1617369123,
            "reviewer": {
                "name": "Alexander Filippov",
                "email": "a.filippov@yadro.com",
                "username": "nest1ing"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1617386815,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1617399269,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1617653292,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1617657852,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1619610571,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1621891770,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1624269486,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1630579446,
            "reviewer": {
                "name": "Alexander Amelkin",
                "email": "a.amelkin@yadro.com",
                "username": "AlexanderAmelkin"
            },
            "message": "Patch Set 5: Code-Review+1\n\nEd, it would be really nice if you could accept and merge this.\nThis is a useful feature."
        },
        {
            "timestamp": 1631039956,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n> Patch Set 5: Code-Review+1\n> \n> Ed, it would be really nice if you could accept and merge this.\n> This is a useful feature.\n\nThat's good to know you care, but in terms of use case, I need to understand the overall design of why this is required  \"It's logical to have opposite\" doesn't really ring true for me.  DisableNode exists because we needed a user-driven way to remove the build-in nodes when they're deleted from the API.  EnableNode isn't really used in the design because the only use cases are for internal system-specific bash scripts, which we should be avoiding.  It's possible some of the reactos need some better interlocking, but that shouldn't be done at entity-manager level.  Entity manager detected the devices, and it should be exposing them.\n\nIf the intent is to disable nodes and enable them from system-specific bash scripts, that's not going to work for me.  We already have a pattern for changing CPU features based on whether a single socket is installed or not, and we should be following that pattern unless there's a good reason not to."
        },
        {
            "timestamp": 1631040226,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1658720806,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\nNo response from submitters, and patch hasn't been rebased.  If this is still desired, please reopen, rebase, and reply to comments."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "35fec18555df185754b7b4b5093c77a718899174",
            "parents": [
                "906975ac00dd07620ebd4b991ea73c15f0205639"
            ],
            "ref": "refs/changes/50/40450/1",
            "uploader": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "createdOn": 1612906206,
            "author": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "00ce731f9fb851ddd05d3d4d912ec9de489ee60c",
            "parents": [
                "e7c3417a86f1229ac69d4a07d8bcde7e3806fdb5"
            ],
            "ref": "refs/changes/50/40450/2",
            "uploader": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "createdOn": 1616780548,
            "author": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 3
        },
        {
            "number": 3,
            "revision": "26c09c231d559b194643aaa3cc040f8448ac2e5e",
            "parents": [
                "e8f6d1d4988009a3762afbe951fd22e2c444f48a"
            ],
            "ref": "refs/changes/50/40450/3",
            "uploader": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "createdOn": 1616782000,
            "author": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "kind": "NO_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 3
        },
        {
            "number": 4,
            "revision": "d22d4e3bb731084bfeb5e1c2a1b3c314afa5acdd",
            "parents": [
                "e8f6d1d4988009a3762afbe951fd22e2c444f48a"
            ],
            "ref": "refs/changes/50/40450/4",
            "uploader": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "createdOn": 1616787144,
            "author": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "More details needed here, as you don't seem to have included an example of when this would be used on a real system.\n\nI see the example below, but I'm really not following what it's accomplishing functionally, which tells me this commit message needs to be longer.  Please give a couple use cases for why this is important, and why this would be used.\n\nAlso, please include some EM configurations that actually use this if you can, as today there would be no concrete examples."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "I think usecases are similar to cases for DisableNode which we don't have in the repo also.\nWe now use it in order to have one baseboard config for both single-cpu and dual-cpu baseboards. This is probably a bit against EM idea of \"one config for one device\" but this helps us to decrease duplication and save effort for configuration support."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "CONFIG_FORMAT.md",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -3
                },
                {
                    "file": "schemas/legacy.json",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 4
        },
        {
            "number": 5,
            "revision": "265e3876937bd2fc43488506e141f3aff72d1b20",
            "parents": [
                "e8f6d1d4988009a3762afbe951fd22e2c444f48a"
            ],
            "ref": "refs/changes/50/40450/5",
            "uploader": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "createdOn": 1617348983,
            "author": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "nit: whitespace problem\n\nNon-nit:\nThe recommended way to do this would be by having two config files.  \n\nSee: #5 in https://github.com/openbmc/entity-manager#requirements\n\n\nI'm not closed to the possibility that there might be a use case for this, but having multiple similar boards is not one of those cases."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "Yes, I know your point here, but this is how we use EM in our environment."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can you elaborate a little?  \"this is how we use EM\" doesn't really give me any hints that could help this patchset move forward."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "Sorry, I'm bit lost, what exactly you want me to explain?\nOur use case is having one big \"Board\" configuration file for board family which includes several similar boards who only differs (from EM point of view) by CPU sockets count and fan configuration and we have several \"Chassis\" configuration files that can control this entities according to actual server model."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Sorry, I'm bit lost, what exactly you want me to explain?\n\nNamely why the existing \"recommended\" and documented way of handling this doesn't work for you, and why this method of handling this is better and should also be supported in upstream.\n\n> Our use case is having one big \"Board\" configuration file for board family which includes several similar boards who only differs (from EM point of view) by CPU sockets count and fan configuration and we have several \"Chassis\" configuration files that can control this entities according to actual server model."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "Well, actually my initial point was that upstream already have \"DisableNode\" ant this is logical to have opposite \"EnableNode\" too.\n\nWe use one config for whole product family just to simplify our development cycle: we don't need to care about keeping in sync all modifications but just to modify one.\nI actually though about \"include\" functionality which will handle this case better, but for now I had not time to implement this."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Well, actually my initial point was that upstream already have \"DisableNode\" ant this is logical to have opposite \"EnableNode\" too.\n> \n> We use one config for whole product family just to simplify our development cycle: we don't need to care about keeping in sync all modifications but just to modify one.\n\nThis is explicitly against the design of entity-manager configs.  In practice, individual products tend to start by looking similar, then diverge, which causes more breakages than just starting them separate from the beginning.  It also makes it much more clear which changes have been tested on which systems.\n\n> I actually though about \"include\" functionality which will handle this case better, but for now I had not time to implement this.\n\nFor what it's worth, I would be against this.  The predecessor to entity-manager had #include capability, and it quickly became a maintenance nightmare, as systems of multiple generations would share config files.  Unless there's a specific upstream system that uses it, and we define very good rules for when the include functionality is allowed to be used, I would be against merging support for include."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "As I look down here, it looks like you're wanting to use this to enable/disable CPU sensors when a CPU is installed or not installed.  That seems like a pretty good use case.\n\nLets get some platform config files push to actually do that to use as examples, get this commit message updated, get that behavior fully tested, and then this should be good to go."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "No, it is not \"when CPU installed\", it is \"when CPU socket soldered on the board\", which is obvious bad example according to you. But I have no other."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Gotcha.  Yeah, I think we have a solution to the dual board problem already."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "Which solution? Where can I find details?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "CONFIG_FORMAT.md",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -3
                },
                {
                    "file": "schemas/legacy.json",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 68,
            "sizeDeletions": 4
        }
    ]
}
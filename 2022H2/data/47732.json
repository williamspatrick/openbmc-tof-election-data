{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I71c6b7e5284571e7462b0ea8737dde61cf951eca",
    "number": 47732,
    "subject": "otp-4: converge on meson",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/47732",
    "hashtags": [],
    "createdOn": 1633968723,
    "lastUpdated": 1662676839,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1633968723,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1634016510,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1634048339,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1634094704,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1634125802,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1634177253,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 1:\n\n(2 comments)\n\nIf a repo is not updated to use meson and the recipe gets deleted, but the repo is necessary for most of the systems, who will be responsible to update the repo to use meson? Will there be some updates to the maintainers of the repo?"
        },
        {
            "timestamp": 1634217082,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1634555015,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Patch Set 1: Code-Review-1\n\nThere's very marginal benifits to creating a monoculture. I support efforts to create document best practice, but not to force any one particular technology.\n\nIf we had a rule such as this one in place from the start, enforcing autotools, then the project would have never evolved to use meson at all."
        },
        {
            "timestamp": 1635710334,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1640118791,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1649696125,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1649960396,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1650421109,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1650424253,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1651673688,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1651677101,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1651684325,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1652230692,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1662676783,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased."
        },
        {
            "timestamp": 1662676821,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1662676821,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1662676839,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50526/ : SUCCESS"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "df11c7f67de18c9e616d53d96c8db793027be32c",
            "parents": [
                "2cbf57a8a0bb8d95b0e19b7fc27c4f95cbd8609a"
            ],
            "ref": "refs/changes/32/47732/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1633968723,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 24,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Agreed to enforce meson for new repos."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Some repos are using C and autotools are used, what is the benefit to enforce such repos to use meson? The \"Rationale\" is mostly about C++20."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Lines 43-44 and 51-53 are still very relevant to C repositories."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "OK, but that's about why meson is easier (and probably better) choice for new repos.\n\nMy point is, if a repo not using meson is going to be deleted, it gives some bad expression that openbmc forces the build tools.\nAs an open community, deleting a repo seems \"too much\".\n\nHow about making it failure to pass CI so that new changes are enforced to use meson, but if an existing repo is not updated, it could be kept?"
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> OK, but that's about why meson is easier (and probably better) choice for new repos.\n\nMy view is that it is probably still a better choice for existing repos because they're likely not doing those things (ex. static analysis) if they are autotools based.  Thus they are not utilizing the current best practices in both the project and industry as a whole.\n\n> As an open community, deleting a repo seems \"too much\".\n\nBut I'm not suggesting deleting a repo.  I wrote that we would delete the _recipe_.  The code may still live in the individual repo and when they get it updated it can be reintegrated into the distribution, but until then it is kept out.\n\n> How about making it failure to pass CI so that new changes are enforced to use meson, but if an existing repo is not updated, it could be kept?\n\nAll this does is likely push the work onto the first person attempting to do any kind of API refactoring.  If the maintainer and the users cannot be bothered to get it updated, I don't want to put an impediment onto someone else attempting to make sweeping improvements.  There is no reason that, for example, adding a [[nodiscard]] to a function we realize is often mistakenly ignored should requirement to rewrite a whole repo into meson in order to get it in."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "> But I'm not suggesting deleting a repo.  I wrote that we would delete the _recipe_. \n\nOK, I missed the \"recipe\" part. Fair enough.\n\n> All this does is likely push the work onto the first person attempting to do any kind of API refactoring.\n\nOK, that's not a good option."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 35,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "As Ed indicated, it's not an easy and smooth way to convert to meson from cmake, gaps exist.\ncmake is modern and it support C++20 as well.\nThe \"Rationale\" about cmake is it lacks of tools to build outside of oe-sdk env. But one could either build and test it with openbmc-build-scripts, or some existing repos already has external_project defined to build in typical Linux system."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 35,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Do you have instances of patterns we are using in cmake that are hard to replicate in meson?  I\u2019ve done quite a bit of work on the autotools conversions already and tackled most of the \u201chard\u201d repositories that are doing python code generation.  My feeling was that most of the cmake repositories were much more straight-forward.  I\u2019ll certainly help out where needed if the conversions are especially difficult to align patterns between the two build systems.\n\nRe openbmc-build-scripts.  The time to build a meson repository with proper wrap files is in the order of 10s of seconds.  The time to build anything in openbmc-build-scripts, if you have the Docker images ready to go, is on the order of minutes.  If you don\u2019t have the Docker images ready to go you\u2019re looking at ~30 to build that.  This is a huge productivity hit in a normal code/compile/test development cycle.\n\nI thought I mentioned ExternalProject somewhere but it looks like I left it out of this doc.  I can add it here.  The issues I have with relying on ExternalProject are two-fold:\n* We\u2019re duplicating a pattern that we already have better support for in Meson, but currently ExternalProject isn\u2019t used everywhere and it isn\u2019t used in consistently similar ways.\n* The specifications for ExternalProject are not easily identifiable and updatable with scripts, compared to wrap files.  Many of our current ExternalProject users chose to pin to a particular commit in the dependent project and in order to find and update them we\u2019d have to write a CMake parser tool.  With wrapfiles they are separate and easily found with a `find -name` type invocation, which can be used to trivially update them all.  (ex. when nlohmann-json makes a new release how do we update all the users?)"
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 35,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Ack"
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 35,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Since neither fan control repos are meson yet, won't removing both of their recipes break all of hardware CI? (cutting off nose to spite face?)\n\nThe work to convert phosphor-fan is planned, just need to get some higher priority milestones out of the way first."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 35,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "As we discussed on last TOF meeting, I propose to create kind of roadmap for migration with assigning responsible persons, instead of just say: this must be done or software will be removed."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "type": "ADDED",
                    "insertions": 71,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 86,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "9e2730b0b1556e001b9031ac604012ad7660de10",
            "parents": [
                "34accd8ec8d877c1aac97cf467cb0ba70678c4af"
            ],
            "ref": "refs/changes/32/47732/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1640118791,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "type": "ADDED",
                    "insertions": 72,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 87,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "4051c743fdf357667e6a01294cd917071eaeede0",
            "parents": [
                "e9da860f9aec59aecc9d33c877c91042897314a4"
            ],
            "ref": "refs/changes/32/47732/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1649696125,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "type": "ADDED",
                    "insertions": 72,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 87,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "77590e91482d49958c73923100a67c32af780ec8",
            "parents": [
                "9058180d875a320e4cd0ac6618fb941e48176757"
            ],
            "ref": "refs/changes/32/47732/4",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1649960396,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 25,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "Can we limit this statement to c/c++ and maybe shell?  For example python, rust or go projects should not use meson.  I realize we don't have many (possibly any?) of those right now, but I don't want the first person that implements something in rust to think they have to use meson in their rust project."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 25,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "\ud83d\udc4d"
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 31,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "and to encourage the use of future (build system) technologies in OpenBMC."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 31,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "See my comment below."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "What does this approval look like? Is it just a TOF member saying \"okay\" in some passing discussion on discord, or a full TOF proposal cycle?"
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Officially, I don't think there is anything except a \"full TOF proposal\" when it comes to getting TOF approval on something.  I expected a design doc + vote, if someone wants to do another build system."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "The bullet above says additional build systems can be used at the maintainers discretion.  Is this bullet even needed?"
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "It was intended to be talking about two different things:\n\na. Supporting meson + cmake in a single repository because you want to make it easier for cmake users to consume your code.\n\nb. Experimenting with conan as a replacement for meson.\n\nThis is also why they have different approval process for it.  (a) is at an individual maintainers discretion and is up to them to figure out how to support it for their project.  (b) has broad implications and requires a larger design / acceptance process.\n\nI can try to improve the wording."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "I the distinction and extra details might be confusing and unnecessary.  Maintainers can play around with Conan (or anything else), at their discretion.  As long as they support meson.  That's all anyone needs to know.\n\n> With a future proposal, and the approval of the TOF, additional build\n      systems may be experimented with in the future as new build systems come\n\nNobody needs approval from the TOF to experiment with new build systems.  as long as they support meson."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 32,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "> Nobody needs approval from the TOF to experiment with new build systems.  as long as they support meson.\n\n+1."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 43,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Not stoked about agreeing to something this open-ended. Also not sure what to do about it. But giving deadlines above and then having the ambiguity here seems odd."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 43,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'm not sure what to do either.  Previously there was a lot of criticism about the deadline and repercussions being too harsh.  The feedback I got was to leave out any repercussions and just put out a \"goal\" and hope that we make it."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 43,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "IMO this entire section could just be dropped.  The important thing is the direction has been set so the problem should not get worse.   And if the benefits of doing the migration are as stated and obvious, the work will get done (eventually)."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 43,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I wanted to be clear that any residuals will be taken up at that time to decide how bad the situation is and how we should react to it."
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "line": 43,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "Understood."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "type": "ADDED",
                    "insertions": 81,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "21f8ea19fc17caf37d1f56b5cd6ddf3f0eb6a45b",
            "parents": [
                "33940c031b314aa683e8d414fad81df1c7beeb33"
            ],
            "ref": "refs/changes/32/47732/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1662676783,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "tof/proposals/otp-4.md",
                    "type": "ADDED",
                    "insertions": 81,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/entity-manager",
    "branch": "master",
    "id": "Id375c387575021f6ad5857fd721e97a45366abc4",
    "number": 41622,
    "subject": "entity-manager: Move main() into separate file",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/entity-manager/+/41622",
    "hashtags": [],
    "createdOn": 1616704033,
    "lastUpdated": 1672759224,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1616704033,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1616704056,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1616704623,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14402/ : SUCCESS"
        },
        {
            "timestamp": 1617287862,
            "reviewer": {
                "name": "Bruce Mitchell",
                "email": "bruce.mitchell@linux.vnet.ibm.com",
                "username": "BMC-Bruce"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1617319368,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1617395361,
            "reviewer": {
                "name": "Vijay Khemka",
                "email": "vijaykhemkalinux@gmail.com",
                "username": "vijaykhemka"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1617628424,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1617644259,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1617645654,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(4 comments)"
        },
        {
            "timestamp": 1617802054,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1617802054,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1617802069,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617802399,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14970/ : SUCCESS"
        },
        {
            "timestamp": 1619561867,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1645540329,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1672759224,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Abandoned"
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "bc11ba4876f2ca20509a2c0c3655b9f54457a15e",
            "parents": [
                "e789bf12a49a8993c7d9b7a161494b58dab2dcf0"
            ],
            "ref": "refs/changes/22/41622/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1616704033,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Haven't really read the patch, but I'm a little worried about calling \"main\" from any sort of \"unit\" test.  Ideally we'd be testing things as units, while mocking out the necessary resources (mostly dbus).\n\nI need to give this a think, and consolidate my thoughts on this.  I promise I'm not ignoring it."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I'm doing this so that a unit test can actually test EntityManager.cpp, which it can't do now because there is a main() in it."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Vijay Khemka",
                        "email": "vijaykhemkalinux@gmail.com",
                        "username": "vijaykhemka"
                    },
                    "message": "Can we avoid extern global variable?"
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "It was already a global, so while it would be nice to get rid of it I think it is outside the scope of this patchset."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can this get moved into a single header and CPP file so we're at least not externing it everywhere?\n\nSame goes for the io_context."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 34,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Looking at it, I'm not sure why this was externed and made a global.  Isn't it just fine as the static it was?\n\nIdeally, it wouldn't be a static at all, but moving it to a global variable in the global namespace seems worse.\n\nSame goes for all these variables, can you walk through a little bit on why they needed to move, and couldn't just be put in the main compile unit?\n\nAs written, this is about the only thing I'm concerned about in this patchset, everything else looks fine, so if we can get this sorted, we should be good."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 34,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "These externs, such as lastJson, are used in both EntityManager.cpp and EntityManagerMain.cpp.  So that EntityManager.cpp can compile in a testcase where EntityManagerMain.cpp won't be, I made it an extern in this header, and then put the actual definition in EntityManager.cpp.\n\nDefinitely open to other methods here, it just has to build in both the testcase and regular app."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 34,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Yeah, I didn't catch the fact that this was already a global... ug....\n\nLets get this one into its own header and cpp as well just to get this patchset moving, but we definitely will need to revisit this one.  This really shouldn't be a global."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Vijay Khemka",
                        "email": "vijaykhemkalinux@gmail.com",
                        "username": "vijaykhemka"
                    },
                    "message": "Am I missing something here as I see same declaration in line 34"
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "+1"
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Ack"
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 176,
                    "reviewer": {
                        "name": "Vijay Khemka",
                        "email": "vijaykhemkalinux@gmail.com",
                        "username": "vijaykhemka"
                    },
                    "message": "Please add comments header for this function. I know it is not being followed across code but it would be nice if we can add in new code."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 176,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "We generally do not require comments for all methods in this, so up to the author if they actually want to do it."
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 176,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Ack"
                },
                {
                    "file": "include/EntityManager.hpp",
                    "line": 176,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "While I do think this code could use more comments to help people like me who try to make changes, it would be better in a standalone commit because this code is pretty complicated and explaining it would take some work."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -101
                },
                {
                    "file": "include/EntityManager.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManagerMain.cpp",
                    "type": "ADDED",
                    "insertions": 101,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 129,
            "sizeDeletions": 101
        },
        {
            "number": 2,
            "revision": "0546339aeeca7fd6277b5daade0c2fed8b752f77",
            "parents": [
                "e789bf12a49a8993c7d9b7a161494b58dab2dcf0"
            ],
            "ref": "refs/changes/22/41622/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1617802054,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManager.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -101
                },
                {
                    "file": "include/EntityManager.hpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/EntityManagerMain.cpp",
                    "type": "ADDED",
                    "insertions": 101,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 128,
            "sizeDeletions": 101
        }
    ]
}
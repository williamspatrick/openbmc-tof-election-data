{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "Ic4502d9b2359817b683cbe2dc639b4bfdbe887a7",
    "number": 25413,
    "subject": "docs: update expired password design",
    "owner": {
        "name": "Joseph Reynolds",
        "email": "joseph-reynolds@charter.net",
        "username": "joseph-reynolds"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/25413",
    "hashtags": [],
    "createdOn": 1568991776,
    "lastUpdated": 1665657967,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1568991776,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1568991992,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2: Published edit on patch set 1."
        },
        {
            "timestamp": 1569423557,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nAdded details about how non-Redfish APIs respond to the PasswordChangeRequired condition."
        },
        {
            "timestamp": 1569858628,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nChange the field name to match the code"
        },
        {
            "timestamp": 1570114132,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\nAdded alternate design to expire the password during the genesis boot (compared with expired in the image itself)."
        },
        {
            "timestamp": 1570652513,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1570735176,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571007345,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Removed reviewer Andrew Jeffery."
        },
        {
            "timestamp": 1571418698,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571427987,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571932675,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1571951597,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1573138336,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 2:\n\nAny update here?"
        },
        {
            "timestamp": 1589766083,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Removed reviewer Gunnar Mills."
        },
        {
            "timestamp": 1589922781,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\nThe implementation for this just merged.  https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/29136 -- I plan to update this design to match. :-)"
        },
        {
            "timestamp": 1592111728,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1629433580,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nI'll try to refresh this design and resubmit."
        },
        {
            "timestamp": 1665657967,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Abandoned\n\nclose due to inactivity"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "967c6af0f2f4ed30c264e8c097b3a6543a212851",
            "parents": [
                "97304f98bcc2ec53d773d07939d3251fe1092a84"
            ],
            "ref": "refs/changes/13/25413/1",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "createdOn": 1568991776,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/expired-password.md",
                    "type": "MODIFIED",
                    "insertions": 73,
                    "deletions": -57
                }
            ],
            "sizeInsertions": 87,
            "sizeDeletions": 57
        },
        {
            "number": 2,
            "revision": "92fc05233c5619ccc4f9c721036ac3916889ddbe",
            "parents": [
                "97304f98bcc2ec53d773d07939d3251fe1092a84"
            ],
            "ref": "refs/changes/13/25413/2",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "createdOn": 1568991992,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/expired-password.md",
                    "line": 17,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "I should update this header section too."
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 69,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Note that the Yocto extrausers class now has a \"passwd-expire\" command available in EXTRA_USERS_PARAMS.  See https://git.yoctoproject.org/cgit.cgi/poky/plain/meta/classes/extrausers.bbclass"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 120,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Add:\n- Redfish login responses have the Redfish `PasswordChangeRequired` message.\n- The `/login` URI responses have the `errorExtendedInfo` field."
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 120,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Change the name of the field to: extendedMessage"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "What's the difference between basic auth and using /login?"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Two answers:\n - Basic Auth (https://en.wikipedia.org/wiki/Basic_access_authentication) performs one request without returning any session credentials to the caller. \n - Using the /login URI creates a session and returns session credentials which can then be used for subsequent requests.\n\nThis design point was added simply to clarify the design.  It could be enhanced if needed.\nThe BMCWeb implementation of Basic Auth is in https://github.com/openbmc/bmcweb/blob/master/include/token_authorization_middleware.hpp function performBasicAuth().  It could be re-structured so that an account that has an expired password and uses Basic Auth\n - will be limited to the ConfigureSelf privilege.\n - will get the same results (same auth and same messages) as from /login users.\n\nBut that would be more work.  Is this function needed? <-- real question"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "So basic auth would be when users put the user and password in the URL? I think some of our external clients are going down the path of using that (we've pointed to using it as valid in the cheatsheet.md) so seems like we would need a indication the password was expired?"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Yep, and Redfish supports Basic Auth.  I'll add that as a requirement....sigh, and more implementation work..."
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Basic Auth will work as expected:\n- When the password is good, it will work exactly as before.\n- When the password is expired:\n  + if the access is authorized (limited to change password, and logout), it will work as before\n  + if the access is not authorized, you'll get the 403 Forbidden and:\n    - if using a Redfish API, you get the Redfish PasswordChangeRequired message.\n    - if using the legacy REST APIs, you'll get the an \"extendedMessage\" with details about the password being expired.\n   - otherwise, 403 Forbidden with no additional message\n(The implementation was easy!)"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I'll just mention that the password is not an element of a https URL, even with BasicAuth."
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 152,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "spelling"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 152,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "yip"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Insert new paragraph here:\nTo clarify, when BMCWeb returns HTTP status 403 Forbidden -and- the session has the special PasswordChangeRequired condition, the HTTP response body may have additional information to help the user diagnose the problem.\n- For Redfish APIs (under the /redfish URI), the Redfish PasswordChangeRequired extended message is sent.\n- For APIs which return a JSON object (such as the DBus REST APIs), the HTTP response message body will contain a top-level JSON field: \"errorExtendedInfo\" = \"The password for this account must be changed.  PATCH the 'Password' property for the account under URI: /redfish/v1/AccountService/Accounts/<accountID>\", with the appropriate accountID.\n- For other APIs, no additional information is sent.  Please note this is simply a straw-man design point which was added to help explain the design; such APIs can be enhanced as needed."
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Foir the non-Redfish case, change the name of the JSON field to: extendedMessage.\n(The Redfish API will use the Redfish PasswordChangeRequired extended message.)"
                },
                {
                    "file": "designs/expired-password.md",
                    "line": 240,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Add new paragraph:\nThis is an alternate mechanism to cause the initial expired password.\nThe main idea is to disable the EXPIRED_PASSWORD image feature, which means the password will not be expired by default.  Then add a new service that runs before the system reaches the multi-user target which administratively expires the password if the BMC's file system looks like its first boot.  For example, if a network server has not written its persistent data to files.  ==> That causes the password to be expired\n\nWhy? This way change the behavior in this edge case scenario:\n- The BMC is running an older version of OpenBMC.\n- The BMC still has its default password.\n- The BMC performs code update to a version of OpenBMC which implements this new design.\n\nThe new behavior will NOT expire the default password during the upgrade, whereas the EXPIRED_PASSWORD image feature would have expired the password."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/expired-password.md",
                    "type": "MODIFIED",
                    "insertions": 76,
                    "deletions": -57
                }
            ],
            "sizeInsertions": 90,
            "sizeDeletions": 57
        }
    ]
}
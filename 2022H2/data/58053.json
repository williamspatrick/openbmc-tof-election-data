{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "Ic8ae9f86257046dda926fcb8f3cafc109fe4bc62",
    "number": 58053,
    "subject": "Redfish user downgrade - keep last Admin user",
    "owner": {
        "name": "Xiaochao Ma",
        "email": "maxiaochao@inspur.com",
        "username": "XiaochaoMa"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/58053",
    "hashtags": [],
    "createdOn": 1666316910,
    "lastUpdated": 1666854255,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1666316910,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1666316975,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666316975,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1666316994,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53809/ : FAILURE"
        },
        {
            "timestamp": 1666319842,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Uploaded patch set 2: Commit message was updated."
        },
        {
            "timestamp": 1666319882,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1"
        },
        {
            "timestamp": 1666319900,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666319900,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1666319984,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53817/ : FAILURE"
        },
        {
            "timestamp": 1666320080,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1666344424,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1666344493,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666344493,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1666345137,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1666345417,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Uploaded patch set 4: Commit message was updated."
        },
        {
            "timestamp": 1666345445,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53846/ : FAILURE"
        },
        {
            "timestamp": 1666345446,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1"
        },
        {
            "timestamp": 1666345483,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666345483,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1666345677,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1666345737,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666345737,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1666345738,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1 Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53847/ : ABORTED"
        },
        {
            "timestamp": 1666347267,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/53850/ : SUCCESS"
        },
        {
            "timestamp": 1666405873,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 5:\n\n(13 comments)"
        },
        {
            "timestamp": 1666474749,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1666632434,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1666854255,
            "reviewer": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "message": "Abandoned\n\nThis function is moved to 'phosphor user manager' for implementation, so this patchset is removed."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "736df1dd77a4b6e38a4655cc724ddac988e6f816",
            "parents": [
                "532d769725d346d5339387016ce14d75d41ee3b2"
            ],
            "ref": "refs/changes/53/58053/1",
            "uploader": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "createdOn": 1666316910,
            "author": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 50,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 169,
                    "deletions": -24
                }
            ],
            "sizeInsertions": 219,
            "sizeDeletions": 24
        },
        {
            "number": 2,
            "revision": "fd9d645fca662e4a8ecdb6278e279b4572f2dcf7",
            "parents": [
                "532d769725d346d5339387016ce14d75d41ee3b2"
            ],
            "ref": "refs/changes/53/58053/2",
            "uploader": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "createdOn": 1666319842,
            "author": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 169,
                    "deletions": -24
                }
            ],
            "sizeInsertions": 227,
            "sizeDeletions": 24
        },
        {
            "number": 3,
            "revision": "e56d172b62f296bba0395e798ba59ff7c820411c",
            "parents": [
                "532d769725d346d5339387016ce14d75d41ee3b2"
            ],
            "ref": "refs/changes/53/58053/3",
            "uploader": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "createdOn": 1666344424,
            "author": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 144,
                    "deletions": -24
                }
            ],
            "sizeInsertions": 202,
            "sizeDeletions": 24
        },
        {
            "number": 4,
            "revision": "9df84a4c499fb5dda1785c2c7c12fce7858ffad8",
            "parents": [
                "532d769725d346d5339387016ce14d75d41ee3b2"
            ],
            "ref": "refs/changes/53/58053/4",
            "uploader": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "createdOn": 1666345417,
            "author": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1188,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "std::function<void(const std::string& ...)>"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 144,
                    "deletions": -24
                }
            ],
            "sizeInsertions": 202,
            "sizeDeletions": 24
        },
        {
            "number": 5,
            "revision": "033c748f1041613ebb713db3d8ddbee87341f210",
            "parents": [
                "532d769725d346d5339387016ce14d75d41ee3b2"
            ],
            "ref": "refs/changes/53/58053/5",
            "uploader": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "createdOn": 1666345677,
            "author": {
                "name": "Xiaochao Ma",
                "email": "maxiaochao@inspur.com",
                "username": "XiaochaoMa"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This logic does not belong in bmcweb.  There's nothing Redfish-specific about this policy, so it needs to be enforced within phosphor-user-manager, not directly in bmcweb.  bmcweb needs to stay as close to a DBus->Redfish converter as possible."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "+1. bmcweb can return a more specific error based on some error returned by phosphor-user-manager,\nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/yaml/xyz/openbmc_project/User/Common.errors.yaml but this logic should go down in phosphor-user-manager"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1183,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "const std::string&"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1190,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "if (!roleId || roleId == \"priv-admin\")"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1201,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "print error log"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1207,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "enabledAdminCount?"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1226,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "else if"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1233,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "print error log"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1250,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "Add blank line"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 1253,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "Does this judgment conflict with line 1190?"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 2097,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "updateUserHandler?"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 2103,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "I did not see any changes in these parameters, they should all be passed in from the outer layer right?\nIf so, I think we can remove them?"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 2109,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "if (innerNewUserName == innerUserName)"
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "line": 2138,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "It has been checked whether the roleId is `std::nullptr` in the redfishJudgeDowngrade method, so I think you can remove it"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 144,
                    "deletions": -24
                }
            ],
            "sizeInsertions": 202,
            "sizeDeletions": 24
        }
    ]
}
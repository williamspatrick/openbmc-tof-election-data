{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I441a8bf3bb7ae70d1a633aee5f307b9239d60e4d",
    "number": 44779,
    "subject": "Design doc for dbus-top tool",
    "owner": {
        "name": "Adedeji Adebisi",
        "email": "adedejiadebisi01@gmail.com",
        "username": "ziniblesssed"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/44779",
    "hashtags": [],
    "createdOn": 1625698869,
    "lastUpdated": 1665682855,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1625698869,
            "reviewer": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1625755392,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(14 comments)\n\nI'd like to see a +1 from your peers on this document too, even if there was an internal review done elsewhere."
        },
        {
            "timestamp": 1625775996,
            "reviewer": {
                "name": "Alex Qiu",
                "email": "xqiu@google.com",
                "username": "alex310110"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1625780212,
            "reviewer": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1625780352,
            "reviewer": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1625782497,
            "reviewer": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "message": "Patch Set 3:\n\n(17 comments)\n\n> Patch Set 1:\n> \n> (14 comments)\n> \n> I'd like to see a +1 from your peers on this document too, even if there was an internal review done elsewhere."
        },
        {
            "timestamp": 1625782677,
            "reviewer": {
                "name": "Alex Qiu",
                "email": "xqiu@google.com",
                "username": "alex310110"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1625788842,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\nLooks like Patrick has given a decent amount of feedback. I'll leave sorting out the gritty details to him, I just want to say this looks like a tool that I would make good use of :)"
        },
        {
            "timestamp": 1635883506,
            "reviewer": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "message": "Abandoned\n\nCommit squashed into change 46107"
        },
        {
            "timestamp": 1635884746,
            "reviewer": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "message": "Restored"
        },
        {
            "timestamp": 1635885618,
            "reviewer": {
                "name": "Alex Qiu",
                "email": "xqiu@google.com",
                "username": "alex310110"
            },
            "message": "Removed reviewer Alex Qiu."
        },
        {
            "timestamp": 1665657946,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Abandoned\n\nclose due to inactivity"
        },
        {
            "timestamp": 1665676141,
            "reviewer": {
                "name": "Sui Chen",
                "email": "suichen@google.com",
                "username": "quadpixels"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1665676931,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1665680811,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1665681739,
            "reviewer": {
                "name": "Sui Chen",
                "email": "suichen@google.com",
                "username": "quadpixels"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1665682855,
            "reviewer": {
                "name": "Sui Chen",
                "email": "suichen@google.com",
                "username": "quadpixels"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "7e0254e4ecf6d344d9e846c9165743dc28ad91aa",
            "parents": [
                "f8cc2a06d9414c7a61af4672d299bcdc0191787e"
            ],
            "ref": "refs/changes/79/44779/1",
            "uploader": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "createdOn": 1625698869,
            "author": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/dbus-top.md",
                    "line": 6,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Check for excess trailing white-space throughout."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 6,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 28,
                    "reviewer": {
                        "name": "Alex Qiu",
                        "email": "xqiu@google.com",
                        "username": "alex310110"
                    },
                    "message": "nit: extra space"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 28,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 31,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I would mention htop here."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 31,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 34,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Can this section be reformatted?  It seems like you intended there to be some bullet point lists but it is really hard to read."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 34,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 44,
                    "reviewer": {
                        "name": "Alex Qiu",
                        "email": "xqiu@google.com",
                        "username": "alex310110"
                    },
                    "message": "Let's include metrics like median latency, and percentile latencies like 99% and 99.9%. We might also want to define a sliding window for the metrics?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 44,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Yes we agree, and we can use the time between a method call and a method return as latency metrics, and compute a median or percentile based on a sliding window."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 63,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'm not sure how useful this is if you don't also analyze method calls to pick out ones which are manipulating properties.  I suspect most method calls are related to properties."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 63,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "As of its current status, this tool is a DBus packet filter, and is not yet capable of performing sophisticated analysis such as relating properties to method calls. But we can do simple analysis such as match method calls with method returns and compute a method call success rate. We will also look into which method calls are manipulating properties."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 64,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Is there any kind of multiplication factor based on how many watchers there are for a signal?  Is it even possible to know that?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 64,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "We will look into whether it\u2019s possible to list watchers for signals."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 68,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "It isn't obvious to me how this leapt to 'sensors'.  How does the tool know that those are a \"special\" thing to analyze?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 68,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "\u201cSensors\u201d are DBus objects that implement the \u201cxyz.openbmc_project.Sensor.Value\u201d interface. The reason \u201csensors\u201d are listed is because our motivation was to find out DBus performance problems related to specific sensors."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 82,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "In what cases do you have a real service name and in what cases do you have numeric service names?  Shouldn't the sender regularly have a service name (I know this is just an example), at least for signals?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 82,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "If our understanding is correct, a real service name is assigned to a DBus connection only if it asks for a name (using sd_bus_request_name for example). Perhaps it\u2019s up to the application author to request human-readable names? This example is obtained by replaying a DBus Pcap, so it seems this particular sender doesn't have a service name."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 97,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "If you really are filtering on sensors, for some reason, then I don't think you should call this 'dbus-top'.\n\nI do think there is likely utility in being able to filter events based on an Interface and/or a sub-tree though.  Can we make this more generic to include everything and add filtering to dig down?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 97,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "If we understand correctly, this comment has two questions: 1) why do we specifically dig into sensors, and 2) need a more generic approach to include the possibility to filter DBus messages on any criteria.\n\nTo answer 1), it is because the original motivation of this tool is to study performance problems with sensors.\n\nTo answer 2),a generic approach may be: the approach takes a user-specified expression, decodes that expression into a sequence of operations, and executes them. For the \u201csensors\u201d info, the expression would be \u201cfilter all objects that implement xyz.openbmc_project.Sensor.Value\u201d interface, then \u201cgroup by the base name of their corresponding DBus Objects\u201d.\n\nSimilar concepts that may be found in other software are the \u201crender nodes\u201d in Blender, \u201cVFX routing\u201d in Lightworks, and/or \u201clow-code\u201d development environments that present logic. All are on different points on the same spectrum where one end is similar to mini script engines.\n\nWe agree this is useful since there might be more types of events to filter; currently we have IPMI in mind and will continue to look for others.\n\nWhat do you think we should call the tool other than dbus-top?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 117,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't think we should encode these special things, personally.  The tool will always be chasing usefulness as the dbus structure changes.\n\nI do think it is reasonable to show all the associations though.  I just wouldn't filter them as \"Inventory\"."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 117,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "We intend to follow the OpenBMC DBus interfaces, should those interfaces be more stable?\nWill change the name \u201cinventory\u201d. Hopefully we can save the trouble of encoding those special things by allowing users to do the filtering."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't know what these mean.  What are they and why are they here?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "These indicate \u201cwhere can this sensor be seen\u201d. In an Inventory manager-based system, a sensor should be visible to Object Mapper, the Inventory Manager, and potentially IPMI SEL. This can help a user debug a problem in the sensor stack. For example, if a sensor\u2019s hwmon daemon is correctly configured but the system experiences an IPMI error, the sensor may not be visible from \u201cIPMI SEL\u201d, and the user can narrow down the debugging to IPMI."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 128,
                    "reviewer": {
                        "name": "Alex Qiu",
                        "email": "xqiu@google.com",
                        "username": "alex310110"
                    },
                    "message": "nit: Use either sender/receiver or source/destination?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 128,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Sender and Destination are the vocabulary used by the DBus API, so we just followed that."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Specifically are you going to use libncurses or libncursesw?"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "libncurses (not with the w suffix, so no wide character support and we avoid using them.) It seems a few BMC images include libncurses by default, so using libncurses is sufficient and convenient."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 181,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Most of these kinds of tools are written using ncurses, right?  I know htop does.  That should probably be listed as an advantage (it is the most widely accepted library for writing a TUI)."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 181,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Rephrased this paragraph."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 183,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This looks like another bullet list that could be formatted better."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 183,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 185,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "You might check with mouse (rnouse) to confirm.  I suspect the changes he is doing for dbus permissions may affect this tool."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 185,
                    "reviewer": {
                        "name": "Adedeji Adebisi",
                        "email": "adedejiadebisi01@gmail.com",
                        "username": "ziniblesssed"
                    },
                    "message": "Thanks for the suggestion, will check with rnouse."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "designs/dbus-top.md",
                    "type": "ADDED",
                    "insertions": 195,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 205,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "31294a39578153c5d97d82eb8d167cf6759aa772",
            "parents": [
                "f8cc2a06d9414c7a61af4672d299bcdc0191787e"
            ],
            "ref": "refs/changes/79/44779/2",
            "uploader": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "createdOn": 1625780212,
            "author": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "designs/dbus-top.md",
                    "type": "ADDED",
                    "insertions": 209,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 219,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "5cba95607ca54319768d83f3d892ae96e559f3a5",
            "parents": [
                "f8cc2a06d9414c7a61af4672d299bcdc0191787e"
            ],
            "ref": "refs/changes/79/44779/3",
            "uploader": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "createdOn": 1625780352,
            "author": {
                "name": "Adedeji Adebisi",
                "email": "adedejiadebisi01@gmail.com",
                "username": "ziniblesssed"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sui Chen",
                        "email": "suichen@google.com",
                        "username": "quadpixels"
                    },
                    "message": "This tool has been submitted: https://github.com/openbmc/openbmc-tools/tree/master/dbus-top"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'm not sure how to take that.  There was a bunch of outstanding feedback.  Are we expecting to merge this design as-is or are we throwing out the doc?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "I would throw it out (and Sui can move it to the openbmc-tools repository if they wish).  Wouldn't it make sense for documentation of isolated, stand-alone applications like this to be along side the code anyway?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sui Chen",
                        "email": "suichen@google.com",
                        "username": "quadpixels"
                    },
                    "message": "Sorry for not following up with this doc in time; I can move the document into openbmc-tools. No matter what the disposition of the document is, we will address the comments in this doc and make changes to the tool accordingly."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sui Chen",
                        "email": "suichen@google.com",
                        "username": "quadpixels"
                    },
                    "message": "Moved the doc to https://gerrit.openbmc.org/c/openbmc/openbmc-tools/+/57920 ."
                },
                {
                    "file": "designs/dbus-top.md",
                    "line": 192,
                    "reviewer": {
                        "name": "Alex Qiu",
                        "email": "xqiu@google.com",
                        "username": "alex310110"
                    },
                    "message": "Anton D. Kachalov (rnouse@google.com)"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "designs/dbus-top.md",
                    "type": "ADDED",
                    "insertions": 209,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 219,
            "sizeDeletions": 0
        }
    ]
}
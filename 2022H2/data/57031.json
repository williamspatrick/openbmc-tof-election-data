{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I458b2fe76f73ff4d71a17f3c7260893b81c70504",
    "number": 57031,
    "subject": "Effect of composed systems on IBM event logging",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/57031",
    "hashtags": [],
    "createdOn": 1662674138,
    "lastUpdated": 1664544162,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1662674138,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1662674276,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1662674277,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1662674292,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50521/ : SUCCESS"
        },
        {
            "timestamp": 1662674299,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1662674416,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1662674421,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1662674430,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50522/ : SUCCESS"
        },
        {
            "timestamp": 1662729483,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1662729614,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1662729619,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1662729632,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50563/ : SUCCESS"
        },
        {
            "timestamp": 1663079583,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Removed reviewer Patrick Williams <patrick@stwcx.xyz>."
        },
        {
            "timestamp": 1663079584,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Removed reviewer Brad Bishop <bradleyb@fuzziesquirrel.com>."
        },
        {
            "timestamp": 1663092621,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1663092666,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663092671,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1663092682,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50707/ : SUCCESS"
        },
        {
            "timestamp": 1663099215,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4:\n\n(5 comments)\n\nThis change is ready for review."
        },
        {
            "timestamp": 1663099225,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1663101345,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(5 comments)"
        },
        {
            "timestamp": 1663159084,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1663160033,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1663169079,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1663191141,
            "reviewer": {
                "name": "Dan Crowell",
                "email": "dcrowell@us.ibm.com",
                "username": "dcrowell77"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1663252173,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1664544115,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Removed reviewer Patrick Williams <patrick@stwcx.xyz>."
        },
        {
            "timestamp": 1664544118,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Removed reviewer Brad Bishop <bradleyb@fuzziesquirrel.com>."
        },
        {
            "timestamp": 1664544162,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Abandoned\n\nDoesn't seem like this is at all helpful to have upstream. Abandoning."
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "49f0e2a8b88c19efb4f11e3dbc724a8691e60354",
            "parents": [
                "5d52507e9ce40ab11338961cacfc525024021e2b"
            ],
            "ref": "refs/changes/31/57031/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1662674138,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/ibm/aggregation/ibm-event-logging.md",
                    "type": "ADDED",
                    "insertions": 146,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 159,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "dba20aadc2c6e416f2741f92f0ff8db60393e892",
            "parents": [
                "5d52507e9ce40ab11338961cacfc525024021e2b"
            ],
            "ref": "refs/changes/31/57031/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1662674299,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/ibm/aggregation/ibm-event-logging.md",
                    "type": "ADDED",
                    "insertions": 146,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 159,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "11ba354502a4fb975d7992a0fa9dc3a3646f37e9",
            "parents": [
                "5d52507e9ce40ab11338961cacfc525024021e2b"
            ],
            "ref": "refs/changes/31/57031/3",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1662729483,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "type": "ADDED",
                    "insertions": 148,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 161,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "a328d4e8472f34b84509bfd464d255cafc375248",
            "parents": [
                "5d52507e9ce40ab11338961cacfc525024021e2b"
            ],
            "ref": "refs/changes/31/57031/4",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1663092621,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 19,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "nit: I see these throughout the doc, are they needed in markdown or something?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 19,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "For some reason I thought apostrophes had to be escaped in markdown, but maybe I was thinking of underscores.  I will fix."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 50,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Is this an example where if we could assume a SCA per composed system, and an SCA is running on a sled, we could greatly reduce work and complexity (i.e. just use the existing d-bus api's from the SCA)?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 50,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Yes.\n\nI still don't know how we're going to pass FFDC in from the SCA since it could be a blob...  Redfish attachments?  that sounds......"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 52,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "What use-case(s) would warrant the SCA app to do this?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 52,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I was envisioning this being the only method for SCA code to create a PEL.  So if the cable validation code wanted to create one, it would be a Redfish call to some other BMC where the standard phosphor-log-manager is already running.  Otherwise, there'd have to be some new SCA PEL daemon that would create a PEL using the VPD from other sleds and then send it as a blob to the target BMC, after it somehow figured out which one to send it to.\n\nWith no log-manager running in the SCA container, that means none of the standard commit() or report() phosphor-logging interfaces would work.  Hopefully that isn't a show stopper."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "I see this being a pretty common use case. Are you thinking the SCA has it's own abstract \"targeting\" model of some sort? Something that maps to the corresponding entity manager objects in each sled? Wondering if we need to capture this requirement on the overall SCA somewhere."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I talked to Santosh a bit more today, and the cable validation PEL would only have a callout for a single BMC, which is also the BMC I presume it would create the PEL on using what I described above.  If it uses an unexpanded location code, which it should know because cable ports have location codes, like Ufcs-P0-T1, then the PEL daemon on the target BMC would know how to expand it based on its VPD.\n\nBut if it does turn out we need to add callouts that cross sleds to a single PEL, then I guess maybe etcd would need a map of BMC IDs to FCS (feature code/serial number) values or something along those lines.\n\nIf it doesn't know the location code, then yea I don't know how to do that."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": ">  which is also the BMC I presume it would create the PEL on using what I described above\n\nThat does not work in all cases, unfortunately :(. The cable validation app will run on the SCA, it could be validating a cable that does not involve the sled on which the SCA is running. So we will need the ability to make \"remote\" callouts."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "How I have it described now is your code would chose a sled, the one that contains the callout, and make a redfish call to it, passing along with it all of the information needed to create the PEL."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Dan Crowell",
                        "email": "dcrowell@us.ibm.com",
                        "username": "dcrowell77"
                    },
                    "message": ">But if it does turn out we need to add callouts that cross sleds to a single PEL\nPRD (running in the SCA) will for sure need to do this."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 60,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "> How I have it described now is your code would chose a sled, the one that contains the callout, and make a redfish call to it, passing along with it all of the information needed to create the PEL.\n\nOkay, I checked the way we callout SMP cables on the FSP - we do a symbolic FRU callout with a location code - so no other inventory information. I think this is easily done now? We could probably just pass in a \"LOCATION_CODE\" key to the logging API?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 68,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "You think there will be cases where the PEL that SCA creates will need to fetch FFDC from a remote BMC? Are there concrete use cases you can think of? Can that complexity be placed in the SCA app that is creating this PEL?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 68,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I have the PEL being created in phosphor-log-manager on the remote BMC."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 98,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "I guess the SCA would also need it's own distinct ID or do you think it's logs just get whichever sled it chooses to create the error?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 98,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I was thinking it would be whatever sled creates it.  If we had to we could add a new PEL field that says it's an SCA level failure if something needs to know that."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 98,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "I think there is some merit in having a way to identify that the PEL was logged by the SCA - Maybe just a different subsystem ID? Will the SCA PELs use their own store separate from the local BMC PELs the SCA is running on? (Edit - NM, you have tackled the storage aspect in the Controversial section below \ud83d\ude0a)\n\nIs there any benefit of syncing SCA level PELs to all BMCs?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 98,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "The PEL spec/IBM doesn't have a concept of a PEL that isn't associated with a physical system, and in the workshop it didn't sound like we needed to invent one, so the PEL will just end being created on a satellite BMC, being reported to that sled's OS.\n\nregarding syncing SCA PELs to all BMCs, I'm not sure what they'd do with them?  Would the HMC just get 8 notifications for the same PEL, and the OSs get sent 8 copies of the same PELs?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 98,
                    "reviewer": {
                        "name": "Dan Crowell",
                        "email": "dcrowell@us.ibm.com",
                        "username": "dcrowell77"
                    },
                    "message": ">I think there is some merit in having a way to identify that the PEL was logged by the SCA\nI second this.  There will definitely be errors that only have SCA-context so none of the BMCs would make sense to be associated.  A unique id range (e.g. 0x5Fzzzzzz) would make those kinds of logs obvious, especially if a SCA bounces around to other BMCs.  This would be similar to how Hostboot uses 9x for the IPL logs and then 89 for the runtime logs with full system scope."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 98,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "> regarding syncing SCA PELs to all BMCs, I'm not sure what they'd do with them?  Would the HMC just get 8 notifications for the same PEL, and the OSs get sent 8 copies of the same PELs?\n\nI was just thinking of a case where the SCA BMC OR the SCA app container dies before HMC can pull the SCA PELs. I think on a failover, the new SCA would have to rediscover state anyway, so I guess this is a non-issue."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 103,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Specify this tool will only be supported on the SCA? Or are you thinking any sled could support it?"
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 103,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I guess it would make the most sense to run on the SCA only, which means it would need the peltool python installed on it.  Theoretically it could also just target the SCA, but then it would have to drag in the peltool python packages as a prereq.\n\nI will update it."
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Dan Crowell",
                        "email": "dcrowell@us.ibm.com",
                        "username": "dcrowell77"
                    },
                    "message": "Are there any requirements for which BMC gets the PEL if there are callouts?  e.g. if HBRT wants to callout sled0:proc0, does the sled0 need to catch that PEL?  If so, how do we handle PELs with callouts that span sleds?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/oem/ibm/aggregation/ibm-event-logging.md",
                    "type": "ADDED",
                    "insertions": 154,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 167,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/phosphor-nvme",
    "branch": "master",
    "id": "I00fabf8f387c83bf139539bba9d5ba6aed693778",
    "number": 57307,
    "subject": "nvme_manager: decouple config dependency of PresentPin and PwrGoodPin",
    "owner": {
        "name": "PL",
        "email": "potin.lai@quantatw.com",
        "username": "potinlai"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-nvme/+/57307",
    "hashtags": [],
    "createdOn": 1663760427,
    "lastUpdated": 1665552158,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1663760427,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1663760446,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1663760457,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663760457,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1663760473,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/52109/ : FAILURE"
        },
        {
            "timestamp": 1663760720,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1663760797,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663760797,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1663760813,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/52110/ : FAILURE"
        },
        {
            "timestamp": 1663775776,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1663775833,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663775843,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1663776091,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52140/ : SUCCESS"
        },
        {
            "timestamp": 1663815087,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 4: Commit message was updated."
        },
        {
            "timestamp": 1663815098,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1"
        },
        {
            "timestamp": 1663815131,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663815131,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1663815150,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 4:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1663815329,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52202/ : SUCCESS"
        },
        {
            "timestamp": 1664319856,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1664432901,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1664485268,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1664485282,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1664516399,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1664556068,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1664761896,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 5: Commit message was updated."
        },
        {
            "timestamp": 1664761908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1"
        },
        {
            "timestamp": 1664761910,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664761910,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1664761956,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52798/ : SUCCESS"
        },
        {
            "timestamp": 1664761965,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1665552158,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Change has been successfully merged\n\n4 is the latest approved patch-set.\nNo files were changed between the latest approved patch-set and the submitted one.\n"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "985a28a49fd7abb03a2c596a01c01616113e62c7",
            "parents": [
                "d4f5199251f2acbcf007c9bc163fd65d3695655b"
            ],
            "ref": "refs/changes/07/57307/1",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1663760427,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "nvme_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": -63
                }
            ],
            "sizeInsertions": 73,
            "sizeDeletions": 63
        },
        {
            "number": 2,
            "revision": "782a6b024324fe7e42029171b515b11179c473ec",
            "parents": [
                "d4f5199251f2acbcf007c9bc163fd65d3695655b"
            ],
            "ref": "refs/changes/07/57307/2",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1663760720,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "nvme_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 58,
                    "deletions": -63
                }
            ],
            "sizeInsertions": 76,
            "sizeDeletions": 63
        },
        {
            "number": 3,
            "revision": "2ca8f856d76c1c79d40d1480562a125c870df94e",
            "parents": [
                "d4f5199251f2acbcf007c9bc163fd65d3695655b"
            ],
            "ref": "refs/changes/07/57307/3",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1663775776,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "nvme_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": -63
                }
            ],
            "sizeInsertions": 75,
            "sizeDeletions": 63
        },
        {
            "number": 4,
            "revision": "13f458060fe11721400c527ed7cf596b6e0e40f6",
            "parents": [
                "d4f5199251f2acbcf007c9bc163fd65d3695655b"
            ],
            "ref": "refs/changes/07/57307/4",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1663815087,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 21,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Was this tested?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 21,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "I tested this patch with another patch together on Bletchley.\nThe test log is posted in the below patch.\n\nnvmes: add Availability interface\nhttps://gerrit.openbmc.org/c/openbmc/phosphor-nvme/+/57316"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 21,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Oh ok, it'd still be good to add the \"Tested\" footer with this log in this commit message as well"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 21,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Done"
                },
                {
                    "file": "nvme_manager.cpp",
                    "line": 681,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "This logic seems different now"
                },
                {
                    "file": "nvme_manager.cpp",
                    "line": 681,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Hi @Brandon, I think it same logic, but please let me know if I missed some cases.\n\nIn original code, when PwrGoodPin is high (PWRGOOD), it straight go to readNvmeData(), then set isErrorPower[config.index] to false.\nAnd when PwrGoodPin is low, it does LED setting & logging, then set isErrorPower[config.index] to true and also call readNvmeData().\n\nreadNvmeData() is called no matter PwrGoodPin is high or low, that's why I move out the readNvmeData()."
                },
                {
                    "file": "nvme_manager.cpp",
                    "line": 681,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I guess the other difference is that if config.presentPin was false, we would skip to \n\n```\n        readNvmeData(config);\n\n        isErrorPower[config.index] = false;\n```\n\nWe now tie setting `isErrorPower[config.index] = false;` to if `pwrGoodPinValStr == POWERGD`\n\nIt is a difference in behavior, but because it defaults `pwrGoodPinValStr` to `POWERGD`, perhaps this is ok."
                },
                {
                    "file": "nvme_manager.cpp",
                    "line": 681,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Got it, thanks for the explanation."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "nvme_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": -63
                }
            ],
            "sizeInsertions": 80,
            "sizeDeletions": 63
        },
        {
            "number": 5,
            "revision": "aef8fa0dd6506907cc863445c27d21c6700d52a4",
            "parents": [
                "d4f5199251f2acbcf007c9bc163fd65d3695655b"
            ],
            "ref": "refs/changes/07/57307/5",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1664761896,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "nvme_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": -63
                }
            ],
            "sizeInsertions": 102,
            "sizeDeletions": 63
        }
    ]
}
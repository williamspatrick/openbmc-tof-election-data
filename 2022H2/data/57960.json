{
    "project": "openbmc/phosphor-host-ipmid",
    "branch": "master",
    "id": "Ia8972d8b194d8340e67da3e0f53165e42c25f643",
    "number": 57960,
    "subject": "fix clang-tidy error for overriding destructor",
    "owner": {
        "name": "Willy Tu",
        "email": "wltu@google.com",
        "username": "wltu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-host-ipmid/+/57960",
    "hashtags": [],
    "createdOn": 1665984963,
    "lastUpdated": 1666047501,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1665984963,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1665985037,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1665985062,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1665985062,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1665985123,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53654/ : FAILURE"
        },
        {
            "timestamp": 1665985135,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1665985212,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1665985212,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1665985272,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53655/ : FAILURE"
        },
        {
            "timestamp": 1665994772,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1665994818,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1665994818,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1665994859,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/53662/ : FAILURE"
        },
        {
            "timestamp": 1665995053,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1665995128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1665995129,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1665995402,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/53663/ : SUCCESS"
        },
        {
            "timestamp": 1666024605,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1666026806,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1666036309,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1666037945,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1666046510,
            "reviewer": {
                "name": "Vernon Mauery",
                "email": "vernon.mauery@linux.intel.com",
                "username": "vmauery"
            },
            "message": "Patch Set 5: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1666046635,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1666046835,
            "reviewer": {
                "name": "Vernon Mauery",
                "email": "vernon.mauery@linux.intel.com",
                "username": "vmauery"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1666046915,
            "reviewer": {
                "name": "Vernon Mauery",
                "email": "vernon.mauery@linux.intel.com",
                "username": "vmauery"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1666047501,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f0a6ad39c223dae1ebaa197bc63173d631114a5c",
            "parents": [
                "45aed6919d1d6ecdfbea93b6b596172d0b472ef7"
            ],
            "ref": "refs/changes/60/57960/1",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1665984963,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -18
                }
            ],
            "sizeInsertions": 53,
            "sizeDeletions": 18
        },
        {
            "number": 2,
            "revision": "535e3417eaeaead3b8f7ce4080ae99d07991f2f3",
            "parents": [
                "45aed6919d1d6ecdfbea93b6b596172d0b472ef7"
            ],
            "ref": "refs/changes/60/57960/2",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1665985037,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -18
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 18
        },
        {
            "number": 3,
            "revision": "3aaa683250d78ef37f1c9795c459d76ff36689fb",
            "parents": [
                "45aed6919d1d6ecdfbea93b6b596172d0b472ef7"
            ],
            "ref": "refs/changes/60/57960/3",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1665985135,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -18
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 18
        },
        {
            "number": 4,
            "revision": "e5e870343e6127d6d94c83a7b2d4028666e84a76",
            "parents": [
                "45aed6919d1d6ecdfbea93b6b596172d0b472ef7"
            ],
            "ref": "refs/changes/60/57960/4",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1665994772,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 17
        },
        {
            "number": 5,
            "revision": "76889090d85dade0e4c486cbd4977d8275765fbe",
            "parents": [
                "45aed6919d1d6ecdfbea93b6b596172d0b472ef7"
            ],
            "ref": "refs/changes/60/57960/5",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1665995053,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 273,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "nit:\n(deprecated in C++17)(removed in C++20)"
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "won't you double de allocate?, because you are added another call to OPENSSL_cleanse, below. (this is the second time you would dealloc, so the error would be here)"
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "I am not exactly sure here."
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Your child class will deconstructs on line 300, calling OPENSSL_cleanse, then when your parent class deconstructs it will (using the child of std::allocate, SecureAllocator) call OPENSSL_cleanse again in line 280. \nwhich is a use after free/double fee issue. \n\nYou could simply not use the SecureAllocator, and use the stock std::allocator"
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "Vernon Mauery",
                        "email": "vernon.mauery@linux.intel.com",
                        "username": "vmauery"
                    },
                    "message": "OPENSSL_cleanse does not dealloc, only forces memset to zero"
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "That is good news."
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "Vernon Mauery",
                        "email": "vernon.mauery@linux.intel.com",
                        "username": "vmauery"
                    },
                    "message": "Also, only one of the dealloc calls will be called anyway. The string class will only call the allocator dealloc function if it used the allocator class to allocate in the first place. For short strings, the allocator/deallocator is not called and only the internal storage is used, which is why the OPENSSL_cleanse is needed in the securestring destructor."
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 280,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "ok, sounds good. thanks for the info."
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 300,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "I suspect this can be simplified. It is strange to use deference twice, and reference once on the same pointer. \n\n&((*this)[0] \n&(**this)\n(*this)"
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 300,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "I am aiming to change minimum code to fix the current issue. Will update the change in a follow up change once this change is resolved. https://gerrit.openbmc.org/c/openbmc/phosphor-host-ipmid/+/57975\n\nBut I think it should just be `this->data()`? Pointing to the beginning of the data."
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "line": 300,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "checks out, I did not see this was the original way. \n\n(resolved)"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "include/ipmid/types.hpp",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 17
        }
    ]
}
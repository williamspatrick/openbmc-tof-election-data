{
    "project": "openbmc/phosphor-pid-control",
    "branch": "master",
    "id": "Idea1ede908fe4a2da3018cc0624c78ac7e0530eb",
    "number": 57578,
    "subject": "Add SIGHUP handling for reloading configuration",
    "owner": {
        "name": "PL",
        "email": "potin.lai@quantatw.com",
        "username": "potinlai"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-pid-control/+/57578",
    "hashtags": [],
    "createdOn": 1664529867,
    "lastUpdated": 1665552176,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1664529867,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1664529963,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664529963,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1664529981,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/52713/ : FAILURE"
        },
        {
            "timestamp": 1664530070,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1664530167,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664530167,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1664530342,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52714/ : SUCCESS"
        },
        {
            "timestamp": 1664531104,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1664560922,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1664560994,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664560994,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1664561451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52767/ : SUCCESS"
        },
        {
            "timestamp": 1664562855,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1664599489,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1664763503,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1664763585,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664763585,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1664763669,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/52799/ : FAILURE"
        },
        {
            "timestamp": 1664763807,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1664763880,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1664763880,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1664764082,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/52800/ : SUCCESS"
        },
        {
            "timestamp": 1664764160,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1664796383,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1664858992,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1664884119,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1665552176,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Change has been successfully rebased and submitted as e2ec69ad006828e8b3aeadbc009947b21aa3b4fe"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c726c4de0ebb6ca02e77443d578d81efd7b7d91a",
            "parents": [
                "bcdeb83ca05ed0fa352290ec8f78bb28a2d1d2fb"
            ],
            "ref": "refs/changes/78/57578/1",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1664529867,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "phosphor-pid-control.service.in",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "main.cpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 92,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "0f87db5a29b3baf5ab895c083c175df2405049ce",
            "parents": [
                "bcdeb83ca05ed0fa352290ec8f78bb28a2d1d2fb"
            ],
            "ref": "refs/changes/78/57578/2",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1664530070,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "This is a good idea, and a good feature to add. However, I have some implementation concerns. What purpose does it serve to have a timer delay? Is there a bug that happens if many SIGHUP signals arrive in rapid succession?\n"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Just simply try to prevent multiple `systemctl reload` called by user in short period."
                },
                {
                    "file": "main.cpp",
                    "line": 217,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Please check the \"error\" parameter here, and if called for an error reason (such as operation_aborted), display the error message and then return without taking further action. That will prevent unwanted action from being taken if there's an error. Your timer callback below already does this, which is good."
                },
                {
                    "file": "main.cpp",
                    "line": 217,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Done"
                },
                {
                    "file": "main.cpp",
                    "line": 220,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "I don't understand this sentence. Please explain further. What is the purpose of adding a delay here? I noticed it was commented out. Is this something that is still under development or testing?"
                },
                {
                    "file": "main.cpp",
                    "line": 220,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Sorry, I forget to remove this before submit the patch.\n\nI was thinking to avoid doing reload if user runs `systemctl reload phosphor-pid-contorl` many times in shot period. But I notice that somehow it already has a way for preventing multiple reload action at same time."
                },
                {
                    "file": "main.cpp",
                    "line": 232,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "The timer is created, and callback is registered with async_wait, however, the timer is never actually started during this function, so it will never fire. The expires_after() is commented out above."
                },
                {
                    "file": "main.cpp",
                    "line": 232,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "This is quite wired, it does trigger the function without set timer.expires_after() in my testing.\nBut it looks like all the examples set expires_after() right before async_wait(), so I add it back (with 1 sec delay)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "phosphor-pid-control.service.in",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "main.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 90,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "251e5b224eac975907abda56b00bf150586bfa25",
            "parents": [
                "bcdeb83ca05ed0fa352290ec8f78bb28a2d1d2fb"
            ],
            "ref": "refs/changes/78/57578/3",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1664560922,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "This looks better now, just a suggested error message cleanup that i just learned about.\n"
                },
                {
                    "file": "main.cpp",
                    "line": 221,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "I just learned you can use boost::system::error_code in Boolean context, in an if statement:\n\n```\nif (error)\n{\n  std::cout << \"Signal \" << signal_number << \" handler error: \" << error.message() << \"\\n\";\n  return;\n}\n```\n\nThis will work for all error possibilities, not just boost::asio::error::operation_aborted, and it will print the error that happened, and it will also clean up a warning message regarding the unused variable signal_number.\n\nhttps://stackoverflow.com/questions/9225119/how-to-countercheck-a-boost-error-code-appropriately"
                },
                {
                    "file": "main.cpp",
                    "line": 221,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Done"
                },
                {
                    "file": "main.cpp",
                    "line": 229,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Same suggestion as above:\n\n```\nif (ec)\n{\n  std::cout << \"Signal timer error: \" << ec.message() << \"\\n\";\n  return;\n}\n```"
                },
                {
                    "file": "main.cpp",
                    "line": 229,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "phosphor-pid-control.service.in",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "main.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "437a2fc2dcb6555e095cceaa57abe3356050e8a4",
            "parents": [
                "bcdeb83ca05ed0fa352290ec8f78bb28a2d1d2fb"
            ],
            "ref": "refs/changes/78/57578/4",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1664763503,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "phosphor-pid-control.service.in",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "main.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "bfd844802a14ad71676e852ac398c2ef3713874b",
            "parents": [
                "bcdeb83ca05ed0fa352290ec8f78bb28a2d1d2fb"
            ],
            "ref": "refs/changes/78/57578/5",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1664763807,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "LGTM - nice, this looks good now\n"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "phosphor-pid-control.service.in",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "main.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        },
        {
            "number": 6,
            "revision": "e2ec69ad006828e8b3aeadbc009947b21aa3b4fe",
            "parents": [
                "f2efcbbd31ebbf9edfcfae16fffe88496d23b53d"
            ],
            "ref": "refs/changes/78/57578/6",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1665552176,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "phosphor-pid-control.service.in",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "main.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 96,
            "sizeDeletions": 0
        }
    ]
}
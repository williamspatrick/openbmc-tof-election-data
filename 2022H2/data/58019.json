{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Ic64023b2d7f9bce80a025a1d847228e90e0b72bd",
    "number": 58019,
    "subject": "meta-ibm: p10bmc: Add rainier runqemu options",
    "owner": {
        "name": "Joel Stanley",
        "email": "joel@jms.id.au",
        "username": "shenki"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/58019",
    "hashtags": [],
    "createdOn": 1666176627,
    "lastUpdated": 1666645451,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1666176627,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1666176641,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1666176773,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666176778,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1666176778,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/13425/"
        },
        {
            "timestamp": 1666177471,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/13425/ : SUCCESS"
        },
        {
            "timestamp": 1666177480,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1666178696,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1666180518,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1666180627,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666180627,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1666180635,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/13428/"
        },
        {
            "timestamp": 1666181420,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/13428/ : SUCCESS"
        },
        {
            "timestamp": 1666181430,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1666182658,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1666234603,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\nThis change is ready for review."
        },
        {
            "timestamp": 1666234616,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1666237712,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1666241252,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1666307349,
            "reviewer": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1666639506,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1666639869,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1666639928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1"
        },
        {
            "timestamp": 1666639935,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Failed \n\nIBM Hardware CI : witherspoon hardware test failed"
        },
        {
            "timestamp": 1666639939,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1666639995,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1666639996,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1666640002,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Verified\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/13465/"
        },
        {
            "timestamp": 1666640140,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1666641256,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/13465/ : SUCCESS"
        },
        {
            "timestamp": 1666641264,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1666642484,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1666645451,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Change has been successfully rebased and submitted as 25cd59bcd0f4abc0fed470574aefe8b38a459884"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "11d94c9507608fb52ca582827a89a3d61a13749d",
            "parents": [
                "0999122bfe6f28863066012c0466fd7f3139b658"
            ],
            "ref": "refs/changes/19/58019/1",
            "uploader": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "createdOn": 1666176627,
            "author": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "dabee75e9602cfd1221f97ead34ec9d7c13da55a",
            "parents": [
                "0999122bfe6f28863066012c0466fd7f3139b658"
            ],
            "ref": "refs/changes/19/58019/2",
            "uploader": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "createdOn": 1666180518,
            "author": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "nit: \"meta-ibm:\" to be consistent with other changes to meta-* dirs."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Adriana could you take a look and +2 if you're good? This seems like more in your area of expertise."
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "line": 73,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Does this add much to the build times? For instance, I hate how long compressing the wic takes, especially as I usually decompress it immediately afterwards :("
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "line": 73,
                    "reviewer": {
                        "name": "Joel Stanley",
                        "email": "joel@jms.id.au",
                        "username": "shenki"
                    },
                    "message": "I've been using the core-image-minimal target for the p10bmc machine for my testing, so the times for the actual image will differ (especially because this build has no host firmware).\n\nFrom a built tree I did this:\n\nbitbake -c cleanall core-image-minimal\n\ntime bitbake core-image-minimal\nreal    1m12.270s\nuser    0m0.937s\nsys     0m0.158s\n\nI then removed wic.qcow2 from IMAGE_FSTYPES, did a cleanall again, and re-ran the core-image-minimal target:\n\nreal\t1m18.069s\nuser\t0m0.603s\nsys\t0m0.114s\n\nWhich makes no sense at all. I thought cleanall cleaned the sstate cache too, so I don't know what's going on there.\n\nI suspect a better test would be to benchmark the qemu-img command, which is what CONVERSION_CMD:qcow2 in poky/meta/classes-recipe/image_types.bbclass in does to produce the qcow2.\n\nHere's what that looks like with a proper full p10bmc image:\n\n$ time qemu-img convert -O qcow2  obmc-phosphor-image-p10bmc-20221019203855.rootfs.wic foo.qcow2\n\nreal\t0m0.464s\nuser\t0m0.065s\nsys\t0m0.624s\n\n$ ls -lhS obmc-phosphor-image-p10bmc-20221019203855.rootfs.wic foo.qcow2\n-rw-r--r--. 1 joel joel  15G Oct 19 16:54 obmc-phosphor-image-p10bmc-20221019203855.rootfs.wic\n-rw-r--r--. 1 joel joel 509M Oct 19 23:35 foo.qcow2\n\nI don't think we have an concerns about this increasing build time.\n\nBTW, if you're building locally and want the .wic instead of the .wic.xz, add this to your local.conf:\n\nIMAGE_FSTYPES:remove=\"wic.xz\"\nIMAGE_FSTYPES +=\" wic \""
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "line": 73,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Ack"
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "line": 73,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "watching bitbake, seems it creates the .wic.xz and .qcow2 in parallel, .wic.xz still taking about 3min to complete with no additional time taking by .qcow2, both files have the same creation time in the tmp/deploy/images/ dir so seems we're ok with build times, just adds a  new ~500MB file.\n\n-rw-r--r-- 2 anoo anoo 538M Oct 24 14:29 obmc-phosphor-image-p10bmc-20221024191554.rootfs.wic.qcow2\n-rw-r--r-- 2 anoo anoo 212M Oct 24 14:29 obmc-phosphor-image-p10bmc-20221024191554.rootfs.wic.xz"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "e3d6b1f571cdaa78797d5fe28e5dff25291cd723",
            "parents": [
                "0999122bfe6f28863066012c0466fd7f3139b658"
            ],
            "ref": "refs/changes/19/58019/3",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1666639869,
            "author": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "25cd59bcd0f4abc0fed470574aefe8b38a459884",
            "parents": [
                "44b66385ccf5f375a764e0b1e666ffaf1df63ffc"
            ],
            "ref": "refs/changes/19/58019/4",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1666645451,
            "author": {
                "name": "Joel Stanley",
                "email": "joel@jms.id.au",
                "username": "shenki"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/conf/machine/p10bmc.conf",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 0
        }
    ]
}
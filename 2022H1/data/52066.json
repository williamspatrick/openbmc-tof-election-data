{
    "project": "openbmc/phosphor-led-manager",
    "branch": "master",
    "id": "Ib4cb5761de1f80567a775cb15e8da921f539037e",
    "number": 52066,
    "subject": "json: enable JSON schema versioning",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-led-manager/+/52066",
    "commitMessage": "json: enable JSON schema versioning\n\nIn a future commit I'm going to introduce a new JSON schema\n(\"version 2\"), so set the ground-work for that here.  There are\ncapabilities that are unable to be expressed in the current format, such\nas prioritization of two groups both have Blink settings but at\ndifferent rates, but we want to retain backwards compatibility to any\nexisting configs.\n\nSigned-off-by: Patrick Williams <patrick@stwcx.xyz>\nChange-Id: Ib4cb5761de1f80567a775cb15e8da921f539037e\n",
    "createdOn": 1647482906,
    "lastUpdated": 1647873761,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1647482906,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1647482926,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647482927,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1647482952,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/39115/ : FAILURE"
        },
        {
            "timestamp": 1647510089,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1647510104,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647510104,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1647510200,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/39136/ : SUCCESS"
        },
        {
            "timestamp": 1647520602,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1647523654,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1647523934,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1647523945,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647523945,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1647524042,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/39150/ : SUCCESS"
        },
        {
            "timestamp": 1647553013,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1647564862,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1647601048,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1647873734,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1647873761,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "7074092a298eb02f6d3194d7eb69de367b35d2d2",
            "parents": [
                "e66db296e96e40e7e94501db217e68c9978b37ea"
            ],
            "ref": "refs/changes/66/52066/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1647482906,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "manager/json-parser.hpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "da02da996f85c9b7c8779209e9b6aed4f47de1f3",
            "parents": [
                "7217c0354245f9096adb4301945951e030d322c8"
            ],
            "ref": "refs/changes/66/52066/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1647510089,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "I don't understand what is the point of adding the json version? Are there any background needs?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yeah, I haven't gotten to fully implementing it yet.  Trying to get there but I keep finding lots of things to clean up first.\n\nI'm going to introduce a new JSON format and wanted to ensure backwards compatibility.  The current format is unable to express priorities such as if we have two different groups that trigger \"Blink\".\n\nConsider the following LED behavior:\n    Powered-On: On\n    Identify: Blink-Fast\n    Fault: Blink-Slow\n\nThere currently isn't any way to set \"Identify\" as the highest priority behavior."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "> Yeah, I haven't gotten to fully implementing it yet.  Trying to get there but I keep finding lots of things to clean up first.\n> \n> I'm going to introduce a new JSON format and wanted to ensure backwards compatibility.  The current format is unable to express priorities such as if we have two different groups that trigger \"Blink\".\n> \n> Consider the following LED behavior:\n>     Powered-On: On\n>     Identify: Blink-Fast\n>     Fault: Blink-Slow\n> \n> There currently isn't any way to set \"Identify\" as the highest priority behavior.\n\nIf there are two different groups triggering \"Blink\", we can set the priority \"Priority\", for example:\n\n````\n\"group\" : \"g1\",\n\"members\" : [\n  {\n    \"Name\" : \"pca955x_front_sys_pwron0\",\n    \"Action\" : \"Blink\",\n    \"DutyOn\" : 50,\n    \"Period\" : 1000,\n    \"Priority\" : \"On\"\n  }\n]\n\n\"group\" : \"g2\",\n\"members\" : [\n  {\n    \"Name\" : \"pca955x_front_sys_pwron0\",\n    \"Action\" : \"On\",\n    \"DutyOn\" : 50,\n    \"Period\" : 1000,\n    \"Priority\" : \"On\"\n  }\n]\n````\n\nIf not set, the default is Blink.\n\nHowever, at present, the priority only supports two states of On and Blink."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "The current code allows blink to be set as priority, yes, but not _which_ blink.  The OCP servers have a different LED strategy that requires this prioritization. We need \u201cidentify\u201d to take priority over \u201cfault\u201d where both of them blink but at a different rate (and color). \n\nif you are curious you can read section 6.11 of the Yosemite v2 spec off the OCP website as an example."
                },
                {
                    "file": "manager/json-parser.hpp",
                    "line": 162,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "remove"
                },
                {
                    "file": "manager/json-parser.hpp",
                    "line": 162,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "manager/json-parser.hpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "73ff9ad6e05b34306f97cef22d6448b14cf64a60",
            "parents": [
                "7217c0354245f9096adb4301945951e030d322c8"
            ],
            "ref": "refs/changes/66/52066/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1647523934,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "manager/json-parser.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 4
        }
    ]
}
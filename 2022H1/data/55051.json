{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "Ia745c5f421f959e75ff99dc7ea2eeaa34b485ed0",
    "number": 55051,
    "subject": "Fix a bug that happened after renaming the login user",
    "owner": {
        "name": "Xie Ning",
        "email": "xiening.xll@bytedance.com",
        "username": "XieNingll"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/55051",
    "commitMessage": "Fix a bug that happened after renaming the login user\n\nAn Internal server Error will happen if you rename the login user.\nRename the session of the renamed user to fix this bug.\n\nTested:\n1. Add a new user such as test\n2. Login with the new user in web\n3. Rename the username and the session is still connected\n\nSigned-off-by: Xie Ning <xiening.xll@bytedance.com>\nChange-Id: Ia745c5f421f959e75ff99dc7ea2eeaa34b485ed0\n",
    "createdOn": 1656661170,
    "lastUpdated": 1657250016,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1656661170,
            "reviewer": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1656661212,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1656661213,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1656661733,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/46237/ : SUCCESS"
        },
        {
            "timestamp": 1656685840,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1656689334,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1656689543,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1656701103,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1656770372,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1656770443,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 1: -Code-Review"
        },
        {
            "timestamp": 1656903285,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1657192890,
            "reviewer": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1657192924,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1657192924,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1657193445,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/46575/ : SUCCESS"
        },
        {
            "timestamp": 1657250016,
            "reviewer": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "bff36daf97bbf509552a627cbf3985e21a1074b8",
            "parents": [
                "b9e1b01ae1a213897d55716454529984caab63bb"
            ],
            "ref": "refs/changes/51/55051/1",
            "uploader": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "createdOn": 1656661170,
            "author": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Should we just remove all the user sessions?  That seems simpler and less error prone."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Jiaqing Zhao",
                        "email": "jiaqing.zhao@intel.com",
                        "username": "jiaqingz-intel"
                    },
                    "message": "I think not, renaming one logged in user should not affect other logged in users' sessions.\n\nThe namespace is quite misleading here, persistent_data::SessionStore actually represents sessions in memory. It's only persisted to file on bmcweb exit."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> I think not, renaming one logged in user should not affect other logged in users' sessions.\n\nCorrect;  I was suggesting that when you rename a user, delete all the sessions for that user.  That seems less error prone.\n\n> \n> The namespace is quite misleading here, persistent_data::SessionStore actually represents sessions in memory. It's only persisted to file on bmcweb exit.\n\nI'm not sure why that matters in the context of this review, but yes, that is the intent.  Sessions change a lot over the lifetime of a system, and we don't necessarily want to be persisting data at that high of a rate, which is why they're only written on shutdown."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Jiaqing Zhao",
                        "email": "jiaqing.zhao@intel.com",
                        "username": "jiaqingz-intel"
                    },
                    "message": "> Correct;  I was suggesting that when you rename a user, delete all the sessions for that user.  That seems less error prone.\n\nAgreed\n\n> I'm not sure why that matters in the context of this review, but yes, that is the intent.  Sessions change a lot over the lifetime of a system, and we don't necessarily want to be persisting data at that high of a rate, which is why they're only written on shutdown.\n\nPreviously I think the \"remove all the user sessions\" means removing all sessions in persistent data file, sorry for my misunderstanding."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "> Correct;  I was suggesting that when you rename a user, delete all the sessions for that user.  That seems less error prone.\n\nIn the webui view, if we delete all the sessions for the user, renaming the current user will cause the user to be logged out after rename. This looks not good."
                },
                {
                    "file": "include/sessions.hpp",
                    "line": 348,
                    "reviewer": {
                        "name": "Jiaqing Zhao",
                        "email": "jiaqing.zhao@intel.com",
                        "username": "jiaqingz-intel"
                    },
                    "message": "nit: using range-based for will make the code simpler"
                },
                {
                    "file": "include/sessions.hpp",
                    "line": 348,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "+1"
                },
                {
                    "file": "include/sessions.hpp",
                    "line": 348,
                    "reviewer": {
                        "name": "Xie Ning",
                        "email": "xiening.xll@bytedance.com",
                        "username": "XieNingll"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "include/sessions.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 34,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "d23bc491b6cd4ee182172a20691c94560b37cf25",
            "parents": [
                "b02464b7a92dd26bb974a142499a9bd8a073922e"
            ],
            "ref": "refs/changes/51/55051/2",
            "uploader": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "createdOn": 1657192890,
            "author": {
                "name": "Xie Ning",
                "email": "xiening.xll@bytedance.com",
                "username": "XieNingll"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/account_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "include/sessions.hpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        }
    ]
}
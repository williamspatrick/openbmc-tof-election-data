{
    "project": "openbmc/bios-bmc-smm-error-logger",
    "branch": "main",
    "id": "I326f814eb66892971ec32f0572618a34825d88b0",
    "number": 54676,
    "subject": "buffer: bugfix (v3) fix the checksum",
    "owner": {
        "name": "Brandon Kim",
        "email": "brandonkim@google.com",
        "username": "brandonkimbk"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bios-bmc-smm-error-logger/+/54676",
    "commitMessage": "buffer: bugfix (v3) fix the checksum\n\nThe BIOS is expected to use the XOR checksum which behaves ever so\nslightly different compared to summing up the bytes (even though\nbitwise XOR is the same as addition).\n\nFixed the unit test accordingly\n\nTested: Unit test + tested on a BIOS with real / valid checksummed\npayload\n\nSigned-off-by: Brandon Kim <brandonkim@google.com>\nChange-Id: I326f814eb66892971ec32f0572618a34825d88b0\n",
    "createdOn": 1655446757,
    "lastUpdated": 1655455113,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1655446757,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1655446788,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655446788,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1655446796,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 2: Commit message was updated."
        },
        {
            "timestamp": 1655446808,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/45228/ : FAILURE"
        },
        {
            "timestamp": 1655446883,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1655446928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655446928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1655447052,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45230/ : SUCCESS"
        },
        {
            "timestamp": 1655448916,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1655449211,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1655449737,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1655449773,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655449773,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1655449837,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1655449897,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45232/ : SUCCESS"
        },
        {
            "timestamp": 1655454485,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1655455113,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f66a41eff96661b63ee76f86b510a4e748230d6a",
            "parents": [
                "35d4335eda4c41bc5c658c8f1d36190f0e7e625a"
            ],
            "ref": "refs/changes/76/54676/1",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1655446757,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "include/buffer.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/buffer.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -3
                },
                {
                    "file": "test/buffer_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 12
        },
        {
            "number": 2,
            "revision": "2d8934ec09e338829fcde2c638537c1053ff8015",
            "parents": [
                "35d4335eda4c41bc5c658c8f1d36190f0e7e625a"
            ],
            "ref": "refs/changes/76/54676/2",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1655446796,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "include/buffer.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/buffer.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -3
                },
                {
                    "file": "test/buffer_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 12
        },
        {
            "number": 3,
            "revision": "62a2b9d21320751876c956aaa7c7da30e048bdc8",
            "parents": [
                "35d4335eda4c41bc5c658c8f1d36190f0e7e625a"
            ],
            "ref": "refs/changes/76/54676/3",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1655446883,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/buffer.cpp",
                    "line": 213,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Do we need entryHeaderPtr?\n\nCan't we convert entryHeader to std::span directly?\n\n```\nstd::span<uint8_t>(&entryHeader, &entryHeader + sizeof(struct QueueEntryHeader));\n```\n\nmight work."
                },
                {
                    "file": "src/buffer.cpp",
                    "line": 213,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Oh maybe, I think I ran into issues but maybe that's just me misremembering."
                },
                {
                    "file": "src/buffer.cpp",
                    "line": 213,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "definitely misremembering - this works! However, just realized that we CAN get accumulate to work... so we do need this ptr"
                },
                {
                    "file": "src/buffer.cpp",
                    "line": 237,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Add a TODO to move back to `std::accumulate`?"
                },
                {
                    "file": "src/buffer.cpp",
                    "line": 237,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "accumulate is a different checksumming method the more I think about it. I think this is fine.\n\nFor instance, if you xor 0x20, 0x20, 0x20, 0x20 -> you get 0 vs. 0x20 + 0x20 + 0x20 + 0x20 = 0x80"
                },
                {
                    "file": "src/buffer.cpp",
                    "line": 237,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Ah, stackoverflow showed that we can specify what function you can use https://stackoverflow.com/questions/69898756/is-there-any-special-c-function-to-get-xor-of-all-element-of-array"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "include/buffer.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/buffer.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -3
                },
                {
                    "file": "test/buffer_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 12
        },
        {
            "number": 4,
            "revision": "f0e4adc963ff62d226d94ff5fb9591fe3eb1a676",
            "parents": [
                "35d4335eda4c41bc5c658c8f1d36190f0e7e625a"
            ],
            "ref": "refs/changes/76/54676/4",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1655449737,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "include/buffer.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/buffer.cpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -3
                },
                {
                    "file": "test/buffer_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 39,
            "sizeDeletions": 12
        }
    ]
}
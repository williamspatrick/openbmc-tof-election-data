{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "id": "Ifdb3e0c51fe66e55ebb1c3fca7097af49607bf35",
    "number": 52376,
    "subject": "side-switch: power off chassis in prep for update",
    "owner": {
        "name": "Andrew Geissler",
        "email": "andrew@geissonator.com",
        "username": "geissonator"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/52376",
    "commitMessage": "side-switch: power off chassis in prep for update\n\nWhen switching to a new level of firmware, ensure the host is off and\nthe chassis power is off before switching to the new firmware.\n\nTested:\n- Verify power off works\n<6> Checking for side switch reboot\n<6> Running firmware version path is /xyz/openbmc_project/software/74575136\n<6> Running firmware version priority is 1\n<6> Running image is at priority 1, execute side switch\n<see power off occur in journal>\n<6> chassis power is off\n\nSigned-off-by: Andrew Geissler <geissonator@yahoo.com>\nChange-Id: Ifdb3e0c51fe66e55ebb1c3fca7097af49607bf35\n",
    "createdOn": 1648216680,
    "lastUpdated": 1649710778,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1648216680,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1648216694,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1648216694,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1648216777,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/39736/ : SUCCESS"
        },
        {
            "timestamp": 1648757539,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1648757554,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1648757555,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1648757665,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/40262/ : SUCCESS"
        },
        {
            "timestamp": 1649185357,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1649208974,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1649277899,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1649277911,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1649277911,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1649278001,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/40656/ : SUCCESS"
        },
        {
            "timestamp": 1649348868,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1649348868,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1649348886,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1649348886,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1649348960,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/40731/ : SUCCESS"
        },
        {
            "timestamp": 1649429426,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1649699874,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1649699874,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1649699886,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1649699886,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1649699966,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/40905/ : SUCCESS"
        },
        {
            "timestamp": 1649708516,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1649708729,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1649709530,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 6: Patch Set 5 was rebased."
        },
        {
            "timestamp": 1649709547,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1649709547,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1649709628,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/40921/ : SUCCESS"
        },
        {
            "timestamp": 1649710679,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1649710778,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Change has been successfully rebased and submitted as cdac8f4769bfe2df7c0a3d01dbbdd1113aee2cb8"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "01f4048ca40797b578bf0f61067749d3f84af2c8",
            "parents": [
                "82232e5f4e07a4ddf5990bcceb2301fee5ae3e5b"
            ],
            "ref": "refs/changes/76/52376/1",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1648216680,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 66,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 99,
            "sizeDeletions": 5
        },
        {
            "number": 2,
            "revision": "4c72fbd743ad4e9a9c8e6f9ebe12c9b631c7a065",
            "parents": [
                "7befe665ed6bc8db4b315ba003f5bb926a2eb7e6"
            ],
            "ref": "refs/changes/76/52376/2",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1648757539,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "side-switch/side_switch.cpp",
                    "line": 164,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I assume it's been determined that 30s is a good number to wait for the chassis to power off, perhaps by other apps that implement the power off function? Perhaps add to the comment above something like \"// Now just.. . 30s has been shown to be long enough\" so we know it's based on observation."
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "line": 164,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah, I think our Everest takes the longest of all systems, and it's 10-15s in the good path. It does bring up a good point on the error paths though. A power off could hang up to 2 minutes if a power off service gets hung. So, I'm thinking maybe it's best to make this something huge. The user has requested a side switch, so we should basically wait as long as worst case. So 2 min service timeout then double that for safety, 4 minutes."
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "line": 166,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "Can we start a 30s timer and then listen for changes in the value of the `CurrentPowerState` property?\n\nI suspect that executing the Get method every second will put performance pressure on dbus?"
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "line": 166,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "It's the ole code complexity vs. efficiency discussion. A d-bus transaction every second is just noise (there are 100's per second most of the time). I'd prefer to just keep it simple as-is here."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 66,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 99,
            "sizeDeletions": 5
        },
        {
            "number": 3,
            "revision": "03ff47aa0e164e5e32038b3cf51dd9361aed979b",
            "parents": [
                "ffcac422435a3a756add527dacc9072722ca0e36"
            ],
            "ref": "refs/changes/76/52376/3",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1649277899,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 66,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 99,
            "sizeDeletions": 5
        },
        {
            "number": 4,
            "revision": "ebd241d9b377cf107bc4d5ab9d259b1ea23838a3",
            "parents": [
                "a3659bce331caa1d3f17dca1d841d689746eb083"
            ],
            "ref": "refs/changes/76/52376/4",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1649348868,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "side-switch/side_switch.cpp",
                    "line": 167,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Update to using the new utils::getProperty()? Or this is the place where you mentioned in the previous commit that you were having issues with it?"
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "line": 167,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "oops, yeah getProperty should work fine here. I should use setProperty too above."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 70,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 103,
            "sizeDeletions": 5
        },
        {
            "number": 5,
            "revision": "7e5af94550a6fc8cb601ab8b52c7de0e513617d8",
            "parents": [
                "a3659bce331caa1d3f17dca1d841d689746eb083"
            ],
            "ref": "refs/changes/76/52376/5",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1649699874,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Thanks for updating the commits to using utils::setProperty() too."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 93,
            "sizeDeletions": 5
        },
        {
            "number": 6,
            "revision": "9e5c102b30a0cbb858a1f0072641a0864149a64f",
            "parents": [
                "7af31c39454843a62a43bb363cc3afed636e811a"
            ],
            "ref": "refs/changes/76/52376/6",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1649709530,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 93,
            "sizeDeletions": 5
        },
        {
            "number": 7,
            "revision": "cdac8f4769bfe2df7c0a3d01dbbdd1113aee2cb8",
            "parents": [
                "03b3082cdbb4b197746597282037dc0d091a1a94"
            ],
            "ref": "refs/changes/76/52376/7",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1649710778,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "side-switch/side_switch.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "side-switch/side_switch.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 93,
            "sizeDeletions": 5
        }
    ]
}
{
    "project": "openbmc/smbios-mdr",
    "branch": "master",
    "id": "Ied5e0df545ec046cc1e0823d9f48317881493325",
    "number": 51500,
    "subject": "Add SMBIOS 3.0 compatibility to version check",
    "owner": {
        "name": "Brandon Kim",
        "email": "brandonkim@google.com",
        "username": "brandonkimbk"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/smbios-mdr/+/51500",
    "commitMessage": "Add SMBIOS 3.0 compatibility to version check\n\nAs per SMBIOS specification (DSP0134 Section 5.2.2) SMBIOS 3.0 requires\na different Entry Point Structure, including a different Anchor String\ncheck.\n\nTested:\nAfter appending the Entry Point Structure to the end of the SMBIOS\ntable, this code started working. We will most likely want to document\nthis somewhere as it's not industry standard to have the entry point\nstructure appended to the back like this.\n\nJan 01 00:01:03 smbiosmdrv2app[902]: SMBIOS 2.1 Anchor String not found. Looking for SMBIOS 3.0\nJan 01 00:03:05 smbiosmdrv2app[1680]: SMBIOS VERSION - 3.2\nJan 01 00:03:06 smbiosmdrv2app[1680]: VERSION INFO - BIOS - 99.99.99.99\n\nResolves: openbmc/smbios-mdr#3\nSigned-off-by: Brandon Kim <brandonkim@google.com>\nChange-Id: Ied5e0df545ec046cc1e0823d9f48317881493325\n",
    "createdOn": 1645678869,
    "lastUpdated": 1648489843,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1645678869,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1645678878,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645678878,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1645679238,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37942/ : SUCCESS"
        },
        {
            "timestamp": 1645807168,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1645807501,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1646345570,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1646345577,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1646351435,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1646359261,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 2: Commit message was updated."
        },
        {
            "timestamp": 1646359315,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nThis change is ready for review."
        },
        {
            "timestamp": 1646930295,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1646938079,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1646942365,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1646948423,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1647313140,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1647313154,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647313154,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1647313518,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38996/ : SUCCESS"
        },
        {
            "timestamp": 1647360470,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1647363322,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1647992696,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1648137522,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1648488057,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1648489843,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f5e67bf5e67051a49428429cd44fc8c64311abc4",
            "parents": [
                "473d890ea7fa48e1f3925f085e870dae67d68527"
            ],
            "ref": "refs/changes/00/51500/1",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1645678869,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Does this test fails with mean SMBIOS 3.0? Is the code change ready be reviewed?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Apologies, didn't see that you already posted a comment here.\n\nI wanted to get this change out for review ASAP to raise up the issue we started seeing, but this CL wasn't able to fix the issue. I can move it to WIP while I figure out why this is still failing."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Finally had time to go through the codeflow for why we are missing this.\n\nWe seem to only transfer the core content of the table (\"DMI\" file) as seen in our smbios_transfer code https://github.com/u-root/u-root/commit/a84f341bf5256abf15dd83a8a7edd2ea76f924cd#diff-1e893e106a003d1bd56b01536dcd6953036736f1fcca100d054d13aebb9d27edR79\n\nand we have a separate file that contains the entry point structure, which is not transferred.\n\nQuick question - What is the expected structure of the SMBIOS content on the BMC? Should it be the `MDRSMBIOSHeader` then the `Entry Point Structure` then the rest of the SMBIOS?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Tested with the Entry Point structure concatenated at the back of the SMBIOS table blob, and verified that this code works."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Where does the concat happen? Is this a test procedure change?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "The concat happened outside of this change - we had to change the payload that was transferred to the BMC.\n\nSince we use the ipmi-blob instead from u-root, we'd have to make the change in u-root as shown in the above link in the comments.\n\nWould it be possible to check for whether this is the case for Intel as well? If you use hexer / hexdump and look for the anchor string, it'd be pretty easy to pinpoint where your entry point struct is concatenated."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Yes, I just checked and we have the entry point struct in the end."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Thank you very much for confirming.\n\nI don't believe this is an industry standard, yet this daemon expects it. As such, we should probably document this requirement somewhere in the repo (perhaps in the README).\n\nI will look for an appropriate place and update."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Will cover this in a follow up commit."
                },
                {
                    "file": "src/mdrv2.cpp",
                    "line": 662,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "These lines are quite similar to lines above them. Please create a function to avoid code duplication."
                },
                {
                    "file": "src/mdrv2.cpp",
                    "line": 662,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Yup, I'll mark this as WIP for now. I was going to clean this up after verifying this logic works (since I didn't want to add to the complexity while debugging the issue)."
                },
                {
                    "file": "src/mdrv2.cpp",
                    "line": 662,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Will focus on fixing this now."
                },
                {
                    "file": "src/mdrv2.cpp",
                    "line": 662,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Refactored - some things like the anchorstrings and structs were a bit harder to factor out so I left those as is.\n\nTested on a QEMU again and it looks to be working."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/mdrv2.cpp",
                    "type": "MODIFIED",
                    "insertions": 68,
                    "deletions": -31
                },
                {
                    "file": "include/smbios_mdrv2.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 105,
            "sizeDeletions": 32
        },
        {
            "number": 2,
            "revision": "ee5047f2f3c7ad4eea1db8931d4e29920bb99121",
            "parents": [
                "473d890ea7fa48e1f3925f085e870dae67d68527"
            ],
            "ref": "refs/changes/00/51500/2",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1646359261,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/mdrv2.cpp",
                    "type": "MODIFIED",
                    "insertions": 68,
                    "deletions": -31
                },
                {
                    "file": "include/smbios_mdrv2.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 107,
            "sizeDeletions": 32
        },
        {
            "number": 3,
            "revision": "e4ea37716d0d282ef664d5a70979274fe40e7c8b",
            "parents": [
                "473d890ea7fa48e1f3925f085e870dae67d68527"
            ],
            "ref": "refs/changes/00/51500/3",
            "uploader": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "createdOn": 1647313140,
            "author": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "gentle ping"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Ping for review"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/mdrv2.cpp",
                    "type": "MODIFIED",
                    "insertions": 49,
                    "deletions": -21
                },
                {
                    "file": "include/smbios_mdrv2.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 88,
            "sizeDeletions": 22
        }
    ]
}
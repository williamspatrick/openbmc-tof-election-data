{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Icf5db5331072cbcbd0359e0b789b664e31423124",
    "number": 51686,
    "subject": "meta-ibm: set critical services for IBM systems",
    "owner": {
        "name": "Andrew Geissler",
        "email": "andrew@geissonator.com",
        "username": "geissonator"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/51686",
    "commitMessage": "meta-ibm: set critical services for IBM systems\n\nThis takes the default critical services list from meta-phosphor and\nappends on extra services IBM is interested in.\n\nIdeally, there would be an easy way to just append an extra file to the\ncommand line but this is going to need some more thought. For now, just\noverride the entire file.\n\nTested:\n- Booted witherspoon up in QEMU and verified new json file was loaded\n  and that stopping one of the new critical services resulted in a\n  dump, error log, and BMC Quiesced state.\n\nSigned-off-by: Andrew Geissler <geissonator@yahoo.com>\nChange-Id: Icf5db5331072cbcbd0359e0b789b664e31423124\n",
    "createdOn": 1646260543,
    "lastUpdated": 1646950967,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1646260543,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1646260583,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646260583,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1646260591,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/9605/"
        },
        {
            "timestamp": 1646261725,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/9605/ : SUCCESS"
        },
        {
            "timestamp": 1646263071,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1646263125,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1646272434,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "barton17pb@gmail.com",
                "username": "msbarth"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1646272680,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "barton17pb@gmail.com",
                "username": "msbarth"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1646319878,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1646323885,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "barton17pb@gmail.com",
                "username": "msbarth"
            },
            "message": "Patch Set 1:\n\n(4 comments)"
        },
        {
            "timestamp": 1646323926,
            "reviewer": {
                "name": "Jim Wright",
                "email": "jlwright@us.ibm.com",
                "username": "wrightjl1"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1646934274,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1646934274,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1646934321,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646934321,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1646934331,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/9712/"
        },
        {
            "timestamp": 1646935791,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/9712/ : SUCCESS"
        },
        {
            "timestamp": 1646936445,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1646937134,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1646937436,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "barton17pb@gmail.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1646938920,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1646942555,
            "reviewer": {
                "name": "Jim Wright",
                "email": "jlwright@us.ibm.com",
                "username": "wrightjl1"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1646950958,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1646950964,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Change has been successfully rebased and submitted as 80a13f8873d8ce85fd5598aff7fd538aebdf959f"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "9ba69f28fe97035cf68c9b76c15b2499fe8071d6",
            "parents": [
                "51a2d77187cde42898dec7118145b0d9330ff0f3"
            ],
            "ref": "refs/changes/86/51686/1",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1646260543,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 0,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "What about the services providing temperatures? Fan control is already configured to handle setting fans to full speed when any of its \"critical\" services crash, so would we get a dump from those services crashing or would they need to be added here? (I dont think we'd want to quiesce on those services crashing, which is probably why you dont have them here?)"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 0,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "After finding out that going to quiesce state does not change any service states on the BMC, should add the following to get the error log and dump:\n\norg.open_power.OCC.Control.service\nxyz.openbmc_project.nvmesensor.service\nxyz.openbmc_project.hwmontempsensor.service\nphosphor-virtual-sensor.service"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Done"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 5,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "If this crashes at runtime, should it really have enough impact to cause the system to go to quiesce?"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 5,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "After finding out that going to quiesce state does not change any service states on the BMC, leave this in so we get the log and dump."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 6,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "My opinion is that this is just a \"data store\" service, so if it crashes the error log and dump are valid, but going to quiesce should probably happen after one of these other services fail to write something to inventory."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 6,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "PEL callouts would be broken if this down.  my vote is to keep it in the list."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 6,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "After finding out that going to quiesce state does not change any service states on the BMC, leave this in so we get the log and dump."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "If either of these services go to a fail state, the fan watchdog is intended to trip fans into 100% PWM but I dont believe the system should go to quiesced. Logging an error and creating a dump is fine, but the system is intended to continue as-is with the fan watchdog tripped."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 30,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "barton17pb@gmail.com",
                        "username": "msbarth"
                    },
                    "message": "After finding out that going to quiesce state does not change any service states on the BMC, leave this in so we get the log and dump."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 33,
                    "reviewer": {
                        "name": "Jim Wright",
                        "email": "jlwright@us.ibm.com",
                        "username": "wrightjl1"
                    },
                    "message": "Please add \"phosphor-power-control.service\". It controls powering the system on and off, and performs power good monitoring."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 33,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Done"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 35,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "This service runs an executable that performs a D-Bus method call and then exits.  The service is run during power on to enable VRM sensor monitoring.\n\nThe service file has RemainAfterExit=yes.\n\nDuring power off, this service is stopped by phosphor-regulators-monitor-disable.service.  VRM sensor monitoring is disabled during power off.\n\nIs that OK?  Or will that cause problems?"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 35,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "This wont hurt anything but since it's run during boot (and not really a runtime monitoring service), lets take it off the list. Boot failures are discovered via the target monitoring function."
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 38,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I guess we'd need to add sensor-monitor.service since it handles EPOW shutdowns based on ambient"
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "line": 38,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager_%.bbappend",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "type": "ADDED",
                    "insertions": 40,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 71,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "e12e91f28290b7609afc719119ae47274b137899",
            "parents": [
                "329ea30817a6419038867bb74d8fd0d722e83ff3"
            ],
            "ref": "refs/changes/86/51686/2",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1646934274,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager_%.bbappend",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 76,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "80a13f8873d8ce85fd5598aff7fd538aebdf959f",
            "parents": [
                "76150e5815eacd121ace9b8fe0229418b3d36fed"
            ],
            "ref": "refs/changes/86/51686/3",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1646950964,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager_%.bbappend",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/state/phosphor-state-manager/phosphor-service-monitor-default.json",
                    "type": "ADDED",
                    "insertions": 45,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 76,
            "sizeDeletions": 0
        }
    ]
}
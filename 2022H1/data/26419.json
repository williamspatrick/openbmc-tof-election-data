{
    "project": "openbmc/intel-ipmi-oem",
    "branch": "master",
    "topic": "WIP",
    "id": "I4a560b26a253fb6ae5f32c06a9678ad4f796e3aa",
    "number": 26419,
    "subject": "storagecommands: use Item.Board Name property",
    "owner": {
        "name": "Patrick Venture",
        "email": "venture@google.com",
        "username": "pstrinkle"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/intel-ipmi-oem/+/26419",
    "commitMessage": "storagecommands: use Item.Board Name property\n\nUse the xyz.openbmc_project.Inventory.Item.Board interface's Name\nproperty when present to name the IPMI FRU object.\n\nThe Name property provide a way to have customize name for each device.\nIt can be useful to insert index for each device, instead of having\nthe same name for all of them.\n\nTested: Verified this patch now uses the Name property from the\ninterface.\n\nSigned-off-by: Patrick Venture <venture@google.com>\nChange-Id: I4a560b26a253fb6ae5f32c06a9678ad4f796e3aa\nSigned-off-by: Willy Tu <wltu@google.com>\n",
    "createdOn": 1571762265,
    "lastUpdated": 1644702017,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1571762265,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1571762300,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1571762310,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1:\n\nBuild Started https://openpower.xyz/job/openbmc-repository-ci/37878/"
        },
        {
            "timestamp": 1571762315,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Patch Set 1:\n\nI don't except this patch to land, I just wanted to share how we handled the FRU names - since we wanted the name to come from the name associated with the board - which let us add additional computed information to it."
        },
        {
            "timestamp": 1571762620,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://openpower.xyz/job/openbmc-repository-ci/37878/ : SUCCESS"
        },
        {
            "timestamp": 1571763119,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Uploaded patch set 2: New patch set was added with same tree, parent, and commit message as Patch Set 1."
        },
        {
            "timestamp": 1571763151,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2:\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1571763166,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2: -Verified\n\nBuild Started https://openpower.xyz/job/openbmc-repository-ci/37882/"
        },
        {
            "timestamp": 1571763468,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://openpower.xyz/job/openbmc-repository-ci/37882/ : SUCCESS"
        },
        {
            "timestamp": 1571764333,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1571764644,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Topic set to WIP"
        },
        {
            "timestamp": 1571768353,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Patch Set 2:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1571768353,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1571769479,
            "reviewer": {
                "name": "James Feist",
                "email": "james.feist@linux.intel.com",
                "username": "feistjj"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571770441,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571771422,
            "reviewer": {
                "name": "James Feist",
                "email": "james.feist@linux.intel.com",
                "username": "feistjj"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571771891,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571776396,
            "reviewer": {
                "name": "James Feist",
                "email": "james.feist@linux.intel.com",
                "username": "feistjj"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1571802517,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Abandoned\n\nThis was sent upstream for comment on it.  Is deliberately abandoned."
        },
        {
            "timestamp": 1612551541,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Restored"
        },
        {
            "timestamp": 1612551546,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1612551552,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Removed reviewer James Feist."
        },
        {
            "timestamp": 1612551561,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612551571,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Patch Set 3:\n\nPTAL"
        },
        {
            "timestamp": 1612551879,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11987/ : SUCCESS"
        },
        {
            "timestamp": 1612551983,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1612596180,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1612596203,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612596494,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12006/ : SUCCESS"
        },
        {
            "timestamp": 1612596594,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1612596613,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612596686,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1612596895,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12007/ : SUCCESS"
        },
        {
            "timestamp": 1612733075,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1614239214,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 6: Commit message was updated."
        },
        {
            "timestamp": 1614239223,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1614705378,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6:\n\n(3 comments)"
        },
        {
            "timestamp": 1615411782,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1644702017,
            "reviewer": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "message": "Abandoned"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "e63b452b56b4ab0a05c28a0835bfede59f59f96f",
            "parents": [
                "d0e47917e0435221994849407cb222fdaab2d798"
            ],
            "ref": "refs/changes/19/26419/1",
            "uploader": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "createdOn": 1571762265,
            "author": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/storagecommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 10
        },
        {
            "number": 2,
            "revision": "7db240611b51794491a9f1e17d05a1126b4e5c25",
            "parents": [
                "b60e97a6f67ea1e81eb8b8d41dad94c62d3376f4"
            ],
            "ref": "refs/changes/19/26419/2",
            "uploader": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "createdOn": 1571763119,
            "author": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "src/storagecommands.cpp",
                    "line": 599,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "this is already done in fru device... if you create an association in entity manager to the thing that passed the probe.. then this wouldn't be necessary"
                },
                {
                    "file": "src/storagecommands.cpp",
                    "line": 599,
                    "reviewer": {
                        "name": "Patrick Venture",
                        "email": "venture@google.com",
                        "username": "pstrinkle"
                    },
                    "message": "So in FruDevice -- there is no pointer to EntityManager -- this could be done with an Association -- yes, (I didn't know about the Association stuff because I did FRUs first).  However, in that case, you'd still want code to use the Board's Name instead of the Product's name -- for our use-case."
                },
                {
                    "file": "src/storagecommands.cpp",
                    "line": 599,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "Ah got it"
                },
                {
                    "file": "src/storagecommands.cpp",
                    "line": 599,
                    "reviewer": {
                        "name": "Patrick Venture",
                        "email": "venture@google.com",
                        "username": "pstrinkle"
                    },
                    "message": "There's a Google bug to add the Association record to the FruDevice when the probe finds it -- that'll speed-up the FRU lookup portion."
                },
                {
                    "file": "src/storagecommands.cpp",
                    "line": 599,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "I think you'd want EntityManager to host the association, and just have it be based on the foundDevice in EntityManager, then you can do a reverse lookup in the mapper. That way when we have more than just FruDevice probes, it still works"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/storagecommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 10
        },
        {
            "number": 3,
            "revision": "49dba49b8fcf0f3775c3184dd274ca0d326e0442",
            "parents": [
                "b910987a7d832e38e9342f0946aeb555a48f9cb0"
            ],
            "ref": "refs/changes/19/26419/3",
            "uploader": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "createdOn": 1612551546,
            "author": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/storagecommands.cpp",
                    "line": 657,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Would it be simpler if we just moved the std::string name declaration on line 681, up to line 624, put lines 685-690 here to fill in the name, then change the check on line 691 to \n\nif (name.empty())\n\nTracking the lifetime of the boardData pointer scares me, even though it looks correct in this case."
                },
                {
                    "file": "src/storagecommands.cpp",
                    "line": 657,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "yep, it would definitely be simpler and allow it to us to remove the declaration of `boardData`.\n\nI moved it outside of #ifdef USING_ENTITY_MANAGER_DECORATORS internally since it is also used outside of it. but use the `name` directly seems like it is cleaner and no need to worry about the pointer."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "src/storagecommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 32,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 10
        },
        {
            "number": 4,
            "revision": "60db73e7fcaa318872ff4d75e1a49d626e2f3a2e",
            "parents": [
                "b910987a7d832e38e9342f0946aeb555a48f9cb0"
            ],
            "ref": "refs/changes/19/26419/4",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1612596180,
            "author": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "src/storagecommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 15
        },
        {
            "number": 5,
            "revision": "76e29b623fa81be6e853b6236c7700ae483038a8",
            "parents": [
                "b910987a7d832e38e9342f0946aeb555a48f9cb0"
            ],
            "ref": "refs/changes/19/26419/5",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1612596594,
            "author": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Sorry for not catching this earlier, but not all Boards have Name parameters, so doesn't this significantly change how those things are represented in the SDR?\n\nIn theory, the existing code was supposed to be equivalent, as entity-manager names the objects the same as the name parameter, the fact that Name exists on the interface is arguably a bug.\n\nIt would help a lot if you could add your motivations for wanting this to the commit message, and we'll see if we can find something that's less invasive, or figure out a way to fall back to this in certain cases."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "It only uses the Name parameter when available, but without it it acts exactly the same as before.\n\nI think the main motivation it to allow us to have a way to have customize name for the devices. It can be useful to insert index for each device, instead of having the same name for all of them.\n\nI have updated the message."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> It only uses the Name parameter when available, but without it it acts exactly the same as before.\n> \n> I think the main motivation it to allow us to have a way to have customize name for the devices. It can be useful to insert index for each device, instead of having the same name for all of them.\n> \n\nBut.... you can customize the dbus paths, so what have you really gained with this patch?\n\n> I have updated the message."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "ok, sounds good. I'll check with the team to see if they can get what they want by customizing the dbus path. Maybe they don't need this patch after that."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "src/storagecommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 15
        },
        {
            "number": 6,
            "revision": "7b71ff364a7618b7da76d2e89b2a2f514df9d11d",
            "parents": [
                "b910987a7d832e38e9342f0946aeb555a48f9cb0"
            ],
            "ref": "refs/changes/19/26419/6",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1614239214,
            "author": {
                "name": "Patrick Venture",
                "email": "venture@google.com",
                "username": "pstrinkle"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "The board interface doesn't have a name property.\n\nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/xyz/openbmc_project/Inventory/Item/Board.interface.yaml"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "In this context, why can't we do that with dbus paths.  For some reason I thought that in entity-manager the last element of the dbus path was literally just the name, escaped for dbus.  Based on the fact that you write this patch, you're making me question that."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "src/storagecommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 51,
            "sizeDeletions": 15
        }
    ]
}
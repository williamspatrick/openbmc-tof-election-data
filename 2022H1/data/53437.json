{
    "project": "openbmc/obmc-ikvm",
    "branch": "master",
    "id": "I78ae45db2f50ef400d72dd92895e67c50d01753e",
    "number": 53437,
    "subject": "Fix shellcheck warnings",
    "owner": {
        "name": "Jae Hyun Yoo",
        "email": "quic_jaehyoo@quicinc.com",
        "username": "jaehyoo"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/obmc-ikvm/+/53437",
    "commitMessage": "Fix shellcheck warnings\n\nFix shellcheck warnings in create_usbhid.sh script.\n\nTested: HID gadget was connected/disconnected properly even with the\nfixed script.\n\nSigned-off-by: Jae Hyun Yoo <quic_jaehyoo@quicinc.com>\nChange-Id: I78ae45db2f50ef400d72dd92895e67c50d01753e\n",
    "createdOn": 1651501518,
    "lastUpdated": 1651614055,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1651501518,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1651501530,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651501530,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1651501572,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/42418/ : SUCCESS"
        },
        {
            "timestamp": 1651519333,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1651522024,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1651600531,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1651600571,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651600571,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1651600574,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1651600612,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/42477/ : SUCCESS"
        },
        {
            "timestamp": 1651611465,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1651612039,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1651612057,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651612057,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1651612095,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/42480/ : SUCCESS"
        },
        {
            "timestamp": 1651612217,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1651613124,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1651613576,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1651613587,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1651613587,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1651613592,
            "reviewer": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1651613625,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/42483/ : SUCCESS"
        },
        {
            "timestamp": 1651614055,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 4: Code-Review+1"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "52b204f6f97c8d707518eae3361b6118378f15c2",
            "parents": [
                "3fa0bfbab1352b7fa907ae8b0199bd16b6e5d425"
            ],
            "ref": "refs/changes/37/53437/1",
            "uploader": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "createdOn": 1651501518,
            "author": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Did this come from some old version of shellcheck, or with some particular non-default settings?  I ran v0.8.0 on this script and it produced a fairly different set of recommendations than what's in this patch."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "My shell check version is v0.7.0 and this change doesn't address all of warnings. It mainly focus on these two critical warnings that are marked in red color.\n\nIn create_usbhid.sh line 128:\n    if ! [[ `cat UDC` =~ \"${dev_name}:p\" ]]; then\n         ^-- SC2039: In POSIX sh, [[ ]] is undefined.\n            ^-------^ SC2006: Use $(...) notation instead of legacy backticked `...`.\n                         ^-------------^ SC2076: Don't quote right-hand side of =~, it'll match literally rather than as a regex.\n\nIn create_usbhid.sh line 144:\n    if [[ `cat UDC` =~ \"${dev_name}:p\" ]]; then\n       ^-- SC2039: In POSIX sh, [[ ]] is undefined.\n          ^-------^ SC2006: Use $(...) notation instead of legacy backticked `...`.\n                       ^-------------^ SC2076: Don't quote right-hand side of =~, it'll match literally rather than as a regex."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "Fixed all warnings."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "create_usbhid.sh",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 20,
            "sizeDeletions": 5
        },
        {
            "number": 2,
            "revision": "1fbb1156fa2c5cb9147e0c2cfe658c4056bda0cf",
            "parents": [
                "3fa0bfbab1352b7fa907ae8b0199bd16b6e5d425"
            ],
            "ref": "refs/changes/37/53437/2",
            "uploader": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "createdOn": 1651600531,
            "author": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "create_usbhid.sh",
                    "line": 10,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "`cd` will issue an error message of its own on failure; I don't think we need to duplicate it manually -- `cd \"${hid_conf_directory} || return` should be fine."
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 10,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "Done"
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 156,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Likewise with the redundant error-reporting here (just `cd \"${hid_conf_directory}\" || exit`)."
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 156,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "Done"
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 164,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "While we're at it with minor cleanups to this script, this should probably be more like:\n\n```\nelse\n    echo >&2 \"...\"\n    exit 1\nfi\n```\n\ni.e. send the error message to stderr rather than stdout, and report the failure so that whatever invoked it doesn't mistakenly think it succeeded."
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 164,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "Done"
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 167,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Considering the script doesn't do anything after this anyway (and it's written to be executed as its own process, not sourced from someone's interactive shell or something), I'd actually be in favor of just removing this `cd` entirely."
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 167,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "I'd keep the cd for a case if this script is called individually, not from a service. Also, I'll keep the '|| exit' to avoid shellcheck warning which is cheap and doesn't break the flow."
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 167,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "What do you mean by \"called individually\"?  If you mean just manually invoked from a shell, like:\n\n```\nroot@bmc:~# /usr/bin/create_usbhid.sh connect\n```\n\nthen the lack of the final `cd` still won't affect anything, since the script will only have changed its own working directory, which won't affect the parent shell process.\n\nThe only way I can see it having any effect at all is if someone goes out of their way to source it instead of executing it normally, like:\n\n```\nroot@bmc:~# source /usr/bin/create_usbhid.sh connect\n```\n\nbut I'm having a pretty hard time imaging any reason why anyone would want to do that, and it doesn't seem like something this script should aim to support.\n\nAs it is it just seems like an unnecessary point of potential failure -- if the final `cd` _does_ fail for whatever weird reason, the script will report an error and make its caller think it failed, even if it actually carried out its \"real\" intended work without any problems."
                },
                {
                    "file": "create_usbhid.sh",
                    "line": 167,
                    "reviewer": {
                        "name": "Jae Hyun Yoo",
                        "email": "quic_jaehyoo@quicinc.com",
                        "username": "jaehyoo"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "create_usbhid.sh",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 10
        },
        {
            "number": 3,
            "revision": "6f4c81969ee95e8959ab94d0bf3de81a0e865831",
            "parents": [
                "3fa0bfbab1352b7fa907ae8b0199bd16b6e5d425"
            ],
            "ref": "refs/changes/37/53437/3",
            "uploader": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "createdOn": 1651612039,
            "author": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "create_usbhid.sh",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -11
                }
            ],
            "sizeInsertions": 27,
            "sizeDeletions": 11
        },
        {
            "number": 4,
            "revision": "f51921a97c0cb5cb5d768d10bcce0dd5f61595ea",
            "parents": [
                "3fa0bfbab1352b7fa907ae8b0199bd16b6e5d425"
            ],
            "ref": "refs/changes/37/53437/4",
            "uploader": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "createdOn": 1651613576,
            "author": {
                "name": "Jae Hyun Yoo",
                "email": "quic_jaehyoo@quicinc.com",
                "username": "jaehyoo"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "create_usbhid.sh",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -14
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 14
        }
    ]
}
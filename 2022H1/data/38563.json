{
    "project": "openbmc/phosphor-dbus-interfaces",
    "branch": "master",
    "topic": "Move-phosphor-bmc-code-mgmt-errors",
    "id": "I01396292f3f810d6cc1a898b06bab7381dd3bfcf",
    "number": 38563,
    "subject": "Move phosphor-bmc-code-mgmt errors",
    "owner": {
        "name": "Gunnar Mills",
        "email": "gmills@us.ibm.com",
        "username": "gtmills"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/38563",
    "commitMessage": "Move phosphor-bmc-code-mgmt errors\n\nAs discussed in discord, these errors are going over D-Bus so move\nthem to PDI. Copied from phosphor-bmc-code-mgmt.\n\nTested: Built with phosphor-bmc-code-mgmt and meta-phosphor change\n        and saw these errors when uploading bad images.\nChange-Id: I01396292f3f810d6cc1a898b06bab7381dd3bfcf\nSigned-off-by: Gunnar Mills <gmills@us.ibm.com>\n",
    "createdOn": 1606258389,
    "lastUpdated": 1649798021,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1606258389,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1606258407,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1606258868,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Topic set to Move-phosphor-bmc-code-mgmt-errors"
        },
        {
            "timestamp": 1606258924,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/8496/ : SUCCESS"
        },
        {
            "timestamp": 1606259517,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\nAfter this is merged I anticipate the bump failing with something like: \n\nException: FileExistsError: [Errno 17] File exists:......\n\nThe bump will want to go in with: \nhttps://gerrit.openbmc-project.xyz/c/openbmc/meta-phosphor/+/38564"
        },
        {
            "timestamp": 1606854725,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1606874425,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1606930215,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1606934103,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1606940007,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1606944505,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1608230090,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1609273246,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1613925776,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1619799857,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\nStill working on this?"
        },
        {
            "timestamp": 1649798021,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Removed reviewer Ed Tanous."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ece61b4de37f494af589dc0cfe4f7cc07fc73970",
            "parents": [
                "b5904f347f0b0c327bcdee665ad520cd48d47bb0"
            ],
            "ref": "refs/changes/63/38563/1",
            "uploader": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "createdOn": 1606258389,
            "author": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 1,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I think we need some convention on these files to indicate that they are internal / implementation-specific errors.  This will help avoid discussions like that on line 7 and similarly avoid anyone accidentally starting to export these over a dbus response.  Maybe an \"Internal\" subdirectory?"
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 1,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "These are used by bmcweb as well but only for this specific code update path. \nAren't these already kind of in a subdirectory \"Software\"?\nAnyone really going to use these xyz::openbmc_project::Software::Image errors for a non-Software repo ?\n\nDon't we have internal / implementation-specific errors in similar paths. E.g. \nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/xyz/openbmc_project/BIOSConfig/Common.errors.yaml\nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/xyz/openbmc_project/User/Common.errors.yaml"
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 1,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I think we're both confused about a few points.\n\n> These are used by bmcweb as well but only for this specific code update path. \n\nHow is this possible?  These aren't documented in an interface and I suspect they do not ever get returned on a dbus interface based on some of the discussion we had recently.\n\nI looked at the bmcweb code and they're manually parsing log entries for various.  This is entirely bogus behavior that I don't even want to give a thought to here (in this commit).\n\n> Aren't these already kind of in a subdirectory \"Software\"?\n> Anyone really going to use these xyz::openbmc_project::Software::Image errors for a non-Software repo ?\n\nSubdirectory != internal.  Subdirectory means they are scoped.  Internal means they are only used within a particular implementation for logging its own internal errors and are not passed between processes (via dbus) in response to a dbus request.\n\n> Don't we have internal / implementation-specific errors in similar paths. E.g. \n\nNo, there is a big difference in the examples you gave.  The errors presented here are not implementation-specific because they are defined by the interface itself.  Certain method and/or property operations specifically return those errors under failure scenarios.  They are the error-return-type, if you will, of those method calls.  _Any_ implementation of those interfaces could (and should) return the same errors under similar situations.\n\nThe errors you're proposing here are never returned outside of the implementation and thus I'm calling them \"internal\".  These YAML files only exist for a relationship between phosphor-logging and your application and are not related to any dbus interface."
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 1,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "A couple drive by thoughts...\n\n1 - put all the \"internal\" yaml into the phosphor-logging repo\n2 - skip phosphor-logging+sdbusplus entirely and just call xyz.openbmc_project.Logging.Create directly from your application."
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 1,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "> I looked at the bmcweb code and they're manually parsing log entries for various.  This is entirely bogus behavior that I don't even want to give a thought to here (in this commit).\n\nWe should move bmcweb away from manually parsing log entries and to using these correctly then. \n\n>   Maybe an \"Internal\" subdirectory?\n\nI don't have a strong preference. internal/xyz/openbmc_project/Software/Image.errors.yaml or  xyz/openbmc_project/Software/Internal/Image.errors.yaml ? Or do you prefer either of Brad's suggestions?"
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 1,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "\u2018xyz/.../Internal/\u2018 seems fine.  I\u2019d also be fine with it only in the logging repo."
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 7,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Any reason we don't just use the Common one for this (https://github.com/openbmc/phosphor-dbus-interfaces/blob/master/xyz/openbmc_project/Common.errors.yaml)?"
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "line": 7,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "Because that doesn't have metadata \n\nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/xyz/openbmc_project/Common.metadata.yaml#L11\n\nlike this one does:\n\n- name: InternalFailure\n  level: ERR\n  meta:\n    - str: \"FAIL=%s\"\n      type: string"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.errors.yaml",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "gen/xyz/openbmc_project/Software/Image/meson.build",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "xyz/openbmc_project/Software/Image.metadata.yaml",
                    "type": "ADDED",
                    "insertions": 28,
                    "deletions": 0
                },
                {
                    "file": "gen/xyz/openbmc_project/Software/meson.build",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 88,
            "sizeDeletions": 0
        }
    ]
}
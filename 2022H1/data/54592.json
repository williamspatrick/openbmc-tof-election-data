{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I50601e7551b0de49c2891b81789e97550bead6e3",
    "number": 54592,
    "subject": "storage: simplify dbus call types",
    "owner": {
        "name": "Nan Zhou",
        "email": "nanzhoumails@gmail.com",
        "username": "FighterNan"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/54592",
    "commitMessage": "storage: simplify dbus call types\n\n|connectionNames| can use MapperServiceMap, which is defined in\ndbus_utility.hpp for GetSubTree response.\n\nThis commit also uses Structured binding declaration, which simplifies a\nlot of for loops.\n\nTested:\n1. code compiles. Strong type guarantees the correctness.\n2. no Redfish Validator failures on Storage resource\nSigned-off-by: Nan Zhou <nanzhoumails@gmail.com>\nChange-Id: I50601e7551b0de49c2891b81789e97550bead6e3\n",
    "createdOn": 1655270157,
    "lastUpdated": 1655910308,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1655270157,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1655270188,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655270188,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1655270701,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45063/ : SUCCESS"
        },
        {
            "timestamp": 1655273158,
            "reviewer": {
                "name": "Jiaqing Zhao",
                "email": "jiaqing.zhao@intel.com",
                "username": "jiaqingz-intel"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1655319943,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2: Patch Set 1 was rebased"
        },
        {
            "timestamp": 1655319970,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655319971,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1655320030,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/45092/ : FAILURE"
        },
        {
            "timestamp": 1655402456,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3: Patch Set 2 was rebased"
        },
        {
            "timestamp": 1655402467,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655402467,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1655402974,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45175/ : SUCCESS"
        },
        {
            "timestamp": 1655611132,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1655830150,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1655834193,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1655834427,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1655835388,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1655835427,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1655835438,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655835438,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1655835953,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45503/ : SUCCESS"
        },
        {
            "timestamp": 1655852038,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 5: Commit message was updated."
        },
        {
            "timestamp": 1655852096,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1655910290,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1655910297,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1655910304,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1655910308,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 8cb65f8ae1114accc03340f122e37dd369fa2440"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d20db6cfe3bd6e3ed5bd39c309cc83ed2b510723",
            "parents": [
                "d642595f3a5fd7ee1391b2718178c16d19c500fa"
            ],
            "ref": "refs/changes/92/54592/1",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1655270157,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -26
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 26
        },
        {
            "number": 2,
            "revision": "148d4431bcf4e9924c34a80d432ed526b1de0895",
            "parents": [
                "8c623a96b43d69a4cfe95f9eac81be084d0a59b6"
            ],
            "ref": "refs/changes/92/54592/2",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1655319943,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -26
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 26
        },
        {
            "number": 3,
            "revision": "299ea0b06e8494a7300f3183bb4a9c9d9c1d135a",
            "parents": [
                "14bd7d9a82aa5302d57ff5ca29e933148ddff330"
            ],
            "ref": "refs/changes/92/54592/3",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1655402456,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "There's no strong typing here.  async_method_call is a template that accepts any variety of inputs, and more than once changes like this have caused issues.  Please test as the developing guide asks for."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "I can run real test for sure. But why aren't there strong types?\n\nI understand the arguments in lambda function of async_method_call doesn't have strong types. But I didn't change that at all. If it works previously, it shall still work.\n\nGiven the arguments of lambda function don't change and this commit changes only types derives from these arguments, as long as code compiles, nothing changes, right?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "FYI, I added Validator test results.\n\nBut I still want to know if the string type makes sense here."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I guess that's a fair point, you didn't actually change the async_method_calls\n\n\nfor example, in your code, you changed to:\n\nfor (const auto& [path, connectionNames] : subtree)\n\nThere have been cases where, if & is left off the \"const auto&\" it makes a copy, but you're right, there are stronger guarantees than I thought there were."
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "line": 528,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Does this type need changed as well to\n\ndbus::utility::MapperServiceMap::value_type"
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "line": 528,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "line": 615,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "I was under the impression explicit types where preferred when the auto type is not obvious. \n\nIf that is not the case, or the guidance has changed, I will also change, and use auto."
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "line": 615,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Not for ranged based loops AFAIK."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -26
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 26
        },
        {
            "number": 4,
            "revision": "e0fd525acb279faf25e73185b2f84bd4e441064b",
            "parents": [
                "14bd7d9a82aa5302d57ff5ca29e933148ddff330"
            ],
            "ref": "refs/changes/92/54592/4",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1655835388,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -30
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 30
        },
        {
            "number": 5,
            "revision": "cc5b1f5c39ae345f7efa6c9901494b4388ed0df7",
            "parents": [
                "14bd7d9a82aa5302d57ff5ca29e933148ddff330"
            ],
            "ref": "refs/changes/92/54592/5",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1655852038,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -30
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 30
        },
        {
            "number": 6,
            "revision": "8cb65f8ae1114accc03340f122e37dd369fa2440",
            "parents": [
                "b53dcd9d8ed899dc387db272a24c05ed147e4d8f"
            ],
            "ref": "refs/changes/92/54592/6",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1655910308,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/storage.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -30
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 30
        }
    ]
}
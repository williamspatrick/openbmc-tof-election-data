{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "Ib3be587fc165670e231a2897d490416bd29530be",
    "number": 54893,
    "subject": "Use an enum to return message registry parsing status",
    "owner": {
        "name": "Jason Bills",
        "email": "jason.m.bills@linux.intel.com",
        "username": "jmbills"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/54893",
    "commitMessage": "Use an enum to return message registry parsing status\n\nWe need to handle an event differently if it's not found in the\nregistries vs. failing to parse, so a simple success/fail return status\nis no longer enough.\n\nThis adds an enum to return additional status information so we can\ncontinue parsing events if one is not found in a registry.\n\nTested:\nConfirmed that events not found in the registry are still correctly\nskipped.\n\nChange-Id: Ib3be587fc165670e231a2897d490416bd29530be\nSigned-off-by: Jason M. Bills <jason.m.bills@intel.com>\n",
    "createdOn": 1656102922,
    "lastUpdated": 1656374826,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1656102922,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1656102984,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1656102985,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1656103365,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/45841/ : FAILURE"
        },
        {
            "timestamp": 1656104419,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1656107318,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1656107622,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1656107823,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1656107859,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1656107859,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1656107867,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656108494,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45848/ : SUCCESS"
        },
        {
            "timestamp": 1656108904,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656109053,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1656109064,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656109353,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656109855,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656110888,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656111777,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1656363088,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1656363128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1656363128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1656363191,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1656363454,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/45964/ : FAILURE"
        },
        {
            "timestamp": 1656363692,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1656363734,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1656363763,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1656363763,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1656363763,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1656364285,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45970/ : SUCCESS"
        },
        {
            "timestamp": 1656365648,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1656365688,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1656367322,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1656374821,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1656374826,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as ac992cded5af9dfcfb211f82f1bd2544bd45ea3c"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "01590c0e95ed6b944b4d532158e29e648e8c255b",
            "parents": [
                "a2b53687069de4a3b1dc8697b4df29fb7fa08875"
            ],
            "ref": "refs/changes/93/54893/1",
            "uploader": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "createdOn": 1656102922,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Other than the one thing, LGTM."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1044,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "This name convention doesn't follow the style. For new codes, I prefer UpperCamelCase\n\nhttps://github.com/openbmc/docs/blob/master/cpp-style-and-conventions.md"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1044,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "That document specifies that enum members should be lowerCamelCase: https://github.com/openbmc/docs/blob/master/cpp-style-and-conventions.md#constants.\n\nIf that isn't correct, I can fix it here, but we should also update the style guide."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1044,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Oh, I miss-remember the guide. Yeah, it's correct here. Thanks."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1210,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "clang-tidy probably is angry because this else is unessesary."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1210,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 16
        },
        {
            "number": 2,
            "revision": "95e7672733624bc18e96eb33234037525d61e3a5",
            "parents": [
                "a2b53687069de4a3b1dc8697b4df29fb7fa08875"
            ],
            "ref": "refs/changes/93/54893/2",
            "uploader": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "createdOn": 1656107823,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "nit; otherwise LGTM"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "nit: this can be \n\n```\nif (LogParseError status = ...; status == xxx) {\n\n} else if (status != ) {\n\n}\n```\n\nSo we don't pollute the scope with a |status| declaration."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "I have been told in the past that that construct doesn't fit with our preferred style as it makes it less readable.  I'm okay with it and am happy to change to that, but I'd like to hear thoughts from others.  Thanks!"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I don't think what Nan suggested works in this case, because the status variable declaration is limited to the first scope, so the second one wouldn't have status in scope?  Maybe it works, but it's not a level of complexity I like to promote as a general rule;  Maybe, if the enum value is only being used in one conditional, and didn't push the declaration to 2 lines would it make sense and still be readable.  In the processor, this is all getting renamed to registers anyway, so I'd rather the code that looks like everything else and is obviously correct."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "> I don't think what Nan suggested works in this case, because the status variable declaration is limited to the first scope, so the second one wouldn't have status in scope?  Maybe it works, but it's not a level of complexity I like to promote as a general rule;\n\nIt works.\n\nhttps://godbolt.org/z/qPTnf361z\n\n\"The scope of the name introduced by condition, if it is a declaration, is the combined scope of both statements' bodies:\" \n\n>  Maybe, if the enum value is only being used in one conditional, and didn't push the declaration to 2 lines would it make sense and still be readable. \n\nGiven that both branches can access the variable, does it make sense now? Why is it not readable?\n\nI don't invent this style myself. Just reference it from what I learned somewhere else. \n\n\"Use the new if (init; cond) and switch (init; cond) syntax when you need a new variable for use within the if or switch statement that is not needed outside of it. This simplifies the ambient code. Moreover, since the variable\u2019s scope is now small, its name can be shorter, too.\"\n\nhttps://abseil.io/tips/165"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Gotcha, didn't realize it worked that way;  We haven't had c++17 for very long, and definitely predates bmcweb (bmcweb was originally written against c++11), so it's possible that there's better syntax we could be using but haven't.  Some of the difference in openbmc versus absl is that we only have 80 character widths, not 120, so almost every time we would use this, it pushes the conditional onto two lines, which is way worse to read.\n\nIn this case, it's already two lines, so maybe it's not as bad?\n\nMy opinion here isn't very strong.  If the submitter thinks it's a better pattern, I'll let him make the change, but it's not something I'm going to generally enforce."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "I made the change so we could see what it will look like.  I don't know if it provides much benefit, though.  It will also be interesting to see if clang-tidy hates on me again for that 'else'. \ud83d\ude0a"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1204,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Yep. clang-tidy doesn't like the else.  So, I will revert this change back to separate statements.  I'll put it back to this if we want to figure out how to make clang-tidy okay with it."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1284,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "same here"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1284,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 16
        },
        {
            "number": 3,
            "revision": "0213ac467017b77a48a23670c46433618f69b3f6",
            "parents": [
                "a2b53687069de4a3b1dc8697b4df29fb7fa08875"
            ],
            "ref": "refs/changes/93/54893/3",
            "uploader": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "createdOn": 1656363088,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 16
        },
        {
            "number": 4,
            "revision": "7ab8a2a21ffd2b984c72deb96c82c14d6c3331fc",
            "parents": [
                "a2b53687069de4a3b1dc8697b4df29fb7fa08875"
            ],
            "ref": "refs/changes/93/54893/4",
            "uploader": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "createdOn": 1656363734,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 1207,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "If you end up doing another revision of this patch, it might be good to log a debug message so we're explicit about dropping the message."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 16
        },
        {
            "number": 5,
            "revision": "ac992cded5af9dfcfb211f82f1bd2544bd45ea3c",
            "parents": [
                "84afc48b8e3e6c9232503756ab5d64a7bb0c12c9"
            ],
            "ref": "refs/changes/93/54893/5",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1656374826,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 16
        }
    ]
}
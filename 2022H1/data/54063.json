{
    "project": "openbmc/smbios-mdr",
    "branch": "master",
    "id": "I9e7b0ebb8c5ec7a8464346f3476490b765579428",
    "number": 54063,
    "subject": "sst: Rediscover profiles after host reboot",
    "owner": {
        "name": "Jonathan Doman",
        "email": "jonathan.doman@intel.com",
        "username": "jonathan-doman"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/smbios-mdr/+/54063",
    "commitMessage": "sst: Rediscover profiles after host reboot\n\nIn some cases, host processor reboot may change the static SST-PP\nprofile information. This commit adds ability to register callbacks to\nrun upon hostState changes, and reruns SST discovery whenever the host\nexits the power-off state.\n\nTested:\n- Ran tools/sst-compare-redfish-os.py tool on platform with SPR host\n  CPU, and observed no mismatches before and after a host reboot.\n- Confirmed Redfish OperatingConfig properties still populated when host\n  is off.\n\nSigned-off-by: Jonathan Doman <jonathan.doman@intel.com>\nChange-Id: I9e7b0ebb8c5ec7a8464346f3476490b765579428\n",
    "createdOn": 1653601430,
    "lastUpdated": 1655426181,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1653601430,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1653601453,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1653601453,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1653601472,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/43960/ : FAILURE"
        },
        {
            "timestamp": 1653601539,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1653601573,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1653601573,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1653602071,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/43961/ : SUCCESS"
        },
        {
            "timestamp": 1654238652,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1655193133,
            "reviewer": {
                "name": "Chen, Yugang",
                "email": "yugang.chen@linux.intel.com",
                "username": "ygangch"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1655421189,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2: Code-Review+2\n\n(3 comments)"
        },
        {
            "timestamp": 1655422844,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1655422856,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655422856,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1655422876,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/45218/ : FAILURE"
        },
        {
            "timestamp": 1655423347,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1655424631,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1655424646,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1655424646,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1655424704,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/45220/ : SUCCESS"
        },
        {
            "timestamp": 1655426115,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1655426181,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f02c7d767df942eedce2ac3b2bd83308d6072eb7",
            "parents": [
                "a30229e13b8f320bdd23442e39b3a43b94b5545b"
            ],
            "ref": "refs/changes/63/54063/1",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1653601430,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "src/cpuinfo_main.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/cpuinfo_utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "src/speed_select.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -21
                },
                {
                    "file": "src/cpuinfo_utils.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/speed_select.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 106,
            "sizeDeletions": 45
        },
        {
            "number": 2,
            "revision": "ccae6edf0ce958507ee0341c0c1cc4b16cb81773",
            "parents": [
                "a30229e13b8f320bdd23442e39b3a43b94b5545b"
            ],
            "ref": "refs/changes/63/54063/2",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1653601539,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Couple minor questions. But I am OK with the way it is now also."
                },
                {
                    "file": "src/speed_select.cpp",
                    "line": 399,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Should it only be cleared after new discovery finished successfully?\nI will leave it up to you to decide whether it is better to keep the old data around longer"
                },
                {
                    "file": "src/speed_select.cpp",
                    "line": 399,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "I think there's an argument for either way, but I think this is a little more conservative - if there's a chance the SST information changed, better to not show anything on D-Bus rather than show outdated information. So I'd prefer to keep it as is."
                },
                {
                    "file": "src/speed_select.cpp",
                    "line": 565,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "nit: this part is not necessary since this is only called when the two states diff.\nOn the other hand, it is safer to test for newState specifically here. It might be slightly better to do a positive logic. \nBut I am OK with the way it is."
                },
                {
                    "file": "src/speed_select.cpp",
                    "line": 565,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "I agree. Fixed and added comment on the HostStateHandler typedef."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "src/cpuinfo_main.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/cpuinfo_utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "src/speed_select.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -21
                },
                {
                    "file": "src/cpuinfo_utils.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/speed_select.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 106,
            "sizeDeletions": 45
        },
        {
            "number": 3,
            "revision": "f8ebc7247f3675441d38fe35bd26bcfe61b59400",
            "parents": [
                "a30229e13b8f320bdd23442e39b3a43b94b5545b"
            ],
            "ref": "refs/changes/63/54063/3",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1655422844,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "src/cpuinfo_main.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/cpuinfo_utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "src/speed_select.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -21
                },
                {
                    "file": "src/cpuinfo_utils.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/speed_select.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 110,
            "sizeDeletions": 45
        },
        {
            "number": 4,
            "revision": "49ea830e123b9e62b91eb7189ecc4e65eb7e0e3b",
            "parents": [
                "63089f7e7ee0d9dbcacc05b5c6d630a2e335a46f"
            ],
            "ref": "refs/changes/63/54063/4",
            "uploader": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "createdOn": 1655424631,
            "author": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "src/cpuinfo_main.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/cpuinfo_utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "src/speed_select.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -21
                },
                {
                    "file": "src/cpuinfo_utils.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/speed_select.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 110,
            "sizeDeletions": 45
        }
    ]
}
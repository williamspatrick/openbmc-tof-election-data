{
    "project": "openbmc/host-error-monitor",
    "branch": "master",
    "id": "I17f651277ce0960d52c837c97529f3c5c70d2199",
    "number": 51610,
    "subject": "Add CPLD CRC Error Monitor",
    "owner": {
        "name": "Jason Bills",
        "email": "jason.m.bills@linux.intel.com",
        "username": "jmbills"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/host-error-monitor/+/51610",
    "commitMessage": "Add CPLD CRC Error Monitor\n\nThis adds a new signal monitor for the CPLD CRC Error that\nrelies on CPU presence to determine if an error should be\nlogged.\n\nTested:\nUsed the GPIO mockup driver to manually trigger both CPLD CRC\nMonitors and confirm that the Redfish event is logged correctly.\nDetails on the GPIO mockup driver can be found here:\nhttps://www.kernel.org/doc/html/latest/admin-guide/gpio/gpio-mockup.html\n\nChange-Id: I17f651277ce0960d52c837c97529f3c5c70d2199\nSigned-off-by: Jason M. Bills <jason.m.bills@linux.intel.com>\n",
    "createdOn": 1646079514,
    "lastUpdated": 1646428337,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1646079514,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1646079525,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646079525,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1646079555,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38180/ : SUCCESS"
        },
        {
            "timestamp": 1646080625,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1646097611,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1646157082,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1646157100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646157100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1646157131,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38244/ : SUCCESS"
        },
        {
            "timestamp": 1646157156,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 2:\n\n(6 comments)"
        },
        {
            "timestamp": 1646160627,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1646161225,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1646161516,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1646199904,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1646428324,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1646428337,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f184cedfa3f205d45caeb712872b8e7c6a31367e",
            "parents": [
                "1c208480e6de77a5a41b0733c595e8d4a99e5311"
            ],
            "ref": "refs/changes/10/51610/1",
            "uploader": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "createdOn": 1646079514,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Is the GPIO mockup driver some platform specific tool to force or simulate certain signals from the CPLD, or some OpenBMC component I'm not familiar with?  (Or at least not recognizing by name.)  If the former, I think it might be good to expand the description slightly to clarify."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "It's a standard Linux driver available for testing GPIOs: https://www.kernel.org/doc/html/latest/admin-guide/gpio/gpio-mockup.html."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Oh neat -- not sure how that's escaped my notice until now, thanks for the pointer."
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "bool?"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Done"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 41,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Is CPLD CRC error a CPUError?"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 41,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Yes, the signal originates from the CPU."
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 41,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Ack"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Can this fail because the line was busy, i.e. used by other app?"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Yes.  If another app claims this GPIO in the future, we will need to adjust this."
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Where is the GPIO name specified?\ncpusensor uses cpuPresence gpio, probably the same one?\nhttps://github.com/openbmc/dbus-sensors/blob/master/include/CPUSensor.hpp#L72\nNot sure whether there could be race condition because it releases it after reading."
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "I think we are still single-threaded, so I don't think there is a race-condition in requesting GPIOs if they are released after reading."
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 64,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Ack"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 68,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "I gather we're assuming this signal will never change value at runtime?  (Which may be a totally fine assumption -- I guess it changing might imply a physical CPU hotplug, which is perhaps far enough outside of supported functionality to not bother with.)"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 68,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "That's correct.  Our BMC implementation does not support CPU hotplug."
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 87,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Most of these are I think fairly self-explanatory, but some are slightly less obvious unless you read through the rest of the code (e.g. I at first assumed cpuPresenceName might be some dbus identifier or something, but I see it's actually just another GPIO).  Maybe add a comment documenting the arguments?"
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "line": 87,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "type": "ADDED",
                    "insertions": 102,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 120,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "267b3490e29531bdc07d8593907f636fae7c6607",
            "parents": [
                "1c208480e6de77a5a41b0733c595e8d4a99e5311"
            ],
            "ref": "refs/changes/10/51610/2",
            "uploader": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "createdOn": 1646157082,
            "author": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "include/error_monitors/cpld_crc_monitor.hpp",
                    "type": "ADDED",
                    "insertions": 110,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 130,
            "sizeDeletions": 0
        }
    ]
}
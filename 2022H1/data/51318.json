{
    "project": "openbmc/openpower-occ-control",
    "branch": "master",
    "id": "Ice647b2e64dbd6b7eb3ba6d278e375bab5810314",
    "number": 51318,
    "subject": "Hold off OCC communication if targets not ready",
    "owner": {
        "name": "Chris Cain",
        "email": "cjcain@us.ibm.com",
        "username": "cjcain"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openpower-occ-control/+/51318",
    "commitMessage": "Hold off OCC communication if targets not ready\n\nWe need to prevent occ-control from trying to access OCC data while FSI\nscan is in progress which we have seen happen after reset/reload.\nThe code change will prevent creating the OCC objects until the host-on\ntask has completed.\n\nChange-Id: Ice647b2e64dbd6b7eb3ba6d278e375bab5810314\nSigned-off-by: Chris Cain <cjcain@us.ibm.com>\n",
    "createdOn": 1645111466,
    "lastUpdated": 1645632997,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1645111466,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1645111481,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645111481,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1645111868,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37502/ : SUCCESS"
        },
        {
            "timestamp": 1645112190,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1645130272,
            "reviewer": {
                "name": "Edward A. James",
                "email": "eajames@us.ibm.com",
                "username": "eddiejames"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1645130903,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1645139348,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1645139358,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645139358,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1645139813,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37587/ : SUCCESS"
        },
        {
            "timestamp": 1645202515,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1645460404,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1645539156,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1645539168,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645539168,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1645539278,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1645539290,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37783/ : SUCCESS"
        },
        {
            "timestamp": 1645539401,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1645540940,
            "reviewer": {
                "name": "Edward A. James",
                "email": "eajames@us.ibm.com",
                "username": "eddiejames"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1645547062,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Change has been successfully rebased and submitted as 1718fd8bcd18f93accb6ed87b36f4c768a93f61a"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "5483c0aaff953f3355887cbf9747d21b10b92120",
            "parents": [
                "0f516528d80a4b679c343081586f96b2f5e06279"
            ],
            "ref": "refs/changes/18/51318/1",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1645111466,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "This resolved the problem when I did a boot/warmBoot/ResetReload:\n\n-- Boot 7d285d6624b14e68a9f4789363d32aaa --\nFeb 17 14:26:36 ever27bmc systemd[1]: obmc-power-start@0.target: Found dependency on fsi-scan@0.service/start\nFeb 17 14:26:36 ever27bmc systemd[1]: obmc-power-start@0.target: Job fsi-scan@0.service/start deleted to break ordering cycle starting with obmc-power-start@0.target/start\nFeb 17 14:26:41 ever27bmc openpower-occ-control[650]: Manager::findAndCreateObjects(): Waiting for transition files (/run/openbmc/host@0-on) to complete...\nFeb 17 14:26:41 ever27bmc systemd[1]: Created slice Slice /system/fsi-scan.\nFeb 17 14:26:51 ever27bmc openpower-occ-control[650]: Manager::findAndCreateObjects(): Waiting for transition files (/run/openbmc/host@0-on) to complete...\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: OccPersistData: Mode: 0x0C, OEM Mode Data: 0 (0x0000)\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: OccPersistData: IPS enabled:true, enter:8%/240s, exit:12%/120s\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Status::occActive OCC0 changed to true\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Manager: OCCs will be polled every 5 seconds\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Manager::createObjects(): OCC0 is the master\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Status::occActive OCC1 changed to true\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Manager: OCCs will be polled every 5 seconds\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Status::readOccState: OCC0 state 0x03\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: PowerMode::sendModeChange: SET_MODE(12,0) command to OCC0 (9 bytes)\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Idle Power Saver Parameters: enabled:true, enter:8%/240s, exit:12%/120s\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: PowerMode::sendIpsData: SET_CFG_DATA[IPS] command to OCC0 (12 bytes)\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Status::occActive OCC2 changed to true\nFeb 17 14:27:11 ever27bmc openpower-occ-control[650]: Status::occActive OCC3 changed to true\nFeb 17 14:27:16 ever27bmc openpower-occ-control[650]: Status::readOccState: OCC1 state 0x03\nFeb 17 14:27:16 ever27bmc openpower-occ-control[650]: Status::readOccState: OCC2 state 0x03\nFeb 17 14:27:16 ever27bmc openpower-occ-control[650]: Status::readOccState: OCC3 state 0x03"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "LGTM, but would like to see Andrew approve as well that this is good enough."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 49,
            "sizeDeletions": 19
        },
        {
            "number": 2,
            "revision": "4d3d529c17bc9744a8a26f16210ea13b04602974",
            "parents": [
                "1be4337b390fbcb951ee3c5c15f1a5a54a2dd205"
            ],
            "ref": "refs/changes/18/51318/2",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1645139348,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Looks good to me other then that we can remove the MPIPL check."
                },
                {
                    "file": "occ_manager.cpp",
                    "line": 31,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I just realized this one wouldn't be necessary since it the app isn't getting restarted here since the BMC isn't being rebooted."
                },
                {
                    "file": "occ_manager.cpp",
                    "line": 31,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "correct, and we don't run a fsi-scan on mpreboots"
                },
                {
                    "file": "occ_manager.cpp",
                    "line": 31,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 49,
            "sizeDeletions": 19
        },
        {
            "number": 3,
            "revision": "365b62a0f6f9192feaca66c7b10c15811b68d0e1",
            "parents": [
                "0f516528d80a4b679c343081586f96b2f5e06279"
            ],
            "ref": "refs/changes/18/51318/3",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1645539156,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 19
        },
        {
            "number": 4,
            "revision": "1718fd8bcd18f93accb6ed87b36f4c768a93f61a",
            "parents": [
                "1be4337b390fbcb951ee3c5c15f1a5a54a2dd205"
            ],
            "ref": "refs/changes/18/51318/4",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1645547062,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 19
        }
    ]
}
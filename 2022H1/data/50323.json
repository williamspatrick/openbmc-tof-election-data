{
    "project": "openbmc/libmctp",
    "branch": "master",
    "id": "I82f04ae19ebeda33a71586cc2dad972b8b36bfc7",
    "number": 50323,
    "subject": "core: Modify TX API to take message tag & tag owner",
    "owner": {
        "name": "Sumanth Bhat",
        "email": "sumanth.bhat@linux.intel.com",
        "username": "sumbhat90"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/libmctp/+/50323",
    "commitMessage": "core: Modify TX API to take message tag & tag owner\n\nWhen an application layer protocol encapsulates its response\nin MCTP packets, it needs to respond with the same message\ntag in the request packet; and it needs to reset the tag\nowner bit. Thus, extend the current mctp_message_tx API\nwith message tag and tag owner bits.\n\nSigned-off-by: Sumanth Bhat <sumanth.bhat@linux.intel.com>\nChange-Id: I82f04ae19ebeda33a71586cc2dad972b8b36bfc7\n",
    "createdOn": 1641982480,
    "lastUpdated": 1643045340,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1641982480,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1641982488,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1641982489,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1641982525,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/35397/ : FAILURE"
        },
        {
            "timestamp": 1641983047,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1642031952,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1: Code-Review-1\n\n(4 comments)"
        },
        {
            "timestamp": 1642034824,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1642049805,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1642049828,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1642049828,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1642049864,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/35462/ : FAILURE"
        },
        {
            "timestamp": 1642049874,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 1:\n\n(4 comments)"
        },
        {
            "timestamp": 1642051647,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1642051661,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1642051661,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1642051699,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/35465/ : FAILURE"
        },
        {
            "timestamp": 1642086079,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1642086092,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1642086093,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1642086146,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/35492/ : SUCCESS"
        },
        {
            "timestamp": 1642124147,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1642960341,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1642960353,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1642960353,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1642960384,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1642960406,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/35955/ : SUCCESS"
        },
        {
            "timestamp": 1642979397,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1642994399,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1643045322,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1643045340,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Abandoned"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "6d032ab0a41a65bd776d849dfaf5865368d26880",
            "parents": [
                "00e212f5996e08133fb7445abbf5416e7fa94c52"
            ],
            "ref": "refs/changes/23/50323/1",
            "uploader": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "createdOn": 1641982480,
            "author": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "CI fails due to changes not applied in applications in utils. Need help in testing the change since I don't have a hardware where I can test mctp-astlpc-daemon.c / mctp-demux-daemon.c."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Thanks Sumanth. My main concern is with the error checking."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "I'm OK with this change, but it does raise the issue that there's no protection against conflicting tags across callers.\n\nThe original code has the same issue though, so that's not a particular issue with this change!\n\nI agree with Andrew's reviews, this should be OK to go after addressing those."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Yeah, I captured a TODO here. We would need something similar to tag_expiry here to track and clear a used tag."
                },
                {
                    "file": "core.c",
                    "line": 781,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I think we should do the tag sanity check here where we pack it into the message. That closes the gap of potential mangling between the public API and here."
                },
                {
                    "file": "core.c",
                    "line": 781,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Done"
                },
                {
                    "file": "core.c",
                    "line": 814,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "This is unnecessary? Bit of a nit-pick, but I think I'd rather\n\n if ((msg_tag & MCTP_HDR_TAG_MASK) != msg_tag)"
                },
                {
                    "file": "core.c",
                    "line": 814,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Done"
                },
                {
                    "file": "core.c",
                    "line": 816,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Shouldn't we return an error here? Sending a message with the wrong tag isn't going to do the right thing."
                },
                {
                    "file": "core.c",
                    "line": 816,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "tests/test_serial.c",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -5
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -9
                },
                {
                    "file": "tests/test_astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 26
        },
        {
            "number": 2,
            "revision": "f10c35c5eb7ec10e6ce26a98037f59980cd8c1f0",
            "parents": [
                "00e212f5996e08133fb7445abbf5416e7fa94c52"
            ],
            "ref": "refs/changes/23/50323/2",
            "uploader": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "createdOn": 1642049805,
            "author": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "tests/test_serial.c",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -5
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -9
                },
                {
                    "file": "tests/test_astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 26
        },
        {
            "number": 3,
            "revision": "30e9b88789795e612107249b979737f91098222c",
            "parents": [
                "08c2893bded7a06981589ccc6bdf9b1dac531fd3"
            ],
            "ref": "refs/changes/23/50323/3",
            "uploader": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "createdOn": 1642051647,
            "author": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "tests/test_serial.c",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -5
                },
                {
                    "file": "utils/mctp-pipe.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "utils/mctp-demux-daemon.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -9
                },
                {
                    "file": "tests/test_astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 68,
            "sizeDeletions": 28
        },
        {
            "number": 4,
            "revision": "47cf626c426ae80c0ff754f95426cc29dff15c13",
            "parents": [
                "1ecc7cb623a90cbea1d57894a7c844e6177477fb"
            ],
            "ref": "refs/changes/23/50323/4",
            "uploader": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "createdOn": 1642086079,
            "author": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Apologies on the delayed comment addressing, I was out on sick leave."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "No worries, hope you're feeling better \ud83d\ude0a\n\nThere was a small bit of discussion in Discord about merging these two patches together, are you happy to do that?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Yep, I can merge them together. I will \"submit with parent\", is that okay?"
                },
                {
                    "file": "libmctp.h",
                    "line": 104,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I'd like to see the following added for use with this parameter (bikeshed ahead):\n\n #define MCTP_MESSAGE_TO_SRC true\n #define MCTP_MESSAGE_TO_DST false\n\nAnd then we can call this like the following when issuing requests:\n\n mctp_message_tx(mctp, eid, tag, MCTP_MESSAGE_TO_SRC, msg, len);\n\nand when responding to requests:\n\n mctp_message_tx(mctp, eid, tag, MCTP_MESSAGE_TO_DST, msg, len);"
                },
                {
                    "file": "libmctp.h",
                    "line": 104,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Ack"
                },
                {
                    "file": "tests/test_astlpc.c",
                    "line": 261,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "With the comments in the header file these unadorned bools go away and we get something more semantically relevant."
                },
                {
                    "file": "tests/test_astlpc.c",
                    "line": 261,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "tests/test_serial.c",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -5
                },
                {
                    "file": "utils/mctp-pipe.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "utils/mctp-demux-daemon.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -9
                },
                {
                    "file": "tests/test_astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 68,
            "sizeDeletions": 28
        },
        {
            "number": 5,
            "revision": "f9b9f7d86c95ee7ce26e803c9becd8a67555f1dc",
            "parents": [
                "1ecc7cb623a90cbea1d57894a7c844e6177477fb"
            ],
            "ref": "refs/changes/23/50323/5",
            "uploader": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "createdOn": 1642960341,
            "author": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Squashed changes in https://gerrit.openbmc-project.xyz/c/openbmc/libmctp/+/50237/13. Abandoning this"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "tests/test_serial.c",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -5
                },
                {
                    "file": "utils/mctp-pipe.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "utils/mctp-demux-daemon.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -9
                },
                {
                    "file": "tests/test_astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -3
                },
                {
                    "file": "utils/mctp-astlpc-daemon.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 72,
            "sizeDeletions": 29
        }
    ]
}
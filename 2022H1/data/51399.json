{
    "project": "openbmc/phosphor-ipmi-blobs-binarystore",
    "branch": "master",
    "id": "I128216825609909c489cbd5471b324d88d3aa25b",
    "number": 51399,
    "subject": "binarystore: Add std::optional for optional config options",
    "owner": {
        "name": "Willy Tu",
        "email": "wltu@google.com",
        "username": "wltu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-ipmi-blobs-binarystore/+/51399",
    "commitMessage": "binarystore: Add std::optional for optional config options\n\nThe `maxSizeBytes` was using 0 size by default instead of skipping it.\nLetting `config.maxSizeBytes` be std::optional allow us to have more\ncontrol to see if the 0 value is expected or nullopt.\n\nChange-Id: I128216825609909c489cbd5471b324d88d3aa25b\nSigned-off-by: Willy Tu <wltu@google.com>\n",
    "createdOn": 1645351124,
    "lastUpdated": 1645746881,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1645351124,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1645351136,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645351136,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1645351343,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/37698/ : FAILURE"
        },
        {
            "timestamp": 1645351774,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1645351786,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645351786,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1645352095,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37701/ : SUCCESS"
        },
        {
            "timestamp": 1645352349,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 3: Patch Set 2 was rebased"
        },
        {
            "timestamp": 1645352361,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645352361,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1645352407,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 4: Patch Set 3 was rebased"
        },
        {
            "timestamp": 1645352416,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645352416,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1645352420,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/37704/ : ABORTED"
        },
        {
            "timestamp": 1645352722,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37705/ : SUCCESS"
        },
        {
            "timestamp": 1645578703,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1645581976,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1645581985,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645581986,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1645582050,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1645582244,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37825/ : SUCCESS"
        },
        {
            "timestamp": 1645584749,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1645665353,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1645690843,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1645690848,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1645723926,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1645746881,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c50adce71e8fe5260ad197a0eb66fa7c5b752a65",
            "parents": [
                "e814a0bd044eaefc978cc6b6e9434a3cdf3be255"
            ],
            "ref": "refs/changes/99/51399/1",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1645351124,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -4
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "src/blobtool.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/parse_config.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 14
        },
        {
            "number": 2,
            "revision": "8d249cbacd6be1d28d03000625e92e6cce3228c6",
            "parents": [
                "e814a0bd044eaefc978cc6b6e9434a3cdf3be255"
            ],
            "ref": "refs/changes/99/51399/2",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1645351774,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -4
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "src/blobtool.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/parse_config.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 14
        },
        {
            "number": 3,
            "revision": "2801e706b745978c70c2294a30cbfe26ab4d962d",
            "parents": [
                "c95bd5910b6b5f1a5000ba6a85c5b320f5627890"
            ],
            "ref": "refs/changes/99/51399/3",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1645352349,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -4
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "src/blobtool.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/parse_config.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 14
        },
        {
            "number": 4,
            "revision": "da1e3e429588d32de748416adbebf3dd7cc963b6",
            "parents": [
                "fdebaa30f75727f0c7c4026024a1a4185f615093"
            ],
            "ref": "refs/changes/99/51399/4",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1645352407,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "src/blobtool.cpp",
                    "line": 170,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "won't this be undefined behavior if offsetBytes isn't present?\n\nseems like 0 would be a reasonable default if it's not in the config file"
                },
                {
                    "file": "src/blobtool.cpp",
                    "line": 170,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "it will be 0 which is equal to the behavior we had before this change.\n\num.. seems like it is undefined behavior. I thought it will always be zero. I'll explicitly define it then.\n\nDone."
                },
                {
                    "file": "src/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "does createFromConfig know how to handle an std::optional?"
                },
                {
                    "file": "src/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "The maxSizeBytes is passed in as std::optional. Since it does not support size of zero. Actually, let me update the offset offset size to take in optional instead of handling it everywhere."
                },
                {
                    "file": "src/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "Got it.\n\nYeah, that would be good to match maxSizeBytes"
                },
                {
                    "file": "src/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "ACK"
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "line": 74,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "should be reversed so you're not invoking undefined behavior (short circuit on nullopt instead)"
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "line": 74,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -4
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "src/blobtool.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "include/parse_config.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 14
        },
        {
            "number": 5,
            "revision": "2b6683fe6b32867cb39a406640d76329d8108f6e",
            "parents": [
                "fdebaa30f75727f0c7c4026024a1a4185f615093"
            ],
            "ref": "refs/changes/99/51399/5",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1645581976,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "include/parse_config.hpp",
                    "line": 35,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "nit: Could reduce to `j.at(\"offsetBytes\").get_to(config.offsetBytes.emplace())`"
                },
                {
                    "file": "include/parse_config.hpp",
                    "line": 35,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Done.\n\nThanks.\n\nFixed in https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-ipmi-blobs-binarystore/+/51543"
                },
                {
                    "file": "src/main.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "nit: `config.maxSizeBytes.value_or(0)`"
                },
                {
                    "file": "src/main.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "test/parse_config_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -2
                },
                {
                    "file": "include/sys_file_impl.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -5
                },
                {
                    "file": "include/parse_config.hpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -6
                },
                {
                    "file": "src/sys_file_impl.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 16
        }
    ]
}
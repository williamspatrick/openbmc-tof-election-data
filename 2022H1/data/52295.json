{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I3dabf001fe5dae9c9827e902761fa879a6f0e478",
    "number": 52295,
    "subject": "ExternalStorer: API document",
    "owner": {
        "name": "Josh Lehan",
        "email": "krellan@google.com",
        "username": "Krellan"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/52295",
    "commitMessage": "ExternalStorer: API document\n\nThis is a companion document for the design document for\nExternalStorer. This describes the API, including usage examples, for\nuse by HTTP and filesystem.\n\nSigned-off-by: Josh Lehan <krellan@google.com>\nChange-Id: I3dabf001fe5dae9c9827e902761fa879a6f0e478\n",
    "createdOn": 1648077293,
    "lastUpdated": 1651527267,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1648077293,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1648077477,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1648171814,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1648174737,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1648174751,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1648224309,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1648598209,
            "reviewer": {
                "name": "Claire Weinan",
                "email": "cweinan@google.com",
                "username": "daylight22"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1648622543,
            "reviewer": {
                "name": "Claire Weinan",
                "email": "cweinan@google.com",
                "username": "daylight22"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1648781269,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1648781329,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1648781486,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1648837754,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1649098926,
            "reviewer": {
                "name": "Claire Weinan",
                "email": "cweinan@google.com",
                "username": "daylight22"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1649112371,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1649112507,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1649115188,
            "reviewer": {
                "name": "Claire Weinan",
                "email": "cweinan@google.com",
                "username": "daylight22"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1649297083,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 6."
        },
        {
            "timestamp": 1649297149,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1649702484,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1649795148,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Uploaded patch set 7."
        },
        {
            "timestamp": 1649795206,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1649795804,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1651198922,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3a2793f5bceed4ab53fd73f77a3eebc4ede9a440",
            "parents": [
                "fd0ec1f9212f127bf302dd4ceb8f4fa2e29a5f1d"
            ],
            "ref": "refs/changes/95/52295/1",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1648077293,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "This is the API for ExternalStorer. The ExternalStorer design document is here: https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/52150\n"
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 138,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: I guess we can add ```console\n\nhere, and below for the code snippets, to highlight % (should it be $ instead?)"
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 138,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Good catch, done. I used ```sh because ```console does not appear to be a valid choice."
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 465,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Perfect, this is a question I had in the other design doc, and I believe it's quite important. It may be good to surface this up higher, as this is a very useful / important feature of ExternalStorer (I feel)"
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 465,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Thanks. This is mentioned briefly in the design document already, but I added more text similar to this, to help call more attention to it."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 526,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 540,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "307c1a7ea3c9199d4b801a49a7d5f5636bc83e87",
            "parents": [
                "6b1efa878f1b24d0444bd3735a40db908db84cac"
            ],
            "ref": "refs/changes/95/52295/2",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1648174737,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Claire Weinan",
                        "email": "cweinan@google.com",
                        "username": "daylight22"
                    },
                    "message": "Thanks for providing clear usage examples!"
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 145,
                    "reviewer": {
                        "name": "Claire Weinan",
                        "email": "cweinan@google.com",
                        "username": "daylight22"
                    },
                    "message": "Is this string ignored? In line 232 I see the inner layer has \"Id\": \"Entries\" instead"
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 145,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Good catch! I was wondering if somebody would notice that. I noticed it myself, right after I sent out the document for review. Fixed it.\n\nA subtle point is that, in the inner layer, \"Id\" is not special. It's just an ordinary customizable field, like anything else one might wish to add. The \"Id\" field is only special in the outer layer (to identify the instance itself), and in any entries later added."
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 221,
                    "reviewer": {
                        "name": "Claire Weinan",
                        "email": "cweinan@google.com",
                        "username": "daylight22"
                    },
                    "message": "In this example isn't the `Id` (\"ExampleAlerts\") in line 211 provided by the external user (line 141), not automatically-generated?"
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 221,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "What I meant to say by \"automatically-generated\" is that they are automatically derived from the filename, as it is stored on disk. There is no need for these fields to appear in the file content itself, as they are automatically generated when the GET command is ran.\n\nI also reworded this accordingly."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 526,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 540,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "cb5f37e784c4acf8f8e5dfb0acd2a09dd3b1a25a",
            "parents": [
                "6b1efa878f1b24d0444bd3735a40db908db84cac"
            ],
            "ref": "refs/changes/95/52295/3",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1648781269,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Thanks for feedback. Revised some text accordingly. Also changing the filesystem root directory to /run/bmcweb/redfish/v1 as per review of the design document.\n"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 528,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 542,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "673d68bb4932fba25313ad04ed0c0d7848134b11",
            "parents": [
                "6b1efa878f1b24d0444bd3735a40db908db84cac"
            ],
            "ref": "refs/changes/95/52295/4",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1648781486,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/external-storer-api.md",
                    "line": 234,
                    "reviewer": {
                        "name": "Claire Weinan",
                        "email": "cweinan@google.com",
                        "username": "daylight22"
                    },
                    "message": "Actually on second glance I'm thinking we really should purposely ignore the user-provided \"Id\" from line 145 and keep this \"Id\" value as \"Entries\" after all (and state this in the doc). Here's my reasoning:\n\nAs I understand from the Redfish spec (v1.15.0), the last part of the \"@odata.id\" URI after the last forward slash (e.g. \"Entries\") is supposed to be the same as the \"Id\" value. Section \"9.13.5 Resource URI patterns annotation\" in the Redfish spec says \"The identifier term in the URI pattern shall match the Id string property for the corresponding resource\"\n\nRedfish Schema Supplement (v2021.4) section \"6.51.2 URIs\" shows the relevant LogEntry URI as \"/redfish/v1/Systems/{ComputerSystemId}/LogServices/{LogServiceId}/Entries/{LogEntryId}\", meaning the resource collection is at \"/redfish/v1/Systems/{ComputerSystemId}/LogServices/{LogServiceId}/Entries\". So it seems we don't have flexibility here with the ID value -- it should be \"Entries\".\n\nAlso in the Redfish spec section \"7.9 POST (create)\" it does say \"The service may ignore any service-controlled properties, such as Id , which would force the service to overwrite those properties.\""
                },
                {
                    "file": "designs/external-storer-api.md",
                    "line": 234,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Sounds reasonable to me. If client has no use for the \"Id\" field, I'm OK with it being a mirror of the last path component of the URL. This provides consistency at all layers of the URL."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 529,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 543,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "5ff75f992da09f693f9e72da13c638e5d818c257",
            "parents": [
                "6b1efa878f1b24d0444bd3735a40db908db84cac"
            ],
            "ref": "refs/changes/95/52295/5",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1649112371,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Updated for more consistent usage of the \"Id\" field at all layers. Also added correct location of \"Location\" in reply message.\n"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 544,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 558,
            "sizeDeletions": 0
        },
        {
            "number": 6,
            "revision": "bd19866b277f669ede7d873192f08d929f94020d",
            "parents": [
                "6b1efa878f1b24d0444bd3735a40db908db84cac"
            ],
            "ref": "refs/changes/95/52295/6",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1649297083,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Updated to use the \".json\" suffix for all regular files created by ExternalStorer, not just the special \"index.json\" file.\n"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 548,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 562,
            "sizeDeletions": 0
        },
        {
            "number": 7,
            "revision": "e369a524026e0386b5652672048d2087eb43fc20",
            "parents": [
                "9058180d875a320e4cd0ac6618fb941e48176757"
            ],
            "ref": "refs/changes/95/52295/7",
            "uploader": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "createdOn": 1649795148,
            "author": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Josh Lehan",
                        "email": "krellan@google.com",
                        "username": "Krellan"
                    },
                    "message": "Updated to always use index.json as the filename, similar to Redfish Mockup Server filesystem layout\n"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'm looking for a +1 from Ed on this.  Has he been involved in the review?  Seems like the underlying design is still open anyhow."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "designs/external-storer-api.md",
                    "type": "ADDED",
                    "insertions": 554,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 568,
            "sizeDeletions": 0
        }
    ]
}
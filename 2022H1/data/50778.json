{
    "project": "openbmc/phosphor-state-manager",
    "branch": "master",
    "id": "I064a9e7fecbed8f859828359a761877e0fa95251",
    "number": 50778,
    "subject": "ups: check state on startup and update power status",
    "owner": {
        "name": "Andrew Geissler",
        "email": "andrew@geissonator.com",
        "username": "geissonator"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/50778",
    "commitMessage": "ups: check state on startup and update power status\n\nLook for a UPS (uninterruptible power supply) D-Bus object on chassis\nstartup. If found, read its State and BatteryLevel properties to check\nthe condition of the power to the chassis. Update the CurrentPowerStatus\nproperty hosted by the chassis state manager based on this information.\n\nTested:\n- Utilized ibm-ups feature to start in debug mode so all properties\n  could be manually set. Validated good path and bad paths for all\n  properties and ensured CurrentPowerStatus was set as expected for each\n  test.\n\nSigned-off-by: Andrew Geissler <geissonator@yahoo.com>\nChange-Id: I064a9e7fecbed8f859828359a761877e0fa95251\n",
    "createdOn": 1643409574,
    "lastUpdated": 1645481659,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1643409574,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1643409584,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1643409584,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1643409595,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1643409761,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/36283/ : SUCCESS"
        },
        {
            "timestamp": 1644271236,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1644271247,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1644271248,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1644271467,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1644271516,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/36752/ : SUCCESS"
        },
        {
            "timestamp": 1644357344,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1644446090,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1644446090,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1644446108,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1644446109,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1644446241,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37014/ : SUCCESS"
        },
        {
            "timestamp": 1644507505,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1644875659,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1644875804,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1645128953,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1645128953,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1645128980,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645128980,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1645129124,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37564/ : SUCCESS"
        },
        {
            "timestamp": 1645221160,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1645481594,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1645481658,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Change has been successfully rebased and submitted as 8b1f8620b08a4de73bcac7fad40e47e296e86f5b"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "aee552ad6b8c9ef2d4d0e741ef8a6849113cf5c1",
            "parents": [
                "3782ac138074405572b505c91bf1921e3a4e3dbb"
            ],
            "ref": "refs/changes/78/50778/1",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1643409574,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 127,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 145,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "2080f4617061f8af17b1e0f1a46c43a0ba44fbfa",
            "parents": [
                "28e727aee20349e8b89be670bd2cf8b2686ae18e"
            ],
            "ref": "refs/changes/78/50778/2",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1644271236,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "chassis_state_manager.cpp",
                    "line": 210,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Using 'GetAll' would simplify this code.\n\nOr would it be better to not use that since most of the time there won't be a UPS..."
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "line": 210,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah, good point, if we found a device, just grab all of the properties. A more data then we need but a single d-bus transaction is better."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 142,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 166,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "ca1f7d4e50a869839d4100231766e51ac870ac8e",
            "parents": [
                "821c2b6617d7f12150709d389f7eedef9da1245b"
            ],
            "ref": "refs/changes/78/50778/3",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1644446090,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "chassis_state_manager.cpp",
                    "line": 196,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Should this msg be \"debug()\"? doesn't seem it'd be relevant to log it every time the bmc starts up.\nSame with the msgs below, do we need to log every time the battery is full for example?"
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "line": 196,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Maybe it's ok, I see on the next commit that this function will be called on properties changed, not every time the bmc boots up."
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "line": 196,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah, since 99% of our systems will not have a UPS, lets just make this a debug. If a system does have a UPS then I'd like to get the info messages below on startup and when the property changes."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 119,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 143,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "7f3adc45be798f88184b2ef5900d96c4aa2be347",
            "parents": [
                "2e05f831101e0acb4b83e2c00d54c3a350b19d4d"
            ],
            "ref": "refs/changes/78/50778/4",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1645128953,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 119,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 143,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "8b1f8620b08a4de73bcac7fad40e47e296e86f5b",
            "parents": [
                "b2b3d9c2a2a59ba119baf20b20ac985cc0b46fc3"
            ],
            "ref": "refs/changes/78/50778/5",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "createdOn": 1645481658,
            "author": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 119,
                    "deletions": 0
                },
                {
                    "file": "chassis_state_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 143,
            "sizeDeletions": 0
        }
    ]
}
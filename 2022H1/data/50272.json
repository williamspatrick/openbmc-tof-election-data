{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "topic": "bmc-dual-image",
    "id": "I07e9df4ad07ede36b13a8f447618b569ec446b86",
    "number": 50272,
    "subject": "dual-image: Always create os-release symlink",
    "owner": {
        "name": "Lei YU",
        "email": "yulei.sh@bytedance.com",
        "username": "mine260309"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/50272",
    "commitMessage": "dual-image: Always create os-release symlink\n\nCreate os-release symlink in processBMCImage() so that the functional\nimage is always available.\n\nWithout this change, processBMCImage() will find the alt image first, and\nskip checking the os-release file in the running image. This results in\nthe missing DBus object for the running image.\n\nTested: Verify the two objects are created for BMC running and alt\n        images.\n\nSigned-off-by: Lei YU <yulei.sh@bytedance.com>\nChange-Id: I07e9df4ad07ede36b13a8f447618b569ec446b86\n",
    "createdOn": 1641880083,
    "lastUpdated": 1647584918,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1641880083,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1641880100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1641880100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1641880195,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/35239/ : SUCCESS"
        },
        {
            "timestamp": 1644233587,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1644233601,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1644233601,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1644233682,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/36681/ : SUCCESS"
        },
        {
            "timestamp": 1644303181,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1644303207,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1644303207,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1644303290,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/36790/ : SUCCESS"
        },
        {
            "timestamp": 1645475982,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1645480278,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: -Code-Review\n\n(1 comment)"
        },
        {
            "timestamp": 1645603140,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1645603155,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645603155,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1645603241,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37854/ : SUCCESS"
        },
        {
            "timestamp": 1645653877,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1646044946,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1646044963,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646044963,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1646045045,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38129/ : SUCCESS"
        },
        {
            "timestamp": 1646047529,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1646086382,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1647243718,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 6: Patch Set 5 was rebased."
        },
        {
            "timestamp": 1647243739,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647243739,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1647243824,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38902/ : SUCCESS"
        },
        {
            "timestamp": 1647487373,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1647584918,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "cbf7e056317fcf6bf45be2d567ecba9b7ee97992",
            "parents": [
                "1258880854c68792806cc2c3c13c0c97411f95c1"
            ],
            "ref": "refs/changes/72/50272/1",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1641880083,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                },
                {
                    "file": "item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 99,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "5a571a6025c492d40b01eaf15ff035a8a02fe14e",
            "parents": [
                "1c0b22bbe96d6475560b9d51ee62baf756eb9f24"
            ],
            "ref": "refs/changes/72/50272/2",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1644233587,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                },
                {
                    "file": "item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 99,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "ba729a0b9514b0b71e636c381a2f03b93c84fc03",
            "parents": [
                "d7907f598786054e23aaec48721488947c8c3512"
            ],
            "ref": "refs/changes/72/50272/3",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1644303181,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "item_updater.cpp",
                    "line": 377,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "The running version should have a \"running\" salt so backup version id should be different, but it's good we don't make assumptions and specify the \"alt\" salt to ensure uniqueness."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 387,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I still need to look at the rest of the commit chain, just have a question about if we don't need/want to create an active association and Activation object for this backup version?"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 387,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I got to commit https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-bmc-code-mgmt/+/50274 that adds the Priority, and seems to me that we don't need this new function, but instead we can mount the alt image in directory name rofs-alt and have the processBMC() function automatically process this alt image. One additional thought is that not sure that processBMC() would know the id for this backup image to add the Priority value, but if we have processBMC() process the primary and alternate images then it knows the id to add the Priority value, in addition to saving from having a new function that is a bit duplicate."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 387,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                },
                {
                    "file": "item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 85,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "272e4bceac776818129607c5201ed32594d1cd31",
            "parents": [
                "fc96e85873dab4a217d3e6cdd0592e691bb40ec0"
            ],
            "ref": "refs/changes/72/50272/4",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1645603140,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "item_updater.cpp",
                    "line": 178,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Could you put this etc symlink inside a check that sees if there's already a \"*-functional\" mount directory and only do the symlink if it doesn't exist? The reason is that ubi/mmc use the mount directory name to communicate what's the 'flash id' so for example for mmc it needs to be rofs-a and rofs-b instead of rofs-<version>. I don't see an issue if add a new iterator over the media dir, then it iterates again below, since it's only 0-2 directories. I'm thinking something like this:\n\nfor (const auto& iter : fs::directory_iterator(MEDIA_DIR))\n{\n    if iter.path() contains \"-functional\"\n    {\n        functionalFound = true;\n    }\n}\nif (!functionalFound)\n{\n    // Create rofs-<versionid>-functional\n}"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 178,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Done"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "We can remove this text about \"calling again processBMCImage()\" to avoid confusion."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "With the updated code this is still needed."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -28
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 28
        },
        {
            "number": 5,
            "revision": "2c747bf250d68f5ba2c7db93b2c17f8163e2193b",
            "parents": [
                "fc96e85873dab4a217d3e6cdd0592e691bb40ec0"
            ],
            "ref": "refs/changes/72/50272/5",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1646044946,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 4
        },
        {
            "number": 6,
            "revision": "d474d9cde4b630172afb92b43b270e1f3e7bd5ea",
            "parents": [
                "6376964ec5b0d1411bf590cf4635a9a72fdb5cce"
            ],
            "ref": "refs/changes/72/50272/6",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1647243718,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 4
        }
    ]
}
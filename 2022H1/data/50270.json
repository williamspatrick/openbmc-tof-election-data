{
    "project": "openbmc/openbmc-tools",
    "branch": "master",
    "topic": "bbdbg",
    "id": "I82f5872742253351c7ac8d25b479ac8194e07afd",
    "number": 50270,
    "subject": "bbdbg: Debug a target environment generated by bitbake",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@aj.id.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc-tools/+/50270",
    "commitMessage": "bbdbg: Debug a target environment generated by bitbake\n\nbbdbg does the legwork to give you a gdb instance tailored for a target\nenvironment generated from a local bitbake build tree. This saves\nthe time otherwise spent by building and installing an SDK for the same.\n\nDocumentation:\n\n```\n3 15:52:42 andrew@mistburn:~/src/openbmc/openbmc-tools/bbdbg (bbdbg) $ ./bbdbg\n./bbdbg: 26: 1: parameter not set\nNAME\n        bbdbg - debug applications in a target environment built by bitbake\n\nSYNOPSIS\n        bbdbg PATH FILE CORE PACKAGES\n\nDESCRIPTION\n        PATH is the path to the root of a bitbake build directory\n        FILE is the absolute path to the binary of interest in the target environment\n        CORE is an optional core file generated by FILE. Pass '-' for no core file\n        PACKAGES will be used to populate a temporary rootfs for debugging FILE\n\nEXAMPLE\n        bbdbg ~/src/openbmc/openbmc/build/p10bmc \\\n                /usr/bin/nvmesensor - \\\n                dbus-sensors dbus-sensors-dbg\n```\n\nExample use:\n\n```\n3 15:50:40 andrew@mistburn:~/src/openbmc/openbmc-tools/bbdbg (bbdbg) $ ./bbdbg ~/src/openbmc/openbmc/build/p10bmc /usr/bin/nvmesensor obmcdump_3_1641877435/core.nvmesensor.0.db0e4de236a6448e9005e85a0dffb348.1554.1641877432000000 dbus-sensors dbus-sensors-dbg\n+ bbdbg_opkg update\n+ LD_LIBRARY_PATH=/home/andrew/src/openbmc/openbmc/build/p10bmc/tmp/sysroots-components/x86_64/libsolv-native/usr/lib /home/andrew/src/openbmc/openbmc/build/p10bmc/tmp/sysroots-components/x86_64/opkg-native/usr/bin/opkg -V0 -f /home/andrew/src/openbmc/openbmc/build/p10bmc/tmp/work/p10bmc-openbmc-linux-gnueabi/obmc-phosphor-image/1.0-r0/opkg.conf -o /tmp/bbdbg.375 update\n+ bbdbg_opkg install dbus-sensors dbus-sensors-dbg\n+ LD_LIBRARY_PATH=/home/andrew/src/openbmc/openbmc/build/p10bmc/tmp/sysroots-components/x86_64/libsolv-native/usr/lib /home/andrew/src/openbmc/openbmc/build/p10bmc/tmp/sysroots-components/x86_64/opkg-native/usr/bin/opkg -V0 -f /home/andrew/src/openbmc/openbmc/build/p10bmc/tmp/work/p10bmc-openbmc-linux-gnueabi/obmc-phosphor-image/1.0-r0/opkg.conf -o /tmp/bbdbg.375 install dbus-sensors dbus-sensors-dbg\n+ [ - = obmcdump_3_1641877435/core.nvmesensor.0.db0e4de236a6448e9005e85a0dffb348.1554.1641877432000000 ]\n+ echo obmcdump_3_1641877435/core.nvmesensor.0.db0e4de236a6448e9005e85a0dffb348.1554.1641877432000000\n+ gdb-multiarch -q -iex set solib-absolute-prefix /tmp/bbdbg.375 -iex add-auto-load-safe-path /tmp/bbdbg.375 /tmp/bbdbg.375/usr/bin/nvmesensor obmcdump_3_1641877435/core.nvmesensor.0.db0e4de236a6448e9005e85a0dffb348.1554.1641877432000000\nReading symbols from /tmp/bbdbg.375/usr/bin/nvmesensor...\nReading symbols from /tmp/bbdbg.375/usr/bin/.debug/nvmesensor...\n[New LWP 1554]\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\nCore was generated by `/usr/bin/nvmesensor'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n #0  0x76b88f50 in epoll_wait (epfd=<optimised out>, events=0x7edf1478, maxevents=128, timeout=-1) at ../sysdeps/unix/sysv/linux/epoll_wait.c:30\n30      ../sysdeps/unix/sysv/linux/epoll_wait.c: No such file or directory.\n(gdb) bt\n #0  0x76b88f50 in epoll_wait (epfd=<optimised out>, events=0x7edf1478, maxevents=128, timeout=-1) at ../sysdeps/unix/sysv/linux/epoll_wait.c:30\n #1  0x0044adf4 in boost::asio::detail::epoll_reactor::run (ops=..., usec=<optimised out>, this=<optimised out>) at /usr/include/boost/asio/detail/impl/epoll_reactor.ipp:501\n #2  boost::asio::detail::scheduler::do_run_one (ec=..., this_thread=..., lock=<synthetic pointer>..., this=0x17b1ea8) at /usr/include/boost/asio/detail/impl/scheduler.ipp:470\n #3  boost::asio::detail::scheduler::run (ec=..., this=0x17b1ea8) at /usr/include/boost/asio/detail/impl/scheduler.ipp:204\n #4  boost::asio::io_context::run (this=0x7edf1234, this=0x7edf1234) at /usr/include/boost/asio/impl/io_context.ipp:63\n #5  main () at ../../../../../../workspace/sources/dbus-sensors/src/NVMeSensorMain.cpp:274\n(gdb) quit\n+ set +x\n3 15:51:10 andrew@mistburn:~/src/openbmc/openbmc-tools/bbdbg (bbdbg) $\n```\n\nSigned-off-by: Andrew Jeffery <andrew@aj.id.au>\nChange-Id: I82f5872742253351c7ac8d25b479ac8194e07afd\n",
    "createdOn": 1641878972,
    "lastUpdated": 1641945588,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1641878972,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1641884731,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1641885330,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1641887142,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1641888284,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1641891631,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1641945568,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2: Verified+1 Code-Review+2"
        },
        {
            "timestamp": 1641945582,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1641945588,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c7daf58f15dc4a466367bea5270ec82ed0822427",
            "parents": [
                "9949cc7ca2192941a340a8dc7218a19b93f0bc55"
            ],
            "ref": "refs/changes/70/50270/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1641878972,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "bbdbg/bbdbg",
                    "line": 34,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "This should not be hard-coded, it could be passed by user."
                },
                {
                    "file": "bbdbg/bbdbg",
                    "line": 34,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Or maybe read the machine from BBDBG_PATH/conf/local.conf, and construct this directory from the MACHINE.\nThough I am not sure if this path is really $MACHINE-openbmc-linux-gnueabi"
                },
                {
                    "file": "bbdbg/bbdbg",
                    "line": 34,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Haha, whoops. I have a solution that I think is simpler:\n\n find tmp/work/*/obmc-phosphor-image/ -name opkg.conf -exec grep -lE ^src \\{\\} \\;"
                },
                {
                    "file": "bbdbg/bbdbg",
                    "line": 34,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 69,
                    "deletions": 0
                },
                {
                    "file": "bbdbg/bbdbg",
                    "type": "ADDED",
                    "insertions": 54,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 123,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "661cc8d0846273cf3b458764231ac10126f0d3a9",
            "parents": [
                "9949cc7ca2192941a340a8dc7218a19b93f0bc55"
            ],
            "ref": "refs/changes/70/50270/2",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1641887142,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Tested with g220a build and it works perfect!"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 69,
                    "deletions": 0
                },
                {
                    "file": "bbdbg/bbdbg",
                    "type": "ADDED",
                    "insertions": 54,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 123,
            "sizeDeletions": 0
        }
    ]
}
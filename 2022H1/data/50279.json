{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "topic": "bmc-dual-image",
    "id": "Ifa849e55c28f17b46d7f999ff43a7ad7e73f2ea1",
    "number": 50279,
    "subject": "dual-image: Implement BMC update when running on secondary",
    "owner": {
        "name": "Lei YU",
        "email": "yulei.sh@bytedance.com",
        "username": "mine260309"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/50279",
    "commitMessage": "dual-image: Implement BMC update when running on secondary\n\nImplement the BMC code update when it's running on the secondary image.\nIt will update the alt flash by obmc-flash-bmc-alt@.service and\nwait for the completion.\nAfter the update is done, it needs reboot to take effect.\n\nNote if the BMC is running on the secondary, it requires a following\ncommit to reset the CS to make the SoC to boot from the primary flash.\n\nThis commit only flashes the alt image when it's running on the\nsecondary image, there will be future commits to support other cases,\ne.g. flashing both images.\n\nTested: Verify the code update process is successful and it flashes the\n        whole primary chip when the BMC is running on the secondary\n        chip.\n\nSigned-off-by: Lei YU <yulei.sh@bytedance.com>\nChange-Id: Ifa849e55c28f17b46d7f999ff43a7ad7e73f2ea1\n",
    "createdOn": 1641880083,
    "lastUpdated": 1647584918,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1641880083,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1641880116,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1641880116,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1641880206,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/35246/ : SUCCESS"
        },
        {
            "timestamp": 1642123505,
            "reviewer": {
                "name": "zhanghaicheng",
                "email": "zhanghch05@inspur.com",
                "username": "zhanghch05"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1644233587,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1644233609,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1644233609,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1644233672,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/36685/ : SUCCESS"
        },
        {
            "timestamp": 1644303181,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1644303227,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1644303227,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1644303315,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/36799/ : SUCCESS"
        },
        {
            "timestamp": 1645603140,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1645603167,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1645603167,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1645603251,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/37859/ : SUCCESS"
        },
        {
            "timestamp": 1646044946,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased."
        },
        {
            "timestamp": 1646044975,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646044975,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1646045060,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38136/ : SUCCESS"
        },
        {
            "timestamp": 1646215326,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 6: Patch Set 5 was rebased."
        },
        {
            "timestamp": 1646215362,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1646215362,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1646215441,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38334/ : SUCCESS"
        },
        {
            "timestamp": 1647243718,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Uploaded patch set 7: Patch Set 6 was rebased."
        },
        {
            "timestamp": 1647243754,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647243754,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1647243837,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/38910/ : SUCCESS"
        },
        {
            "timestamp": 1647244536,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1647291835,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1647487414,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 7: Code-Review+2"
        },
        {
            "timestamp": 1647584918,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "2ef4d56aabb86a8e3d980617f4769439fe6f0f8c",
            "parents": [
                "09fed7de1397e633c852b504e1984414cbba71f1"
            ],
            "ref": "refs/changes/79/50279/1",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1641880083,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "static/flash.cpp",
                    "line": 40,
                    "reviewer": {
                        "name": "zhanghaicheng",
                        "email": "zhanghch05@inspur.com",
                        "username": "zhanghch05"
                    },
                    "message": "Should sync-manager be turned off before this?"
                },
                {
                    "file": "static/flash.cpp",
                    "line": 40,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "It's a good point, yup it should be turned off in case some file is to be synced during the flash.\nWe could add this in the `obmc-flash-bmc-alt@.service`, let it be done in the following commit."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        },
        {
            "number": 2,
            "revision": "98c570b5934d8c11e8e1a37804f0e760d20d06c8",
            "parents": [
                "3b923cefc9aea3547f76e8738456df13c7e6a479"
            ],
            "ref": "refs/changes/79/50279/2",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1644233587,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        },
        {
            "number": 3,
            "revision": "d498a1c3f23cd5f18849f0afe0b1d3c53893604a",
            "parents": [
                "fdc48559ee9c3ddecdd0fc00c39935ba480418c6"
            ],
            "ref": "refs/changes/79/50279/3",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1644303181,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        },
        {
            "number": 4,
            "revision": "e45fe2b860774750f210d8c1b6c6ddb3af6e7360",
            "parents": [
                "152daad5bc10b4e9123c4ddf7f127d7066c9c5f4"
            ],
            "ref": "refs/changes/79/50279/4",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1645603140,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        },
        {
            "number": 5,
            "revision": "a1e4d2a9448e5eb0b1ad54a34e74957ca3d8242a",
            "parents": [
                "a2bab06819dd697491a8bed121534ebb3da61c03"
            ],
            "ref": "refs/changes/79/50279/5",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1646044946,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        },
        {
            "number": 6,
            "revision": "24582c71485b7f5a99ab52abfdfb1fedd393865f",
            "parents": [
                "b6b0680c0c79133fd411d3a5f88e72d9d47a69fb"
            ],
            "ref": "refs/changes/79/50279/6",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1646215326,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        },
        {
            "number": 7,
            "revision": "d8c9eea3bd603a578b0db833cfdaefa8ce83250d",
            "parents": [
                "ba022464b151e3ab63c7a15916b049e182483d29"
            ],
            "ref": "refs/changes/79/50279/7",
            "uploader": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "createdOn": 1647243718,
            "author": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "activation.cpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -3
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "static/flash.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "static/obmc-flash-bmc-alt@.service.in",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 6
        }
    ]
}
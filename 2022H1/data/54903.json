{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "If15f95eee364b281af34650ad572bce719054815",
    "number": 54903,
    "subject": "Update example for clang-format-14",
    "owner": {
        "name": "Zane Shelley",
        "email": "zshelle@us.ibm.com",
        "username": "zane131"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/54903",
    "commitMessage": "Update example for clang-format-14\n\nThe CI tools now use clang-format-14. Updating example with all v14\nfields and their recommended values.\n\nSigned-off-by: Zane Shelley <zshelle@us.ibm.com>\nChange-Id: If15f95eee364b281af34650ad572bce719054815\n",
    "createdOn": 1656195493,
    "lastUpdated": 1657713978,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1656195493,
            "reviewer": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1656195748,
            "reviewer": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1656449614,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1657033617,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "andrew@geissonator.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1657035364,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1657036020,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(5 comments)"
        },
        {
            "timestamp": 1657053025,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1657059532,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1657576258,
            "reviewer": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "message": "Patch Set 2:\n\n(6 comments)"
        },
        {
            "timestamp": 1657659214,
            "reviewer": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1657713825,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1657713978,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "eaafd9eff82d83801a814437953236cd7aae1d28",
            "parents": [
                "6147515382bb95237725d0e40e02f51e47c7a8af"
            ],
            "ref": "refs/changes/03/54903/1",
            "uploader": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "createdOn": 1656195493,
            "author": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "style/cpp/.clang-format",
                    "type": "MODIFIED",
                    "insertions": 82,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 95,
            "sizeDeletions": 9
        },
        {
            "number": 2,
            "revision": "d577f14b229ceec7482fe4f8bdfd027931e08784",
            "parents": [
                "6147515382bb95237725d0e40e02f51e47c7a8af"
            ],
            "ref": "refs/changes/03/54903/2",
            "uploader": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "createdOn": 1656195748,
            "author": {
                "name": "Zane Shelley",
                "email": "zshelle@us.ibm.com",
                "username": "zane131"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "What is a recommended value?  Can you point to the documentation you pulled these recommended values from in your commit message?  clang-format maintains codes for multiple styles of formatting, so I'd be surprised if there were just one \"recommended\" value.\n\nIf any of these values are just setting or keeping the defaults, why is it necessary to have them in this file?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "My understanding was that this file contained the recommended style format for the OpenBMC community. Otherwise, why do we even have this file? I simply took my best guess to be consistent with the style previously presented in this file. I'll graciously make any changes based on constructive input.\n\nWhen I started this activity I ran:\n\n    clang-format -style=llvm -dump-config > .clang-format\n\nThis dumped out all available options with the llvm settings. Then I edited them to match the previous style. I believe this is what had been done before. I simply followed that pattern."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "There are a lot of changes proposed here.  We probably need to run this against a few bigger repositories and make sure the changes are pretty minor, or else we may need to tweak."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "andrew@geissonator.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah wow, that is quite a few changes. Not sure what next step is here? We want Zane to run this against some of our bigger/popular repos? That seems like quite an ask for someone who's just trying to help out here with a doc update. As this is just a doc update, and it's up to the maintainers to pull into their repos, I'm not sure the testing is really necessary."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> We want Zane to run this against some of our bigger/popular repos?\n\nThat'd be a good start.\n\n> That seems like quite an ask for someone who's just trying to help out here with a doc update.\n\nHow is this a docs update?  He's changing config files for compile time tooling.  If he had updated the coding standard with the things that this file conveys, I could see that argument being made, but as-written, it doesn't at all document why these changes are being made, or what effect they're going to have on our coding style.\n\nI'm also not quite understanding the pushback;  It's a 5 minute task to apply this clang-format to a repo and push the patch.  In lieu of writing a lengthy commit message documenting why this change is needed (which for any other sort of code-changing commit we'd generally require) pointing to a couple repos and showing \"These are the code formatting changes that get made\" seems reasonable to me.\n\nI applied this change to bmcweb, and it changed 13000 lines of code.\n\n\n> That seems like quite an ask for someone who's just trying to help out here with a doc update.\n\nI don't know if we formally documented that anywhere, and IMO, it's up to the person submitting the change to ideally make the case that every repo in the codebase needs to change."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/55106\n\nAre the changes it's making, and some things to note:\n\n1. This file makes us incompatible with clang-format-13, which is currently the standard in a lot of debian distros.  We should message that more heavily.\n\n2. The biggest change I see is in regards to the tabbing of lambdas, which, seems ok, but is going to cause mass merge conflicts on existing patches like it did a couple months ago when we changed the lambda formatting rules once.  The rollout of this should be discussed in the commit message."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> I applied this change to bmcweb, and it changed 13000 lines of code.\n\nThis implies to me this is not just \"assigning the default\".  If the desire is to assign the defaults, that should be one commit.  If the desire is to change the coding standards, each of those should be a separate commit with ideally a corresponding update to the coding standard document.  If the standard is ambiguous, I'd like to have those parts clearly differentiated so that we can discuss which direction we want to go.\n\n@Zane, can you elaborate more on what you were attempting to do here?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "The Jenkins docker CI updated to clang-format-14. With the current .clang-format files in openpower-hw-diags and openpower-libhei, our CI runs all failed. This forced us to update the .clang-format file. If you do a quick search, you will see that many other OpenBMC projects had to do the same. Since I went through the exercise I thought I would contribute to the community with my \"best guess\" at these options in the hopes that it might safe someone else a lot of time. I know it did long ago when I started my projects.\n\nI should also note that this is document is not definitive. It never has been. They are simply suggested guidelines. In fact, we changed two of the options in my projects to align what my team prefers. I am sure bmcweb can do the same to minimize changes."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "> this is document is not definitive. It never has been.\n\nI'm curious why you think the project coding style guidelines are not definitive.  I'm certain the intent was that they are definitive (otherwise why bother with maintaining them), so we should probably fix whatever phrasing led you to think this."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": ">  you will see that many other OpenBMC projects had to do the same\n\nI'm not certain but I don't think this was because of the move to clang-14.  Rather, I recently made a change: https://gerrit.openbmc.org/c/openbmc/docs/+/53744 and people were picking that up."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 1,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I see a bunch of options below where we're just imposing the defaults.  Is there value in that?  Especially for all the settings that are empty list, or \"None\" it seems like extra noise in the file."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 1,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "As stated in another comment, I am just following what had been done before."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Why did this change?\n\n\nI originally went through this file and wrote \"Why did this change\" on every parameter where its value was changed compared to the previous, but that was a little overkill.  I think the right approach would be getting the commit message updated with how you arrived at the decision that we needed some of these changes, and we can discuss.\n\nSo far as I can tell, this commit is changing 10s of parameters from their previous value, so I think some statement as to why would be warranted."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 9,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "According to the documentation (https://releases.llvm.org/14.0.0/tools/clang/docs/ClangFormatStyleOptions.html), the possible values are Consecutive, AcrossEmptyLines, AcrossComments, and AcrossEmptyLinesAndComments. I am guessing this option used to be a boolean, but was later changed to the AlignConsecutiveStyle type. A boolean value may still be accepted to retain backwards compatibility."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 107,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "We don't use Java on the project, so it's not clear why these options are helpful."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 107,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "I agree. They were just added for completeness and can be removed. We could probably also remove BreakAfterJavaFieldAnnotations, InsertTrailingCommas, and SortJavaStaticImport.\n\nAlso, I didn't realize until after I had filled in everything that there is a separate `style/javascript/.clang-format` file."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 109,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This change is one we were looking for the last time we reformatted the lambdas, and is probably overall a good change."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 109,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "Ack"
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 188,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "How was this list chosen?  Considering our coding standard is to not use macros as a general rule, it seems odd we would have this."
                },
                {
                    "file": "style/cpp/.clang-format",
                    "line": 188,
                    "reviewer": {
                        "name": "Zane Shelley",
                        "email": "zshelle@us.ibm.com",
                        "username": "zane131"
                    },
                    "message": "This is left over from the llvm config. This probably should be an empty list. I don't recall why I left it this way."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "style/cpp/.clang-format",
                    "type": "MODIFIED",
                    "insertions": 82,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 95,
            "sizeDeletions": 9
        }
    ]
}
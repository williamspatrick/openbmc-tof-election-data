{
    "project": "openbmc/openbmc-tools",
    "branch": "master",
    "id": "I6e56202c014a52d16773415edf59d4e6a7ecdf59",
    "number": 50179,
    "subject": "tof-voters: add commit analysis subcommand",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc-tools/+/50179",
    "commitMessage": "tof-voters: add commit analysis subcommand\n\nSigned-off-by: Patrick Williams <patrick@stwcx.xyz>\nChange-Id: I6e56202c014a52d16773415edf59d4e6a7ecdf59\n",
    "createdOn": 1641524932,
    "lastUpdated": 1642634392,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1641524932,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1641778324,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1641818831,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1641833021,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1641856541,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1641856687,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1641860808,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1642206343,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1642214611,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1642214646,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1642234490,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1642271924,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1642461218,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1642461471,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1642468389,
            "reviewer": {
                "name": "Zev Weiss",
                "email": "zev@bewilderbeest.net",
                "username": "zevweiss"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1642481541,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1642634318,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1642634381,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 4: Verified+1"
        },
        {
            "timestamp": 1642634392,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "7818b1083b1f6266a8a6761d3554f1c1f29c0270",
            "parents": [
                "94be194a2f418a0fdca78f34031e78b2b9a313f0"
            ],
            "ref": "refs/changes/79/50179/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1641524932,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tof-voters/libvoters/acceptable.py",
                    "line": 40,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "FWIW I think there is some value in some of the EM configurations.  The ones for re-usable off the shelf components anyway.  But perfect is the enemy of good for todday..."
                },
                {
                    "file": "tof-voters/libvoters/acceptable.py",
                    "line": 40,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't think there are any reusable components today... but if we can identify them we can filter it out here, certainly.  Right now they're all company-specific."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 30,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "Isn't there some convention about required \"options\" that this violates? ;-)"
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 30,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This could obviously be done as positional arguments but I feel like they are less self-documenting in that way.  (first parameter is \"before\" is far less usable than --before to me).\n\nAs is the argparse gives pretty good error information and is clear which ones are optional and which ones are required (optional has [] wrapper).\n```\n$ ./voters analyze-commits                                              \nusage: voters analyze-commits [-h] --before BEFORE --after AFTER\nvoters analyze-commits: error: the following arguments are required: --before/-b, --after/-a\n$ ./voters --help                \nusage: voters [-h] [--data-directory DATA_DIRECTORY] {analyze-commits,analyze-reviews,dump-gerrit,report} ...\n$ ./voters analyze-commits --help                                    \nusage: voters analyze-commits [-h] --before BEFORE --after AFTER\n```"
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 75,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Resisting the urge to rewrite this in functional style \ud83d\ude1c"
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 75,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "What do you mean by \"in a functional style\"?  I'm not an especially pythonic developer."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 75,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "taking the directory listing and processing it with map() and filter() calls to avoid the explicit statefulness of continue.\n\nI didn't expect you to do anything, was just voicing my instinct when reading the code."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 83,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "That's some hectic formatting"
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 83,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "It was whatever 'black' does automatically, but yes..."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 83,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "type": "ADDED",
                    "insertions": 104,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/entry_point.py",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "tof-voters/libvoters/time.py",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/acceptable.py",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 196,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "f6da5bc085b4b899bf10a679269786994b0456f0",
            "parents": [
                "c0600373b935b147cf3094ee5fa2f2844204000b"
            ],
            "ref": "refs/changes/79/50179/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1641856687,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 64,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "It looks like this is causing the script to skip some commits that have different messages indicating they've been applied.  For example, patch 46584 has \"Change has been successfully rebased and submitted\" instead of \"Change has been successfully merged\".  I'm assuming that's not intended, but it seems to have had a significant impact on at least some results (see https://github.com/openbmc/technical-oversight-forum/issues/10)."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 64,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "You are correct.  I have applied a fix and will regenerate the data.  \n\nGood news! You qualified."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 64,
                    "reviewer": {
                        "name": "Zev Weiss",
                        "email": "zev@bewilderbeest.net",
                        "username": "zevweiss"
                    },
                    "message": "Great, thanks -- though while we're looking at this, are there legitimate cases where we can end up with `data[\"status\"] == \"MERGED\" && merged_at == 0`?  If not, I wonder if we might change the `if` to just be `assert merged_at != 0` or similar, just in case there are any other alternate \"this has been applied\" message formats lurking anywhere..."
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "line": 64,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Good point.  I'll add an exception if merged_at is 0.  It turns out this did identify a small handful of commits but not enough to change the numbers any."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "type": "ADDED",
                    "insertions": 104,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/entry_point.py",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "tof-voters/libvoters/time.py",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/acceptable.py",
                    "type": "ADDED",
                    "insertions": 68,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 206,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "553a84561eb8ab66883f85c6421c92393fda67a5",
            "parents": [
                "df917f87d92560c8e04b4239d6acd46f3f3c682c"
            ],
            "ref": "refs/changes/79/50179/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1642214611,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "type": "ADDED",
                    "insertions": 104,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/entry_point.py",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "tof-voters/libvoters/time.py",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/acceptable.py",
                    "type": "ADDED",
                    "insertions": 68,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 206,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "215c1c3b201c1396ab1cdc30d46579184b4ce34b",
            "parents": [
                "df917f87d92560c8e04b4239d6acd46f3f3c682c"
            ],
            "ref": "refs/changes/79/50179/4",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1642461471,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/subcmd/analyze-commits.py",
                    "type": "ADDED",
                    "insertions": 104,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/entry_point.py",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "tof-voters/libvoters/time.py",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "tof-voters/libvoters/acceptable.py",
                    "type": "ADDED",
                    "insertions": 68,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 206,
            "sizeDeletions": 1
        }
    ]
}
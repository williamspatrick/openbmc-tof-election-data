{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Icd26fb3c7585461152c3b929a46dc16675d6c937",
    "number": 53189,
    "subject": "meta-bletchley: add usb-controller-update tool",
    "owner": {
        "name": "PL",
        "email": "potin.lai@quantatw.com",
        "username": "potinlai"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/53189",
    "commitMessage": "meta-bletchley: add usb-controller-update tool\n\nAdd usb-controller-update script for firmware updating.\n\nTested results:\n\nroot@bletchley:~# systemctl start flash-usb-controller@3.service\nroot@bletchley:~# systemctl status flash-usb-controller@3.service\n\u25cb flash-usb-controller@3.service - Flash usb controller image on SLED 3\n     Loaded: loaded (/lib/systemd/system/flash-usb-controller@.service; static)\n     Active: inactive (dead)\n\nApr 22 02:52:52 bletchley systemd[1]: Starting Flash usb controller image on SLED 3...\nApr 22 02:52:54 bletchley usb-controller-update[3915]: Bind mtd node success, path: /dev/mtd7\nApr 22 02:53:01 bletchley usb-controller-update[3937]: [293B blob data]\nApr 22 02:53:01 bletchley usb-controller-update[3915]: Erase flash block done\nApr 22 02:53:08 bletchley usb-controller-update[3940]: [438B blob data]\nApr 22 02:53:10 bletchley usb-controller-update[3940]: [293B blob data]\nApr 22 02:53:11 bletchley usb-controller-update[3940]: [293B blob data]\nApr 22 02:53:11 bletchley usb-controller-update[3915]: Write firmware image done\nApr 22 02:53:12 bletchley systemd[1]: flash-usb-controller@3.service: Deactivated successfully.\nApr 22 02:53:12 bletchley systemd[1]: Finished Flash usb controller image on SLED 3.\n\nSigned-off-by: Potin Lai <potin.lai@quantatw.com>\nChange-Id: Icd26fb3c7585461152c3b929a46dc16675d6c937\n",
    "createdOn": 1650554586,
    "lastUpdated": 1651165546,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1650554586,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1650554657,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1650554657,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1650554664,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/10442/"
        },
        {
            "timestamp": 1650555708,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1650557600,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/10442/ : FAILURE"
        },
        {
            "timestamp": 1650589571,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1650589645,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1650589645,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1650589652,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/10460/"
        },
        {
            "timestamp": 1650590809,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/10460/ : FAILURE"
        },
        {
            "timestamp": 1650591279,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1650596481,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1650596544,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1650596544,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1650596552,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/10461/"
        },
        {
            "timestamp": 1650597353,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/10461/ : SUCCESS"
        },
        {
            "timestamp": 1650598585,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1651137014,
            "reviewer": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "message": "Patch Set 3:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1651165531,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1651165538,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1651165541,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as ee63475740e68c6b5bf19f8f8ee80310422f3b9a"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "8fff19c553d0e55b95eb644379e5c32b484c92ff",
            "parents": [
                "325b4c772b3dbb98c711269035e5836e3699b52e"
            ],
            "ref": "refs/changes/89/53189/1",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1650554586,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "PL",
                        "email": "potin.lai@quantatw.com",
                        "username": "potinlai"
                    },
                    "message": "Hi @Patrick, could help review this patch?\n\nCurrent usb-controller-update script does not prevent multi process running, it might fall into unexpected behavior if user launch multiple update process at same time.\n\nI guess the service file can add some dependency to prevent that, but I am not familiar with it and still try to figure it out."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update_0.1.bb",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-phosphor/images/fb-bletchley-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/flash-usb-controller@.service",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/usb-controller-update",
                    "type": "ADDED",
                    "insertions": 110,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 170,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "f38baaca9ca854540f8cda0c354403cfad2211b8",
            "parents": [
                "325b4c772b3dbb98c711269035e5836e3699b52e"
            ],
            "ref": "refs/changes/89/53189/2",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1650589571,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update_0.1.bb",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-phosphor/images/fb-bletchley-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/flash-usb-controller@.service",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/usb-controller-update",
                    "type": "ADDED",
                    "insertions": 116,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 177,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "7218ef23798c94d608841217b9630e36dba7054d",
            "parents": [
                "440928041a6792b92b5d5d2a37aade93916bbb35"
            ],
            "ref": "refs/changes/89/53189/3",
            "uploader": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "createdOn": 1650596481,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This is ok for now, but we'll need to hook this into phosphor-bmc-code-mgmt by the end of PVT.  The HCL team is working on adding arbitrary device update to that."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update_0.1.bb",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-phosphor/images/fb-bletchley-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/flash-usb-controller@.service",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/usb-controller-update",
                    "type": "ADDED",
                    "insertions": 121,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 183,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "ee63475740e68c6b5bf19f8f8ee80310422f3b9a",
            "parents": [
                "f6faab8d7fc58739cdf3f106977e412941145aeb"
            ],
            "ref": "refs/changes/89/53189/4",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1651165541,
            "author": {
                "name": "PL",
                "email": "potin.lai@quantatw.com",
                "username": "potinlai"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update_0.1.bb",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-phosphor/images/fb-bletchley-phosphor-image.inc",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/flash-usb-controller@.service",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-bletchley/recipes-bletchley/fw-update/fw-update/usb-controller-update",
                    "type": "ADDED",
                    "insertions": 121,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 183,
            "sizeDeletions": 0
        }
    ]
}
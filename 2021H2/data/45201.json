{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I47de93a99440106becf5596fedb7769691fd5820",
    "number": 45201,
    "subject": "IBM ACF authentication",
    "owner": {
        "name": "Joseph Reynolds",
        "email": "joseph-reynolds@charter.net",
        "username": "joseph-reynolds"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/45201",
    "commitMessage": "IBM ACF authentication\n\nThis is a new design for IBM ACF authentication which would be used only\non IBM systems and only for selected user accounts.\n\nSigned-off-by: Joseph Reynolds <joseph-reynolds@charter.net>\nChange-Id: I47de93a99440106becf5596fedb7769691fd5820\n",
    "createdOn": 1627057407,
    "lastUpdated": 1630363959,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1627057407,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1627424067,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(4 comments)\n\nIt would be good to have someone else from IBM review this.  I'm only really reviewing it for following the pattern elsewhere in design documents."
        },
        {
            "timestamp": 1627505786,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1627506083,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1627510410,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1628034489,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1629413217,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nAdded details about restriction which may be present in the BMC's environment.  Added details about why pam_u2f is not preferred."
        },
        {
            "timestamp": 1629459915,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\n> Added details about restriction which may be present in the BMC's environment.  Added details about why pam_u2f is not preferred.\n\nGuessing you missed a push or ran out of time in the day. ;)  We will want these explanations added to the doc."
        },
        {
            "timestamp": 1629460224,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1629925819,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\nSomehow I left this comment as a draft for quite a while.  Sorry."
        },
        {
            "timestamp": 1629967789,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\n> Patch Set 2:\n> \n> (1 comment)\n> \n> Somehow I left this comment as a draft for quite a while.  Sorry."
        },
        {
            "timestamp": 1630194753,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1630363959,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "5393c8224683e341358196891cc73c265cde5b0c",
            "parents": [
                "564bcf282f4ebc0b4c321828c5114414720f4492"
            ],
            "ref": "refs/changes/01/45201/1",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "createdOn": 1627057407,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/ibm-acf-authentication.md",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Please move under 'designs/oem/ibm/'"
                },
                {
                    "file": "designs/ibm-acf-authentication.md",
                    "line": 3,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Typically we want email address and/or Discord on here too."
                },
                {
                    "file": "designs/ibm-acf-authentication.md",
                    "line": 5,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Wouldn't this also be you?"
                },
                {
                    "file": "designs/ibm-acf-authentication.md",
                    "line": 7,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This isn't really a contributor.  Just leave it blank if you don't have names."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/ibm-acf-authentication.md",
                    "type": "ADDED",
                    "insertions": 367,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 367,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "f08159f85ee8ed7d25f68c34f8d4ab1947738ab9",
            "parents": [
                "564bcf282f4ebc0b4c321828c5114414720f4492"
            ],
            "ref": "refs/changes/01/45201/2",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "createdOn": 1627505786,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 138,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Add: 4. The authentication function must operate in a highly restricted operational environment where no devices (such as USB storage) can be brought into the console area, and no connection to the internet can be assumed."
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 218,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "There appears to be some space vs tab damage."
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 218,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "The format looks okay (as intended) to me (modulo my art skills).\nFor example, line 208 shows three lines, from left to right, showing:\n- The public key goes into the firmware associated with to the BMC.\n- The ACF is loaded onto the BMC via the admin account.\n- The password goes to the service login.\n\nWhat happens if you view the diagram on another monospaced medium?"
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 218,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I agree when I downloaded it.  Not sure why gerrit is showing damage"
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 218,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 342,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Authentication based on [Universal 2nd Factor (U2F)](https://en.wikipedia.org/wiki/Universal_2nd_Factor), specifically pam_u2f, was considered.\n\nIn its original formulation, U2F requires a device to authenticate the second factor.  However, because IBM BMCs may operate in an environment where no devices are allowed, the BMC would have an internal server for pam_u2f to authenticate with.  The server would perform the ACF password authentication function.\n\nAlso, the regular U2F flow checks the password before checking the second factor.  That is, it is geared toward adding a 2nd factor to the normal password authentication path.  However, this design requires the password to be different for each scheduled maintenance window.  To make this work with pam_u2f, the ACF upload function would have to set the service user's password.\n\nFor these reasons, pam_u2f is not a good fit for this design, and the functions above were put into the pam_ibmacf module."
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 342,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> However, this design requires the password to be different for each scheduled maintenance window.  To make this work with pam_u2f, the ACF upload function would have to set the service user's password.\n\nThat's exactly what a U2F challenge/response is though; the equivalent of a unique password.  You could set the password on the service account to 'bob' for all it matters as long as the U2F challenge is required."
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 342,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "Patrick, How would you get around no electronics in or out of the data center, let alone attached to a USB port?"
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 342,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I'm not suggesting a U2F device in the machine; I'm suggesting using the algorithm for U2F challenge verification.\n\nThe inside-IBM service token creator machine would create a U2F compliant challenge-response based on the date+serial number (just like you want here) and we use the U2F protocol on the machine to accept the U2F token.  They're approximately 28 alpha-numeric characters long.\n\nWhen you insert a U2F machine into a USB port it basically just emulates a keyboard.  You touch the strip on it and it \"types\" a bunch of characters.  There is nothing in U2F that requires the device is physically present as a \"real\" emulated keyboard.  In fact, at both FB and Amazon, I regularly used U2F devices in my laptop to authenticate services inside of an SSH session."
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 342,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I looked into the protocols a few years ago when I got a tomu.\nhttps://www.crowdsupply.com/sutajio-kosagi/tomu\n\nRemember the operating environment above is no electronics in our out, and the certificate in via asynchronous file transport (eg mail gateway) inbound only. \n\nMy understanding of the fido protocol is that during registration the token device creates a pub/private pair and delivers the public key and an opaque blob to the server.  During authentication, the account is used to retrieve the blob, public key, and these along with a challenge is sent rom the network server to the token device, which uses its knowledge of the opaque and private keys to determine a response.  The network service then verifies the response with the public key and challenge to allow access.   Even if the acf blob replaced the server side I don't understand what would replace the key.  \n\nAlternativly TOTP devices encrypt a local clock with a private key and send to a server for public key to decode the time and agree with the window, usually in the order of a couple of seconds.  While the information is short its the limited time window that is the foundation of the security, while repair may loose the RTC and hence all idea of the current time.\n\nIf you can point to specific sections of the specs and a proposed flow you think would help advance a full u2f architecture while maintaing security I'll take a look, but normal flows send a challenge (or implicitly use time) and expect a response that can be proven fresh."
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "line": 342,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I spent some more time looking at the FIDO standards.  The communication to a U2F key over USB is HID but its far from keyboard protocol, instead a binary request / response with at least 2 additional layers of encoding.\n\nhttps://fidoalliance.org/specs/fido-v2.1-ps-20210615/fido-client-to-authenticator-protocol-v2.1-ps-20210615.html#usb"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/oem/ibm/acf-authentication.md",
                    "type": "ADDED",
                    "insertions": 367,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 367,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I651ac17ae5091e12aa78cecedf6a9f4a2c7421d8",
    "number": 47513,
    "subject": "virtual-media: add support for asynchronicity",
    "owner": {
        "name": "Przemyslaw Czarnowski",
        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
        "username": "phawryle"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/47513",
    "commitMessage": "virtual-media: add support for asynchronicity\n\nSometimes mounting and unmounting can be time consuming. Low performing\nplatforms mount remote resources in time exceeding 25 seconds of DBus\ntimeout. In order to address that, support for asynchronous DBus and\nRedfish calls has to be defined by design.\n\nThis is not an issue on faster platforms so it was not considered\nbefore.\n\nAlso Redfish schemas example has been extended with actions.\n\nChange-Id: I651ac17ae5091e12aa78cecedf6a9f4a2c7421d8\nSigned-off-by: Przemyslaw Czarnowski <przemyslaw.hawrylewicz.czarnowski@intel.com>\n",
    "createdOn": 1633506509,
    "lastUpdated": 1639595971,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1633506509,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1633509506,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1633530652,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1633619215,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1633619241,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1633621495,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Removed reviewer Ed Tanous."
        },
        {
            "timestamp": 1633622435,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1633696246,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1634193830,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 4: Patch Set 3 was rebased"
        },
        {
            "timestamp": 1636648401,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1636651707,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)\n\nThis whole design doc is for a feature that never had its backend upstreamed, so it's not clear what the intent of making modifications design doc is.  Do you plan to work to get the backend upstreamed?"
        },
        {
            "timestamp": 1636966348,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 4:\n\n> Patch Set 4:\n> \n> (1 comment)\n> \n> This whole design doc is for a feature that never had its backend upstreamed, so it's not clear what the intent of making modifications design doc is.  Do you plan to work to get the backend upstreamed?\n\nYes, asynchronous dbus is actualy the last thing that needs to be implemented to make the backend upstream ready. The plan (and my hope) is to start upstreaming process this year."
        },
        {
            "timestamp": 1636968653,
            "reviewer": {
                "name": "Krzysztof Richert",
                "email": "krzysztof.richert@intel.com",
                "username": "krichert-code"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1638810784,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 4: Code-Review+1\n\n> Patch Set 4:\n> \n> > Patch Set 4:\n> > \n> > (1 comment)\n> > \n> > This whole design doc is for a feature that never had its backend upstreamed, so it's not clear what the intent of making modifications design doc is.  Do you plan to work to get the backend upstreamed?\n> \n> Yes, asynchronous dbus is actualy the last thing that needs to be implemented to make the backend upstream ready. The plan (and my hope) is to start upstreaming process this year.\n\nWhen can we expect the service will be upstreamed?"
        },
        {
            "timestamp": 1638811512,
            "reviewer": {
                "name": "Andrei Kartashev",
                "email": "a.kartashev@yadro.com",
                "username": "alatarum"
            },
            "message": "Patch Set 4: -Code-Review\n\n(1 comment)"
        },
        {
            "timestamp": 1638912646,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1638982016,
            "reviewer": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "message": "Patch Set 4:\n\n> Patch Set 4: Code-Review+1\n> \n> > Patch Set 4:\n> > \n> > > Patch Set 4:\n> > > \n> > > (1 comment)\n> > > \n> > > This whole design doc is for a feature that never had its backend upstreamed, so it's not clear what the intent of making modifications design doc is.  Do you plan to work to get the backend upstreamed?\n> > \n> > Yes, asynchronous dbus is actualy the last thing that needs to be implemented to make the backend upstream ready. The plan (and my hope) is to start upstreaming process this year.\n> \n> When can we expect the service will be upstreamed?\n\nI've sent a request to create Virtual Media repository, so as soon as it will be created I will start to submit patches."
        },
        {
            "timestamp": 1639595969,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4: Verified+1 Code-Review+2"
        },
        {
            "timestamp": 1639595971,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 9de2f4eea01d7daa6ccff3c7615e6954a36900fc by Patrick Williams"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d0c5b24c296af15161ff24b9137d7c627f60e45c",
            "parents": [
                "a021c6c0ea017656b2849a56f7c18df1f270003e"
            ],
            "ref": "refs/changes/13/47513/1",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1633506509,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "designs/virtual-media.md",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 10
        },
        {
            "number": 2,
            "revision": "dd4e84f152a7a232f06cdbf4b8cde41d34ccc169",
            "parents": [
                "a021c6c0ea017656b2849a56f7c18df1f270003e"
            ],
            "ref": "refs/changes/13/47513/2",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1633509506,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Can you add some context to this title:\n\n\"virtual-media: add support for asynchronicity\""
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Przemyslaw Czarnowski",
                        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                        "username": "phawryle"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 413,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Do they need some kind of task identifier?  How does Redfish keep track of them to create its own Task object?"
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 413,
                    "reviewer": {
                        "name": "Przemyslaw Czarnowski",
                        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                        "username": "phawryle"
                    },
                    "message": "This part is related to DBus only, so there is no Task tracking for started jobs. Just a signal is raised on completion. There is no possibility to start the same action twice."
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 413,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> How does Redfish keep track of them to create its own Task object?\n\nCan you answer this part?  I didn't think the bmcweb codebase appreciated having to track signals without some sort of dbus object path tracking the work being done."
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 413,
                    "reviewer": {
                        "name": "Przemyslaw Czarnowski",
                        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                        "username": "phawryle"
                    },
                    "message": "Do we need any? Task is started on POST action, then we'll create shared object passed with signal callback destroyed on completion. With 1:1 relation I don't see anything more to track here."
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 413,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "@Ed?"
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 413,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Clients need some kind of ID to be able to track a task to completion.  Generally bmcweb just stores this as temporary state, which I think would be fine here."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "designs/virtual-media.md",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 10
        },
        {
            "number": 3,
            "revision": "f7c6ec9aaeea4ee0eda02cd7f495ccccf1c03cda",
            "parents": [
                "a021c6c0ea017656b2849a56f7c18df1f270003e"
            ],
            "ref": "refs/changes/13/47513/3",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1633619215,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "designs/virtual-media.md",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 10
        },
        {
            "number": 4,
            "revision": "1167c26335a97b71cfbda9e7c2350c2e79e41678",
            "parents": [
                "7e1776ee0fa3db5bcffcd3fb68c7b546f5d2beec"
            ],
            "ref": "refs/changes/13/47513/4",
            "uploader": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "createdOn": 1634193830,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "designs/virtual-media.md",
                    "line": 421,
                    "reviewer": {
                        "name": "Andrei Kartashev",
                        "email": "a.kartashev@yadro.com",
                        "username": "alatarum"
                    },
                    "message": "What about concurrent operations? What happens if I request mount on one drive, while other mount operation is in progress? If I request unmount of the media while it is in mounting yet?"
                },
                {
                    "file": "designs/virtual-media.md",
                    "line": 421,
                    "reviewer": {
                        "name": "Przemyslaw Czarnowski",
                        "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                        "username": "phawryle"
                    },
                    "message": "Concurrent operations does not make any sense, so they shall be rejected at level of dbus method call. \nMount/Unmount methods return bool, so false can be returned or exception may be thrown with appropriate error (this could be implementation dependent).\nMaybe it's worth mentioning that completion signal will be generated only when the request is successfully triggered."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "designs/virtual-media.md",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 10
        },
        {
            "number": 5,
            "revision": "9de2f4eea01d7daa6ccff3c7615e6954a36900fc",
            "parents": [
                "8ec6cb41fa3aac6e4f4c4b25efdbfbfc6f0dd27b"
            ],
            "ref": "refs/changes/13/47513/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1639595971,
            "author": {
                "name": "Przemyslaw Czarnowski",
                "email": "przemyslaw.hawrylewicz.czarnowski@intel.com",
                "username": "phawryle"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "designs/virtual-media.md",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 10
        }
    ]
}
{
    "project": "openbmc/phosphor-fan-presence",
    "branch": "master",
    "topic": "ibm2569_2",
    "id": "I8e696e747c432d7a6f696c5ccd9dab73abf7708f",
    "number": 46833,
    "subject": "Monitor: Support hwmon service offline during startup",
    "owner": {
        "name": "Mike Capps",
        "email": "mikepcapps@gmail.com",
        "username": "mikecgithub"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-fan-presence/+/46833",
    "commitMessage": "Monitor: Support hwmon service offline during startup\n\nIt is possible for fan-monitor to startup before the Hwmonitor service,\ncausing unhandled exceptions that block system initialization. This fix\ncatches the exception until a proper hwmon presence detector is\ndeployed.\n\nIf the exception is caught, this code change forces a re-subscription\nduring the poweron event to ensure tach sensors will receive published\nupdates upon resumption of the hwmon service.\n\nSigned-off-by: Mike Capps <mikepcapps@gmail.com>\nChange-Id: I8e696e747c432d7a6f696c5ccd9dab73abf7708f\n",
    "createdOn": 1631554870,
    "lastUpdated": 1631797679,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1631554870,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1631554883,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631554914,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1631554928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631554932,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/26223/ : ABORTED"
        },
        {
            "timestamp": 1631555013,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26224/ : SUCCESS"
        },
        {
            "timestamp": 1631555515,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1631629126,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1631629138,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631629230,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26293/ : SUCCESS"
        },
        {
            "timestamp": 1631637359,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1631637437,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1631639669,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1631639683,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631639691,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 4:\n\n(5 comments)"
        },
        {
            "timestamp": 1631639769,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26298/ : SUCCESS"
        },
        {
            "timestamp": 1631654396,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1631654420,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631654507,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26306/ : SUCCESS"
        },
        {
            "timestamp": 1631654582,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1631654846,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1631717604,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 6: Commit message was updated."
        },
        {
            "timestamp": 1631717653,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Topic ibm2569_wspoon_fix removed"
        },
        {
            "timestamp": 1631717661,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Topic set to ibm2569_2"
        },
        {
            "timestamp": 1631729022,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1631729515,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 6:\n\n(2 comments)"
        },
        {
            "timestamp": 1631730306,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Uploaded patch set 7."
        },
        {
            "timestamp": 1631730322,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631730404,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 7:\n\n(2 comments)"
        },
        {
            "timestamp": 1631730414,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26401/ : SUCCESS"
        },
        {
            "timestamp": 1631730942,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1631738394,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 7: Code-Review+2"
        },
        {
            "timestamp": 1631738397,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1631797679,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Change has been successfully rebased and submitted as 25f0327e3b509b5f445a9f9abb4945d1bbf3406d by Mike Capps"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0ed9b26808bd80325f08f15ea593f988f8de5355",
            "parents": [
                "e7df19bcec309bcca86e74468daa4a2c651ef712"
            ],
            "ref": "refs/changes/33/46833/1",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631554870,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -21
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 21
        },
        {
            "number": 2,
            "revision": "44a1ae4faeee51a10b3c44428116c3260f90da5d",
            "parents": [
                "12e888fb630499ab4211f5a93a5b36b20ad56ea1"
            ],
            "ref": "refs/changes/33/46833/2",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631554914,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -21
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 21
        },
        {
            "number": 3,
            "revision": "f6e8ab20d2dfb4e35cfa1cc0befdf385edd841e0",
            "parents": [
                "12e888fb630499ab4211f5a93a5b36b20ad56ea1"
            ],
            "ref": "refs/changes/33/46833/3",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631629126,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "No longer a \"Witherspoon\" temporary mitigation"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "This is a general fix now for when fan monitor may start prior to the service providing the fan sensors."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "Done"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 89,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "I dont think we want to be calling this twice right?"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 89,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "good catch, I was optimizing for the wrong thing and missed that =)"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "This is no longer a temporary mitigation for a particular system anymore really, its required to catch the `getSubTreeRaw` exception that is thrown when no fan sensor paths exist yet."
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "Done"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 340,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "I dont think we want to be calling this twice, right?\n\nMake this static pure, then I believe we could do it this way?"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 340,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 52,
                    "deletions": -31
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 31
        },
        {
            "number": 4,
            "revision": "1689021059c4c4b9068a0dacc21e492dfe329b97",
            "parents": [
                "12e888fb630499ab4211f5a93a5b36b20ad56ea1"
            ],
            "ref": "refs/changes/33/46833/4",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631639669,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": -31
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 31
        },
        {
            "number": 5,
            "revision": "515b4f307f9467f92ccb1fdc150eb37afe131684",
            "parents": [
                "12e888fb630499ab4211f5a93a5b36b20ad56ea1"
            ],
            "ref": "refs/changes/33/46833/5",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631654396,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "monitor/system.cpp",
                    "line": 40,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "I can move this to local scope"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 81,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "not sure if this is a good check or not, perhaps its best to clear our the map/subscriptions each time. anything that could cause service names to change would probably cause a failure."
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 262,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "tested with cout statements here to prove the handler fires for all N-sensors"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 48,
                    "deletions": -34
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 51,
            "sizeDeletions": 38
        },
        {
            "number": 6,
            "revision": "702ebc9e726cd27992f854e2f4c7ef23cade6917",
            "parents": [
                "12e888fb630499ab4211f5a93a5b36b20ad56ea1"
            ],
            "ref": "refs/changes/33/46833/6",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631717604,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "nit: commit msg wrapped\n\nWith my additional comment on this patch set (in regard to this change and sighups), an enhancement definitely needs to be designed to detect the hwmon service(s) are running."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "Done"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "I just realized that we need to clear and refresh the subscription to the sensor services here upon a sighup.\n\ni.e.)\n    _sensorMatch.clear();\n    subscribeSensorsToServices();"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Mike Capps",
                        "email": "mikepcapps@gmail.com",
                        "username": "mikecgithub"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 48,
                    "deletions": -34
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 51,
            "sizeDeletions": 38
        },
        {
            "number": 7,
            "revision": "a33268daf25647e25bde1efb13b233f1aee538c5",
            "parents": [
                "12e888fb630499ab4211f5a93a5b36b20ad56ea1"
            ],
            "ref": "refs/changes/33/46833/7",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631730306,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 52,
                    "deletions": -34
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 38
        },
        {
            "number": 8,
            "revision": "25f0327e3b509b5f445a9f9abb4945d1bbf3406d",
            "parents": [
                "65d07507e46ee30ff7135620362e695a39c7fef5"
            ],
            "ref": "refs/changes/33/46833/8",
            "uploader": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "createdOn": 1631797679,
            "author": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 52,
                    "deletions": -34
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 38
        }
    ]
}
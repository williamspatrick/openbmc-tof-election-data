{
    "project": "openbmc/phosphor-logging",
    "branch": "master",
    "id": "I42372cc1d79ece5914e7fdb51f3fa2a2d9cb07e7",
    "number": 48981,
    "subject": "PEL: Fix for error - unable to read PEL ID file",
    "owner": {
        "email": "sumit_kumar@in.ibm.com",
        "username": "sumitk56"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-logging/+/48981",
    "commitMessage": "PEL: Fix for error - unable to read PEL ID file\n\nThis is a case when PEL daemon can't read pelID file to get the next\npel Id to use. It could be that the file got corrupted during code\nupdate or factory reset leading to zeros data in file. The fix is to\ndelete the file as there is already code later to recreate file if\nnot available.\n\nSigned-off-by: Sumit Kumar <sumit_kumar@in.ibm.com>\nChange-Id: I42372cc1d79ece5914e7fdb51f3fa2a2d9cb07e7\n",
    "createdOn": 1637324725,
    "lastUpdated": 1638291818,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1637324725,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1637324739,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1637325453,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/30566/ : SUCCESS"
        },
        {
            "timestamp": 1637335664,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1637337152,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1637345121,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1638185647,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1638185660,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1638186379,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/30848/ : SUCCESS"
        },
        {
            "timestamp": 1638215193,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1638271783,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1638272008,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1638272022,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1638272749,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/30907/ : SUCCESS"
        },
        {
            "timestamp": 1638291756,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1638291818,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully rebased and submitted as f380c5167603aaa1b891682bec0e9448f5d3bad9 by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f87c8dfa2c3dced2a28811fe738d6f212167e3cb",
            "parents": [
                "16f5495bd796905cd60aeaddcdc1d12cfe3226db"
            ],
            "ref": "refs/changes/81/48981/1",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1637324725,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 67,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "For now I would prefer to just have this done once, on application startup.  So maybe a call from the Repository constructor.  \n\nThe danger in deleting this at any point is if we already have say a PEL with an ID of 0x500000001, and then at some point later it gets corrupted, the file would get deleted and we'd start back over at 500000001 again and overwrite the previous one.  Right now the case is handled because if the file isn't readable it starts generating random number PEL IDs.\n\nIn summary, make a function in this file, call it from the Repo constructor, and if the file is corrupt trace it and delete it."
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 67,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "This would be called only at startup/restart as idFilename is defined as static (ref line no. 63)."
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 67,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "yea, that could be.  this would be a good opportunity for a testcase in log_id_test.cpp."
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 118,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Since we use the << and >> operators to read and write to the file, that actually stores the values as ascii, for example 0x1A23 gets stored as:\n\nhexdump -C pelID\n00000000  36 36 39 31    |6691|\n00000004\n\n\nThe case we want to check for is binary zeros\n\nlike this:\n$ hexdump -C pelID\n00000000  00 00 00 00 00                                    |.....|\n00000005"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 22,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "17127a38f0d33f2da99f3a29a2c3e56254e1e73e",
            "parents": [
                "16f5495bd796905cd60aeaddcdc1d12cfe3226db"
            ],
            "ref": "refs/changes/81/48981/2",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1638185647,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 112,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "you can do a const std::string&  here."
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 112,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Ok"
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 119,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "this already takes a char*, so you shouldn't need to cast it?  same as on 129."
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 119,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Ok"
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 126,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "file"
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "line": 126,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Ok"
                },
                {
                    "file": "test/openpower-pels/log_id_test.cpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "nice!"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/log_id_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "598b8bb940ff2ecff3eafb315e17f9922d878cb8",
            "parents": [
                "16f5495bd796905cd60aeaddcdc1d12cfe3226db"
            ],
            "ref": "refs/changes/81/48981/3",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1638272008,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/log_id_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "f380c5167603aaa1b891682bec0e9448f5d3bad9",
            "parents": [
                "90c884031eddeddaa6d506c9abe2a66bc15c8086"
            ],
            "ref": "refs/changes/81/48981/4",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1638291818,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/log_id.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/log_id_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 0
        }
    ]
}
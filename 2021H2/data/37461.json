{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I0a2270cee2bf4313f1915636f324e2569c265dd3",
    "number": 37461,
    "subject": "docs: Add recommendation to refactor static config",
    "owner": {
        "name": "John Broadbent",
        "email": "jebr@google.com",
        "username": "jebr224"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/37461",
    "commitMessage": "docs: Add recommendation to refactor static config\n\nThis document proposes refactoring the code that transforms the .yamls\ninto .c, into its own repository.\n\nChange-Id: I0a2270cee2bf4313f1915636f324e2569c265dd3\nSigned-off-by: John Edward Broadbent <jebr@google.com>\n",
    "createdOn": 1602800530,
    "lastUpdated": 1629897517,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1602800530,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1602866124,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 1:\n\nHello Benjamin, let me know what you think of the plan to refactor the python and mako code that builds the c library."
        },
        {
            "timestamp": 1603217328,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(6 comments)"
        },
        {
            "timestamp": 1603316363,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1603316923,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 2:\n\n> Patch Set 1:\n> \n> (6 comments)\nThanks for the review, let me know if you find anything else."
        },
        {
            "timestamp": 1603317674,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1603387070,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1603387189,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1603387535,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 3:\n\n(8 comments)\n\nThanks for the feedback. Let me know if you see anything else.\nI might Email the open bmc list, to make sure the broader community thinks about this."
        },
        {
            "timestamp": 1604610816,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1604958100,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1605045676,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1606167605,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1607030572,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1608053444,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 3:\n\n(1 comment)\n\n> Patch Set 3:\n> \n> (2 comments)"
        },
        {
            "timestamp": 1608246139,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1608246210,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1609283882,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1610140751,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 4:\n\n(4 comments)\n\nLet me know if there are any unresolved objections.\nThanks for your thoughtful insight."
        },
        {
            "timestamp": 1619799827,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n> Patch Set 4:\n> \n> (4 comments)\n> \n> Let me know if there are any unresolved objections.\n> Thanks for your thoughtful insight.\n\nI see a bunch of 'acks' from PS3 but no changes.  Did you miss uploading a new revision?"
        },
        {
            "timestamp": 1620335549,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n> Patch Set 4:\n> \n> > Patch Set 4:\n> > \n> > (4 comments)\n> > \n> > Let me know if there are any unresolved objections.\n> > Thanks for your thoughtful insight.\n> \n> I see a bunch of 'acks' from PS3 but no changes.  Did you miss uploading a new revision?\n\n+1, John are you able to push a new revision if available?"
        },
        {
            "timestamp": 1629897517,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)\n\nStill looking for a push/update to this one..."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "debe02d63c3c9e4ebbd65fc01882af4869f34928",
            "parents": [
                "919a7b6816a5f16aa72d298e81e0756d95d5031e"
            ],
            "ref": "refs/changes/61/37461/1",
            "uploader": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "createdOn": 1602800530,
            "author": {
                "name": "John Edward Broadbent",
                "email": "jebr.google.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 14,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: typo? I think you meant C++ library"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 14,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: double space"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 14,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 14,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 22,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: . after the ()"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 22,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 30,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: . to end the sentence"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 30,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 43,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: double space"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 43,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 45,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: typo?"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 45,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "type": "ADDED",
                    "insertions": 62,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "5169956721561256bf73385fafc2d2527d80ac1f",
            "parents": [
                "919a7b6816a5f16aa72d298e81e0756d95d5031e"
            ],
            "ref": "refs/changes/61/37461/2",
            "uploader": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "createdOn": 1603316363,
            "author": {
                "name": "John Edward Broadbent",
                "email": "jebr.google.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 45,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "nit: to"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 45,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 54,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "Explicitly say \"no impact\" (or better yet, you can say \"Reduction in technical debt\")"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 54,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "type": "ADDED",
                    "insertions": 62,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "951664136e4f502a6d1fc308d264243cf5709d76",
            "parents": [
                "919a7b6816a5f16aa72d298e81e0756d95d5031e"
            ],
            "ref": "refs/changes/61/37461/3",
            "uploader": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "createdOn": 1603387070,
            "author": {
                "name": "John Edward Broadbent",
                "email": "jebr.google.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 11,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I can't tell if this is a proposal for a specific set of repositories or ALL repositories that use any static configuration.  Can you clarify?\n\nIt seems like this is centered around IPMI-related repositories.  If it is IPMI-centric, can you please rename the file to indicate this.  I expect this \"design document\" to be somewhat short-lived while the work is going on, if we need to even merge it at all, and I don't want someone confusing this as an over-arching design if that isn't what it is."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 11,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Ack"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 11,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Ack"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 42,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Rather than creating a new repository, have you considering just using one of the existing repositories, and having them publish the generated files as part of their install step?\n\nThat would allow other tools to use said files, but wouldn't require moving (a least one repos worth) the existing code, or creating a new repo, and mechanincally seems like it would be pretty minimal to execute.\n\nOff the top of my head, phosphor-host-ipmid could publish the generated headers files then declaring a DEPENDS for ipmi-fru-parser and openpower-host-ipmi-oem on phosphor-host-ipmid would give you access to said files.\n\nWhat do you think?"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 42,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "I'm intrigued by the idea of make install installing a bunch of generated headers...\n\n> phosphor-host-ipmid could publish the generated headers\n\nthe yaml->mako->cpp pattern extends way beyond the ipmi domain so this probably doesn't make sense."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 42,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Using an exiting repositories sounds good. I would support putting it  phosphor-host-ipmid.\n\nI will ask a noob question, what other data uses the yaml->mako->cpp pattern?"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 42,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "I'd be fine with using an existing repo, but wouldn't we want to have a separate -native recipe to avoid the installed headers ending up in the final BMC image?"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 42,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "I agree, we defiantly don't want the headers ending up in the BMC image.\nLike you said we can put them in a different native package."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 42,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Headers are never put into a BMC image.  Yocto already handles (mostly automatically) creating subpackages from a recipe, including a \"foo-dev\" package that includes the headers and unstripped library information for linking."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This isn't necessarily a bad thing.  The code is the same right now because the requirements happen to align.  As time moves on it is possible that these repositories will end up with different data needs, which may necessitate a different format.\n\nHaving all the parsing code in one repository may reduce the duplication but it also ties these repositories together tighter.  Code duplication is also less coupling.\n\nI'm not suggesting one approach is better than another but I think this aspect should be discussed in the pros/cons."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "> but it also ties these repositories together tighter\n\nIMO OpenBMC is already tightly coupled because of things like our (lack of) API stability guarantee and esoteric DBus patterns like the mapper.  Do we really care about loose coupling?"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Benjamin Fair",
                        "email": "benjaminfair@google.com",
                        "username": "BenjaminFair"
                    },
                    "message": "These data structures are all being generated from the same set of YAML files anyways. If one repo has different data needs, it'll most likely have to change the YAML format (affecting all the consumers of these files) or create a new YAML.\n\nI don't think the code duplication really gets us any concrete benefits."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 55,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "When the when the data comes from the same source, having different copies of the same parser is difficult to justify (in my mind).\nBut I know, I am new here."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 55,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Ack"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 59,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Openbmc upstream pre-submit infrastructure probably isn't enough in this case.  I'd recommend using something that dumps the FRUs/SDRs as an example that this works properly, something like ipmitool fru print is likely enough of a test to verify we haven't broken anything, as well as dumping the ipmi sdr to a file and comparing it before and after to verify the SDR didn't change."
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 59,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "I will update this section in the doc. Let me know what you think of it"
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "line": 59,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/refactor-static-configs.md",
                    "type": "ADDED",
                    "insertions": 63,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "a95143c25964c6e193dcdd7c9448d351d3e93e91",
            "parents": [
                "919a7b6816a5f16aa72d298e81e0756d95d5031e"
            ],
            "ref": "refs/changes/61/37461/4",
            "uploader": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "createdOn": 1608246210,
            "author": {
                "name": "John Edward Broadbent",
                "email": "jebr.google.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/ipmi-static-configs-refactor.md",
                    "type": "ADDED",
                    "insertions": 63,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 0
        }
    ]
}
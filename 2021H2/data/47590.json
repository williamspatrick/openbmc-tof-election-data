{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "Ia7329a17c46f4f1fda0b66f795f123c8524a1be5",
    "number": 47590,
    "subject": "psu-ng: Implement gpio write function",
    "owner": {
        "name": "Adriana Kobylak",
        "email": "anoo@linux.ibm.com",
        "username": "anoo1"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/47590",
    "commitMessage": "psu-ng: Implement gpio write function\n\nImplement a gpio write function to allow writing to gpios via the\nlibgpiod bindings. The bindings allow to set the desired gpio value by\npassing it to the line request call.\n\nAdd the ability to pass flags as defined in gpiod.hpp so that the caller\ncan specify options such as FLAG_OPEN_DRAIN.\n\nChange-Id: Ia7329a17c46f4f1fda0b66f795f123c8524a1be5\nSigned-off-by: Adriana Kobylak <anoo@us.ibm.com>\n",
    "createdOn": 1633554471,
    "lastUpdated": 1634859657,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1633554471,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1633554481,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633555002,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/27657/ : SUCCESS"
        },
        {
            "timestamp": 1634313382,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1634313393,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634313916,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28351/ : SUCCESS"
        },
        {
            "timestamp": 1634600048,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1634663658,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1634761645,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1634761670,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634762002,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1634762226,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28660/ : SUCCESS"
        },
        {
            "timestamp": 1634763274,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1634843058,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1634859547,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1634859657,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Change has been successfully merged by Shawn McCarney"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "63f0d970d089b929b8dc02a08246e4bfc28d6580",
            "parents": [
                "a588eafec450a1efcfd0d14b819f703e0e4e8d8d"
            ],
            "ref": "refs/changes/90/47590/1",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1633554471,
            "author": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util_base.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "5211a27fdfe09045aeba284cf1010820861b0e22",
            "parents": [
                "8b66288a840568cffdfa92f7cce025efcee7944d"
            ],
            "ref": "refs/changes/90/47590/2",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1634313382,
            "author": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "phosphor-power-supply/util.cpp",
                    "line": 98,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "How does request() handle a value other than 0 or 1?  Does it flag that as an error, or just treat everything that is != 0 as 1, or ?\n\nJust wondering what would happen if someone tries to write 2 or -99."
                },
                {
                    "file": "phosphor-power-supply/util.cpp",
                    "line": 98,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "good question!, I checked with some debug traces and yes, everything that is != 0 is set to 1, no error msgs are logged:\n\nOct 20 20:17:35 localhost phosphor-psu-monitor[1124]: Setting gpio to 1\nOct 20 20:17:36 localhost phosphor-psu-monitor[1124]: Read value after write: 1\nOct 20 20:17:37 localhost phosphor-psu-monitor[1124]: Setting gpio to 0\nOct 20 20:17:38 localhost phosphor-psu-monitor[1124]: Read value after write: 0\nOct 20 20:17:39 localhost phosphor-psu-monitor[1124]: Setting gpio to 2\nOct 20 20:17:40 localhost phosphor-psu-monitor[1124]: Read value after write: 1\nOct 20 20:17:41 localhost phosphor-psu-monitor[1124]: Setting gpio to -99\nOct 20 20:17:42 localhost phosphor-psu-monitor[1124]: Read value after write: 1"
                },
                {
                    "file": "phosphor-power-supply/util.cpp",
                    "line": 98,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "I should add that I looked at the libgpiod binding code and doesn't seem it's been handled there, so the logic seems to be deeper in the libgpio code."
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "line": 96,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Should the class name be changed now that it supports writing as well?"
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "line": 96,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Hrm... oversight on creation? \nclass GPIOInterface : public GPIOInterfaceBase ?"
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "line": 96,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Done. Makes sense, changed to \"class GPIOInterface : public GPIOInterfaceBase\" in a new commit https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/48014 and rebased this one on top."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util_base.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "52245b695eeb1714691e326dc92cb0043bf1fd7c",
            "parents": [
                "3ca062ae22d2cae25c5a55caba2b7a1b45a6bdaf"
            ],
            "ref": "refs/changes/90/47590/3",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1634761645,
            "author": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util_base.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 0
        }
    ]
}
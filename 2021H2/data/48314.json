{
    "project": "openbmc/phosphor-fan-presence",
    "branch": "master",
    "id": "I1756494e61ada60d44e58704431fb882ef7646a4",
    "number": 48314,
    "subject": "control: Add setFloorHold to Zone",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-fan-presence/+/48314",
    "commitMessage": "control: Add setFloorHold to Zone\n\nSimilar to the existing Zone::setTargetHold function, setFloorHold\nallows an action to set a floor and hold it, meaning the fans are not\nallowed to decrease to a value below that floor until the hold is\nreleased.  Adding this allows multiple actions to set the floor, without\nworrying if one is overwriting another.\n\nIt also adds some flight recorder entries with the ID zone-floorX when\nfloor holds are added and removed.  An example of that output is:\n\nzone-floor0: count_state_floor-1 is setting floor hold to 7777\nzone-floor0: Setting new floor to 7777\nzone-floor0: mapped_floor-0 is setting floor hold to 10700\nzone-floor0: Setting new floor to 10700\nzone-floor0: count_state_floor-1 is removing floor hold\n\nSigned-off-by: Matt Spinler <spinler@us.ibm.com>\nChange-Id: I1756494e61ada60d44e58704431fb882ef7646a4\n",
    "createdOn": 1635284081,
    "lastUpdated": 1635886138,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1635284081,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1635284095,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635284186,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29100/ : SUCCESS"
        },
        {
            "timestamp": 1635344923,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1635778184,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1635784619,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1635784619,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1635784633,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635784735,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29452/ : SUCCESS"
        },
        {
            "timestamp": 1635785423,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1635883734,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1635883756,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635883858,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29573/ : SUCCESS"
        },
        {
            "timestamp": 1635885138,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1635885455,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1635885455,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1635885472,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635885569,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29582/ : SUCCESS"
        },
        {
            "timestamp": 1635885944,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1635886138,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully merged by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ac38491108fbcd923deecd2f0e86d90663058438",
            "parents": [
                "e4867b2f6e2e88a7d0282e0dbe6967aad6842596"
            ],
            "ref": "refs/changes/14/48314/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635284081,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "control/json/zone.cpp",
                    "line": 189,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "This could be simplified to:\n```\nauto numErased = _floorHolds.erase(ident);\nif (numErased)\n{\n    FlightRecorder::instance().log(\"zone-floor\"s + getName(),\n        fmt::format(\"{} is removing floor hold\", ident));\n}\n```"
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 189,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 199,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "To save from doing the find, we could just record that \"set floor hold for ident to target\".\n\nFloor holds are not intended to really change too often, so doing this shouldnt flood the flight recorder...and if it does then something else is likely wrong with the configuration."
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 199,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done. \n\nThough mapped_floor will do it every time it runs, which could be every second with the ambient."
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 199,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Good point. I suppose the find should be minimal in this case considering how many actions would be configured to deal with setting a floor.\n\nMind putting the find back in?"
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 199,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 219,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "This is really \"No set floor exists, using default floor\" right?\n\nI'm thinking we should see this logged to the flight recorder prior to any event configs that would begin setting a floor."
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 219,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "This would only get logged if the 'hold' var passed in is false, meaning some action is basically removing its vote on the floor."
                },
                {
                    "file": "control/json/zone.cpp",
                    "line": 219,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "control/json/zone.cpp",
                    "type": "MODIFIED",
                    "insertions": 70,
                    "deletions": -4
                },
                {
                    "file": "control/json/zone.hpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 86,
            "sizeDeletions": 5
        },
        {
            "number": 2,
            "revision": "938a021fb1d919931929c288bce58fe20c232367",
            "parents": [
                "e4867b2f6e2e88a7d0282e0dbe6967aad6842596"
            ],
            "ref": "refs/changes/14/48314/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635784619,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "control/json/zone.cpp",
                    "type": "MODIFIED",
                    "insertions": 66,
                    "deletions": -4
                },
                {
                    "file": "control/json/zone.hpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 82,
            "sizeDeletions": 5
        },
        {
            "number": 3,
            "revision": "277f3d48d51e6ef89bcd11b15f7dfc2867ab81af",
            "parents": [
                "9db6dd1d451e28892c84d0870dad57bd5bace8fe"
            ],
            "ref": "refs/changes/14/48314/3",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635883734,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "control/json/zone.cpp",
                    "type": "MODIFIED",
                    "insertions": 68,
                    "deletions": -5
                },
                {
                    "file": "control/json/zone.hpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 84,
            "sizeDeletions": 6
        },
        {
            "number": 4,
            "revision": "40554d8c0d2081894eb758b4dedecff79086e091",
            "parents": [
                "9db6dd1d451e28892c84d0870dad57bd5bace8fe"
            ],
            "ref": "refs/changes/14/48314/4",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635885455,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "control/json/zone.cpp",
                    "type": "MODIFIED",
                    "insertions": 72,
                    "deletions": -5
                },
                {
                    "file": "control/json/zone.hpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 88,
            "sizeDeletions": 6
        }
    ]
}
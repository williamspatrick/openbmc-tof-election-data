{
    "project": "openbmc/phosphor-logging",
    "branch": "master",
    "id": "I50dfe4807ac9c19f54c49dfa2b9ec7119aaffb96",
    "number": 45073,
    "subject": "PEL: Set critical association to object paths",
    "owner": {
        "email": "sumit_kumar@in.ibm.com",
        "username": "sumitk56"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-logging/+/45073",
    "commitMessage": "PEL: Set critical association to object paths\n\nCreate critical association to inventory d-bus objects.\nThis is being done for the items in callouts that need\ntheir service indicators turned on in its code, and\nthat the other association endpoint is the chasis so\nit can be used for health rollup.\n\nThe associations property on the\nxyz.openbmc_project.Association.Definitions interface\nwill have following entry added to called out object path:\n[\"health_rollup\", \"critical\",\n\"/xyz/openbmc_project/inventory/system/chassis\"]\n\nSigned-off-by: Sumit Kumar <sumit_kumar@in.ibm.com>\nChange-Id: I50dfe4807ac9c19f54c49dfa2b9ec7119aaffb96\n",
    "createdOn": 1626775517,
    "lastUpdated": 1627495132,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1626775517,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1626775530,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626775783,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22368/ : FAILURE"
        },
        {
            "timestamp": 1626777487,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1626777506,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626777728,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22370/ : FAILURE"
        },
        {
            "timestamp": 1626777955,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1626777966,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626778676,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22371/ : SUCCESS"
        },
        {
            "timestamp": 1626874906,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(5 comments)"
        },
        {
            "timestamp": 1626881369,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Patch Set 3:\n\n(5 comments)"
        },
        {
            "timestamp": 1626960444,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1626960456,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626961163,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22581/ : SUCCESS"
        },
        {
            "timestamp": 1627315557,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1627377367,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1627377514,
            "reviewer": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1627377526,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627378244,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22907/ : SUCCESS"
        },
        {
            "timestamp": 1627412911,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1627495132,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully rebased and submitted as 76198a2ea2e3deb14078e0d3dd3932b657ddd9b8 by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "bd3cd886dc9e3f5ab5e71bf5ba601ee93e47897a",
            "parents": [
                "47c773420ce1bc961ae020c05084a4115e89b38e"
            ],
            "ref": "refs/changes/73/45073/1",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1626775517,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/dbus_types.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 109,
            "sizeDeletions": 2
        },
        {
            "number": 2,
            "revision": "713dd6398dd46ab9947479e907af7dd1cc9d85ca",
            "parents": [
                "47c773420ce1bc961ae020c05084a4115e89b38e"
            ],
            "ref": "refs/changes/73/45073/2",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1626777487,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "type": "MODIFIED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/dbus_types.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 107,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "42bc672ea586b1c03a064de0cc938c25e8cc160e",
            "parents": [
                "47c773420ce1bc961ae020c05084a4115e89b38e"
            ],
            "ref": "refs/changes/73/45073/3",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1626777955,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Can you describe here that you're doing this for the items in callouts that need their service indicators turned on in the service indicator code, and that the other association endpoint is the chassis so it can be used for health rollup?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Ok"
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 39,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "looks like this can be removed, since you're (correctly) using getService to get the service name."
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 39,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Yeah right. Actually I was using it earlier but when I modified the code it wasn't no longer required."
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 538,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "At the top of this function you can just do a:\nusing AssociationTuple = std::tuple<std::string, std::string, std::string>;\nusing AssociationsProperty = std::vector<AssocationTuple>;\n\nThen you can use those below instead of having to type out the whole definition each time."
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 538,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Thanks Matt for this suggestion. Will do."
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 540,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I think you can simplify this code some, like:\n\ngetProperty(..., getAssocationValue);\n\nauto associations = std::get<AssociationsProperty>(getAssocationsValue);\n\nAssociationTuple critAssociation{\"health_rollup\", ...};\n\n\nif (std::find(associations.begin(), associations.end(), critAssociation) == associations.end())\n{\n    associations.push_back(newAssociation);\n\n     // write property...\n}"
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 540,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Based on comment above will look into it"
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "line": 48,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "in service_indicators_test.cpp there's some testcases where you can add EXPECT_CALLs for this."
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "line": 48,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Ok"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "type": "MODIFIED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/dbus_types.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 108,
            "sizeDeletions": 2
        },
        {
            "number": 4,
            "revision": "5e7b0b4594302d9a5523bedbc8690150959de533",
            "parents": [
                "47c773420ce1bc961ae020c05084a4115e89b38e"
            ],
            "ref": "refs/changes/73/45073/4",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1626960444,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 554,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "on line 544 association was already defined to be an AssociationsProperty."
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "line": 554,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "Ok"
                },
                {
                    "file": "test/openpower-pels/service_indicators_test.cpp",
                    "line": 340,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Instead of having this just to check the function was called, you can just add the EXPECT_CALL up around line 273 where setFunctional also has an EXPECT_CALL.\n\nAnd I guess since there is a testcase where setFunctional is made to fail, maybe you can just change this one to have setCriticalAssociationFail."
                },
                {
                    "file": "test/openpower-pels/service_indicators_test.cpp",
                    "line": 340,
                    "reviewer": {
                        "email": "sumit_kumar@in.ibm.com",
                        "username": "sumitk56"
                    },
                    "message": "yeah ok will do"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/dbus_types.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/service_indicators_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 102,
            "sizeDeletions": 2
        },
        {
            "number": 5,
            "revision": "766acd18012ca6042c675dc8a126e8592d464aff",
            "parents": [
                "5c0c917600eae393494930858fc32b65c3127fd9"
            ],
            "ref": "refs/changes/73/45073/5",
            "uploader": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "createdOn": 1627377514,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/dbus_types.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/service_indicators_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 106,
            "sizeDeletions": 2
        },
        {
            "number": 6,
            "revision": "76198a2ea2e3deb14078e0d3dd3932b657ddd9b8",
            "parents": [
                "ebc91be6b62973ed372f7670285aa5ac19e9a273"
            ],
            "ref": "refs/changes/73/45073/6",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1627495132,
            "author": {
                "email": "sumit_kumar@in.ibm.com",
                "username": "sumitk56"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/data_interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/dbus_types.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "extensions/openpower-pels/service_indicators.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/mocks.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "test/openpower-pels/service_indicators_test.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 106,
            "sizeDeletions": 2
        }
    ]
}
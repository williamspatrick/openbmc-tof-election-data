{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "If59b86211ab54c31248ede78f8f117b607298923",
    "number": 49775,
    "subject": "psu-ng: Continue reading after readFail",
    "owner": {
        "name": "B. J. Wyman",
        "email": "bjwyman@gmail.com",
        "username": "bjwyman"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/49775",
    "commitMessage": "psu-ng: Continue reading after readFail\n\nUpdate the PMBus::read() function to allow for not creating journal\ntrace and elog, but default it to that behavior.\n\nIf we reach the limit of read failures that results in a communication\nerror log, continue to read, but stop logging failures.\n\nIf communication restores, we may be able to detect what caused the read\nfailure, or otherwise detect or clear new faults.\n\nChange-Id: If59b86211ab54c31248ede78f8f117b607298923\nSigned-off-by: Brandon Wyman <bjwyman@gmail.com>\n",
    "createdOn": 1639697452,
    "lastUpdated": 1641512476,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1639697452,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1639697465,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1639697524,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/32166/ : FAILURE"
        },
        {
            "timestamp": 1640036473,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1640036489,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1640037057,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/32283/ : SUCCESS"
        },
        {
            "timestamp": 1640037735,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1640117481,
            "reviewer": {
                "name": "Jim Wright",
                "email": "jlwright@us.ibm.com",
                "username": "wrightjl1"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1640118932,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1640118956,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1640132218,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1640132234,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1640132273,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1640132813,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/32360/ : SUCCESS"
        },
        {
            "timestamp": 1640145482,
            "reviewer": {
                "name": "Jim Wright",
                "email": "jlwright@us.ibm.com",
                "username": "wrightjl1"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1640187357,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1641317169,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1641503764,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1641511175,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1641511779,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1641511793,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1641511794,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1641511829,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1641512476,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/35009/ : SUCCESS"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "8b6e0bfafe65212ee38dcbdf13cb0552e68d2dda",
            "parents": [
                "391a0690043baafbe96b7962a3e843101c53fcb7"
            ],
            "ref": "refs/changes/75/49775/1",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1639697452,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -4
                },
                {
                    "file": "pmbus.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -9
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 15
        },
        {
            "number": 2,
            "revision": "20d49b65b75efee786061d2d2ba55ba608887f1d",
            "parents": [
                "391a0690043baafbe96b7962a3e843101c53fcb7"
            ],
            "ref": "refs/changes/75/49775/2",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1640036473,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "pmbus.cpp",
                    "line": 212,
                    "reviewer": {
                        "name": "Jim Wright",
                        "email": "jlwright@us.ibm.com",
                        "username": "wrightjl1"
                    },
                    "message": "Nit: cleanup"
                },
                {
                    "file": "pmbus.cpp",
                    "line": 212,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Ack"
                },
                {
                    "file": "pmbus.hpp",
                    "line": 169,
                    "reviewer": {
                        "name": "Jim Wright",
                        "email": "jlwright@us.ibm.com",
                        "username": "wrightjl1"
                    },
                    "message": "For compatibility, do we want the default to be true?"
                },
                {
                    "file": "pmbus.hpp",
                    "line": 169,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Um... yes. How did I get that backwards?"
                },
                {
                    "file": "pmbus.hpp",
                    "line": 169,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -4
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -10
                },
                {
                    "file": "pmbus.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -9
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 50,
            "sizeDeletions": 26
        },
        {
            "number": 3,
            "revision": "a522c78b87e992ed8c578eac6509fe3c55c5fdab",
            "parents": [
                "391a0690043baafbe96b7962a3e843101c53fcb7"
            ],
            "ref": "refs/changes/75/49775/3",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1640132218,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 230,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "does readFail get cleared every power up, and when a new psu is plugged in, as well?"
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 230,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Yes.\n\n1. cleared every powerup:\nhttps://github.com/openbmc/phosphor-power/blob/e3f7ad238a5ffaa87e19839ce15c12c3e8df9c9e/phosphor-power-supply/psu_manager.cpp#L349\nPSUManager::powerStateChanged(...) power state is 1 (on), call clearFaults().\n\n2. new psu is plugged in\nhttps://github.com/openbmc/phosphor-power/blob/e3f7ad238a5ffaa87e19839ce15c12c3e8df9c9e/phosphor-power-supply/power_supply.cpp#L177\npresentOld != present:\nclearFaults() called if present is true (new psu is plugged in)"
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 433,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "If I'm reading it right, won't this create multiple error logs for when readFail = 1 and 2?"
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 433,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Yes, and we were doing this all along, basically...\n\nFred Freck actually asked about this while investigating an issue on an Everest system. That underlying ReadFailure ends up creating a BD571008 PEL."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 433,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Should I change something here?"
                },
                {
                    "file": "pmbus.hpp",
                    "line": 289,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "In the commit message, I thought you stated the default was for error tracing to be enabled.  Also, that is the default value in the parent class.\n\nI think it is confusing the modify default parameter values between levels of a class hierarchy.  Callers often don't know the exact type of an object if they have a pointer to the parent class."
                },
                {
                    "file": "pmbus.hpp",
                    "line": 289,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Oops, only changed the one Jim pointed out. Missed this.\n\nhttps://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/49775/2..3/pmbus.hpp#b169\nChanged that from false to true, something Jim pointed out."
                },
                {
                    "file": "pmbus.hpp",
                    "line": 289,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -4
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -10
                },
                {
                    "file": "pmbus.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -9
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 26
        },
        {
            "number": 4,
            "revision": "b1b1707e6ad6e54cc5d1d112782340adda56d6bd",
            "parents": [
                "e3f7ad238a5ffaa87e19839ce15c12c3e8df9c9e"
            ],
            "ref": "refs/changes/75/49775/4",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1641511779,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -4
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -10
                },
                {
                    "file": "pmbus.cpp",
                    "type": "MODIFIED",
                    "insertions": 17,
                    "deletions": -9
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 48,
            "sizeDeletions": 26
        }
    ]
}
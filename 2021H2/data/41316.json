{
    "project": "openbmc/phosphor-ipmi-flash",
    "branch": "master",
    "id": "I0d68fff6527cd52360abee1cb225a8f228d68392",
    "number": 41316,
    "subject": "tools/handler: Read the running version",
    "owner": {
        "name": "Jie Yang",
        "email": "jjy@google.com",
        "username": "PlotCondor"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-ipmi-flash/+/41316",
    "commitMessage": "tools/handler: Read the running version\n\nA host tool would read the running firmware version through polling the\nversion blob state.\n\nSigned-off-by: Jie Yang <jjy@google.com>\nChange-Id: I0d68fff6527cd52360abee1cb225a8f228d68392\n",
    "hashtags": [
        "version-polling"
    ],
    "createdOn": 1615882894,
    "lastUpdated": 1629187756,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1615882894,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1615882907,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1615883564,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/13832/ : SUCCESS"
        },
        {
            "timestamp": 1615914466,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1616148258,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(2 comments)\n\nLooks mostly good"
        },
        {
            "timestamp": 1616187262,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1616462072,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1617414012,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1617414028,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617414693,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14826/ : SUCCESS"
        },
        {
            "timestamp": 1617417369,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 3:\n\nPTAL"
        },
        {
            "timestamp": 1617649660,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\nApologies, this review fell through the crack. I'll get to this by EOD."
        },
        {
            "timestamp": 1617650317,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1617650387,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1617650438,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1617677409,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1617677444,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617677611,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 4:\n\n(3 comments)\n\nPTAL"
        },
        {
            "timestamp": 1617678307,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14866/ : SUCCESS"
        },
        {
            "timestamp": 1617682874,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1617683971,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4:\n\n(7 comments)"
        },
        {
            "timestamp": 1617690145,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1617690168,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 5:\n\n(7 comments)"
        },
        {
            "timestamp": 1617690204,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617691107,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14882/ : SUCCESS"
        },
        {
            "timestamp": 1617728044,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(4 comments)\n\nThanks! A few minor nits and it should be good to commit."
        },
        {
            "timestamp": 1617728286,
            "reviewer": {
                "name": "Jason Ling",
                "email": "jasonling@google.com",
                "username": "jclaz"
            },
            "message": "Patch Set 5:\n\n(6 comments)"
        },
        {
            "timestamp": 1617733007,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Uploaded patch set 6."
        },
        {
            "timestamp": 1617733030,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617733112,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 6:\n\n(8 comments)"
        },
        {
            "timestamp": 1617733738,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14921/ : SUCCESS"
        },
        {
            "timestamp": 1617735427,
            "reviewer": {
                "name": "Jason Ling",
                "email": "jasonling@google.com",
                "username": "jclaz"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1617735789,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1617735908,
            "reviewer": {
                "name": "William A. Kennington III",
                "email": "wak@google.com",
                "username": "wak-google"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1617739158,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1617739176,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Change has been successfully merged by Jie Yang"
        },
        {
            "timestamp": 1629187756,
            "reviewer": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "message": "Hashtag added: version-polling"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "5a35fd3584dbb75263662b44fba18a303eda8126",
            "parents": [
                "c7fa2c2803065fcae3e9540e57d2a28a5bc83ecc"
            ],
            "ref": "refs/changes/16/41316/1",
            "uploader": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "createdOn": 1615882894,
            "author": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 56,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -1
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 53,
                    "deletions": 0
                },
                {
                    "file": "tools/test/updater_mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 204,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "86c45c00d4b8ffcdf1ec395e86eaea9628091d44",
            "parents": [
                "c7fa2c2803065fcae3e9540e57d2a28a5bc83ecc"
            ],
            "ref": "refs/changes/16/41316/2",
            "uploader": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "createdOn": 1615914466,
            "author": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "tools/helper.cpp",
                    "line": 114,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "Would probably be better named `pollReadReady`, so that the caller understands why it exists at a glance? You might consider making it return the size too, so you don't need the follow up stat call."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 114,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "should be fine to return a pair of <bool, uint32_t>?"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 114,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "You could, but i think it would also be fine to use an exception for false, and then just the size when true."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 139,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "You should just check open_read / and if not set, then committing. Blobs don't generally guarantee setting the committing bits on open. We've overloaded the term, purely for cases when the file isn't available for reading yet to use the committing bit to tell the reader to come back. Older readers would error out for these new blobs (they dont have any retry code anyway).\n\nHowever, older blobs and blobs which don't need time to get read won't necessarily set the commit bits. If the blob isn't open_read and isn't committing, then it is an error to the reader."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 139,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "When the committing bits are not set, the loop will go on. If we just check open_read and committing, how can we know the data is ready to read? When I wrote this function, it is suppose to be only used by version blob, where the stat() will always have committing bits set up."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 139,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Is the following pseudocode your logics?\n\nif ! blob_state & open_read\n    then exit_loop return false\nelse if blob_state & committing\n    then continue_polling\nelse \n    then exit_loop return true\n\nThis will cause read errors, as it returns true when a commit_error occurs especially for version blobs. But we can catch the error when reading.\n\nhttps://github.com/openbmc/phosphor-ipmi-flash/blob/c8b456e08bf6fedebc15c399e4a3a79b744b1624/bmc/version-handler/version_handler.cpp#L163\n\nlooks like we need add open_read flag for version blob stat()?"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 139,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "More like\n```\nif blob_state & open_read\nthen exit_loop return true (size)\nelse if blob_state & committing\nthen continue_polling\nelse\nthen exit_loop return false\n```\n\nI don't want to rely on the presence of commit_error, but just the lack of open_read and using committing as a signal that it might become open later. The committing state should never persist on any blob, so it's safe to re-use for this purpose."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 139,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 56,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -1
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 53,
                    "deletions": 0
                },
                {
                    "file": "tools/test/updater_mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 204,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "cfc182135bdb7f931c858277a68d86491bb11ca5",
            "parents": [
                "c8b456e08bf6fedebc15c399e4a3a79b744b1624"
            ],
            "ref": "refs/changes/16/41316/3",
            "uploader": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "createdOn": 1617414012,
            "author": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "`tolls` -> `tools`"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 169,
                    "reviewer": {
                        "name": "William A. Kennington III",
                        "email": "wak@google.com",
                        "username": "wak-google"
                    },
                    "message": "Just return inside the loop for these termination conditions so you don't have to check twice."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 169,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 48,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                },
                {
                    "file": "tools/test/updater_mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 218,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "67f77c8ef513731adfb56fe6de6cd05909129adc",
            "parents": [
                "c8b456e08bf6fedebc15c399e4a3a79b744b1624"
            ],
            "ref": "refs/changes/16/41316/4",
            "uploader": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "createdOn": 1617677409,
            "author": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tools/handler.cpp",
                    "line": 144,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I wonder if Jason Ling wanted to create a Tools side implementation for Version Handler as well, I would check with him as he factored out a lot of the code for version handling."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 144,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 168,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I feel like this would feel out of place - do you mind putting a different fprintf statement above before you try to read that tells the user the context of what you're trying to do?\n\nSimilar to above with VerifyFile:\n```\n  std::fprintf(stderr, \"Calling stat on %s session to check status\\n\",\n                 target.c_str());\n```\n\nUnless, you were planning on calling readVersion from a different function and that was going to provide context."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 168,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 120,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit:\n```\n * - The open read and committed bits set -> stat successful;\n * - The open read and committing bits unset -> stat failed;\n * - Blob exception was received\n * - Time ran out.\n```"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 120,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Looking at https://github.com/openbmc/phosphor-ipmi-flash/blob/master/bmc/version-handler/version_handler.cpp\n\nIt looks like we should be checking for committed AND open_read"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "William would like this function to be generic and not just for specific version blobs.https://github.com/openbmc/phosphor-ipmi-flash/blob/c8b456e08bf6fedebc15c399e4a3a79b744b1624/bmc/version-handler/version_handler.cpp#L158\n\nversion blobs will only have three states: committing, commit_error and committed | open_read. It would be safe to only check the open_read bit here . \n\nFor generic blobs, it is not required to have committed bit set. \n\nQuote of William's comment\n\nYou should just check open_read / and if not set, then committing. Blobs don't generally guarantee setting the committing bits on open. We've overloaded the term, purely for cases when the file isn't available for reading yet to use the committing bit to tell the reader to come back. Older readers would error out for these new blobs (they dont have any retry code anyway).\n\nHowever, older blobs and blobs which don't need time to get read won't necessarily set the commit bits. If the blob isn't open_read and isn't committing, then it is an error to the reader."
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Thanks for the clarification - would it be possible to add a short summary comment for future readers?"
                },
                {
                    "file": "tools/helper.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Add an additional comment in the function description."
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 65,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "For completeness, I would check for `commit_error` since that is what is used https://github.com/openbmc/phosphor-ipmi-flash/blob/master/bmc/version-handler/version_handler.cpp"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 65,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Please create another test case where the first poll returns committing to ensure it tries again"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Created two test cases. The first poll returns committing, the second returns open_read / commit_error.\n\nIt will take additional 5 seconds. Hope it will not block the CI tests."
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I believe it should be ok. Thanks!"
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "line": 178,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Please write a 1~2 liner brief description of the test (and for the tests below0."
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "line": 178,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "line": 210,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I don't think we're failing because the response is empty right (since we don't have an \"empty\" check - should we be checking for that?) it's because blob_state is commit_error it seems like."
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "line": 210,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "readVersion function will return a uint8_t vector. This is just a trivial test that checks the return vector is empty if polling fails. I should change the test name to ReadVersionReturnEmptyIfPollingFail."
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "line": 210,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Ah, I was looking at the `readVersionResponse`, when I should have been looking at the last `EXPECT_THAT(..., IsEmpty())`. Thanks"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 48,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 56,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                },
                {
                    "file": "tools/test/updater_mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 210,
            "sizeDeletions": 1
        },
        {
            "number": 5,
            "revision": "d205844f49d18df2613011c8fbdfd469829bdc14",
            "parents": [
                "c8b456e08bf6fedebc15c399e4a3a79b744b1624"
            ],
            "ref": "refs/changes/16/41316/5",
            "uploader": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "createdOn": 1617690145,
            "author": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tools/handler.cpp",
                    "line": 144,
                    "reviewer": {
                        "name": "Jason Ling",
                        "email": "jasonling@google.com",
                        "username": "jclaz"
                    },
                    "message": "Is this function unit tested?"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 144,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "yes, in tools_updater_unittest.cpp"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 167,
                    "reviewer": {
                        "name": "Jason Ling",
                        "email": "jasonling@google.com",
                        "username": "jclaz"
                    },
                    "message": "This looks like it can throw, should we clean up (close the blob) if it throws?"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 167,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "clean up will be done by cleanArtifacts() function, when the readVersion() function is called."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 171,
                    "reviewer": {
                        "name": "Jason Ling",
                        "email": "jasonling@google.com",
                        "username": "jclaz"
                    },
                    "message": "and if the size is 0? Should we not report that as an error condition?"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 171,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "This is not an error condition. If the buffer size is 0, no need to issue an readBytes() call, as it will return an empty result."
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 181,
                    "reviewer": {
                        "name": "Jason Ling",
                        "email": "jasonling@google.com",
                        "username": "jclaz"
                    },
                    "message": "Do we need to try to close the blob before throwing?"
                },
                {
                    "file": "tools/handler.cpp",
                    "line": 181,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 53,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "super minor nit: could you cover the case here or in the other test that open_read | committed would also pass (as expected?)"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 53,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Jason Ling",
                        "email": "jasonling@google.com",
                        "username": "jclaz"
                    },
                    "message": "nit: spelling mistake, Reruns not Reurns."
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 90,
                    "reviewer": {
                        "name": "Jason Ling",
                        "email": "jasonling@google.com",
                        "username": "jclaz"
                    },
                    "message": "nit: spelling mistake, reruns not reurns"
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "line": 90,
                    "reviewer": {
                        "name": "Jie Yang",
                        "email": "jjy@google.com",
                        "username": "PlotCondor"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 50,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 59,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 59,
                    "deletions": 0
                },
                {
                    "file": "tools/test/updater_mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 251,
            "sizeDeletions": 1
        },
        {
            "number": 6,
            "revision": "328f520f44a4e986d58b204468660e7ddeedc189",
            "parents": [
                "c8b456e08bf6fedebc15c399e4a3a79b744b1624"
            ],
            "ref": "refs/changes/16/41316/6",
            "uploader": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "createdOn": 1617733007,
            "author": {
                "name": "Jie Yang",
                "email": "jjy@google.com",
                "username": "PlotCondor"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.cpp",
                    "type": "MODIFIED",
                    "insertions": 51,
                    "deletions": 0
                },
                {
                    "file": "tools/handler.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.cpp",
                    "type": "MODIFIED",
                    "insertions": 64,
                    "deletions": 0
                },
                {
                    "file": "tools/helper.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                },
                {
                    "file": "tools/test/tools_helper_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": 0
                },
                {
                    "file": "tools/test/tools_updater_unittest.cpp",
                    "type": "MODIFIED",
                    "insertions": 60,
                    "deletions": 0
                },
                {
                    "file": "tools/test/updater_mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 261,
            "sizeDeletions": 1
        }
    ]
}
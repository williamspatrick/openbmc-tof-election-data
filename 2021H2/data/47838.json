{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "Iac43b0e53524789ff5472efe3818be84ce991523",
    "number": 47838,
    "subject": "Initialize the uninitialized variables",
    "owner": {
        "name": "Arun P M",
        "email": "arun.p.m@linux.intel.com",
        "username": "arun-pm"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/47838",
    "commitMessage": "Initialize the uninitialized variables\n\nInitilize the variables with default value to avoid undefined\nbehaviors.\n\nTested: No functionality change\n\nSigned-off-by: Arun P. Mohanan <arun.p.m@linux.intel.com>\nChange-Id: Iac43b0e53524789ff5472efe3818be84ce991523\n",
    "cherryPickOfChange": 47838,
    "cherryPickOfPatchSet": 1,
    "createdOn": 1634228730,
    "lastUpdated": 1635355150,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1634228730,
            "reviewer": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1634228748,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634228897,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28294/ : SUCCESS"
        },
        {
            "timestamp": 1634229084,
            "reviewer": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1634229095,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1634229098,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634229248,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28295/ : SUCCESS"
        },
        {
            "timestamp": 1634231273,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1634231583,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1634243523,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1634407608,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1634558420,
            "reviewer": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1634578205,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1635355150,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\nDiscussion determined this wasn't required.  Feel free to reopen or discuss on discord if I've closed this in error."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3aa9ecbfe17acecf28ebfc81e1b5489ad648fa2f",
            "parents": [
                "1dc85f51670dea67df5bb80c7328419f2eacec27"
            ],
            "ref": "refs/changes/38/47838/1",
            "uploader": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "createdOn": 1634228730,
            "author": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/sensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 10,
            "sizeDeletions": 6
        },
        {
            "number": 2,
            "revision": "37bb5a4c800c6aee9314ef08301e23291cf20950",
            "parents": [
                "1dc85f51670dea67df5bb80c7328419f2eacec27"
            ],
            "ref": "refs/changes/38/47838/2",
            "uploader": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "createdOn": 1634229084,
            "author": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "Did you observe any bad behavior?\nAccording to the documentation I could find, the default constructor and the (std::nullptr_t) constructor do the same thing, so I wouldn't think this change is necessary/useful."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Arun P M",
                        "email": "arun.p.m@linux.intel.com",
                        "username": "arun-pm"
                    },
                    "message": "My bad. You are right.\n\nThere was a Segmentation fault issue(difficult to reproduce) reported and the coredump analysis was pointing out to operationalInterface->set_property() in sensor.hpp.\nFrom the code analysis the uninitialized smart pointer was a suspect. But as you mentioned the default constructor does the job here. Missed that part.\n\nI will try to dig deeper to the issue."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> My bad. You are right.\n> \n> There was a Segmentation fault issue(difficult to reproduce) reported and the coredump analysis was pointing out to operationalInterface->set_property() in sensor.hpp.\n> From the code analysis the uninitialized smart pointer was a suspect. But as you mentioned the default constructor does the job here. Missed that part.\n\nGenerally this occurs when we have callbacks that don't take proper ownership of the objects, and an event happens as a sensor is being destroyed.  Check for anyplace in the set_property callback where we capture by reference instead of by weak_ptr, and I'll bet that's your culprit.\n\n> \n> I will try to dig deeper to the issue."
                },
                {
                    "file": "include/sensor.hpp",
                    "line": 66,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Is this actually necessary? I thought an empty shared_ptr here is equivalent to nullptr. Did you see any issue without it?"
                },
                {
                    "file": "include/sensor.hpp",
                    "line": 66,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "These two statements are equivalent.  To my understanding and reading of the standard library, both the nullptr constructor, and the normal constructor would give the same result.\n\nto the author:\nCan you cite something that says that what we did previously is undefined behavior?"
                },
                {
                    "file": "include/sensor.hpp",
                    "line": 66,
                    "reviewer": {
                        "name": "Arun P M",
                        "email": "arun.p.m@linux.intel.com",
                        "username": "arun-pm"
                    },
                    "message": "My bad. You are right.\n\nThere was a Segmentation fault issue(difficult to reproduce) reported and the coredump analysis was pointing out to operationalInterface->set_property() at L374.\nThe issue was only one time seen and from the code analysis the uninitialized smart pointer was a suspect. But as you mentioned the default constructor does the job here. Missed that part.\n\nI will try to dig deeper to the issue."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/sensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 10,
            "sizeDeletions": 6
        }
    ]
}
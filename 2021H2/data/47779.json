{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "I0463377a3e67faf1f32ab4a4b30ff73cbb8f5631",
    "number": 47779,
    "subject": "psu-ng: Include STATUS_INPUT in input fault error",
    "owner": {
        "name": "B. J. Wyman",
        "email": "bjwyman@gmail.com",
        "username": "bjwyman"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/47779",
    "commitMessage": "psu-ng: Include STATUS_INPUT in input fault error\n\nRead the value of STATUS_INPUT if STATUS_WORD is not zero. Include the\nvalue of STATUS_INPUT if logging an error for an input fault.\n\nSigned-off-by: Brandon Wyman <bjwyman@gmail.com>\nChange-Id: I0463377a3e67faf1f32ab4a4b30ff73cbb8f5631\n",
    "createdOn": 1634075987,
    "lastUpdated": 1635299236,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1634075987,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1634076003,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634076072,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/28163/ : FAILURE"
        },
        {
            "timestamp": 1634250669,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1634250685,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634250750,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/28315/ : FAILURE"
        },
        {
            "timestamp": 1634672685,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1634672704,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634673239,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28542/ : SUCCESS"
        },
        {
            "timestamp": 1634674248,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 3:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1634674695,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1634675843,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1634764181,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1634764195,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634764736,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28665/ : SUCCESS"
        },
        {
            "timestamp": 1634767204,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1634861482,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1634930334,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1634931502,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1634931666,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1634932966,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1634932981,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634933089,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 5:\n\n(4 comments)"
        },
        {
            "timestamp": 1634933758,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28819/ : SUCCESS"
        },
        {
            "timestamp": 1635196519,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635273815,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635297180,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635297184,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1635299236,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Change has been successfully merged by Shawn McCarney"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3a9568d7a934675cb3429631a8aea649a6278ebf",
            "parents": [
                "8c8d85910660aacd67c7e12d2d5c8deb0db9d929"
            ],
            "ref": "refs/changes/79/47779/1",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1634075987,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -8
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 8
        },
        {
            "number": 2,
            "revision": "431dab0c61f584008482377fe1dbbf1d91a44733",
            "parents": [
                "786b6f4cbfb8e3779570a09f89bce589ba2e75d4"
            ],
            "ref": "refs/changes/79/47779/2",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1634250669,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -8
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 50,
                    "deletions": -12
                }
            ],
            "sizeInsertions": 74,
            "sizeDeletions": 20
        },
        {
            "number": 3,
            "revision": "258e439422b6bac18355dd9476dac47341d3146c",
            "parents": [
                "786b6f4cbfb8e3779570a09f89bce589ba2e75d4"
            ],
            "ref": "refs/changes/79/47779/3",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1634672685,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -8
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 139,
                    "deletions": -44
                }
            ],
            "sizeInsertions": 163,
            "sizeDeletions": 52
        },
        {
            "number": 4,
            "revision": "f494c702532b839487ce8b6e874efe11aa4efe7a",
            "parents": [
                "81dbbb60a4488daf016e0b6d526ebbd6c632e618"
            ],
            "ref": "refs/changes/79/47779/4",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1634764181,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 156,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "I'm confused by this.  In looking at analyze(), doesn't it skip reading STATUS_MFR AND STATUS_INPUT when STATUS_WORD is 0?\n\nIf I am misunderstanding that part, you mention 3 in the comment but only have Times(2)?"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 156,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "I must have messed something up in moving and updating things. I wonder if this isn't one of those \"wait, what did vim just do\" moments I had.\n\nIf STATUS_WORD is 0, there are no faults, so STATUS_INPUT and STATUS_MFR will not be read. Below, there is one call to analyze(), the function doing the read of STATUS_WORD. There should just be one read, of STATUS_WORD, which returns 0."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 156,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Oops! I see what happened here.\n\nI created the object, and then indicated that the presence GPIO would return a value indicating the power supply is missing.\n\nI then add in the expectation that it changes to present, which will result in clearing faults, and part of that does a read of \"in1_input\" as that was  expected to result in the CLEAR_FAULTS command being sent through the hwmon /pmbus operations in the base/core code. That read does not care what value is returned, so the return of 0 just worked out okay.\n\nSo, what should happen is analyze() gets called, it updates the presence status, the presence changed from missing to present, so that results in writing the ON_OFF_CONFIG and reading the in1_input as part of the clearing of faults, the analyze function then moves onto reading STATUS_WORD, since the power supply is present.\n\nI am missing the expected read of in1_input."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 156,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/48017/1/phosphor-power-supply/test/power_supply_tests.cpp#157"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 156,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Done"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Should this be deleted?"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Oops...I think I removed it in a later commit, but should be removed from this one."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Done"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 233,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Missing Times(2)?"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 233,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Huh... I suppose. There are two WillOnce parts, but missed the Times(2) part."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 233,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Done"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 254,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Missing Times(2)?"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 254,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Ditto"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 254,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -8
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 139,
                    "deletions": -44
                }
            ],
            "sizeInsertions": 163,
            "sizeDeletions": 52
        },
        {
            "number": 5,
            "revision": "f07bc797b37b4a34999a22cc7acf794a5a3e166e",
            "parents": [
                "523704d0141d67a9fc9a05c2fe2abac2040201d0"
            ],
            "ref": "refs/changes/79/47779/5",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1634932966,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -8
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 144,
                    "deletions": -46
                }
            ],
            "sizeInsertions": 168,
            "sizeDeletions": 54
        }
    ]
}
{
    "project": "openbmc/phosphor-inventory-manager",
    "branch": "master",
    "id": "I341d3c6ffc0d36e63444c63351012ac487b171ef",
    "number": 45006,
    "subject": "utils: allow conversion from string to dbus enum",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-inventory-manager/+/45006",
    "commitMessage": "utils: allow conversion from string to dbus enum\n\nEnhance the variant visitor to leverage functionality in sdbusplus\nthat allows conversion of strings to enums (or variants containing\nenums).  This will allow a seem-less transition for Inventory\nproperties which are defined as string and then transition to\nenumerations, such as that introduced by [1].\n\nTested: Booted Witherspoon in QEMU with [1] and [2].  Confirmed PIM\nno longer coredumps and successfully converts the string to an\nenumeration.\n\n1. https://github.com/openbmc/phosphor-dbus-interfaces/commit/178cae08d6b79eac7cf3eca963526eeefc53a5af\n2. https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/45005\n\nSigned-off-by: Patrick Williams <patrick@stwcx.xyz>\nChange-Id: I341d3c6ffc0d36e63444c63351012ac487b171ef\n",
    "createdOn": 1626457310,
    "lastUpdated": 1626961903,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1626457310,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1626457355,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626457418,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22178/ : FAILURE"
        },
        {
            "timestamp": 1626457436,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\nI expect this to fail build until https://gerrit.openbmc-project.xyz/c/openbmc/sdbusplus/+/45001/1 is merged."
        },
        {
            "timestamp": 1626457827,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1626457839,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626457905,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22179/ : FAILURE"
        },
        {
            "timestamp": 1626689695,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik@in.ibm.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 2:\n\n(2 comments)\n\nThanks for fixing this! I'll +1 once the CI goes through."
        },
        {
            "timestamp": 1626893236,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1626893272,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1626893275,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626893636,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22487/ : FAILURE"
        },
        {
            "timestamp": 1626897778,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1626897790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626897844,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22489/ : FAILURE"
        },
        {
            "timestamp": 1626897901,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1626897972,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1626897985,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626898330,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/22490/ : FAILURE"
        },
        {
            "timestamp": 1626900925,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1626900955,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626901316,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22494/ : SUCCESS"
        },
        {
            "timestamp": 1626950110,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik@in.ibm.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1626961883,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1626961903,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully merged by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3fa3d5bf02186b25e7ad3fd13943235896556152",
            "parents": [
                "4ccd39603b041099723ffe0389f9f19b6b75f747"
            ],
            "ref": "refs/changes/06/45006/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1626457310,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "649ae66e90fcff7f5bd3ddef839ccddd39a81d70",
            "parents": [
                "4ccd39603b041099723ffe0389f9f19b6b75f747"
            ],
            "ref": "refs/changes/06/45006/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1626457827,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "utils.hpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik@in.ibm.com",
                        "username": "santoshpuranik"
                    },
                    "message": "Should this also include a std::is_enum check on T? I see we'd throw anyway if convert_from_string fails, so maybe not?"
                },
                {
                    "file": "utils.hpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't think the is_enum check is necessary.  In the future we could support additional conversions within sdbusplus and this code should automatically handle them."
                },
                {
                    "file": "utils.hpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "There were test cases that ended up calling this function with an int.  I ended up writing a little helper template to determine if `sdbusplus::message::convert_from_string` exists for the type and if not it will use the default version from 33.  So similar to what you suggested of 'std::is_enum' but a little more robust."
                },
                {
                    "file": "utils.hpp",
                    "line": 88,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik@in.ibm.com",
                        "username": "santoshpuranik"
                    },
                    "message": "Is this return needed?"
                },
                {
                    "file": "utils.hpp",
                    "line": 88,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yes, unfortunately.  Without it the compiler gets upset that the return type is different between 81 and 88 and fails to compile (cannot deduce 'auto' type)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "6fcd934a2da0ca30d292e4abddaa1efb32511a6c",
            "parents": [
                "4ccd39603b041099723ffe0389f9f19b6b75f747"
            ],
            "ref": "refs/changes/06/45006/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1626897778,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 50,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 50,
            "sizeDeletions": 4
        },
        {
            "number": 4,
            "revision": "57d76cd6e553eca7a1cdd860a40c89b286287520",
            "parents": [
                "4ccd39603b041099723ffe0389f9f19b6b75f747"
            ],
            "ref": "refs/changes/06/45006/4",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1626897972,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 49,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 49,
            "sizeDeletions": 4
        },
        {
            "number": 5,
            "revision": "706a9fcc53d2b96393aeb9e829599b2605f92595",
            "parents": [
                "4ccd39603b041099723ffe0389f9f19b6b75f747"
            ],
            "ref": "refs/changes/06/45006/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1626900925,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "utils.hpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 4
        }
    ]
}
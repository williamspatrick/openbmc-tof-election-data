{
    "project": "openbmc/phosphor-virtual-sensor",
    "branch": "master",
    "topic": "Update Severity to be a string",
    "id": "I893877a769eb81e6589ce42a01079816e5493b4f",
    "number": 48571,
    "subject": "thresholds: Update Severity to be a string",
    "owner": {
        "name": "Rashmica K Gupta",
        "email": "rashmica.g@gmail.com",
        "username": "RashmicaG"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-virtual-sensor/+/48571",
    "commitMessage": "thresholds: Update Severity to be a string\n\nThresholds are now strings, so update to treat them as such. However\nstill accept unsigned ints for backwards compatibility.\n\nTested: Used both strings and unsigned ints in severity fields in a\nvirtual sensor config, and we see correct threshold properties and\nbehaviour.\n\nSigned-off-by: Rashmica Gupta <rashmica.g@gmail.com>\nChange-Id: I893877a769eb81e6589ce42a01079816e5493b4f\n",
    "createdOn": 1635932071,
    "lastUpdated": 1639572329,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1635932071,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1635932082,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635932183,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29711/ : SUCCESS"
        },
        {
            "timestamp": 1636020152,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Patch Set 1:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1636044061,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1636068396,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Topic set to Update Severity to be a string"
        },
        {
            "timestamp": 1639027473,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1639043687,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1639043700,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1639043811,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/31660/ : SUCCESS"
        },
        {
            "timestamp": 1639062338,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1639090615,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1639090615,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1639090630,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1639090738,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/31712/ : SUCCESS"
        },
        {
            "timestamp": 1639149627,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1639464515,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1639481670,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1639529079,
            "reviewer": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1639529094,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1639529197,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/32049/ : SUCCESS"
        },
        {
            "timestamp": 1639572324,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1639572329,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully merged by Patrick Williams"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3f0bbde6ac837a14fba2fe14956e4c73a9215112",
            "parents": [
                "333e5bf60cdc34450617994f29901b6b131111fa"
            ],
            "ref": "refs/changes/71/48571/1",
            "uploader": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "createdOn": 1635932071,
            "author": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "README.md",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "virtualSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 21
        },
        {
            "number": 2,
            "revision": "a616b6c6b2e0e70282622036d96941f65237656e",
            "parents": [
                "333e5bf60cdc34450617994f29901b6b131111fa"
            ],
            "ref": "refs/changes/71/48571/2",
            "uploader": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "createdOn": 1639027473,
            "author": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "README.md",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "virtualSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 21
        },
        {
            "number": 3,
            "revision": "cd91b00e2143fe15e5eb013548f75a9f39e52870",
            "parents": [
                "b57d7370815015ce8f04be16cee39c45b0770355"
            ],
            "ref": "refs/changes/71/48571/3",
            "uploader": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "createdOn": 1639043687,
            "author": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "virtualSensor.cpp",
                    "line": 171,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "if (0 == std::ranges::count(threadholdTypes, severity))\n{\n    throw ...\n}"
                },
                {
                    "file": "virtualSensor.cpp",
                    "line": 171,
                    "reviewer": {
                        "name": "Rashmica K Gupta",
                        "email": "rashmica.g@gmail.com",
                        "username": "RashmicaG"
                    },
                    "message": "Nice. Done."
                },
                {
                    "file": "virtualSensor.cpp",
                    "line": 187,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "severity = thresholdTypes.get(getNumberFromConfig<size_t>(propertyMap, \"Severity\", true));\n\nstd::array::get already does bounds checking."
                },
                {
                    "file": "virtualSensor.cpp",
                    "line": 187,
                    "reviewer": {
                        "name": "Rashmica K Gupta",
                        "email": "rashmica.g@gmail.com",
                        "username": "RashmicaG"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "README.md",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "virtualSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 28
        },
        {
            "number": 4,
            "revision": "215bc85023d5abcffca42cc9428f8e2e4f3d4190",
            "parents": [
                "b57d7370815015ce8f04be16cee39c45b0770355"
            ],
            "ref": "refs/changes/71/48571/4",
            "uploader": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "createdOn": 1639090615,
            "author": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "virtualSensor.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "You need to be explicit about using `thresholdTypes.at(sev)` though.  subscript access isn't bounds checked; get access is.\n\nhttps://en.cppreference.com/w/cpp/container/array\n\nI guess I wrote 'get' instead of 'at' in my previous review, which isn't even a valid function on arrays.  Apologies."
                },
                {
                    "file": "virtualSensor.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Rashmica K Gupta",
                        "email": "rashmica.g@gmail.com",
                        "username": "RashmicaG"
                    },
                    "message": "Ah good point. I didn't really stop to think when replying last time.\n\nI was going with an approach of checking if all input is valid, if it isn't throwing an invalid argument type exception, and catching those when creating a sensor. As we probably don't want to crash the whole app from an invalid config, I should add in a catch for out of bounds accesses. \n\nI think it makes more sense to either check if its within range or catch an out of range exception here and then throw an invalid argument exception (that is caught when creating the sensor)-- rather than catching an out of bounds exception elsewhere. What do you think?"
                },
                {
                    "file": "virtualSensor.cpp",
                    "line": 180,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Ah, ok. A catch around the bounds check with a rethrow of a different type is wasteful. Go ahead and do your own bounds check but leave a comment as to why."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "README.md",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "virtualSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 28
        },
        {
            "number": 5,
            "revision": "05b1d41788058cdf255ce1d46b2ff8041abf5656",
            "parents": [
                "b57d7370815015ce8f04be16cee39c45b0770355"
            ],
            "ref": "refs/changes/71/48571/5",
            "uploader": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "createdOn": 1639529079,
            "author": {
                "name": "Rashmica K Gupta",
                "email": "rashmica.g@gmail.com",
                "username": "RashmicaG"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "README.md",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -11
                },
                {
                    "file": "virtualSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 28
        }
    ]
}
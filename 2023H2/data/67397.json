{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "If5c5cc1b8622dc5ce27a065e921e19f57f411ca8",
    "number": 67397,
    "subject": "TEMP: meta-security: Write filenames and signatures into file",
    "owner": {
        "name": "Stefan Berger",
        "email": "stefanb@linux.ibm.com",
        "username": "stefanberger"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/67397",
    "hashtags": [],
    "createdOn": 1698259945,
    "lastUpdated": 1698864042,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1698259945,
            "reviewer": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1698260250,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1698260250,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1698265577,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20331/"
        },
        {
            "timestamp": 1698266829,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20331/ : FAILURE"
        },
        {
            "timestamp": 1698328145,
            "reviewer": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1698328416,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1698328416,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1698333207,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20360/"
        },
        {
            "timestamp": 1698334680,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20360/ : SUCCESS"
        },
        {
            "timestamp": 1698334689,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1698342222,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1698361031,
            "reviewer": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1698361305,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1698361305,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1698365119,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20397/"
        },
        {
            "timestamp": 1698366222,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20397/ : SUCCESS"
        },
        {
            "timestamp": 1698366231,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1698371103,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1698548871,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "mdmii@outlook.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1698619743,
            "reviewer": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1698857398,
            "reviewer": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1698857632,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1698857632,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1698859377,
            "reviewer": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1698860922,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20468/"
        },
        {
            "timestamp": 1698862051,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20468/ : SUCCESS"
        },
        {
            "timestamp": 1698862058,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1698864042,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ba4cf697b087fe4667c758bcdf30fca23b6f9e4c",
            "parents": [
                "d7f4e3ae6bd762959b68e39aac0d0204f7c2743e"
            ],
            "ref": "refs/changes/97/67397/1",
            "uploader": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "createdOn": 1698259945,
            "author": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "07857e45dcf473e137561621344b8c83b7951cdd",
            "parents": [
                "5f6b90013b1937ccd15a1ff9f2427469466bd296"
            ],
            "ref": "refs/changes/97/67397/2",
            "uploader": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "createdOn": 1698328145,
            "author": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "bd1412dde945624f67d575910c8967b799d588a4",
            "parents": [
                "2e8ed2846dcbe47e2721d5ca278ccad6f409980f"
            ],
            "ref": "refs/changes/97/67397/3",
            "uploader": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "createdOn": 1698361031,
            "author": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "line": 103,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "I'm surprised you need to process the output of getfattr --dump with sed; reading the manual pages setfattr takes the output exactly as generated by dump.\n\nAlso, the -R (recursive) option should be much more efficient than using find to invoke for each file individually.  If you need to restrict to files, then use -print0 | xargs -0 to batch the invocations and be safe to unusually named files."
                },
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "line": 103,
                    "reviewer": {
                        "name": "Stefan Berger",
                        "email": "stefanb@linux.ibm.com",
                        "username": "stefanberger"
                    },
                    "message": "Ok, I will the -R option.\nThe output of getfattr normally looks like this:\n\n```\n# file: usr/bin/softhsm2-util\nsecurity.ima=0x0302047c435bb5680030660231009cf469047aef33acdaa37bdcb7e3c0454a870628fae2b587baa48f4e5e2a1ad3484f1c5e866385af713fe4810cdee1d3023100ab07dd24ed72618a50c8bfb79dd2d43da35214e28c45043f5b29517dae7cc8ab50a191cd0abdda29d05618704b12774e\n```\n\nFor line-by-line reading I transform the two lines above to this here, which does allow for breaking the strings apart and account for filenames with spaces or other odd characters:\n\n```\n/usr/bin/softhsm2-util ima:0x0302047c435bb5680030660231009cf46904...\n``` \n\nCode that applies the signature reads the file line-by-line:\n```\n+                while read -r line; do\n+                    fn=${line%% ima:*}\n+                    sig=${line#* ima:}\n+                    setfattr -n security.ima -v \"$sig\" \"$fn\"\n+                done < /run/ima_file_signatures\n```"
                },
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "line": 103,
                    "reviewer": {
                        "name": "Stefan Berger",
                        "email": "stefanb@linux.ibm.com",
                        "username": "stefanberger"
                    },
                    "message": "I posted this patch now on the Yocto mailing list: https://lists.yoctoproject.org/g/yocto/message/61560"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "b87dcbda5eec9c26646fad87d311f798089de597",
            "parents": [
                "223155e3e19d6300f3a9264c3f4c1e04d0c47825"
            ],
            "ref": "refs/changes/97/67397/4",
            "uploader": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "createdOn": 1698857398,
            "author": {
                "name": "Stefan Berger",
                "email": "stefanb@linux.ibm.com",
                "username": "stefanberger"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-security/meta-integrity/classes/ima-evm-rootfs.bbclass",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/openpower-proc-control",
    "branch": "master",
    "id": "I17c208197a9fd08b1a0aca519da4e03813862255",
    "number": 52223,
    "subject": "PHAL: Added non functional boot processor failure handling",
    "owner": {
        "name": "Jayanth Othayoth",
        "email": "ojayanth@gmail.com",
        "username": "ojayanth"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openpower-proc-control/+/52223",
    "hashtags": [],
    "createdOn": 1647943118,
    "lastUpdated": 1697525726,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1647943118,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1647943128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1647943128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1647943193,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/39406/ : SUCCESS"
        },
        {
            "timestamp": 1647971474,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1647972079,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1647999796,
            "reviewer": {
                "name": "Ramesh Iyyar",
                "email": "rameshi1@in.ibm.com",
                "username": "RameshIyyar"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1648007412,
            "reviewer": {
                "name": "MARRI DEVENDER RAO",
                "email": "devenrao@in.ibm.com",
                "username": "devenrao"
            },
            "message": "Patch Set 1: Code-Review-1\n\n(6 comments)"
        },
        {
            "timestamp": 1648035617,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1648035630,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1648035630,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1648035638,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2:\n\n(9 comments)"
        },
        {
            "timestamp": 1648035697,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/39513/ : SUCCESS"
        },
        {
            "timestamp": 1648091277,
            "reviewer": {
                "name": "MARRI DEVENDER RAO",
                "email": "devenrao@in.ibm.com",
                "username": "devenrao"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1648108402,
            "reviewer": {
                "name": "Ramesh Iyyar",
                "email": "rameshi1@in.ibm.com",
                "username": "RameshIyyar"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1648139938,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1648140620,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1648140626,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1648196855,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Uploaded patch set 3: Commit message was updated."
        },
        {
            "timestamp": 1648196855,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1648196934,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1697525726,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "375bf442356d9d414e1ba76b3a3bdf8c7d1f263b",
            "parents": [
                "d7469407ec4d45cc1c1bd3704be18c7ba7ecdcda"
            ],
            "ref": "refs/changes/23/52223/1",
            "uploader": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "createdOn": 1647943118,
            "author": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@in.ibm.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ramesh Iyyar",
                        "email": "rameshi1@in.ibm.com",
                        "username": "RameshIyyar"
                    },
                    "message": "typo? non functional?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "remove"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Done"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 268,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "nit: two words\n\"In case the issue still persists after reboot, recommend replacing the primary processor\""
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 268,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "is this software issue?"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 268,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Done"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 268,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Primary issue may be related to devtree software. and secondary issue might be pdbg probe function is not correctly detecting the primary processor."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Why would we callout the BMC for a non functional processor?"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Ramesh Iyyar",
                        "email": "rameshi1@in.ibm.com",
                        "username": "RameshIyyar"
                    },
                    "message": "> This function adds the BMC code callout as priority 1 to fix devtree related software issue.\n\nWhy we are only caring the device tree related issue for the primary processor error alone? If we need this, is it not the generic callout to handle all device tree related errors (IPL_ERR_ATTR_READ_FAIL, IPL_ERR_ATTR_WRITE)?\n\nI think we need to handle those error codes separately to add callouts instead of mixing here, right?\n\nI am just wondering, how both error code (IPL_ERR_PRI_PROC_NON_FUNC or IPL_ERR_ATTR_READ_FAIL/IPL_ERR_ATTR_WRITE) returns in the flow from the PHAL layer."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "IPL_ERR_PRI_PROC_NON_FUNC error is login incase istep function fail to to find primary processor. For any hardware failure or devtree read/write failure login error separately. Two npossibilty to hit this issue. due to devtree issue primary processor fail to see the functional or pdbg probe is not marked primary processor as non functional. considering use case setting BMC code callout as priority one and hwardware as seconday issue. Usually harwdare failure detects during boot process and adds proper service action ,"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Ramesh Iyyar",
                        "email": "rameshi1@in.ibm.com",
                        "username": "RameshIyyar"
                    },
                    "message": "> For any hardware failure or devtree read/write failure login error separately.\n\nOk, Looks,\n- We are just creating the PEL if the device tree related error without BMC callout \n- For the safe side, we are adding the PEL + callouts (BMC and Primary proc) if the primary processor is failed due to the possibility that you mentioned."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 281,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "struct pdbg_target* procTarget = nullptr?\n\nwhy set the pointer to nullptr for every proc at line 286?"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 281,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "This is to see we got primary processor target. , related to line 289 check"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 281,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "Ack"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 293,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "early return? this way we do not need else condition\nif(!procPTr)\n{\n   return;\n}\n....\n...\n\nsuggestion."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 293,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "The genral direction used here to log error with available data . if we return here , skips the pel cerate function."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 300,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "c++ initalization?\nATTR_LOCATION_CODE_Type locationCode = {'\\0};"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 300,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Ack"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 304,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "I'm surprised the PEL infrastructure doesn't add this for free with the callout?"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 304,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "There's no inventory path to call out in this case, only the location code."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 304,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Done"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 315,
                    "reviewer": {
                        "name": "MARRI DEVENDER RAO",
                        "email": "devenrao@in.ibm.com",
                        "username": "devenrao"
                    },
                    "message": "do we want to continue and add traces to the log even if we have location code exception?"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 315,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "yes we need to create error with available resources."
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 356,
                    "reviewer": {
                        "name": "Ramesh Iyyar",
                        "email": "rameshi1@in.ibm.com",
                        "username": "RameshIyyar"
                    },
                    "message": "typo? functional?"
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "line": 356,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "type": "MODIFIED",
                    "insertions": 71,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 90,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "400a731d84b3c1a7e10ed374428cabe5a82b164c",
            "parents": [
                "d7469407ec4d45cc1c1bd3704be18c7ba7ecdcda"
            ],
            "ref": "refs/changes/23/52223/2",
            "uploader": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "createdOn": 1648035617,
            "author": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@in.ibm.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Please be sure to document new PEL over in PEL registry."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "PEL registry support is already available.  https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-logging/+/51819"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "type": "MODIFIED",
                    "insertions": 69,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 88,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "69708fbb4be11e132b72a2ca6807abc24b01e9f6",
            "parents": [
                "d7469407ec4d45cc1c1bd3704be18c7ba7ecdcda"
            ],
            "ref": "refs/changes/23/52223/3",
            "uploader": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "createdOn": 1648196855,
            "author": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@in.ibm.com",
                "username": ""
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "extensions/phal/phal_error.cpp",
                    "type": "MODIFIED",
                    "insertions": 69,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 88,
            "sizeDeletions": 0
        }
    ]
}
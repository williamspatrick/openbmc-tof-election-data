{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I9032d458f8eb7a0689bee575aae611641bacee26",
    "number": 66298,
    "subject": "Clean up vm CredentialPipe",
    "owner": {
        "name": "Ed Tanous",
        "email": "ed@tanous.net",
        "username": "edtanous"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/66298",
    "hashtags": [],
    "createdOn": 1692914803,
    "lastUpdated": 1695664215,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1692914803,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1692914925,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1692914925,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1692915017,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/73502/ : FAILURE"
        },
        {
            "timestamp": 1692930332,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1692976660,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Commit message was updated.\n\nCopied Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1692976674,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1692976722,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Published edit on patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1692976732,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4: Patch Set 3 was rebased"
        },
        {
            "timestamp": 1692976790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1692976790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1692976880,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/73530/ : FAILURE"
        },
        {
            "timestamp": 1692980340,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1692980381,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1692980381,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1692981578,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/73533/ : SUCCESS"
        },
        {
            "timestamp": 1693428388,
            "reviewer": {
                "name": "Vernon Mauery",
                "email": "vernon.mauery@linux.intel.com",
                "username": "vmauery"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1693435763,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1693591395,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1693591487,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1693591487,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1693592780,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/73708/ : FAILURE"
        },
        {
            "timestamp": 1693593088,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 7.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1693593143,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1693593143,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1693594567,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/73709/ : SUCCESS"
        },
        {
            "timestamp": 1693946851,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1694119023,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1695664210,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 7: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1695664215,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 11e8f60df2fbe1ceafdf886132bd93d112a726bf"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "a6a1883bcf915a5bb3853048d4887cb947654c15",
            "parents": [
                "8b0194b5914a09f9108d503258343a5aee6386b8"
            ],
            "ref": "refs/changes/98/66298/1",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1692914803,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "Testing? Looking for someone? I unfortunately don't have a system I can test this on"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "updated commit message."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -144
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 144
        },
        {
            "number": 2,
            "revision": "3bcc31bf6b5b0498d7af65b4e45d3442adf820cd",
            "parents": [
                "8b0194b5914a09f9108d503258343a5aee6386b8"
            ],
            "ref": "refs/changes/98/66298/2",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1692976660,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -144
                }
            ],
            "sizeInsertions": 67,
            "sizeDeletions": 144
        },
        {
            "number": 3,
            "revision": "4788cb8d7a0109d7dce28fc5ba40d6d2d8516aa1",
            "parents": [
                "8b0194b5914a09f9108d503258343a5aee6386b8"
            ],
            "ref": "refs/changes/98/66298/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1692976722,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -144
                }
            ],
            "sizeInsertions": 67,
            "sizeDeletions": 144
        },
        {
            "number": 4,
            "revision": "3f651202bfd440705e66b69178d18c2af647bc10",
            "parents": [
                "8e73b9064fdd414b9a71806a44f0e0f176b5a88d"
            ],
            "ref": "refs/changes/98/66298/4",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1692976732,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": -144
                }
            ],
            "sizeInsertions": 67,
            "sizeDeletions": 144
        },
        {
            "number": 5,
            "revision": "eb77b22aafc47425db73b92503d03995ab7b4922",
            "parents": [
                "8e73b9064fdd414b9a71806a44f0e0f176b5a88d"
            ],
            "ref": "refs/changes/98/66298/5",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1692980340,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 452,
                    "reviewer": {
                        "name": "Vernon Mauery",
                        "email": "vernon.mauery@linux.intel.com",
                        "username": "vmauery"
                    },
                    "message": "does std::move on a string zero out the source? I am not sure how that works. It is very tricky to get all the passwords zero'd out."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 452,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "it doesn't zero out the source, but it moves the malloced pointer over to be zeroed out later rather than making a copy.  I suspect it very much depends on the implementation of string on what it does.  I guess we could also explicit_bzero username.data() and password.data() just to be sure?  I wonder if we should be doing\n\nexplicit_bzero(username.data(), username.capacity()) instead of using size?\n\n\nFWIW, the password exists in more buffers than just here.  Zeroing out here I suspect doesn't actually do anything, as several copies of the password string are made over the course of reading in the request (like in the json payload) in buffers that aren't zeroed out.\n\nIf you have any ideas on how this could be done better, I'm open to them."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 452,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I would also point out that std::move was also what the old code did (line 457) so this either works, or we are just as broken as we were before."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 452,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Vernon, does this work for you?"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 452,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 479,
                    "reviewer": {
                        "name": "Vernon Mauery",
                        "email": "vernon.mauery@linux.intel.com",
                        "username": "vmauery"
                    },
                    "message": "What about buffer? does async_write zero it?\n\n        // Add +1 to ensure that the null terminator is included.\n        std::array<boost::asio::const_buffer, 2> buffer{\n            {{user.data(), user.size() + 1}, {pass.data(), pass.size() + 1}}};\n        boost::asio::async_write(impl, buffer,\n              [hndlr{std::forward<WriteHandler>}, &buffer] (const boost::system::error_code& ec, std::size_t s)\n              {\n                  explicit_bzero(buffer.data(), buffer.size());\n                  hndlr(ec, s);\n              });\n    }"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 479,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "\"buffer\" doesn't actually contain the password data, it contains two pointers to the std::strings that contain the password data, because it's using scatter gather IO to avoid having to copy into a common buffer like the old way did, there's no real need to securely clean up buffer, because the data structure never contained the data.\n\nThe password likely exists in some kernel buffers along the way, but I'm not sure there's much we can do about that."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 45,
                    "deletions": -144
                }
            ],
            "sizeInsertions": 69,
            "sizeDeletions": 144
        },
        {
            "number": 6,
            "revision": "3d9dfd978b956d745cc576f9fd8763b0da50f375",
            "parents": [
                "7ead48e61a7b507eb187933d9497ed9b31e4401f"
            ],
            "ref": "refs/changes/98/66298/6",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1693591395,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "test/include/credential_pipe_test.cpp",
                    "type": "ADDED",
                    "insertions": 41,
                    "deletions": 0
                },
                {
                    "file": "include/credential_pipe.hpp",
                    "type": "ADDED",
                    "insertions": 54,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -165
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 144,
            "sizeDeletions": 165
        },
        {
            "number": 7,
            "revision": "aa74768a5993e83ac1f49a2da2199e99bdcc1a46",
            "parents": [
                "7ead48e61a7b507eb187933d9497ed9b31e4401f"
            ],
            "ref": "refs/changes/98/66298/7",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1693593088,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "test/include/credential_pipe_test.cpp",
                    "type": "ADDED",
                    "insertions": 41,
                    "deletions": 0
                },
                {
                    "file": "include/credential_pipe.hpp",
                    "type": "ADDED",
                    "insertions": 52,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -165
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 142,
            "sizeDeletions": 165
        },
        {
            "number": 8,
            "revision": "11e8f60df2fbe1ceafdf886132bd93d112a726bf",
            "parents": [
                "b25644a1ae3bbf00ddea91ad494be959cb2632c8"
            ],
            "ref": "refs/changes/98/66298/8",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1695664215,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "test/include/credential_pipe_test.cpp",
                    "type": "ADDED",
                    "insertions": 41,
                    "deletions": 0
                },
                {
                    "file": "include/credential_pipe.hpp",
                    "type": "ADDED",
                    "insertions": 52,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -165
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 142,
            "sizeDeletions": 165
        }
    ]
}
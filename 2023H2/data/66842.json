{
    "project": "openbmc/entity-manager",
    "branch": "master",
    "id": "Ia63c01bc303fa3104a48720382bc899d5d0e5f9c",
    "number": 66842,
    "subject": "topology: Add support for LocationCode",
    "owner": {
        "name": "Willy Tu",
        "email": "wltu@google.com",
        "username": "wltu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/entity-manager/+/66842",
    "hashtags": [],
    "createdOn": 1696010066,
    "lastUpdated": 1696283145,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1696010066,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1696010103,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1696010103,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1696010122,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/74598/ : FAILURE"
        },
        {
            "timestamp": 1696010146,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1696010158,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1696010158,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1696010179,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/74599/ : FAILURE"
        },
        {
            "timestamp": 1696011028,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1696011043,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1696011043,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1696011048,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 4: Published edit on patch set 3."
        },
        {
            "timestamp": 1696011067,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1696011067,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1696011068,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/74601/ : ABORTED"
        },
        {
            "timestamp": 1696011511,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/74602/ : SUCCESS"
        },
        {
            "timestamp": 1696014257,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1696019067,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1696027822,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1696057645,
            "reviewer": {
                "name": "Smriti-Ayushi",
                "email": "smriti.ayushi@linux.intel.com",
                "username": "Smriti-Ayushi"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1696283145,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4: Code-Review-1\n\n(2 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "57fda8a8780a5b4ddac2d7571af13bc371d34037",
            "parents": [
                "0422a24bb6033605ce75479f675fedc76abb1167"
            ],
            "ref": "refs/changes/42/66842/1",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1696010066,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 40,
                    "deletions": 0
                },
                {
                    "file": "src/entity_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 32,
                    "deletions": -9
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 136,
            "sizeDeletions": 9
        },
        {
            "number": 2,
            "revision": "5a247543c442f6e27bd17c166f8bb91741baf905",
            "parents": [
                "0422a24bb6033605ce75479f675fedc76abb1167"
            ],
            "ref": "refs/changes/42/66842/2",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1696010146,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 40,
                    "deletions": 0
                },
                {
                    "file": "src/entity_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -8
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 131,
            "sizeDeletions": 8
        },
        {
            "number": 3,
            "revision": "de3f316b47c77fdce61d0e5d0f90e58eec02c3a9",
            "parents": [
                "0422a24bb6033605ce75479f675fedc76abb1167"
            ],
            "ref": "refs/changes/42/66842/3",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1696011028,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 40,
                    "deletions": 0
                },
                {
                    "file": "src/entity_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 123,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "2c8ac414981deae20141c993b0414f049f3afd08",
            "parents": [
                "0422a24bb6033605ce75479f675fedc76abb1167"
            ],
            "ref": "refs/changes/42/66842/4",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1696011048,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Can you add in here what (redfish?) code is going to look at this?\n\nThings are going to get interesting, because we (IBM) are going to only need the location code interface on the upstream connector/slot. For example we'll need to associate a slot with its fault LED right next to the connector and be able to light it based on the location code even if the slot is empty, like for a missing DIMM that should be present.\n\n(Our location codes are also hierarchical, and built up as segments based on the plugging, so eventually I'll need to add in code here to handle that as well.)"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "It will used by something like\n- https://gerrit.openbmc.org/c/openbmc/bmcweb/+/50016\n- https://gerrit.openbmc.org/c/openbmc/bmcweb/+/51879\n\nIn our usecase, the device itself will have the LocationCode directly. It won't look at the upstream connector for it. That is don't because there can be multiple devices connect to the same slot, so this way we can uniquely identify the downstream ports instead of all of them having the upstream ports' location."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "\"there can be multiple devices connect to the same slot\"\n You just mean there are multiple types of devices, of which only one will be present at a time, right?  Because I'd say by definition a slot should only have one entity in it at a time, otherwise you could just have 2 slots.\n \nLooking at https://gerrit.openbmc.org/c/openbmc/bmcweb/+/51879, it looks like the code is looking for the LocationCode interface on the same object path as the Inventory.Item.Cpu object, which isn't the connector.\n\nso what if you put the interface on the entity itself?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "lgtm"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Smriti-Ayushi",
                        "email": "smriti.ayushi@linux.intel.com",
                        "username": "Smriti-Ayushi"
                    },
                    "message": "Changes look good to me."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "just giving it a -1 so it doesn't merge until we discuss more."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 40,
                    "deletions": 0
                },
                {
                    "file": "src/entity_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 122,
            "sizeDeletions": 0
        }
    ]
}
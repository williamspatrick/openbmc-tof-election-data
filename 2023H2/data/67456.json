{
    "project": "openbmc/phosphor-led-manager",
    "branch": "master",
    "id": "I75b59a12dde417a9ccadaf25b2af07fc33186a01",
    "number": 67456,
    "subject": "Persistence the led group asserted value by default",
    "owner": {
        "name": "George Liu",
        "email": "liuxiwei@ieisystem.com",
        "username": "lxwinspur"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-led-manager/+/67456",
    "hashtags": [],
    "createdOn": 1698633575,
    "lastUpdated": 1698845438,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1698633575,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1698633606,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1698633606,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1698633840,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1698633861,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1698633861,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1698633863,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/75558/ : ABORTED"
        },
        {
            "timestamp": 1698633979,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/75559/ : SUCCESS"
        },
        {
            "timestamp": 1698675265,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1698712873,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1698761567,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1698845436,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1698845438,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d04662a25d4d733e220b8ebfb49b7bb6b0476f08",
            "parents": [
                "605600eb66911549e292ce06f11039298d23502c"
            ],
            "ref": "refs/changes/56/67456/1",
            "uploader": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "createdOn": 1698633575,
            "author": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "manager/group.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "manager/group.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -1
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "manager/led-main.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 61,
            "sizeDeletions": 16
        },
        {
            "number": 2,
            "revision": "5467185344a5a8c327d0c860ded34b51d939b6d6",
            "parents": [
                "605600eb66911549e292ce06f11039298d23502c"
            ],
            "ref": "refs/changes/56/67456/2",
            "uploader": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "createdOn": 1698633840,
            "author": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "So if your BMC reboots at runtime with some groups asserted and LEDs on, and the GPIO driver chips still hold their values, the LEDs will be on, the physical LED objects will be On, won't the groups be out of sync?  Or do you have code that runs that turns off all the LEDs?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "> So if your BMC reboots at runtime with some groups asserted and LEDs on, and the GPIO driver chips still hold their values, the LEDs will be on, the physical LED objects will be On, won't the groups be out of sync? \n\nWhether BMC is a hot reboot or a cold reboot, we do not need persistence because:\n1. Reset all physical LEDs to off state and will not perform persistent LED actions.\n2. Some monitoring processes monitor all faults, including reading the value of the GPIO driver chip\n3. If the fault is still present, the LED is retriggered.\n4. Our dimension of whether persistence is required is not the LED, but the fault so that we will persist some special faults. These faults will be restored after booting again, and then the Asserted of the corresponding group will be triggered and the LED will light up.\n\nThere is a problem when the persistence group is asserted:\n1. When the BMC is cold rebooted and the previous fault has been restored, the ledManager will still restore the asserted of the corresponding group. Currently, the LED status will be inconsistent with the actual status.\n2. If there is logic for sensor warning and LED triggering, can the persistence function satisfy the situation where multiple sensors hold a group of LED groups simultaneously?\n\n> Or do you have code that runs that turns off all the LEDs?\n\nIn our BMC, whether we control physical LEDs through GPIO or CPLD, we will initialize all physical LEDs to off when the BMC starts and listen for sensor (discrete & threshold) faults again."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Thanks for the explanation!"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "manager/group.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -9
                },
                {
                    "file": "manager/group.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -1
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "manager/led-main.cpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 16
        }
    ]
}
{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "I20ac5b9935acf7d805dceec029fe5b30374a5532",
    "number": 67991,
    "subject": "meta-facebook: yosemite4: add mctp service conf",
    "owner": {
        "name": "DelphineCCChiu",
        "email": "Delphine_CC_Chiu@wiwynn.com",
        "username": "DelphineCCChiu"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/67991",
    "hashtags": [],
    "createdOn": 1702275707,
    "lastUpdated": 1702405962,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1702275707,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1702275791,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1702275791,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1702275800,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20899/"
        },
        {
            "timestamp": 1702276422,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20899/ : FAILURE"
        },
        {
            "timestamp": 1702279945,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1702280011,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1702280011,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1702280020,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20902/"
        },
        {
            "timestamp": 1702280617,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20902/ : SUCCESS"
        },
        {
            "timestamp": 1702280627,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1702281977,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1702304347,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(4 comments)"
        },
        {
            "timestamp": 1702365517,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1702365579,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1702365579,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1702365586,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20912/"
        },
        {
            "timestamp": 1702365940,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1702365987,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1702365988,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1702365989,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20912/ : ABORTED"
        },
        {
            "timestamp": 1702365996,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/20913/"
        },
        {
            "timestamp": 1702366611,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/20913/ : SUCCESS"
        },
        {
            "timestamp": 1702366621,
            "reviewer": {
                "name": "Jenkins OpenBMC Google",
                "email": "haojenkinsg00gle@gmail.com",
                "username": "jenkins-openbmc-g00gle"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nGoogle Internal CI : Google internal tests successfully started"
        },
        {
            "timestamp": 1702366717,
            "reviewer": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1702367956,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1702397963,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1702397965,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1702397969,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 99be5bc3ebfb3d314baf3cf553b47be53e296de6"
        },
        {
            "timestamp": 1702405962,
            "reviewer": {
                "name": "Amithash Prasad",
                "email": "amithash@meta.com",
                "username": "amithash"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0db67b0f6d28e87be89e4e7d949628cc71b76708",
            "parents": [
                "90ae8f350bec35f960e9c10573148dadc22c7c72"
            ],
            "ref": "refs/changes/91/67991/1",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1702275707,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/mctp_%.bbappend",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/setup-local-eid.service",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 59,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "b10962a2d0efdc39bb3b97d871466e547af98722",
            "parents": [
                "90ae8f350bec35f960e9c10573148dadc22c7c72"
            ],
            "ref": "refs/changes/91/67991/2",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1702279945,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "line": 5,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Can we get comments as to what these are setting up?  What are on busses 0-6?  (isn't it `-le 8`?)?  I assume these are the 8 slots."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "line": 5,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Added comments in the file. This is for setting up mctp link and mctp local address. The Sentinel Dome BICs are on the i2c bus0 to bus7. It is `-le 7`, `-le` means `<=`."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "line": 13,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Same here?  What are on busses 24-26?  (is it `-le 28`?).  I assume these are the 4 NICs."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "line": 13,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Same as above. The NICs are on the bus24 to bus27."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/setup-local-eid.service",
                    "line": 7,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Is there any kind of dependency with the `mctpd`?  Should this be done as an ExecStartPre on the `mctpd` by installing a config extension into `mctpd.service.d` (or something like that)."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/setup-local-eid.service",
                    "line": 7,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Agree. Made it as a conf for `mctpd`."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/mctp_%.bbappend",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "nit: mctp is in recipes-networking and not recipes-phosphor"
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/mctp_%.bbappend",
                    "line": 0,
                    "reviewer": {
                        "name": "DelphineCCChiu",
                        "email": "Delphine_CC_Chiu@wiwynn.com",
                        "username": "DelphineCCChiu"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/mctp_%.bbappend",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/setup-local-eid.service",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "0ba7a4a00bd7e41a6d9e06afcad2b4e2609ac337",
            "parents": [
                "90ae8f350bec35f960e9c10573148dadc22c7c72"
            ],
            "ref": "refs/changes/91/67991/3",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1702365517,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/mctp_%.bbappend",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/mctp-config.sh",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/mctp/files/setup-local-eid.conf",
                    "type": "ADDED",
                    "insertions": 8,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "28042636d4332d6b64984b99901611cb48131846",
            "parents": [
                "90ae8f350bec35f960e9c10573148dadc22c7c72"
            ],
            "ref": "refs/changes/91/67991/4",
            "uploader": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "createdOn": 1702365940,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/files/setup-local-eid.conf",
                    "line": 8,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Do we need these?  If so, should we contribute them up to the original mctpd.service file?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/mctp_%.bbappend",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/files/mctp-config.sh",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/files/setup-local-eid.conf",
                    "type": "ADDED",
                    "insertions": 8,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "99be5bc3ebfb3d314baf3cf553b47be53e296de6",
            "parents": [
                "f31b5c6dbb263370fa657ce9f29ffe80748a95c7"
            ],
            "ref": "refs/changes/91/67991/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1702397969,
            "author": {
                "name": "DelphineCCChiu",
                "email": "Delphine_CC_Chiu@wiwynn.com",
                "username": "DelphineCCChiu"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/files/mctp-config.sh",
                    "line": 8,
                    "reviewer": {
                        "name": "Amithash Prasad",
                        "email": "amithash@meta.com",
                        "username": "amithash"
                    },
                    "message": "Instead of a while loop and handling each hole explicitly, I would just loop over a list of required busses\n```\n#!/bin/bash\nmctp_busses=(0 1 2 3 4 5 6 7 24 25 26 27)\nfor busnum in ${mctp_busses[@]}; do\n  mctp link set mctpi2c${busnum} up\n  mctp addr add ${localEid} dev mctpi2c${busnum}\ndone\n```"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/mctp_%.bbappend",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/files/mctp-config.sh",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-networking/mctp/files/setup-local-eid.conf",
                    "type": "ADDED",
                    "insertions": 8,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 64,
            "sizeDeletions": 0
        }
    ]
}
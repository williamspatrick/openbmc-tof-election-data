{
    "project": "openbmc/entity-manager",
    "branch": "master",
    "id": "Iad10e61417437a41628cf311cdd7893725a5dcde",
    "number": 68030,
    "subject": "topology: Add powered_by topology",
    "owner": {
        "name": "Jeff Lin",
        "email": "JeffLin2@quantatw.com",
        "username": "JinFuLin"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/entity-manager/+/68030",
    "hashtags": [],
    "createdOn": 1701401079,
    "lastUpdated": 1702312311,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1701401079,
            "reviewer": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1701401109,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701401110,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1701401130,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/76711/ : FAILURE"
        },
        {
            "timestamp": 1701403100,
            "reviewer": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701403120,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701403120,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1701403143,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/76712/ : FAILURE"
        },
        {
            "timestamp": 1701404072,
            "reviewer": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701404099,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701404100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1701404354,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/76713/ : SUCCESS"
        },
        {
            "timestamp": 1701704045,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1701731467,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1701773899,
            "reviewer": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1701915229,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1702030945,
            "reviewer": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1702030954,
            "reviewer": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1702312311,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "6bb8fc362e2a42f45fd53c6713602d3b2d5f6e3b",
            "parents": [
                "e41b5cbcf53411ed9d40f056064bb1a251f4bb73"
            ],
            "ref": "refs/changes/30/68030/1",
            "uploader": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "createdOn": 1701401079,
            "author": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 88,
                    "deletions": 0
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -6
                },
                {
                    "file": "test/test_topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 221,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 346,
            "sizeDeletions": 12
        },
        {
            "number": 2,
            "revision": "1d112e8cab2d7f0f87597943c742a4dfeefbe381",
            "parents": [
                "e41b5cbcf53411ed9d40f056064bb1a251f4bb73"
            ],
            "ref": "refs/changes/30/68030/2",
            "uploader": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "createdOn": 1701403100,
            "author": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 88,
                    "deletions": 0
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -6
                },
                {
                    "file": "test/test_topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 215,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 340,
            "sizeDeletions": 12
        },
        {
            "number": 3,
            "revision": "2a0e82d3810c2b2ded7e4b3ccbcb7d3937d0d52e",
            "parents": [
                "e41b5cbcf53411ed9d40f056064bb1a251f4bb73"
            ],
            "ref": "refs/changes/30/68030/3",
            "uploader": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "createdOn": 1701404072,
            "author": {
                "name": "Jeff Lin",
                "email": "JeffLin2@quantatw.com",
                "username": "JinFuLin"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 22,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Have the Type and Name the same is confusing"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 22,
                    "reviewer": {
                        "name": "Jeff Lin",
                        "email": "JeffLin2@quantatw.com",
                        "username": "JinFuLin"
                    },
                    "message": "I update the config as following:\nIn mobo json:\n```\n        {\n            \"Name\": \"MOBO Port\",\n            \"Type\": \"MOBO Port\"\n        },\n        {\n            \"PoweredByType\": \"PSU Port\",\n            \"Name\": \"MOBO to PSU Port\",\n            \"Type\": \"PoweredPort\"\n        },\n```\nIn PSU json:\n```\n        {\n            \"ConnectsToType\": \"MOBO Port\",\n            \"Name\": \"PSU to MOBO Port\",\n            \"Type\": \"DownstreamPort\"\n        },\n        {\n            \"Name\": \"PSU Port\",\n            \"Type\": \"PSU Port\"\n        },\n```\nAnd the result is not change."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 38,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "would this just always follow the upstream port?  If so, we could just combine it into the upstream one with a new bool property, like 'ProvidesPower: true' or something like that.\n\nI suppose that would require that the PSs always connect to the chassis..."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 38,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Another way to do it is to just identify an entity as a power provider, and then the code could follow the physical topology and create the associations on the path up, like PS -> power-dist-board -> chassis, or more likely I suppose PS -> chassis.\n\nI have a long term goal of having the Topology class actually build a tree of objects that follows the upstream/downstream connectors, so it'd be easy to traverse."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 38,
                    "reviewer": {
                        "name": "Jeff Lin",
                        "email": "JeffLin2@quantatw.com",
                        "username": "JinFuLin"
                    },
                    "message": ">would this just always follow the upstream port? If so, we could just combine it into the upstream one with a new bool property, like 'ProvidesPower: true' or something like that.\n>\n>I suppose that would require that the PSs always connect to the chassis...\n\nYeah, that was what I implement at first because our platform only have one power supply per chassis, so we can use a variable to record the board path of power supply to create powered_by association.\n\nBut I think it might be better to make more flexible to push to upstream, so that people can easily create the complex association as there requirement.\n\nThis patch can make the power association not to forcely bind to upstream port.\n\n>Another way to do it is to just identify an entity as a power provider, and then the code could follow the physical topology and create the associations on the path up, like PS -> power-dist-board -> chassis, or more likely I suppose PS -> chassis.\n\nIt sounds like use a special json to define pysical topology and the write new code to create new topology.\nI suspect this might have lot of duplicate code with topology today.\n\n>I have a long term goal of having the Topology class actually build a tree of objects that follows the upstream/downstream connectors, so it'd be easy to traverse.\n\nI think the connectors is not that complex for now to require a tree, but maybe it is a good try."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 38,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Same here, have the Type and Name the same here is confusing. Is this a new Type that needs to be added to one of the schema?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 38,
                    "reviewer": {
                        "name": "Jeff Lin",
                        "email": "JeffLin2@quantatw.com",
                        "username": "JinFuLin"
                    },
                    "message": "The string of the \"Type\" for topology is not a fixed name, this Type only required to be equal to the string in \"ConnectsToType\" in specific config.\n\nI think it might be better to do what Matt mentioned in previous commit that add some label like ```'ProvidesPower: true' ``` with ConnectsToType to achieve our purpose.\n\nI will work on it."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 38,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I was thinking about this some more, and am OK with either way.\n\nWe had a system from a previous generation where there was a manager chassis and a compute chassis which is what had the power supplies.  So there was a cable from the compute chassis to the  manager chassis to power it, meaning the power didn't follow the typical connector plugging topology unless something new was invented for cables.  So just having the ports like you did in this commit would work easier there (not that we need to support that exact system anymore of course)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 88,
                    "deletions": 0
                },
                {
                    "file": "src/topology.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -6
                },
                {
                    "file": "test/test_topology.cpp",
                    "type": "MODIFIED",
                    "insertions": 214,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 339,
            "sizeDeletions": 12
        }
    ]
}
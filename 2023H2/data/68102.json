{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I0bcd381a9e3c9a1e8e6dc39534e81fa698570689",
    "number": 68102,
    "subject": "Simplify mutual TLS checks",
    "owner": {
        "name": "Ed Tanous",
        "email": "ed@tanous.net",
        "username": "edtanous"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/68102",
    "hashtags": [],
    "createdOn": 1701821150,
    "lastUpdated": 1702076379,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1701821150,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1701821206,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701821206,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1701821637,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1701822340,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/76834/ : SUCCESS"
        },
        {
            "timestamp": 1701849241,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1701854140,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1701878562,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1701881436,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1701882847,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Published edit on patch set 1.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701882878,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701882950,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701882950,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1701883145,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/76878/ : FAILURE"
        },
        {
            "timestamp": 1701883832,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701892122,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701892362,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701893309,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701904921,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701905830,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701905909,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701905909,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1701905922,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1701906333,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/76883/ : FAILURE"
        },
        {
            "timestamp": 1701906613,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701906654,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701906654,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1701906814,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1701907104,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1701908214,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/76884/ : FAILURE"
        },
        {
            "timestamp": 1701960897,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701960993,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701960993,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1701961023,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1701962068,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/76902/ : SUCCESS"
        },
        {
            "timestamp": 1701968044,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1701968066,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1701981949,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6: Patch Set 5 was rebased\n\nCopied Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1701982000,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1701982000,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1701982069,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/76929/ : FAILURE"
        },
        {
            "timestamp": 1702011651,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 7: Published edit on patch set 6.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1702011732,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1702011732,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1702012813,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/76959/ : SUCCESS"
        },
        {
            "timestamp": 1702046736,
            "reviewer": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1702055455,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 8: Patch Set 7 was rebased\n\nCopied Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1702055472,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 8: Code-Review+2"
        },
        {
            "timestamp": 1702055532,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1702055532,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: -Ok-To-Test"
        },
        {
            "timestamp": 1702056633,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/76984/ : SUCCESS"
        },
        {
            "timestamp": 1702076379,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 23f1c96e6bc9060b54ff08a6b4d6cf8b8e0c3b23"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "793f844475133c7798b8e5e345977cade1b550bf",
            "parents": [
                "ec5198af219b97eb4272fea28ee8ae7c72cedcd6"
            ],
            "ref": "refs/changes/02/68102/1",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1701821150,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "To those reviewing, this is the code that openssl is running:\n\nhttps://github.com/openssl/openssl/blob/de8e0851a1c0d22533801f081781a9f0be56c2c2/crypto/x509/v3_purp.c#L712\n\nThe only differences in flow are that it checked extended key usage first, takes the OR of KU_DIGITAL_SIGNATURE/KU_KEY_AGREEMENT instead of the AND (Which is the bug we actually hit)\n\nand checks that the NS_SSL_CLIENT is set, which I think we should've been doing anyway."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "I'm getting a 401 while testing this change with `scripts/generate_auth_certificates.py` as compared to the parent revision (ec5198af219b97eb4272fea28ee8ae7c72cedcd6):\n\n```\npython3 scripts/generate_auth_certificates.py --host localhost:8443 \n...\nEnsuring TLS authentication is enabled.\nSuccessfully enabled TLS authentication.\nTesting redfish TLS authentication with generated certs.\nTraceback (most recent call last):\n  File \"/repos/bmcweb/scripts/generate_auth_certificates.py\", line 289, in <module>\n    main()\n  File \"/repos/bmcweb/scripts/generate_auth_certificates.py\", line 261, in main\n    response.raise_for_status()\n  File \"/usr/local/lib/python3.11/dist-packages/requests/models.py\", line 1021, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://localhost:8443/redfish/v1/SessionService/Sessions\n```\n\nComparing `journalctl -f` output, there's an `Authentication failed` message when running a romulus qemu image with the change:\n```\nromulus bmcweb[209]: [INFO http_connection.hpp:249] Request:  0x1072740 HTTP/1.1 GET /redfish/v1/SessionService/Sessions ::1\nromulus bmcweb[209]: [WARNING http_connection.hpp:272] Authentication failed\n```\n\nReference ec5198af219b97eb4272fea28ee8ae7c72cedcd6 (OK):\n```\nromulus bmcweb[209]: [INFO http_connection.hpp:249] Request:  0x1fcb740 HTTP/1.1 GET /redfish/v1/SessionService/Sessions ::1\nromulus bmcweb[209]: [INFO complete_response_fields.hpp:23] Response:  /redfish/v1/SessionService/Sessions 200\n```"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "I don't think this is meant to be resolved"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "Done"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "I think the check here needs to be `X509_check_purpose(...) != 1` instead:\n\nhttps://github.com/openssl/openssl/blob/master/crypto/x509/v3_purp.c#L84"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "`scripts/generate_auth_certificates.py` works with the `!= 1` check, let me try with a prod Meta certificate"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Weird..... I wonder why the unit tests passed....\n\nFixed."
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "I was stepping through the unit test failure with `gdb`, seems `X509_check_purpose()` is returning -1 due to `x->ex_flags & EXFLAG_NO_FINGERPRINT` in this line, not sure if it helps:\n\nhttps://github.com/openssl/openssl/blob/openssl-3.0.10/crypto/x509/v3_purp.c#L630\n\n```\n(gdb) p x->ex_flags & 0x100000\n$3 = 1048576\n\n(gdb) bt\n#0  ossl_x509v3_cache_extensions (x=x@entry=0x55fba9b4d2b0) at ../crypto/x509/v3_purp.c:630\n#1  0x00007f8560783db5 in X509_check_purpose (x=0x55fba9b4d2b0, id=1, require_ca=0) at ../crypto/x509/v3_purp.c:86\n#2  0x000055fba9b26f42 in verifyMtlsUser (clientIp=..., ctx=...) at ../http/mutual_tls.hpp:63\n...\n```"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Yeah, this patchset doesn't really work with the unit tests I wrote.  We could try it, but there's something in the x509 cert store that I'm not initing properly, and I don't have time to debug it.  oh well."
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "Yeah, seems `X509_check_purpose()` is checking for some fields we're setting in `generate_auth_certificates.py` but not in the unit tests.\n\nLet me try tweaking the unit tests a bit, will let you know how it goes"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I chased the call stack as far as these two functions failing:\nhttps://github.com/openssl/openssl/blob/f529a2eb75374946b60ed686ca6f90fdf244e787/crypto/x509/x_all.c#L589\nhttps://github.com/openssl/openssl/blob/f529a2eb75374946b60ed686ca6f90fdf244e787/crypto/asn1/a_digest.c#L54"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "OK, was able to make the test error go away by signing the cert (this might be relevant to the other tests, not sure if worth integrating with the `OSSLX509` class):\n\n```\ndiff --git a/test/http/mutual_tls.cpp b/test/http/mutual_tls.cpp\nindex a08c81d2..a9bf4c6d 100644\n--- a/test/http/mutual_tls.cpp\n+++ b/test/http/mutual_tls.cpp\n@@ -56,6 +56,18 @@ TEST(MutualTLS, GoodCert)\n {\n     OSSLX509 x509;\n \n+    // Generate test key\n+    EVP_PKEY *pkey = NULL;\n+    EVP_PKEY_CTX *pctx = EVP_PKEY_CTX_new_id(EVP_PKEY_EC, NULL);\n+    ASSERT_EQ(EVP_PKEY_keygen_init(pctx), 1);\n+    ASSERT_EQ(EVP_PKEY_CTX_set_ec_paramgen_curve_nid(pctx, NID_X9_62_prime256v1), 1);\n+    ASSERT_EQ(EVP_PKEY_keygen(pctx, &pkey), 1);\n+    EVP_PKEY_CTX_free(pctx);\n+\n+    // Sign cert with key\n+    ASSERT_EQ(X509_set_pubkey(x509.get(), pkey), 1);\n+    ASSERT_GT(X509_sign(x509.get(), pkey, EVP_sha256()), 0);\n+\n     X509_NAME* name = X509_get_subject_name(x509.get());\n     std::array<unsigned char, 5> user = {'u', 's', 'e', 'r', '\\0'};\n     X509_NAME_add_entry_by_txt(name, \"CN\", MBSTRING_ASC, user.data(), -1, -1,\n```"
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Weird, I had that in one of my earlier tests, I just removed it because it didn't seem necessary.  I pushed the fix, integrating it with the x509 class.\n\nI'm still looking for some indication that this patchset solves your issue.  It seems simpler than adding an option, and doesn't have us relying on our own code to do checks, but I'm happy to discuss if meta prod certs still don't work."
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "line": 63,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "Just tested with Meta prod certs, it's working \ud83d\udc4d"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 21,
            "sizeDeletions": 64
        },
        {
            "number": 2,
            "revision": "10c799635de89854f6aa8ff129053e35055624a9",
            "parents": [
                "ec5198af219b97eb4272fea28ee8ae7c72cedcd6"
            ],
            "ref": "refs/changes/02/68102/2",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1701882847,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 21,
            "sizeDeletions": 64
        },
        {
            "number": 3,
            "revision": "bd3f6d4cf1526c3b03037ca803078d98d7ad17e4",
            "parents": [
                "ec5198af219b97eb4272fea28ee8ae7c72cedcd6"
            ],
            "ref": "refs/changes/02/68102/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1701905830,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -52
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 54,
            "sizeDeletions": 116
        },
        {
            "number": 4,
            "revision": "c050bbc832364b30d80d49d3bf119b4b1098a8d3",
            "parents": [
                "ec5198af219b97eb4272fea28ee8ae7c72cedcd6"
            ],
            "ref": "refs/changes/02/68102/4",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1701906613,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -52
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 54,
            "sizeDeletions": 116
        },
        {
            "number": 5,
            "revision": "75a4bb6cb0039627722a0146de08924f62554da2",
            "parents": [
                "ec5198af219b97eb4272fea28ee8ae7c72cedcd6"
            ],
            "ref": "refs/changes/02/68102/5",
            "uploader": {
                "name": "Marco Kawajiri",
                "email": "kawajiri@meta.com",
                "username": "kawmarco"
            },
            "createdOn": 1701960897,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can you please review the patchset previous to this one?"
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "line": 46,
                    "reviewer": {
                        "name": "Marco Kawajiri",
                        "email": "kawajiri@meta.com",
                        "username": "kawmarco"
                    },
                    "message": "Added this `EVP_PKEY_free()` call, unit tests and `valgrind` pass, let's see if CI goes through"
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "line": 46,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "\ud83d\udc4d"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -52
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 116
        },
        {
            "number": 6,
            "revision": "b914b54cb40334d2458013a2da398b2a70ebf70b",
            "parents": [
                "18215bb42bec8a7f4bd6adfa9168b6b5cf8afd2a"
            ],
            "ref": "refs/changes/02/68102/6",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1701981949,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -52
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 116
        },
        {
            "number": 7,
            "revision": "e6d8113867262fe2cff404ae6597a413bb42f49a",
            "parents": [
                "18215bb42bec8a7f4bd6adfa9168b6b5cf8afd2a"
            ],
            "ref": "refs/changes/02/68102/7",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1702011651,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -54
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 58,
            "sizeDeletions": 118
        },
        {
            "number": 8,
            "revision": "3ba00f39bec28abc8ee9fd464432b19b4896141e",
            "parents": [
                "0b403fce0c0696908fe7306107c6cada05c6f646"
            ],
            "ref": "refs/changes/02/68102/8",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1702055455,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -52
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 116
        },
        {
            "number": 9,
            "revision": "23f1c96e6bc9060b54ff08a6b4d6cf8b8e0c3b23",
            "parents": [
                "e79239970c3701f12903e8ac1574b9210b69aebc"
            ],
            "ref": "refs/changes/02/68102/9",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1702076379,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "test/http/mutual_tls.cpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -52
                },
                {
                    "file": "http/mutual_tls.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -64
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 116
        }
    ]
}
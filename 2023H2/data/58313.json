{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "Ic34dff82df84b45967f0abff85f0109afbb0b5a2",
    "number": 58313,
    "subject": "docs: add a design doc for Redfish OAuth",
    "owner": {
        "name": "Nan Zhou",
        "email": "nanzhoumails@gmail.com",
        "username": "FighterNan"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/58313",
    "hashtags": [],
    "createdOn": 1667235535,
    "lastUpdated": 1700882317,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1667235535,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1667235596,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1667235596,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1667235614,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/54401/ : SUCCESS"
        },
        {
            "timestamp": 1667235621,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1667251779,
            "reviewer": {
                "name": "Richard-Hanley",
                "email": "rhanley@google.com",
                "username": "Richard-Hanley"
            },
            "message": "Patch Set 1:\n\n(4 comments)"
        },
        {
            "timestamp": 1667254797,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1667258848,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1667258874,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1667258909,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1667258909,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1667258929,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/54414/ : SUCCESS"
        },
        {
            "timestamp": 1668498412,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1668543359,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1668543377,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1668543487,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1668543487,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1668543509,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/55418/ : SUCCESS"
        },
        {
            "timestamp": 1668595775,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1668648116,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1671664450,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1689006192,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "mdmii@outlook.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 3:\n\n(58 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d0f165e2f62372c0a7b9917a7c096124740cedf3",
            "parents": [
                "1adafbb37e1325af7d62aea8589114e483204e53"
            ],
            "ref": "refs/changes/13/58313/1",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1667235535,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Let me know if you want me to add extra reviewers. "
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Richard-Hanley",
                        "email": "rhanley@google.com",
                        "username": "Richard-Hanley"
                    },
                    "message": "Overall I think this looks pretty good.\n\nThe main thing I'm wondering is if there is any more plowing we want to do to try enabling a remote authorization server."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 169,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Replace Authz service with Token service\nReplace Resource Owner with proxy service.   If desired split the box to iniclude into authorization service communicating with the above Token service."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 249,
                    "reviewer": {
                        "name": "Richard-Hanley",
                        "email": "rhanley@google.com",
                        "username": "Richard-Hanley"
                    },
                    "message": "Section \"13.4.4.4 Redfish OAuth2.0 scope usage\" of the spec allows this to be a comma separated list of roles or privileges. \n\nIMO, having a list of roles is an undefined operations. As an example, I don't really know what a scope like \"Redfish.Role.ReadOnly, Redfish.Role.Operator\" would entail. My guess is that it would allow the union of both ACLS, but maybe that's a question for DMTF.\n\nDoes this design change much if we only allow roles in the scope, or is that not too serious of an issue?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 249,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "As implementation details, we can write codes so that it allows either a single role or a list of privileges.\n\nI can bring this up as a Github issue in DMTF."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 249,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Correction: scope is space separated not comma separated (The Redfish specification is consistent with OAuth, just this comment is incorrect).\n\n\nWhy is this described as a Redfish Role (implying a single role adding Redfish.Role.<rpc-value> will be in the claim) instead of this being a string with the complete value of the scope claim?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 254,
                    "reviewer": {
                        "name": "Richard-Hanley",
                        "email": "rhanley@google.com",
                        "username": "Richard-Hanley"
                    },
                    "message": "I think this makes a lot of sense for mTLS users, as it allows the resource server to ensure that client is definitively the subject of the OAuth token.\n\nHowever, I don't think there will be a username/password pair registered with the server"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 254,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Clients can still use one side TLS to connect to the resource server and claims their identity by username/password in the system. This is how BasicAuth and Session login currently work in BMCWeb.\n\nThese usernames have to be registered with the server"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 254,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Delegation is the transfer of authority to a trusted entity.   \n\nThe overview section (13.4.1) introduces the concept of Authorization and sepeartes the mapping of users to roles and roles and then to privileges (13.4.2.1) from the privilege to operation model (13.4.3) describing the required privileges.\n\nWhile it is not clearly stated how the concept of users or sessions interact with OAuth tokens, the section is titled Delegated authorization with OAuth (13.4.4) and it describes how JWT tokens use the scope claims with defined values to provide the privileges (13.4.4.4).\n\nTo me this means that users are not required (and sessions, which require a password, will not be created) because 13.4.4 OAuth Delegation describes an alternative to the privilege model described in 13.4.2.\n\n\nA key point of using OAuth tokens is to delegate the identification to the outside infrastructure and just enforce the authorization in the Resource Server (it also allows the user to be granted authorization only through the client).  Requiring an account violates this concept.  \n\nRequiring users to be registered significantly increases the administrative burden.  Requiring a password goes against the purpose of using an SSO, and any password assigned to the user is not visible to the client for all recommended OAuth flows.  While SCIM defines endpoints (2.0 2015, RFC7643, RFC7644, RFC7642) to maintain users and groups across systems, it uses a push model of account updates which would not scale.  OpenID was created to extend OAuth with authentication (the concept of who is using it) by adding an ID_token (not provided to the resource server, rather only to the client), however the Redfish spec only talks about authorization (what privileges are granted) and hence limits itself to OAuth 2.0.  (There are several videos describing the difference including how it can be a client (software) vs a user initiating the request, etc).  \n\nRecently the OAuth community has described methods for restricting the use of Bearer tokens, including to use over a mTLS channel security by an X.509 certificate (implictly proving the private key through the use of the certificate) and later DPoP (currently submited to the RFC editor for publication, this system does not require forwarding of the client certificate).\n\nIt may be a desired to explicitly reject any requests with a bearer token to access an X-Auth-Token session."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Richard-Hanley",
                        "email": "rhanley@google.com",
                        "username": "Richard-Hanley"
                    },
                    "message": "This feels like a gap, but I haven't really had a chance to wrap my head around this.\n\nThere really doesn't seem to be any standard way in either DMTF or OAuth to describe the key management for the token signature.\n\nThat makes me think that there are one of two ways that the PKI can be managed:\n\n1) Distributed signing keys along with X.509 root certificates.\n2) Have the authorization server pre-register the signing key by hitting an endpoint in the resource server.\n\nWould it be future proof to just say that the signing key is in phosphor-cert-manager, and leave it to the next person to figure out how they want to wire it up?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "> 1) Distributed signing keys along with X.509 root certificates.\n> 2) Have the authorization server pre-register the signing key by hitting an endpoint in the resource server.\n\nGreat suggestion, I can add these two options in the next patchset.\n\n> Would it be future proof to just say that the signing key is in phosphor-cert-manager, and leave it to the next person to figure out how they want to wire it up?\n\nYes, I can mention this in the next patchset."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Section 13.4.4.2 of Redfish requires the OAuth2 proprty in the AccountService resource to be implemented.  The Data Model and Schema Guide points to OAuth2Service 6.2.4.10 (1.10+, 2021.x) listinig Audience, Issuer, OAuth2ServiceSigningKeys, Mode, and OEM.   Issuer is described as the RFC8414 service address of the OAuth2 provider.  The OAuth2ServiceSigningKeys property is described as RFC7517 defined and shall be the value at the jwks_url string of the OAuth 2.0 service metadata if Mode is Discovery, and configured if mode is Offline."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "type": "ADDED",
                    "insertions": 329,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 342,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "6036d6ec12062f49c00d682a8a81884b97c21f08",
            "parents": [
                "1adafbb37e1325af7d62aea8589114e483204e53"
            ],
            "ref": "refs/changes/13/58313/2",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1667258874,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 86,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "Duplicated \"valid time\""
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 86,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Thanks! Done"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "It is a bit complicated for expiration.\nWe have a requirement for 1 hour expiration for logged in users. So in Bytedance's SSO implementation, we do not check the expiration from the token, it is assumed as 1 hour that is configured in SessionStore"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "For the proposed workflow here, it's a pretty straightforward check: |local time| <= |create time| + |valid time|. |local time| can be get from std library, |create time| + |valid time| are just strings in the JWT.\n\nCould you elaborate why you think it's complicated here?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "By \"complicated\" I mean the session timeout, would this mean the session timeout is set every time when an SSO login is performed?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "I see where you are from now. I have two options here,\n\n1. not use the session codes at all in BMCWeb. This means every request will go to token verification. This might affect performance but I need to evaluate how slow it is. To my understanding, verifying a signature of short token should be fast.\n\n2. use session. Whenever we found there is no session for this token, we create a new session and set the session timeout to min(CurrTime + MaxSessionTimeout, CurrTime + TokenValidFor).\n\nMakes sense to you?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 122,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The Redfish specification requires the `exp` claim be present and be processed.  To avoid confusion, standards rely on application profiles to differentiate between access tokens and other uses of JSON Web Tokens, for example the security event token specification (SET, RFC8417 section 4.1), which can be used to log security relevant events, explicitly omits and rejects the exp claim.\n\nTokens may be rejected when otherwise valid for policy reasons; there is a standard introspection endpoint (RFC7662) that will identify arbitrary tokens from an associated token endpoint as invalid (eg to implement revocation) or valid.  Regardless, the lifetime of the token should be limited at the authorization service.  ByteDance like all users is welcome to add additional checks for tokens in their downstream code as they desire.\n\nIf the concern is using a token near the end of its lifetime being used to persist the usage of a token via a Redfish session beyond its lifetime realize that session creation requires a POST with a username and password and therefore do not provide a path to authenticate to an account.\n\nIf verifying tokens via processing their algorithm and signature (Nam option 1) proves to be too expensive then they can be presented to an introspection service (RFC7662) which can be used as part of a token revocation system however encrypting for transport over TLS is likely as or more expensive as validating the JWT;"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "In BMC the privileges are bound to a user group, how do you manage the user that is logged in to the BMC?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Yes, there are two flavors:\n\n1. Redfish Privileges in JTW claim. We might send a dbus call to phosphor-user-manager to check if these privileges are in the system. Or we just skip the check, and directly use these strings as is when performing intersection.\n\n2. Redfish Roles in JTW claim. We need to send a DBus query to phosphor-user-manager to check what privileges this role has.\n\nI understand privileges are stored as groups. I have an approved design doc to add OEM privileges and roles in https://github.com/openbmc/docs/blob/master/designs/redfish-authorization.md"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "I still have the question about the user who logged in.\nWhen the user logged in via OAuth will the session be associated with a user in phosphor-user-manager?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "No, there is no concept of \"user\" in authorization delegation. Only either \"Redfish Role\" or \"Redfish privileges\".\n\nFor mTLS connections, we might check if the peer's identity matches the subject role."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 178,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "RFC8705 describes how to bind a bearer token to a mTLS client certificate (when the same mTLS client certificate is used to authenticate to the authorization server and the resource (Redfish) server).\n\n##### In regards to identifying a user:\nRFC7523 (JWT Profile for OAuth 2.0 Authentication and Authorization Grants) gives requirements for the authorization server and gives expectations for the subject (`sub`) claim for an authorization JWT.  It describes the subject being authorized accessor, but explicitly states the subject claim can be pseudonymous and may be opaque (section 3 requirement 2 A).\n\nThis means the JWT subject (`sub`) combined with the issuer (`iss`) claim can be used as an identifier (eg for audit, ownership of subscriptions, tasks, and any other uses of `ConfigureSelf`), but `sub` should not be interpreted beyond that, certainly not as a user account in the `ManagerAccount` service implemented by phosphor-user-manager.\n\nValidating the access token provides the requirement to authenticate the request.  Requiring a Redfish Session implies knowledge of the password assigned to an account and allows the access to the Role assigned to the account by omitting the access token from the request.  In addition it requires some method to maintain accounts visible to the account service and defeats the concepts of SSO and passwordless.  The RFCs explicitly forbid multiple values of the Authentication header or multiple schemes for its use to be defined.  We should honor that intent by not allowing a session to be specified.  See also the discussion about session lifetimes; avoiding the session avoids the confusion."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "type": "ADDED",
                    "insertions": 332,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 345,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "8057b14dd6656c7f32c9e80075f1fd3951c070e1",
            "parents": [
                "1adafbb37e1325af7d62aea8589114e483204e53"
            ],
            "ref": "refs/changes/13/58313/3",
            "uploader": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "createdOn": 1668543377,
            "author": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Any more comments?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "I've had an interest in how to integrate security and modern systems for a while.  After  seeing this topic in the security working group minutes I started researching the OAuth standard over the new year.  Unfortunately, life events beyond my control have demanded my attention delaying this review.  I have tried to give specific citations to specifications.  If desired I can share links to videos on YouTube of conference presentations etc (there are some that compare the OAuth framework to real life analogues with different levels of being contrived; I particularly enjoyed a recent 50 minute video comparing to a centuries old hotel incrementally adding requirements in response to new threats and then briefly showing the corresponding OAuth flow).\n\nI've tried to temper my comments and I do realize that opensource projects require people to actually contribute code and its motivated by their use cases.  I believe this proposal describes an honest design that can be used by hyperscalers.  However, I think it was written after reading the Redfish Specification missing some other references especially about framework components not described therein."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 14,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The Redfish Specification talks about the option for supporting the OAuth 2.0 authorization framework, not integrating it."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 55,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "### Native Redfish authentication\n\nWhile explicitly allowing additional methods of authentication, the Redfish Specification requires two methods be implemented: HTTP Basic Authorization and Redfish Session authentication using a defined login endpoint.  Both of these submit a username and unencrypted password with minimal encoding for transparency as credentials although they do so over a TLS secured channel."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 73,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "user to Redfish Role and/or Redfish Privileges mappings."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 74,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "I assert validation of the token should also result in the delegation of the authentication of the user, and requiring an account increases the security concerns.  I'll expand this argument in the discussion of requirements below."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 78,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "While this language is copied from the Redfish specification, it is inaccurate. From section 3 overview of RFC7519 \n> JWTs represent a set of claims that is as a JSON object that is encoded in a JWS or JWE structure.\n\n> A JWT is represented as a sequence of URL-safe parts separated by period ('.') characters.  Each part contains a base64url-encoded value.\n\nA JWT uses either the compact JWS encoding or the compact JWE encoding but neither employ compression.  The compact encodings merely use shorter member names for some object members (many header parameters are 3-7 character strings) and avoid encoding possibly redundant information targeting support of multiple recipients.  In contrast each part is subjected to base64url encoding resulting in the use of only 6 bits of each 8-bit byte before joining them with a period.  However the result is a URL safe string suitable for direct inclusion in headers."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 83,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "consists of -> contains.\n\nThe JOSE header contains parameters describing the cryptographic operations applied to the JWT and optionally additional properties (RFC7519 section 5).  The Redfish Specification requires processing the cryptographic algorithm (`alg`) and the token type (`typ`) when present, but other parameters should be processed.  Various RFCs describe other parameters; for instance the metadata service conditionally requires a key be identified (listing a prior key allows for rotation without service interruption)."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 88,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Note: Both this and the prior paragraph simply list items the Redfish Service requires be present or processed and could be summarized in the Requirements section as process the required headers.  The statement about required claims is not true for JWTs in general.\n\nThe exception to the above statement is the description scope claim contains the Redfish Roles or Redfish Privileges authorized to the client."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 97,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Configuration of the Redfish service to recognize an OAuth provider is described by the data model, specifically in DSP0268 the OAuth2 property contains an OAuth2Service property described in 6.41.3 Properties of 6.41 ExternalAccountProvider 1.6.0 (added in 1.3.0 as part of the 2021.2 release) and section 6.41.4.3 Mode describes Discovery and Manual configuration via the RFC8414 metadata endpoint of the authorization service.\n\nDSP0268 6.41\n\nOther RFCs likely relevant to BMCWeb as a Resource Server under the OAuth 2.0 framework:\n\nWhile Bearer tokens are nominally usable by anyone who can find them, RFC8705 describes how they can be constrained to be presented over a X.509 secured mTLS channel, restricting their use to the possessor(s) of the private key of said certificate.\n\nRFC6750 Bearer tokens and the Authorization Bearer scheme\nRFC2618 OAuth 2.0 security threat model\nRFC7517 jwks keyset\nRFC7800 Proof-of-Possession including defining the confirmation (`cnf`) claim \nRFC8414 OAuth metadata service\nRFC8705 restricting JWT validity requiring a mTLS secured by a X.509 certificate\n\nAdditional background containing possible requirements to consider when creating an OAuth 2.0 framework authorization service (ordered by RFC number):\nRFC7009 Token Revocation\nRFC7521 Assertion framework\nRFC7522 grants using SAML Assertions\nRFC7523 grants using JWT\nRFC7636 PKCE Proof Key for Code Exchange\nRFC7662 Token Introspection (endpoint to ask if a token is valid and its claims)\nRFC8693 Token Exchange (includes impersonation and delegation)\n\nMethods for clients to request specific claims in tokens:\nRFC8707 resource parameter (request a specific value in audience claim)\nRFC9101 JWT-secured auth requests (JAR)\nRFC9126 Pushed auth requests (PAR) describes iss should be the metadata endpoint\nRFC9396 Rich Authorization Requests (RAR) (for fine grained tokens)"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 102,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The resource owner is an entity or person, not a service or algorithm to be implemented."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 105,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "needs"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 109,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The client is the software though which the user accesses the resource server.  While it may be acting on its own authority, it may also be acting on behalf of a user and present the users credentials.\n\nThe paragraph asserts the Redfish server doesn't understand the credentials without describing any challenges to doing so or how they are overcome.\n\nMy nth attempt for a replacement:\n### Motivation and Challenges\n\nAuthorization referes to the process to decide if a request is permitted.  It authenticates (proves valid or true) credentials (statements about qualifications, background, or attributes about a subject) about the requester and may reference additional credentials from additional sources such as a user account.  Credentials are often presented as a set of claims, each describing an attribute of the user or another claim.  Criteria established by the owner or his delegate is then used to make the decision.\n\nIn Redfish it starts with the presentation of credentials by the requester.  While allowing additional methods of authentication, the specification requires at least two methods are implemented (HTTP Basic Authentication and Redfish Session login); both take use a username to locate an account and a password to authenticate with (something-you-know).  Once authenticated, the Redfish Role assigned to the provided account is retrieved and then the associated Set of Redfish Privileges is obtained.  Finally, the set of privileges are evaluated against those required to perform the requested operation and a decision is made.  While accounts may be retrieved from an external account provider (for example an LDAP provider), the required authentication methods expect to verify a password to authenticate the account holder.\n\n>Modern enterprises deploy a centralized system to manage identity (one example is Google's LOAS cluster manager but there are several providers including commercial and open-source solutions).  In addition to providing the enterprise with a single point of control, they allow users to establish a single sign-on (SSO) session allowing them to supply multiple applications with credentials without authenticating to each one individually.\n\n\nHowever there are several challenges to integrating a service with an identity system.\n\nDepending on sensitivity or access provided by the credentials being supplied the  the system may consult a dynamic threat model or other rules to request multiple authentication factors (MFA) to go beyond or instead of requesting a password (something you know) when authenticating the identity of a user; indeed, protocols in the FIDO2 family allow credentials to be presented while maintaining security and privacy without the use of a password.  While there are several standard claims that can be used to provided, deployments are permitted and encouraged to augment them with custom claims.  A deployment may associate client application with a profile to select which custom and standard claims should be included but allow neither the name of the claim nor the format of content to be adjusted.  An owner may establish require a number of custom and standard claims when authorizing privileges to perform  operations.  The critera may vary depending on the current use or may reflect the assignment of a specific user to a system.  In addition, there are several frameworks that describe how to format credentials for presentation to services (including as SAML assertions expressed in XML, as a JWT containing claims encoded in a JSON object, or as opaque tokens) and validate them (requiring the distribution of cryptographic keys or presentation of credentials to an API endpoint).  \n\n\nThe Redfish Specification describes requirements when a service decides to support the OAuth 2.0 framework to delegate some parts of the authorization process.  The description results in the extraction of Redfish Roles and Redfish Privileges to be applied when authorizing to an operation requested by the client.  It includes several requirements on the framework including the delivery of the access token by the client in an Authorization header using the Bearer scheme.  It requires the authorization server to format access tokens as a JWT and including specific values for standard claims.  As is good practice, it expects the token to include claims specific to the service (ignoring aggregation).  It also adds requirements on the service to process several claims and required support in the data model of specific configuration through, and how to express Redfish Roles and Redfish Privileges in the standard scope claim.  \n\n>By supporting the OAuth 2.0 framework as described in the Redfish Specification a single process can be written employed to extract the Redfish Roles and Privileges to be applied to a given request from the authorization token provided in the Authorization header using the Bearer scheme and parse it as a JWT which is then validated using information obtained from the data model either obtained and cached via discovery from the OAuth metadata service endpoint or configured manually.\n\n\nThis delegates the burden of understanding the user credentials and interaction with the resource owner to a suitably configured authorization service."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 110,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "This subsection states a fact (no current service implements the OAuth framework) without any motivation.  It makes a second statement (the Redfish service doesn't understand the credentials) makes a leap to \"OAuth is a natural fit\".\n\nHowever it doesn't present any justification why the authorization service should be near the Redfish Service and part of the BMC deployment.\n\nThe requirements describes an gRPC service to generate tokens and an ad-hoc (OEM) out of band method to distribute the corresponding public key to BMCWeb.  However, it does so without addressing any requirements of actually being an OAuth 2.0 authorization service.\n\n\nWhile I agree there does appear to be a gap between many OAuth service implementations out there and a scalable deployment of Resource servers with Redfish service endpoints to be controlled (indeed, RFC2618 describing the security threat model in 2013 explicitly avoids identification of resource servers or locating authorization servers), I am not convinced supplying the said token service advances that goal.  Regardless, upon presenting said service and proposing to share its public key via private, out of band methods this proposal missed the requirement to implement the OAuth2 property in the account service including the requirements and recommendations contained in the descriptions of the required properties in the Redfish Data Model.\n\nFurther discussion is in the requirements and Proposed design sections.\n\n\n### My idealized authorization service for a fleet of Redfish servers\n\n\nWhen I was exploring the OAuth 2.0 specification and landscape (including OpenID 1.0, and later OAuth 2.1 draft), it seems like most providers are expecting to authorize a (scalable list of) users to authenticate to a (scalable list of) client applications each accessing a single (or limited set of) service endpoint(s).  Many providers feature cross-authentication of users from other systems (either or both of SAML and OpenID Connect), and several support the import of identity information from other systems including LDAP and/or Active Directory, most offer several forms of MFA to authenticate users.  \n\nWith the OAuth 2.0 framework having been in existence for over a decade there are several products that can both act as an authentication service and act as a client to another system via a concept called federation.  Some provide a rules language and an overlapping set support writing code to intervene and adjust the claims supplied in the token.   Some place strict limits on the manipulation of standard claims.\n\nWhile I explored service offering documentation of different servers or frameworks to different depths, few if any seem to provide scaling of resource servers available to a client (although some supplied client frameworks only check an audience `aud` claim on an opt-in basis).  Many expect each Resource Server to be registered as a client even when no direct communication is required to validate credentials.\n\nRFC8707 defines the `resource` parameter to allow the client to inform the authorization server a specific resource server it intends to present with the requested token.  This allows the authorization server to construct the token to meet the servers requirements.  The client to identifies an absolute URI that can be used (possibly with mapping) to identify requested audience(s) (explicitly allowing repitition for requesting multiple resources) to place in the audience claim of the issued token.  In addition to describing the behavior for the authorization endpoint, its behavior for the token endpoint is also described, allowing a refresh token (or equivalently an assertion grant) to be customized with a specific audience for the granted token, possibly restricted by the source token.  \n\nThis parameter seems to be closely aligned with my ideal deployment, where a single authorization server supporting many redfish service endpoints each accessed by a few common clients that request tokens using either their own identity when pure automatin or combined with that of their invoking user.  A Resource Owner would describe criteria for claims presented by a federated system such as membership in a collection of users be it a group or assigned role might authorize Redfish Roles or Privileges and it may include specific supplementary attributes for specific privileges on specific servers.  When a client requests a scope (optionally that includes a Redfish defined scope) no Redfish scope not requested by the client would be included (this might require knowledge of the Role to Privilege mapping or the ability to query it or rules for allowed downgrade of Roles).\n\nNote: There are several RFCs describing how the client can supply parameters to an authorization request.  While RFC9101 describes a method to offer request parameters securely, it requires all parameters to be in the same request JWT including the client_id, so would not scale to general requests.  RFC9126 both expands on RFC9101 but also clarifies the aud claim when referring to RFC7523, declaring one but requiring 3 variants to be accepted."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 119,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Redfish requires that if `typ` is not present it is assumed to be JWT.   (Note JWT is case sensitive)."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Security hazard  (for all JWT):  It must only support asymmetric (public/private) algorithms (otherwise the publicly displayed public key can be using by another algorithm where it is treated as a symmetric key by an attacker)."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 124,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "RFC 8705 describes in detail how a mTLS certificate can be used with an JWT Bearer token to limit the presenter of the token.   It describes placing a confirmation method claim (`cnf` object RFC7800) in the token with the SHA256 thumbprint of the x.509 certificate (`x5t#S256`).\n\nThis allows the delegation to the OAuth server the task of authenticating the possessor of the certificate private key before issuing the Barer token.  In fact it describes 5 ways for a client to link a x509 PKI certificate in the authorization server (`tls_client_auth_subject_dn`, `tls_client_auth_san_dns`, `tls_client_auth_san_uri`, `tls_client_auth_san_ip`, `tls_client_auth_san_email`) in addition to 2 ways to register a client that will self-sign its X.509 client certificate (with `jwks` or `jwks_uri`).\n\n\n(From YouTube videos of conference presentations, this RFC was created as the first of two methods for proof of possession to meet UK banking regulations, allowing rapid deployment for those who had PKI in place.)"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 128,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "along with (or beside) -- it's independent."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 129,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The described service does not implement an OAuth authorization server, rather it describes a token minting service for its client(s) (authorized by a mTLS certificate) to create signed JWT Bearer tokens.  This is a security context to token service (what some implementations refer to as STS to JWT), far from a complete OAuth authorization service.\n\nTo be an OAuth authorization server it must implement OAuth flows and endpoints described in OAuth related RFCs.  RFC6749 describes two protocol endpoints provided by the the authorization server (section 3), one to provide an access token and one to interact with the resource owner via browser redirect to provide authorization grants.  The proposed server implements neither of these and is therefore not an authorization server an any OAuth framework.\n\nIf this were an OAuth authorization service, then additional RFCs apply.\nRFC 7521 describes the Assertion framework for OAuth client authorization and authorization grants, and RFC7523 describes JWTs when used as such assertions.  RFC7523 states creating tokens for such a server requires the authorization endpoint to be listed as the audience (or an application profile to specify some other comparison for the audience).  Alternatively, RFC8693 describes JSON token exchange over HTTP, both for delegation and impersonation, both for cross-domain and defining the actor role in explicit cross-identity usage."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 133,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "RFC8705 gives several requirements when using mTLS to authenticate a client to the authorization server."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 136,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The data model (DSP2068 2022.02) gives hints on how the authz server is conveyed to the Redfish service:  specifically, `Mode` `Discovery` or `Offline` (6.36.4.3) and `OAuth2Service` (`Audience`, `Issuer`, `Mode`, `OAuthServiceSigningKeys`) (6.36.3), which has statements about read only vs read write access depending on the state of Mode.  In turn this points out RFC8414 which has standard service information endpoints, including the public key be given in a json web key set (`jwks`) or at a https URL (`jwks_url`) and requiring intended usage notation if there is more than one key in the set."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 137,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "There hasn't been a mention of what URI are going to be published or supported for the audience (`aud`) claim.   Under `OAuth2Service` `Audience` property, the long description incudes\n> For example, a MAC address or UUID for the manager can uniquely identify the service\n\nand these are likely more permanent than the hostname or IP address, both of which could be assigned via DHCP (there are defined URN namespace for both UUID and MAC, in addition to the normal https authority).\n\nOAuth security guidelines warn of confusing tokens meant for one RP being supplied to another, and this header is one of several used to detect such Mix-ups."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 138,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "This paragraph should be in the proposed design section as its describing the example architecture, not stating requirements."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 140,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Resource owners are people (or entities) not software.  While it doesn't give details, RFC6749 section 3 states the interaction between clients and resource owners granting an authorization grant is initiated via user-agent redirection at the authorization endpoint.  Alternatively, RFC7521 describes a framework for additional methods of conveying the authorization grant.\n\nThe proposed design has confused several of the OAuth defined roles, even though the definition were copied into this document.  After a few revisions I feel I have proposed descriptions that uses OAuth roles more accurately without significantly adjusting the design.  It does point out that the proxy as described combines both the roles of a client and an embedded authorization server in addition to its implied proxy service initiation endpoint.  I have tried to differentiate the roles ignoring the details of the actual transport.\n\nSuggested replacement:\n> Details of the how the Resource Owner conveys authorization grants to clients are outside this proposal, however we provide an example architecture where a Resource Owner provides a combined Redfish proxy service with embedded authorization service, relying on the token service on the BMC to hold an ephemeral public/private key that is transported to the Redfish Service outside of the Redfish Data Model."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 174,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "nit: dumps\nThis implies a new mode to obtain some of the required service information.  This appears to describe a new OEM Mode.  It doesn't specify how the required issuer claim will be transported."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 176,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "the client makes a request to the proxy service.\n\nQuestion: how does the proxy identify the requested resource server?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 179,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "the authorization service (embedded in the box labled proxy service) authenticates the client and determines the authorized roles and/or privileges granted by the Resource Owner; in the example diagram, the authentication method is LOAS (Google's cluster authentication system)."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 181,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "the"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 182,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The authorization service (embedded in the proxy service) requests the token service to mint a authorization token.  Within the request, the authorization service specifies the Redfish role or Redfish privileges granted by the resource owner."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 186,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "the token(authz) server receives the token request; it verifies the peer is authorized by the resource owner via validating the client via the mTLS channel; ...\n\n... to the authorization service as an JWT object.  The JWT is returned to the proxy service via the (internal) token endpoint."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 187,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The proxy service"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 193,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "by the proxy service."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 197,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "the token server"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 207,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "why include none?"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 213,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "Why is this described as a single redfish role instead of a scope string, which can contain a list of redfish privileges for instance?   When specified as a redfish role I would expect the scope claim to be Redfish.Role.<string>."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 216,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "(If this service is determined to not be the issuer the value for that claim will need to be added)"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 232,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "SIGHUP (I presume)"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 233,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "While this auto-configuration may be convenient, its neither the Discovery nor the Offline method defined in the data model.  I suppose the normal OEM extension could be created, but our policy for OEM usage requires raising use cases with the DTMF before adding them."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 236,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "This only supports owners who can supply their own firmware and requires a firmware update the owner list.  Its unclear how the peer is identified as a member of the list.  Some kind of certificate for each member?  How is the trust in the client certificate obtained?  In contrast, the redfish data model supports configuration of the OAuth service including using https to verify contact with a trusted server."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 242,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "This fixed string is not nearly unique to be considered a URI.   If you meant the URL of the server, please state as such.  The data model expects this to be the metadata endpoint."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 244,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "see above comment on possible audience values."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 248,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "requires persistence of the counter; alternatively, a cryptographically random value to be reasonably certain to avoid collision."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 250,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The described API is a long way from describing an OAuth framework authorization server.  While most of the server is presumed to be implemented elsewhere (as code that calls the gRPC endpoint), this proposal only describes the security sensitive penultimate step of minting the access token and returning it to the client without describing any audit requirements or other considerations.\n\n   Continued via comment in the alternatives section."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 263,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The typ claim must be optional and assumed to be JWT per Table 44 \u2014 OAuth 2.0 JWT JOSE Header parameters in the Redfish specification."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 268,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "the `exp` claim must be checked per the RFCs."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 270,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "RFC8705 defines 4 ways for a mTLS x509 certificate to identify a client (the software) to the authorization server and explicitly differentiates the subject claim between a JWT describing the client to the authorization server with the sub claim when used in a token issued with an audience, which is explicitly vague if the subject claim is the client, an abstract identifier of the user, or some other identifier.\n\nPlease use the RFC method to bind the mTLS certificate (and private key holder) to the bearer token.  There are several ways for the identity to be expressed in the certificate, and its not delegation if we attempt to authenticate the identity.  The possession of the private key as used to establish the session is enough to show the OAuth service trusts the client."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 271,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The data model Isuers claim exports the supported values to be contained in the aud claim.  In the long description mention is made to consider using a mac address or service identifier.  In BMCWeb our service identifier is derived from the machine-id (usually randomly generated once at initial bmc os install) and could be exposed as urn:uuid:<std-formatted-string>."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 290,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "The data model describes how both are represented, and is required when implementing Delegation via OAuth.\n\nWhile Mode Discovery requires a https client, such support has been in bmcweb since August."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 296,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "While separating the authz service does isolate the requirements from the bmcweb codebase, locating a gRPC service on the BMC to mint tokens authorization tokens doesn't appear to actually address a pinch point; instead, it only offers to partially shortcut configuring the authorization service to the Redfish service.  \n\nEach client still has to locate the token generattion service for each service and would still be required to obtain an authorization grant token specific to that authorization service, thus just moving the scaling issue up one level.  \n\nIn addition, as described, the security model requires compile time customization of the resource owner credentials, limiting the usage to owners who compile their own deployment and an update each key rotation.\n\nIn contrast, using a more centralized service can start to address the scaling and provide a flexible, standards compliant deployment."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 299,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "### Configure a KeyCloak server for test\n\nKeyCloak is an Apache 2.0 licensed server under active development that ships a Kubernetes ready Docker image with REST endpoints to configure a service.  While being written in java probably precludes it running on the BMC, it may be adapted to scale in the future.\n\n##### watch keycloak for RFC8707\nWhile not required to test using the service via a JWT, it appears that an interpretation of RFC8707 similar to my desired model has been discussed for implementation in keycloak [keycloak-resource]() but has not been fully accepted or implemented in the current 21.1 release, instead just the initial audience mapping support [keycloak-audience](), along with registering each resource server as a confidential client.  Also the reskhrce claim is explicitly not being processed for refresh tokens; I suggest change from a group of resource servers to a specific one should be allowed.  Perhaps by providing use cases similar the one described above may encourage community acceptance.\n\n[keycloak-resource](https://github.com/keycloak/keycloak/issues/14355) https://github.com/keycloak/keycloak/issues/14355\n[keycloak-audience](https://www.keycloak.org/docs/latest/server_admin/#audience-support) https://www.keycloak.org/docs/latest/server_admin/#audience-support"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 306,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "This proposal does not address how the web GUI might interact with an OAuth framework.  Single page applications (SPA) must be treated as public clients because they can not keep a secret.  There are significant security concerns providing Bearer tokens to web browsers, and several owners may not support public clients.  See draft-ietf-oauth-browser-based-apps for discussion including mitigation strategies like backend for frontend (BFF), token mediation (TMI), and others."
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 318,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "any thoughts on JWT library?  Since crypto and validation is security sensitive.\na quick search for jwt cpp found two,\n- one last updates 6 years ago\n  - readme describes private key lifetime \n- a second, active one\n  - header only \n  - allows choice of json and crypto providers \n  - probably started about 2020 \n  - labeled 0.6\n  - spare time support"
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "line": 332,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "missing new line at end of file"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/redfish-oauth.md",
                    "type": "ADDED",
                    "insertions": 332,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 345,
            "sizeDeletions": 0
        }
    ]
}
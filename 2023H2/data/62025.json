{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "Icbd568aeeca6428a9fade12416e260741a76213c",
    "number": 62025,
    "subject": "IntelCPUSensor: support new Linux PECI API",
    "owner": {
        "name": "Paul Fertser",
        "email": "fercerpav@gmail.com",
        "username": "paulfertser"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/62025",
    "hashtags": [],
    "createdOn": 1680096628,
    "lastUpdated": 1691702282,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1680096628,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1680096647,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1680096647,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1680096891,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/63322/ : FAILURE"
        },
        {
            "timestamp": 1680097125,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1680097152,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1680097152,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1680097439,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/63324/ : SUCCESS"
        },
        {
            "timestamp": 1680230472,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680246510,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680252399,
            "reviewer": {
                "name": "Iwona Winiarska",
                "email": "iwona.winiarska@intel.com",
                "username": "iklm"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680254496,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1680260207,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1680260238,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1680260238,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1680260525,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/63464/ : SUCCESS"
        },
        {
            "timestamp": 1680260627,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1680567444,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1680591104,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1680926707,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1680938396,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1681247566,
            "reviewer": {
                "name": "Iwona Winiarska",
                "email": "iwona.winiarska@intel.com",
                "username": "iklm"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1682013546,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1684144683,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1684144710,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1684144710,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1684144725,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/66452/ : FAILURE"
        },
        {
            "timestamp": 1684145079,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1684145100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1684145100,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1684145405,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/66454/ : SUCCESS"
        },
        {
            "timestamp": 1684146258,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1686128528,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1686723778,
            "reviewer": {
                "name": "Patrick Rudolph",
                "email": "patrick.rudolph@9elements.com",
                "username": "PatrickRudolph"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1687953510,
            "reviewer": {
                "name": "Arun Lal K M",
                "email": "arun.lal@intel.com",
                "username": "arunlalkm-intel"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(2 comments)"
        },
        {
            "timestamp": 1687954260,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1689691635,
            "reviewer": {
                "name": "Marvin Drees",
                "username": "MDr164"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1690849639,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1691057477,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1691057500,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1691057500,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1691057515,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/72412/ : FAILURE"
        },
        {
            "timestamp": 1691057732,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 7: Patch Set 6 was rebased.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1691057760,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1691057760,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1691057784,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/72413/ : FAILURE"
        },
        {
            "timestamp": 1691058156,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1691107337,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 8: Patch Set 7 was rebased\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1691107368,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1691107368,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: -Ok-To-Test"
        },
        {
            "timestamp": 1691107680,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/72425/ : SUCCESS"
        },
        {
            "timestamp": 1691195141,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 8: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1691215397,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 8:\n\n(1 comment)"
        },
        {
            "timestamp": 1691444111,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 8: Code-Review+2"
        },
        {
            "timestamp": 1691448131,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 8:\n\n(1 comment)"
        },
        {
            "timestamp": 1691699640,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 9: Patch Set 8 was rebased\n\nCopied Votes:\n* Code-Review+2 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1691699652,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1691699652,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: -Ok-To-Test"
        },
        {
            "timestamp": 1691700089,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/72742/ : SUCCESS"
        },
        {
            "timestamp": 1691702282,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Change has been successfully rebased and submitted as 6e69973ebd248f95483c8c8ee1d656520cda0e2f\n\n8 is the latest approved patch-set.\nNo files were changed between the latest approved patch-set and the submitted one.\n"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d35799d638e747778166eee4f963cbf622e3d000",
            "parents": [
                "2ef139fb45f7780c7eb5257d277dc4b690944733"
            ],
            "ref": "refs/changes/25/62025/1",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1680096628,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 38,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "83947997df106bc68273d908002a68d8422eb0fa",
            "parents": [
                "2ef139fb45f7780c7eb5257d277dc4b690944733"
            ],
            "ref": "refs/changes/25/62025/2",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1680097125,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Iwona, can you please recommend the best way to check for the new code and whether you think it's the right way to proceed here? So far it looks like the new API is a subset of the old one, and with this patch the daemon tries a no longer supported operation as a way to differentiaite."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Iwona Winiarska",
                        "email": "iwona.winiarska@intel.com",
                        "username": "iklm"
                    },
                    "message": "The old one doesn't exist.\nFrom upstream kernel perspective, we're committed to maintain backwards compatibility, but only for the code that exist in upstream. We can't ever remove existing uAPI, so there's no dedicated mechanism to discover uAPI \"version\".\n\nI think what Andrew suggested is simply to invert the logic here.\nIf we wish to maintain userspace compatibility with the old out-of-tree module, we can simply test for /sys/bus/peci/rescan presence first."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Hi Iwona,\n\nThank you for answering.\n\n> The old one doesn't exist.\n\nOf course in never existed in upstream, no doubt. But it exists and is relied upon by downstream forks so and I assume IntelCPUSensor maintainers would prefer to continue supporting it, hence I'm asking for the most practical way given the situation.\n\n> I think what Andrew suggested is simply to invert the logic here.\n\nSo with the patch as it currently is, the daemon tries opening /dev/peci-0 , and right there if it fails tries to continue doing a \"rescan\" in case it might be needed. The new code is above the old code and is run as soon as it's discovered /dev/peci-0 doesn't exist.\n\nI've just checked and indeed the old code doesn't have rescan at all (that surprised me), so I'll just check for it first, agreed. Thank you for the feedback."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Done"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Now the new rescan file presence is checked first."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 471,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "We should be testing the presence of the new ABI first before falling back to the original device path. That way the new code paths are tried first now that we have them, not used only only once we remove the old paths."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 471,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 3
        },
        {
            "number": 3,
            "revision": "b79d52632f477a00d82636e975a1868168a942e9",
            "parents": [
                "2ef139fb45f7780c7eb5257d277dc4b690944733"
            ],
            "ref": "refs/changes/25/62025/3",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1680260207,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Any test done with the new PECI driver?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Basic testing was performed on a Tioga Pass board (ast2500 BMC, Xeon Skylake SKX host CPUs) with Linux version 6.1.15-0e94476-dirty-3631c2d, basically, current OpenBMC master with minor unrelated tweaks. Worked as expected. The DIMM temperatures appeared automatically a bit later, probably after POST was done."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Please add Tested section in commit message"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Sure, will do. I'm surprised nobody else is testing this, as my QA options are quite limited. Current OpenBMC is not doing one of the main functions on Intel servers, how come there's so little interest in fixing it?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Iwona, during the last testing of this code with a slightly different memory configuration I faced a condition when this daemon didn't show any DIMM temperatures while they were already available in hwmon.\n\nPlease describe how exactly the new API is supposed to be used. Under which conditions should the userspace trigger rescan? I noticed if triggered right after host is turned on it often isn't creating the memory temperature hwmon nodes. Should userspace retrigger it after a while (fixed amount of time?)? Also, after doing rescan how long exactly should one wait for all hwmon devices to appear? Or should intelcpusensor be constantly polling /sys/bus/peci/ to see if some hwmon directories appeared or disappeared? Please explain how you see the ideal userspace for your code."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Iwona Winiarska",
                        "email": "iwona.winiarska@intel.com",
                        "username": "iklm"
                    },
                    "message": "When PECI subsystem loads on BMC, it's possible that the platform is in e.g. S5 state, which means that PECI subsystem won't be able to communicate with CPUs in order to discover their properties (and create PECI devices corresponding with a given CPU).\nThat's the reason for exposing rescan - userspace running on BMC needs to call it once the platform is up (since currently we don't have any mechanism to detect it on the kernel side). Once PECI devices are created, their corresponding drivers (peci_cpu in this case) will bind to them, and will create auxiliary devices for HWMONs. Assuming there are no changes in physical devices on the platform during BMC kernel lifetime, rescan can be called once (as long as CPUs will respond and PECI devices will be created). If CPUs were responding during PECI subsystem initialization on BMC, there would be no need to call rescan at all.\n\nWhen it comes to dimmtemp, HWMON registration can potentially be delayed (even though PECI device already exists). Calling rescan multiple times won't change anything in this case.\nNote that this behavior didn't change between \"legacy\" PECI subsystem and the current one."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "What happens when CPU reset/powers down after these peci_cpus are created. They will still work after CPUs powers backup? legacy PECI works that way I think."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "In my testing they seem to be working nicely after the power is back."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 467,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "> When PECI subsystem loads on BMC, it's possible that the platform is in e.g. S5 state, which means that PECI subsystem won't be able to communicate with CPUs in order to discover their properties (and create PECI devices corresponding with a given CPU).\n> That's the reason for exposing rescan - userspace running on BMC needs to call it once the platform is up (since currently we don't have any mechanism to detect it on the kernel side). Once PECI devices are created, their corresponding drivers (peci_cpu in this case) will bind to them, and will create auxiliary devices for HWMONs.\n\nBased on Iwona's comment, I think config.state should be set based on HWMONs. State::ON is HWMONs for cpus are created, State::Ready is HWMONs for DIMM are created. Keep periodically do rescan until all configs are in READY state."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 467,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Doing rescan doesn't seem to be necessary if the CPU node is present, the DIMM nodes will appear automatically later when available. Please see if the latest version I pushed is OK, it seems to be working as expected in my testing."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 470,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "With new upstream PECI driver, is it guaranteed that the rescan path always exists?"
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 470,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "I'd say it's created unconditionally:\nhttps://elixir.bootlin.com/linux/latest/source/drivers/peci/core.c#L209\nhttps://elixir.bootlin.com/linux/latest/source/drivers/peci/sysfs.c#L36"
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 470,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "ACK"
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 473,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "nit: Legacy PECI API (open to discuss whether it is better than \"downstream\"\nActually, we probably don't need to log anything since there is nothing wrong and it can flood the logging for users still use legacy driver."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 473,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "During normal operation it prints \"CPU configs are parsed\" and \"Sensors are created\" even though there's nothing wrong, and the logs weren't considered flooded with that, so I thought one more informational message wouldn't harm but might help someone bringing up a new board and dealing with configuration options.\nI personally prefer to always have \"strace\" to run any daemon under that when in doubt about what's really happening, but seeing a message is a bit more straightforward.\nI do not mind eiher way, just tell me how you like it and I'll send an amended version."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 473,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "But parse config only happen once ( or few times when config is updated). detectCpu on the other hand can happen periodically (every few seconds) during run time. I prefer not to have this printed repeatedly."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 473,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Will remove the message, no problem."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 2
        },
        {
            "number": 4,
            "revision": "02fdbe0a8888231626fa27f43977a959efc4436f",
            "parents": [
                "c41be83a22f2b00db80352a49fa025ff47cb59aa"
            ],
            "ref": "refs/changes/25/62025/4",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1684144683,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 3
        },
        {
            "number": 5,
            "revision": "e713adebb068388247441f67a850471ceba17e3c",
            "parents": [
                "44ee17d8dd04b0376d024107a331428494f8231a"
            ],
            "ref": "refs/changes/25/62025/5",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1684145079,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Hi!\nI think I resolved all the comments. Is anything still missing?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Rudolph",
                        "email": "patrick.rudolph@9elements.com",
                        "username": "PatrickRudolph"
                    },
                    "message": "Patch series tested on IBM/SBP1. It exposes the temperature sensors of 4 CPUs and 64 DIMMs."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Arun Lal K M",
                        "email": "arun.lal@intel.com",
                        "username": "arunlalkm-intel"
                    },
                    "message": "Except some minor comments, looks good to me."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Arun Lal K M",
                        "email": "arun.lal@intel.com",
                        "username": "arunlalkm-intel"
                    },
                    "message": "Magic number?"
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "A magic character rather. And it's parsed by this function in Linux: https://elixir.bootlin.com/linux/latest/source/lib/kstrtox.c#L348 . I'll amend the patch with whatever the maintainers prefer."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "I am ok with adding a comment on the source of the magic char"
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> I am ok with adding a comment on the source of the magic char\n\nI added a link to the official kernel API documentation by Iwona, hope that's what you wanted.\n\nI'll repush after the CI issues with formatting are fixed by the maintainers."
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "CI build is fixed"
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Thank you.\nLooks like reuploading is not needed since CI was rerun successfully, and Verified is +1 now."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 3
        },
        {
            "number": 6,
            "revision": "6f32679afa96483ad508f39644e2839b24559f93",
            "parents": [
                "44ee17d8dd04b0376d024107a331428494f8231a"
            ],
            "ref": "refs/changes/25/62025/6",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1691057477,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 3
        },
        {
            "number": 7,
            "revision": "128099082fab4253141cc81a1b942be03a78aab7",
            "parents": [
                "4d1f8145236427fc3c3af4fb7a41f4ed9a861b5b"
            ],
            "ref": "refs/changes/25/62025/7",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1691057732,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 3
        },
        {
            "number": 8,
            "revision": "9ea77087bfc8c45e81650832d6d614f845be54e1",
            "parents": [
                "cb359da1621ae8f78d41880236433729d81ea2b2"
            ],
            "ref": "refs/changes/25/62025/8",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1691107337,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "For this to be useful first https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/62004 needs to be +2 and submitted."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 3
        },
        {
            "number": 9,
            "revision": "7470eff06f97918e1efe828de850e56f06140205",
            "parents": [
                "75f925870dd4684066b2bfabca2c29399d5ccd5e"
            ],
            "ref": "refs/changes/25/62025/9",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1691699640,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 3
        },
        {
            "number": 10,
            "revision": "6e69973ebd248f95483c8c8ee1d656520cda0e2f",
            "parents": [
                "4cd5a90bad356f17d5bdb289b2d67a9961ceb2ea"
            ],
            "ref": "refs/changes/25/62025/10",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1691702282,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "src/IntelCPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 44,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 63,
            "sizeDeletions": 3
        }
    ]
}
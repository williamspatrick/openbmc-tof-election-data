{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "Id9c33aa753c9af32880a0cc874b39c113222568f",
    "number": 66411,
    "subject": "psu-ng: Add peak input power sensor for some PSs",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-power/+/66411",
    "hashtags": [],
    "createdOn": 1693488140,
    "lastUpdated": 1694190710,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1693488140,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1693488178,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1693488178,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1693488677,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/73670/ : SUCCESS"
        },
        {
            "timestamp": 1693506625,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(3 comments)"
        },
        {
            "timestamp": 1694022571,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nCopied Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1694022571,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1694022611,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1694022611,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1694022663,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/73798/ : FAILURE"
        },
        {
            "timestamp": 1694022904,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1694100450,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1694109046,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE\")\n"
        },
        {
            "timestamp": 1694109046,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1694109056,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1694109056,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1694109123,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/73896/ : SUCCESS"
        },
        {
            "timestamp": 1694116429,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1694122146,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1694181411,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1694190710,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "fd6867a816f08db6e1ee57933d33cde7c35c3b22",
            "parents": [
                "97e9aea209c0cdb15c9697c99bdc4f1e37b9bd26"
            ],
            "ref": "refs/changes/11/66411/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1693488140,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Nice description and code!  Just noted a couple of assumptions I had that I'm pretty sure are correct.\n\nMight not hurt to mention in the description in: \n\"Some investigation showed the average power values weren't needed at all\nanymore, so that won't need an equivalent sensor.\"\nthat we still need the average but can get them from the existing hwmon input_power sensor so there's no confusion."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 685,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Assuming this call is removed in a later change..."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 685,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Yea, the next commit."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1165,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "I assume this associates the sensor to the chassis, so we don't need to update the inv mgr config file like we do for hwmon sensors..."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1165,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "That's correct, this handles all of the sensor associations here.\n\nI also tried to arrange things where we can just do all of the PSU sensors in this app so we can get rid of phosphor-hwmon in the future if it helps."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1165,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 46,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 149,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 123,
                    "deletions": -166
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 79,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util_base.hpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 412,
            "sizeDeletions": 167
        },
        {
            "number": 2,
            "revision": "f1f712c0c6175fa59e90ab60e184e74c97a84794",
            "parents": [
                "97e9aea209c0cdb15c9697c99bdc4f1e37b9bd26"
            ],
            "ref": "refs/changes/11/66411/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1694022571,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "CI fail was caused by an unrelated change that'll need to be fixed upstream first."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1165,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Nit: Should this be std::move(associations) so we don't make a copy?"
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1165,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "If I understand it right, I don't think it will help because the generated code doesn't take an rvalue:\n\n        virtual std::vector<std::tuple<std::string, std::string, std::string>> associations(std::vector<std::tuple<std::string, std::string, std::string>> value,\n               bool skipSignal);"
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1251,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Might want to mention AAAA and PPPP are in little endian format (according to record_manager.cpp).\n\nI see you did the swap on line 1253."
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 1251,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "line": 65,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Did you choose not to make this a MOCK_METHOD because it was a hassle to constantly provide the desired return value?\n\nI think there is a way in gtest to provide a default output."
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "line": 65,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Yea. I never needed to change the value of this, and didn't really want to add even more mock related calls into the testcase file."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 149,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 123,
                    "deletions": -166
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 79,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util_base.hpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 413,
            "sizeDeletions": 167
        },
        {
            "number": 3,
            "revision": "592bd27cce59ac57031b0e439371bee166a6ee7b",
            "parents": [
                "d6760265e74938f6acf49d3be9b9aecee42ae2b4"
            ],
            "ref": "refs/changes/11/66411/3",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1694109046,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 149,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 123,
                    "deletions": -166
                },
                {
                    "file": "phosphor-power-supply/util.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 79,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/util_base.hpp",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 413,
            "sizeDeletions": 167
        }
    ]
}
{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "id": "Ia3dc95820f985092d3974015f8812a7053e26236",
    "number": 66558,
    "subject": "Add version of BIOS to ItemUpdater",
    "owner": {
        "name": "Steven Liou",
        "email": "Steven.Liou@quantatw.com",
        "username": "Steven-Liou-quanta"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/66558",
    "hashtags": [],
    "createdOn": 1694496302,
    "lastUpdated": 1698661093,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1694496302,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1694500089,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1694506437,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 3: New patch set was added with same tree, parent tree, and commit message as Patch Set 2."
        },
        {
            "timestamp": 1694635793,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(2 comments)"
        },
        {
            "timestamp": 1694670483,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n"
        },
        {
            "timestamp": 1694670642,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1694670868,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1694805991,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1695102180,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 5: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1695240313,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: -Code-Review"
        },
        {
            "timestamp": 1696310754,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n"
        },
        {
            "timestamp": 1696310789,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1696312858,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1696387954,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Uploaded patch set 7."
        },
        {
            "timestamp": 1696387967,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1696661332,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1697179449,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1697216121,
            "reviewer": {
                "name": "Lei YU",
                "email": "mine260309@gmail.com",
                "username": "mine260309"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1697526408,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1697526486,
            "reviewer": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "message": "Abandoned\n\nsmbios-mdr is not widely used"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "196fb1232590d66ba3611aacf81d7346823b4f52",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/1",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1694496302,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "property_watch.cpp",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "property_watch.hpp",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -1
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 109,
            "sizeDeletions": 2
        },
        {
            "number": 2,
            "revision": "7b3326aa0f960456be1441671627b289e2e9b377",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/2",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1694500089,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "property_watch.cpp",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "property_watch.hpp",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -1
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 107,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "4b77aa2ea6d37e890653783501ba907200d2183f",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/3",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1694506437,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "item_updater.cpp",
                    "line": 850,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Just nitpicking, but perhaps this function could be called \"getBIOSVersion\" because it's not restoring the version, it's reading the value and returning it, and letting the caller function \"createBIOSObject\" create and restore the dbus object."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 850,
                    "reviewer": {
                        "name": "Steven Liou",
                        "email": "Steven.Liou@quantatw.com",
                        "username": "Steven-Liou-quanta"
                    },
                    "message": "Thanks for the suggestion. The function has been renamed."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 863,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "There's already a templated getProperty() function available in the utils.hpp file, let's use that one instead of creating a new file/function."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 863,
                    "reviewer": {
                        "name": "Steven Liou",
                        "email": "Steven.Liou@quantatw.com",
                        "username": "Steven-Liou-quanta"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "property_watch.cpp",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "property_watch.hpp",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -1
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 107,
            "sizeDeletions": 2
        },
        {
            "number": 4,
            "revision": "27f5623edc1af53e3c863bdd234302863dfd7c60",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/4",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1694670483,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 47,
            "sizeDeletions": 2
        },
        {
            "number": 5,
            "revision": "370b2d49ea5de9ca750f5e719e51e511949ec2e7",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/5",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1694670642,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "item_updater.cpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "This is not documented dbus object and it's not clear when and how the \u201cRevision\" interface is created and the property is set.\n\nCould you elaborate?\n\nInstead of setting the \"Revision\" interface somewhere else, why not let that app/service set software-manager's BIOS version directly?"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Steven Liou",
                        "email": "Steven.Liou@quantatw.com",
                        "username": "Steven-Liou-quanta"
                    },
                    "message": "Sorry for late reply.\nThe bios object is created by smbios-mdr.\nRef:https://github.com/openbmc/smbios-mdr/blob/21cb0e8750b76fff5860b985d8122fd653ca8a1f/include/smbios_mdrv2.hpp#L168\n\nsmbios-mdr parses a binary SMBIOS table(/var/lib/smbios/smbios2) which is sent from host firmware(BIOS) and publishes the system information on D-Bus.\n\nGetting bios version from smbios-mdr is good for data synchronization."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "This assumes software-manager should depend on the smbios-mdr service.\nI do not think it's a good idea to have such dependency.\n\nCould you consider making other service (e.g. smbios-mdr, or maybe phosphor-dbus-monitor) to set the property of software-manager's BIOS version object?"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Steven Liou",
                        "email": "Steven.Liou@quantatw.com",
                        "username": "Steven-Liou-quanta"
                    },
                    "message": "Smbios-mdr sets the property at https://github.com/openbmc/smbios-mdr/blob/e05a542324fcac40c9ff100287302ee92ed03621/src/system.cpp#L152\n\nBut ItemUpdater will get \"null\" if it is restarted for some reason.\n\nMay I ask what the reason is to set the property by smbios-mdr, not to get the property by ItemUpdater instead?"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "mine260309@gmail.com",
                        "username": "mine260309"
                    },
                    "message": "> Smbios-mdr sets the property at https://github.com/openbmc/smbios-mdr/blob/e05a542324fcac40c9ff100287302ee92ed03621/src/system.cpp#L152\n\nThat's good.\n\n> But ItemUpdater will get \"null\" if it is restarted for some reason.\n\nThis is another issue to resolve. Maybe you can serialize the BIOS version, or you could use some post-init script to fetch and update the BIOS version in the software-manager service.\n\nBy using `/xyz/openbmc_project/inventory/system/chassis/motherboard/bios` in this patch, it's actually use the \"serialized\" one as well, is it?\n\n> May I ask what the reason is to set the property by smbios-mdr, not to get the property by ItemUpdater instead?\n\nBe noted that smbios-mdr is not widely used and some x86 systems do not use this repo as well. So we can not assume it's generic in OpenBMC. software-manager is kind of generic here.\nThat's why I suggest setting the property by smbios-mdr."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Steven Liou",
                        "email": "Steven.Liou@quantatw.com",
                        "username": "Steven-Liou-quanta"
                    },
                    "message": "OK, Thanks for replies and suggestions."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 45,
            "sizeDeletions": 1
        },
        {
            "number": 6,
            "revision": "cefc0bfd3731616639feab61c99f82f81cf54d09",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/6",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1696310754,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 45,
            "sizeDeletions": 1
        },
        {
            "number": 7,
            "revision": "3bec10f52267cd1d03d5927e28c1a869724b2856",
            "parents": [
                "123dde15d8c796bc439d8081933eabb5b1ac42ec"
            ],
            "ref": "refs/changes/58/66558/7",
            "uploader": {
                "name": "Steven Liou",
                "email": "Steven.Liou@quantatw.com",
                "username": "Steven-Liou-quanta"
            },
            "createdOn": 1696387954,
            "author": {
                "name": "Steven Liou",
                "email": "steven.liou@quantatw.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 1
        }
    ]
}
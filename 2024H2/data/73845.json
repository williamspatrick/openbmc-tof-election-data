{
    "project": "openbmc/phosphor-dbus-interfaces",
    "branch": "master",
    "id": "Ibf2ea15b2fe1bd118ec0a04e5c0e91bc188c5bcf",
    "number": 73845,
    "subject": "state: bmc: update description of UpdateInProgress value",
    "owner": {
        "name": "Thang Tran",
        "email": "thuutran@amperecomputing.com",
        "username": "thangtran-ampere"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/73845",
    "hashtags": [],
    "createdOn": 1724145594,
    "lastUpdated": 1728637631,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1724145594,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1724145622,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724145622,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1724146004,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/90107/ : SUCCESS"
        },
        {
            "timestamp": 1724149323,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1724158398,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1724158469,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1724163769,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1724165225,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1724207698,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1724753790,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1724753837,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724753838,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1724753964,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1724754190,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/90743/ : SUCCESS"
        },
        {
            "timestamp": 1724849526,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1724857472,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1724857494,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724857495,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1724857889,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/90871/ : SUCCESS"
        },
        {
            "timestamp": 1724858012,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724858474,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1724860739,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724861746,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724865101,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724865106,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1724904542,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1724989657,
            "reviewer": {
                "name": "Thang Q. Nguyen",
                "email": "thang@os.amperecomputing.com",
                "username": "thangqn-ampere"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1725000513,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1728637631,
            "reviewer": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "message": "Abandoned\n\nThe updateInProgress value is used to indicate BMC is flashing itself, therefore, this commit is redundant. But the adding an error for `RequestedBMCTransition` is necessary, I created another commit to do that https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/75231"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "cb55b0fdf227c9d44c02d849eb66f21b3299f6e4",
            "parents": [
                "2fa322280d730a5ef123c8fe749b90ded90cd293"
            ],
            "ref": "refs/changes/45/73845/1",
            "uploader": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "createdOn": 1724145594,
            "author": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Who else needs to be added as reviewers?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Probably should add Ed and Gunnar as bmcweb will probably want to report this back via the Redfish API."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't know why BIOS is relevant here and needs to be changed."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Are you saying because on most systems the BIOS is in the BMC image? High level we want to highlight here that the BMC state will now be UpdateInProgress when it is updating any type of firmware. So it could be updating a power supply, a FPGA, another BMC, a PCIe switch, ... and in all those cases the BMC state will be UpdateInProgress."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "It wasn't obvious to me why we want to make this change.  Don't we already have ActivationInProgress associations, if necessary?  Why are we changing the state of the BMC itself?\n\n> Are you saying because on most systems the BIOS is in the BMC image? \n\nNo.  I don't think most systems have the BIOS code included in the BMC image."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "> Why are we changing the state of the BMC itself?\n\nThere was some ambiguity on this state. Is it only if the BMC flash itself is being updated, or if the BMC is doing an update to itself or any other device update? There was a lot of discussion over in https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/73456 on how we specifically know when just the BMC flash chip was being updated. But, from a users perspective, I think it would be valuable to know if the BMC is doing any type of firmware update. So the thought was to clarify that UpdateInProgress will be set when the BMC is doing _any_ type of firmware update to _any_ device (including itself)."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Thang Tran",
                        "email": "thuutran@amperecomputing.com",
                        "username": "thangtran-ampere"
                    },
                    "message": "Hi @Patrick, \n\n>I don't know why BIOS is relevant here and needs to be changed.\n\nThe Host's BIOS (EDKII ...) can be flashed by BMC, during this time, the CurrentBMCState should be set to UpdateInProgress, that why I mention BIOS here.\n\n\nHi @Andrew,\n>High level we want to highlight here that the BMC state will now be UpdateInProgress when it is updating any type of firmware.\n\nThis is exactly what I want. Thank you."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Thang Tran",
                        "email": "thuutran@amperecomputing.com",
                        "username": "thangtran-ampere"
                    },
                    "message": "I added one error to indicate the BMC is in update mode, the reboot action during this mode is prevented."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 61,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> The Host's BIOS (EDKII ...) can be flashed by BMC, during this time, the CurrentBMCState should be set to UpdateInProgress\n\nIn terms of interfaces, I disagree.   If this is the case, then Redfish needs some new interface to determine whether this BMC is currently updating (which is reflected in Managers), separate from BIOS (Which would be reflected in ComputerSystem).\n\nIf people are checking Manager to determine if ANY device is updating, that's not in the schema descriptions anywhere in Redfish that I can see.  the description is \"This value shall indicate the element is updating\", emphasis on \"this element\"."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "05d002ca156cb5f22dd2632f50c271ac9f845bc3",
            "parents": [
                "2fa322280d730a5ef123c8fe749b90ded90cd293"
            ],
            "ref": "refs/changes/45/73845/2",
            "uploader": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "createdOn": 1724753790,
            "author": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.errors.yaml",
                    "line": 4,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Why not use xyz.openbmc_project.Common.Error.Unavailable?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.errors.yaml",
                    "line": 4,
                    "reviewer": {
                        "name": "Thang Tran",
                        "email": "thuutran@amperecomputing.com",
                        "username": "thangtran-ampere"
                    },
                    "message": "Thank you for your comment, I updated this error."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -3
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.errors.yaml",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 26,
            "sizeDeletions": 3
        },
        {
            "number": 3,
            "revision": "fc3ae4969dd5206e88703d07e35b663dda9f7c04",
            "parents": [
                "2fa322280d730a5ef123c8fe749b90ded90cd293"
            ],
            "ref": "refs/changes/45/73845/3",
            "uploader": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "createdOn": 1724857472,
            "author": {
                "name": "Thang Tran",
                "email": "thuutran@amperecomputing.com",
                "username": "thangtran-ampere"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 59,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Should this go in its own interface?  I get that this is what Redfish does, but it would seem like\n\nReady/NotReady\n\nQuiesced/NotQuiesced\n\nUpdating/NotUpdating\n\nAre all independent states that can happen at any time.  For example, a bmc might be running an update while still in the NotReady State.  Obviously in Redfish we have to make a decision on which takes precedence, but I suspect separating out at least the update state into its own property is the right thing to do, rather than add a bunch more implementation details to the description."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 59,
                    "reviewer": {
                        "name": "Thang Tran",
                        "email": "thuutran@amperecomputing.com",
                        "username": "thangtran-ampere"
                    },
                    "message": "What do you think if we add new `UpdateStatus` property in this interface? This property indicate that BMC is updating something, and the BMC should not be reboot during this time.\n\nUpdateInProgress value is only used to indicate that BMC is updating itself.\n\nDo you have any comment for my suggestion @Patrick @Andrew @Ed?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 65,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "@Thang How does State Manager gets to know that there is an update in progress? Is state manager relying on existence of ActivationBlocksTransition interface?"
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 65,
                    "reviewer": {
                        "name": "Thang Tran",
                        "email": "thuutran@amperecomputing.com",
                        "username": "thangtran-ampere"
                    },
                    "message": "Currently, the phosphor-bmc-state-manager did not implement UpdateInProgress value. I created a commit to support this one https://gerrit.openbmc.org/c/openbmc/phosphor-state-manager/+/73456. The idea of this commit is the same with your comment, the phosphor-bmc-state-manager shall monitor `InterfaceAdded` signal. When `ActivationBlocksTransition` interface is added, it changes the CurrentBMCState to UpdateInProgress, when `ActivationBlocksTransition` is removed, it recover the BMC state."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 65,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "\"when ActivationBlocksTransition is removed, it recover the BMC state.\".\nThis should be more like when no ActivationBlocksTransition interface exist."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 65,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> The BMC should prevent BMC reboot action during updating phase to protect system.\n\nThis is a weird thing to enforce in the interface.  There's lots of implementations that don't need to enforce reboot prevention, and allow reboots (which abort the update process).\n\nI suspect at this interface level, this description should be removed.  The update daemon MIGHT operate that way, but this interface shouldn't' really reflect that."
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "line": 65,
                    "reviewer": {
                        "name": "Thang Q. Nguyen",
                        "email": "thang@os.amperecomputing.com",
                        "username": "thangqn-ampere"
                    },
                    "message": "I think that when a firmware is being flashed but not completed, terminating the action might take the firmware broken. So, if we allow the BMC reboots during firmware flashing, we might have the firmware broken"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "yaml/xyz/openbmc_project/State/BMC.interface.yaml",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 3
        }
    ]
}
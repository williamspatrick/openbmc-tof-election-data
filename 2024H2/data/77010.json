{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I22f443268927c4b94f97379050682bc818304e61",
    "number": 77010,
    "subject": "Fix PATCH bmc/NetworkProtocol SSH/ProtocolEnabled",
    "owner": {
        "name": "Joseph Reynolds",
        "email": "joseph.reynolds1@ibm.com",
        "username": "joseph-reynolds"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/77010",
    "hashtags": [],
    "createdOn": 1735597817,
    "lastUpdated": 1735784176,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1735597817,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1735597829,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1735597829,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1735598149,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/97527/ : FAILURE"
        },
        {
            "timestamp": 1735598735,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1735598780,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1735598780,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1735599095,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/97528/ : FAILURE"
        },
        {
            "timestamp": 1735601975,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1735601995,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1735601995,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1735603473,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/97529/ : SUCCESS"
        },
        {
            "timestamp": 1735667836,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(3 comments)"
        },
        {
            "timestamp": 1735680357,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1735680437,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1735784106,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1735784176,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "16ed3c1d1b6e9f8bbcc65fb6a34fca61458e5dc1",
            "parents": [
                "b437a535064719778cb6d33f1b2b6ad32e20b204"
            ],
            "ref": "refs/changes/10/77010/1",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "createdOn": 1735597817,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -20
                }
            ],
            "sizeInsertions": 53,
            "sizeDeletions": 20
        },
        {
            "number": 2,
            "revision": "c3218e044ec0344b835a4fa6b9399c2ab0c38666",
            "parents": [
                "b437a535064719778cb6d33f1b2b6ad32e20b204"
            ],
            "ref": "refs/changes/10/77010/2",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "createdOn": 1735598735,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 34,
                    "deletions": -20
                }
            ],
            "sizeInsertions": 53,
            "sizeDeletions": 20
        },
        {
            "number": 3,
            "revision": "4c300eb8fe306a669d916fcc25261fea9818189c",
            "parents": [
                "b437a535064719778cb6d33f1b2b6ad32e20b204"
            ],
            "ref": "refs/changes/10/77010/3",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "createdOn": 1735601975,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph.reynolds1@ibm.com",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Needs a little more details here on what \"no effect\" means."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph.reynolds1@ibm.com",
                        "username": "joseph-reynolds"
                    },
                    "message": "By no effect, I mean the HTTP operation performs no D-Bus operation to affect SSH enablement, SSH enablement is not changed, and there is no indication of error.\nNote this is after taking into account the 15 second delay used by the configuration service manager."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> By no effect, I mean the HTTP operation performs no D-Bus operation to affect SSH enablement, SSH enablement is not changed, and there is no indication of error.\n> Note this is after taking into account the 15 second delay used by the configuration service manager.\n\n\nThe above is what your commit message should say, along with what request (in curl or whatever) you're attempting so that others can reproduce."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Revert is certainly something to be discussed, but why is setDbusProperty failing in this case?  Code looks equivalent."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph.reynolds1@ibm.com",
                        "username": "joseph-reynolds"
                    },
                    "message": "Originally the handleProtocolEnabled() function handled only \"IPMI/ProtocolEnabled\"; the \"IPMI/ProtocolEnabled\" was hard-coded in the function body.  Then this function was enhanced to also handle \"SSH/ProtocolEnabled\" and take the Redfish property name as a parameter.\nCommit 87c449664 [here: https://github.com/openbmc/bmcweb/commit/87c449664e5375abb040af6fad63ef965c311bec#diff-c8f2d16b1cd85758922a4bdc29a25e0eed76b9141d5fcf427cd8f269b3f1e439R394] apparently accidentally changed this back to hard-coded IPMI/ProtocolEnabled.\n\nNote that two later commits affect this same line of code: e93abac6d and then bd79bce8c.  This series of commits makes it difficult to revert the commit which introduced this bug.  Hence this patch."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Then this function was enhanced to also handle \"SSH/ProtocolEnabled\" and take the Redfish property name as a parameter.\n\nContinue this line of thought just a little...... How did this enhancement break things, and how does your commit fix it?  (presumably you tested that this fixes the issue?)\n\nCan we just fix the args on this call?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Happy to revert this if that's what's needed, but we need more details on the actual root cause and failure mode so that we don't accidentally accept this patch again."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph.reynolds1@ibm.com",
                        "username": "joseph-reynolds"
                    },
                    "message": "The problem is introduced by https://github.com/openbmc/bmcweb/commit/87c449664e5375abb040af6fad63ef965c311bec#diff-c8f2d16b1cd85758922a4bdc29a25e0eed76b9141d5fcf427cd8f269b3f1e439R394.  It is probably worth re-reviewing that patch.  For additional details, see my response to the comment at line 12."
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 421,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph.reynolds1@ibm.com",
                        "username": "joseph-reynolds"
                    },
                    "message": "Although this code may be functionally correct, it should continue to use setDbusProperty() [but not hard-code \"IPMI/ProtocolEnabled\"].\nAs such, I am setting this to WIP."
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 421,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Although this code may be functionally correct, it should continue to use setDbusProperty() [but not hard-code \"IPMI/ProtocolEnabled\"].\n> As such, I am setting this to WIP.\n\n\nSounds good to me.  Let me know when you've got something that works."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 20,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 39,
            "sizeDeletions": 6
        }
    ]
}
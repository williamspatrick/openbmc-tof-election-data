{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "Ie6ab37fd944243983319ccfd88976f17a73d86d0",
    "number": 75398,
    "subject": "meta-facebook: yosemite4: gpio: rescan FRU only after BMC ready",
    "owner": {
        "name": "Peter Ho",
        "email": "peter.ho.wiwynn@gmail.com",
        "username": "PeterHo-wiwynn"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/openbmc/+/75398",
    "hashtags": [],
    "createdOn": 1729838449,
    "lastUpdated": 1730390719,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1729838449,
            "reviewer": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1729838481,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1729838481,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1729838487,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/25707/"
        },
        {
            "timestamp": 1729839086,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/25707/ : SUCCESS"
        },
        {
            "timestamp": 1729843050,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nIBM Simulation CI: p10bmc simulation tests passed"
        },
        {
            "timestamp": 1730150291,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1730194427,
            "reviewer": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1730197948,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1730257286,
            "reviewer": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1730314688,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1730347182,
            "reviewer": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1730347221,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1730347221,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1730347228,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/25812/"
        },
        {
            "timestamp": 1730347229,
            "reviewer": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1730347883,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/25812/ : SUCCESS"
        },
        {
            "timestamp": 1730358750,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nIBM Simulation CI: p10bmc simulation tests passed"
        },
        {
            "timestamp": 1730390715,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1730390719,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 64273a4934a650b7ee80e3ad9b4f72190776d61a"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "c80ce9c041b595283ad51fa92b6df29c35f02703",
            "parents": [
                "3b3525f1caec3f6beeb463b161718b10cf6928f6"
            ],
            "ref": "refs/changes/98/75398/1",
            "uploader": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "createdOn": 1729838449,
            "author": {
                "name": "PeterHo-wiwynn",
                "email": "Peter_MH_Ho@wiwynn.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Why is this GPIO changing state during the BMC start up?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Peter Ho",
                        "email": "peter.ho.wiwynn@gmail.com",
                        "username": "PeterHo-wiwynn"
                    },
                    "message": "The CPLD will wait for BMC to set the BMC-ready pin on CPLD, bypassing the slot*_stby_power_good to the BMC."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Else where we have suggested that we need to allow-list/block-list fru-device so only the real EEPROM addresses are probed.  Please make this change first and see if this is still an issue."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Peter Ho",
                        "email": "peter.ho.wiwynn@gmail.com",
                        "username": "PeterHo-wiwynn"
                    },
                    "message": "The sequence was:\nBMC boot up -> FruDevice initial scan and publish D-Bus path -> EntityManager publish D-Bus path -> GPIO asserted and FRU rescanned -> EntityManager removed inventory -> pldmd get configuration failed -> EntityManager added inventory\n\nThe FruDevice rescan sequence will remove the existing path and add it back according to the scan result. The EntityManager had a chance to remove inventory and add it back after a few seconds. \n\nSo adding a block list shouldn't affect this sequence but can improve efficiency and avoid potential i2c issues.\n\nI've created a blocklist for yv4:\nhttps://gerrit.openbmc.org/c/openbmc/openbmc/+/75406"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> The FruDevice rescan sequence will remove the existing path and add it back according to the scan result. The EntityManager had a chance to remove inventory and add it back after a few seconds.\n\nDoesn't this sound like a bug in fru-device?  It shouldn't be removing items on the rescan unless those eeproms no longer exist."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Peter Ho",
                        "email": "peter.ho.wiwynn@gmail.com",
                        "username": "PeterHo-wiwynn"
                    },
                    "message": "There might be a case where the EEPROM exists but its content has changed. In this case, we will need to compare every single byte to determine if there is a difference. The easiest way to do this is to remove the existing paths. However, I think it needs more time if we want to change FruDevice's behavior.\n\nHowever, it is related to the critical. Could we merge this first or we push an internal patch for this?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> In this case, we will need to compare every single byte to determine if there is a difference.\n\nI don't think this is entirely necessary.  We just need to update properties as the content is parsed out.\n\n> However, it is related to the critical. Could we merge this first or we push an internal patch for this?\n\nWe can merge this, but I'd like a big comment in the code block to indicate what the workaround is and that we'll plan to remove it in the future."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Peter Ho",
                        "email": "peter.ho.wiwynn@gmail.com",
                        "username": "PeterHo-wiwynn"
                    },
                    "message": "Done"
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/gpio/phosphor-gpio-monitor/rescan-fru-ocp-setting",
                    "line": 5,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Please put a big comment here as to why this is being done and that it will be removed in the future."
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/gpio/phosphor-gpio-monitor/rescan-fru-ocp-setting",
                    "line": 5,
                    "reviewer": {
                        "name": "Peter Ho",
                        "email": "peter.ho.wiwynn@gmail.com",
                        "username": "PeterHo-wiwynn"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/gpio/phosphor-gpio-monitor/rescan-fru-ocp-setting",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "94f77fef3afc00ef074865283b436d5136f0fd7e",
            "parents": [
                "14845bead2d99b2334d09f440ad0c7fd425ad405"
            ],
            "ref": "refs/changes/98/75398/2",
            "uploader": {
                "name": "Peter Ho",
                "email": "peter.ho.wiwynn@gmail.com",
                "username": "PeterHo-wiwynn"
            },
            "createdOn": 1730347182,
            "author": {
                "name": "PeterHo-wiwynn",
                "email": "Peter_MH_Ho@wiwynn.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/gpio/phosphor-gpio-monitor/rescan-fru-ocp-setting",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 30,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "64273a4934a650b7ee80e3ad9b4f72190776d61a",
            "parents": [
                "4fe8548841d7a6f9c0f92e900ec00d1233a0a27f"
            ],
            "ref": "refs/changes/98/75398/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1730390719,
            "author": {
                "name": "PeterHo-wiwynn",
                "email": "Peter_MH_Ho@wiwynn.com",
                "username": ""
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meta-facebook/meta-yosemite4/recipes-phosphor/gpio/phosphor-gpio-monitor/rescan-fru-ocp-setting",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 30,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "I097b4aeefc0967d5591b8fb6aefb3c600c9f77f8",
    "number": 76108,
    "subject": "psutils: Add new functions to  AEI Updater class",
    "owner": {
        "name": "Faisal Awada",
        "email": "faisal@us.ibm.com",
        "username": "faisal-awada"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-power/+/76108",
    "hashtags": [],
    "createdOn": 1732658653,
    "lastUpdated": 1733244954,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1732658653,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1732658692,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1732658692,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1732659104,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/95377/ : SUCCESS"
        },
        {
            "timestamp": 1732659289,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1732715990,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1732716027,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1732716027,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1732716450,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/95450/ : SUCCESS"
        },
        {
            "timestamp": 1732748973,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1733162091,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(5 comments)"
        },
        {
            "timestamp": 1733176281,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1733176324,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1733176324,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1733176387,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/95642/ : FAILURE"
        },
        {
            "timestamp": 1733176560,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1733176604,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1733176604,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1733177029,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/95643/ : SUCCESS"
        },
        {
            "timestamp": 1733177099,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 4:\n\n(9 comments)"
        },
        {
            "timestamp": 1733178141,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1733178400,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1733178635,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1733244894,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1733244945,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1733244954,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "8f8c9da8eee15f6438db1e280e5833fc2bb5c717",
            "parents": [
                "5a582d3c7a6865eaa0d80f0dc6aeb85b2f72c2a8"
            ],
            "ref": "refs/changes/08/76108/1",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1732658653,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Please review"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 46,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 110,
                    "deletions": -4
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 56,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 212,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "511d18bc4c79cb2c8c997c5277a23798c9a43997",
            "parents": [
                "5a582d3c7a6865eaa0d80f0dc6aeb85b2f72c2a8"
            ],
            "ref": "refs/changes/08/76108/2",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1732715990,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 25,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Nit: open"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 25,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Done"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Couple of comments so far, Shawn/Matt will do a better review than me though."
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Have you heard back from AEI on a final value to use for this yet?"
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 36,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "I did not get any response from AEI, you're listed on the email hopefully they reply to all."
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 234,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "This comparison doesn't make sense to me.\n\nThe BLOCK_WRITE_SIZE constant is 0x25/37 decimal.  This is the number of bytes written in the I2C block write/read.  It includes the index bytes (4), data bytes (32), and PEC (1).  It does not include the I2C command F9 or the byte count itself.\n\nThe cmdBlockWrite vector at this point includes the I2C command F9 (1), byte count (1), index bytes (4), and data bytes (32), but no PEC. So I think the vector size should be 38?  Then the resize() sets it to 38 (no change).\n\nSo should the comparison be `if cmdBlockWrite.size() != BLOCK_WRITE_SIZE + 1`?\n\nPlease double check my math.  I could be wrong."
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 234,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Correct I missed it on line 234, while correct on line 236"
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 240,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "I think this is a bug.  The documentation on assign says:\n> If either argument is an iterator into *this, the behavior is undefined. \n\nSo it might work now, but it might stop with a different version of the compiler.  In general assigning a vector to a subset of itself one byte at a time is tricky to get right.\n\nI think the supported way would be\n```\ncmdBlockWrite.erase(cmdBlockWrite.begin(), cmdBlockWrite.begin() + 2);\n```\n\nNote that the second parameter to erase() is the element *after* the last one to erase.  See https://en.cppreference.com/w/cpp/container/vector/erase."
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 240,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Modified to use erase instead."
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 272,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "maybe use a constant for status in the check below like the other i2c read compares?"
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 272,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Will add constant"
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "with a later change, here is where we'll want to log an informational PEL for the download success"
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "You want to log PEL for success, what about failure?"
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "line": 276,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Informational for success, serviceable for failure, these can be added in a later story as we discussed."
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "line": 85,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "It is not necessary to include the return type in the @return comment.  We can look a line down and see it.  If the return type changes, you'll have to change it in two spots.  Same comment for other methods."
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "line": 85,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Removed all return type from doxygen."
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "line": 117,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "This method name is a little confusing, since there are multiple commands that are written (ISP_COMMAND, ISP_MEMORY).\n\nI believe this is specific to the ISP_MEMORY (F9) command, so the doxygen should probably state that.  e.g. `Prepares an ISP_MEMORY command block by ...`"
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "line": 117,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Modified to: Prepares an ISP_MEMORY command block by processing the firmware ...."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 110,
                    "deletions": -4
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 56,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 224,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "bb3d559a5b5e5dce8a3c5333b3b3d7f2c12411eb",
            "parents": [
                "5a582d3c7a6865eaa0d80f0dc6aeb85b2f72c2a8"
            ],
            "ref": "refs/changes/08/76108/3",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1733176281,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 112,
                    "deletions": -4
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 61,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 231,
            "sizeDeletions": 8
        },
        {
            "number": 4,
            "revision": "8dca5075fc2bc68d7900d0ffa49a499351be197a",
            "parents": [
                "5a582d3c7a6865eaa0d80f0dc6aeb85b2f72c2a8"
            ],
            "ref": "refs/changes/08/76108/4",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1733176560,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Resolved all comments, please review"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/aei_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 112,
                    "deletions": -4
                },
                {
                    "file": "tools/power-utils/aei_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 61,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 231,
            "sizeDeletions": 8
        }
    ]
}
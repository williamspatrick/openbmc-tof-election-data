{
    "project": "openbmc/phosphor-psu-code-mgmt",
    "branch": "master",
    "id": "I10166a1412fb9de421bd304c40916a81c1ca0558",
    "number": 74567,
    "subject": "Retrieve FW version from IMG_BUILTIN_DIR",
    "owner": {
        "name": "Faisal Awada",
        "email": "faisal@us.ibm.com",
        "username": "faisal-awada"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-psu-code-mgmt/+/74567",
    "hashtags": [],
    "createdOn": 1726148285,
    "lastUpdated": 1726256566,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1726148285,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1726148308,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726148308,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1726148339,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91758/ : FAILURE"
        },
        {
            "timestamp": 1726149511,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1726149547,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726149547,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1726149758,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91759/ : SUCCESS"
        },
        {
            "timestamp": 1726151331,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(6 comments)"
        },
        {
            "timestamp": 1726168597,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1726172722,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1726172741,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 2:\n\n(4 comments)"
        },
        {
            "timestamp": 1726172754,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726172754,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1726173101,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91773/ : SUCCESS"
        },
        {
            "timestamp": 1726240619,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1726240935,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1726241564,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1726244322,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review+1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1726244364,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726244364,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1726244396,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91812/ : FAILURE"
        },
        {
            "timestamp": 1726247251,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1726247285,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726247285,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1726247351,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1726247495,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91813/ : SUCCESS"
        },
        {
            "timestamp": 1726249418,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1726250151,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1726255722,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1726256566,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "494c1c476d5740997d8ea96067b72d5f429695b9",
            "parents": [
                "80c2daae12d8ca7a9f9d033bdeb47b295853cf01"
            ],
            "ref": "refs/changes/67/74567/1",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1726148285,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 73,
            "sizeDeletions": 5
        },
        {
            "number": 2,
            "revision": "e18918ca989140e9b7c174e7d0bba44061472836",
            "parents": [
                "80c2daae12d8ca7a9f9d033bdeb47b295853cf01"
            ],
            "ref": "refs/changes/67/74567/2",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1726149511,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Nit: Since this repository only contains one application, you don't need a prefix indicating the affected application."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "removed"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Usually the commit message contains a higher level description of what enhancement or fix it provides.  We can see from the diffs what the lower-level implementation looks like.\n\nI think the big picture here is this commit provides an option to only install PSU firmware found in the IMG_BUILTIN_DIR.  This is the required behavior on some systems types."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Modified to: \nAdded method to retrieve firmware level found in IMG_BUILTIN_DIR. This is required behavior on some sytems types."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Looks good in general.  Some smaller things to consider cleaning up."
                },
                {
                    "file": "meson.build",
                    "line": 46,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Can you use cdata.set() so that the value is a boolean true or false?  I'm not sure why the value needs to be a 0 or 1?\n\nAlso, would this be clearer if it was named ALWAYS_USE_IMG_DIR_BUILTIN so that it exactly matched the option IMG_DIR_BUILTIN?"
                },
                {
                    "file": "meson.build",
                    "line": 46,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "I was reading this page when I made my this comment:\n\nhttps://mesonbuild.com/Reference-manual_returned_cfg_data.html#cfg_dataset\n\nIt looked like you could set a variable to a boolean value via set()\n\nHowever, from the following page\n\nhttps://mesonbuild.com/Configuration.html#configuring-without-an-input-file\n\nIt looks like a boolean value results in a simple #define with no value\n\n```\nconf_data.set('BAR', true, description : 'Set BAR if it is available')\n\n/* Set BAR if it is available */\n#define BAR\n```\n\nSo I think what you have here is correct and my comment was wrong."
                },
                {
                    "file": "src/item_updater.hpp",
                    "line": 206,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Probably don't need to repeat the name in the description.  Otherwise if this is renamed in the future they'll have to change it in the comment too."
                },
                {
                    "file": "src/item_updater.hpp",
                    "line": 206,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "removed function name"
                },
                {
                    "file": "src/item_updater.hpp",
                    "line": 207,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "I didn't understand this part?"
                },
                {
                    "file": "src/item_updater.hpp",
                    "line": 207,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Here is what I meant the version for appropriate PSU Model.\n\nChanged to:\nThis function retrieves the firmware version from the PSU model directory that is in the IMG_DIR_BUILTIN."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 73,
            "sizeDeletions": 5
        },
        {
            "number": 3,
            "revision": "5a1ccaf0f6e6338bf6487b110c3d251b92b44500",
            "parents": [
                "80c2daae12d8ca7a9f9d033bdeb47b295853cf01"
            ],
            "ref": "refs/changes/67/74567/3",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1726172722,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/item_updater.cpp",
                    "line": 397,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "not entirely sure what this change has to do with the commit message?"
                },
                {
                    "file": "src/item_updater.cpp",
                    "line": 397,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "can you put this in a separate commit."
                },
                {
                    "file": "src/item_updater.cpp",
                    "line": 397,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Restored present to previous code"
                },
                {
                    "file": "src/item_updater.cpp",
                    "line": 424,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "usually these would be #ifdef/#ifndef, since it is a value known at compile time.  That being said, there is better CI coverage I guess when it isn't, and I'm not sure if anyone else cares enough either way."
                },
                {
                    "file": "src/item_updater.cpp",
                    "line": 424,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Talked with Shawn, and this works as is."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                }
            ],
            "sizeInsertions": 71,
            "sizeDeletions": 5
        },
        {
            "number": 4,
            "revision": "71a5f112b52e2f41891de982dbee30c0dbe54d12",
            "parents": [
                "80c2daae12d8ca7a9f9d033bdeb47b295853cf01"
            ],
            "ref": "refs/changes/67/74567/4",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1726244322,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 1
        },
        {
            "number": 5,
            "revision": "fb86e7947e455a33ffd04a8653f520c1b3ac2352",
            "parents": [
                "80c2daae12d8ca7a9f9d033bdeb47b295853cf01"
            ],
            "ref": "refs/changes/67/74567/5",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1726247251,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "So the meson option 'ALWAYS_USE_BUILTIN_IMG_DIR' is used to both:\n1. Ignore the /var/lib \"saved\" image and only use the one included with the bmc (/usr/share...)\n2. Always put the image included with the bmc on the psu's if different, regardless if older or newer (aka the 'override' flag in the design doc).\n\nLooks good, thanks."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.hpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 33,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 67,
            "sizeDeletions": 2
        }
    ]
}
{
    "project": "openbmc/phosphor-certificate-manager",
    "branch": "master",
    "id": "I53907253857b04629914290a77b140c338344d05",
    "number": 74307,
    "subject": "Update copyCertificate function to preserve file metadata",
    "owner": {
        "name": "Zac Tang",
        "email": "zactang1024@gmail.com",
        "username": "ZTang813"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-certificate-manager/+/74307",
    "hashtags": [],
    "createdOn": 1725483765,
    "lastUpdated": 1727127849,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1725483765,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1725483776,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1725484068,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Uploaded patch set 2: Commit message was updated."
        },
        {
            "timestamp": 1725484094,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1725570718,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1725570738,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725570738,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1725570758,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91429/ : FAILURE"
        },
        {
            "timestamp": 1725570924,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Patch Set 4: Published edit on patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725570953,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725570953,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1725570980,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91430/ : FAILURE"
        },
        {
            "timestamp": 1725573700,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725573733,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725573733,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1725573752,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91431/ : FAILURE"
        },
        {
            "timestamp": 1725573847,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Patch Set 6: Published edit on patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725573878,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725573878,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1725573895,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91432/ : FAILURE"
        },
        {
            "timestamp": 1725575333,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Uploaded patch set 7.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725575384,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725575384,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1725575908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91435/ : FAILURE"
        },
        {
            "timestamp": 1725577021,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Uploaded patch set 8.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725577068,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725577068,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: -Ok-To-Test"
        },
        {
            "timestamp": 1725577859,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91436/ : SUCCESS"
        },
        {
            "timestamp": 1726065794,
            "reviewer": {
                "name": "MARRI DEVENDER RAO",
                "email": "devenrao@in.ibm.com",
                "username": "devenrao"
            },
            "message": "Patch Set 8: Code-Review+1"
        },
        {
            "timestamp": 1726261198,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 8:\n\n(1 comment)"
        },
        {
            "timestamp": 1726261781,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Patch Set 8:\n\n(1 comment)"
        },
        {
            "timestamp": 1726780128,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 8:\n\n(1 comment)"
        },
        {
            "timestamp": 1726780129,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 8: Code-Review+2"
        },
        {
            "timestamp": 1727127849,
            "reviewer": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "4c348d4bdd46585bbfe927aaf13982f15bc10b9b",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/1",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725483765,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 19
        },
        {
            "number": 2,
            "revision": "94bc07d93cc362890917ac163e311f67f4f7039a",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/2",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725484068,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 19
        },
        {
            "number": 3,
            "revision": "8fb42ba10e149777b618b7c4c9ea2b64e1f0ecaa",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/3",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725570718,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "NO_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 19
        },
        {
            "number": 4,
            "revision": "16435cdf51d0dd9a9a1eb06c1b6b03180bc529fe",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/4",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725570924,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 19
        },
        {
            "number": 5,
            "revision": "1292cbb839f9edeb02428f6624e145339f5e4c09",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/5",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725573700,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -25
                }
            ],
            "sizeInsertions": 44,
            "sizeDeletions": 25
        },
        {
            "number": 6,
            "revision": "b99b4ddcc50ad36ec290cb699b842fa9e27a245b",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/6",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725573847,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 19
        },
        {
            "number": 7,
            "revision": "67e89704790926d201f2bb4d000555fcdcc158a7",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/7",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725575333,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 19
        },
        {
            "number": 8,
            "revision": "cbbec8d9907cba4f2d76af065055e5f5333bd064",
            "parents": [
                "a2f68d8b7955970d8c4dd986a1a226a616f0e0aa"
            ],
            "ref": "refs/changes/07/74307/8",
            "uploader": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "createdOn": 1725577021,
            "author": {
                "name": "Zac Tang",
                "email": "zactang1024@gmail.com",
                "username": "ZTang813"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "certificate.cpp",
                    "line": 126,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Is there an another way to do this via C APIs?"
                },
                {
                    "file": "certificate.cpp",
                    "line": 126,
                    "reviewer": {
                        "name": "Zac Tang",
                        "email": "zactang1024@gmail.com",
                        "username": "ZTang813"
                    },
                    "message": "I've consulted file system management teams and unfortunately native C++ libraries don't have functions to gracefully copy both file metadata and content. \n\nThe only other way to do use a combination of `stat()`, `chmod()`, `chown()`, `utime()` assuming the process has root privileges to override the metadata.\n\nSomething like this:\n```\nvoid Certificate::copyCertificate(const std::string& certSrcFilePath,\n                                  const std::string& certFilePath)\n{\n        // Copy file content (no change to original code)\n        .....\n        \n        // Add the following code to preserve file meta.\n        struct stat src_stat;\n        if (stat(certSrcFilePath.c_str(), &src_stat) != 0)\n        {\n            lg2::error(\"Failed to stat certificate source file SRC:{SRC}\",\n                       \"SRC\", certSrcFilePath);\n        }\n        if (chmod(certFilePath.c_str(), src_stat.st_mode) != 0)\n        {\n            lg2::error(\"Failed to chmod certificate source file SRC:{SRC}\",\n                       \"SRC\", certSrcFilePath);\n        }\n        if (chown(certFilePath.c_str(), src_stat.st_uid, src_stat.st_gid) != 0)\n        {\n            lg2::error(\"Failed to chown certificate source file SRC:{SRC}\",\n                       \"SRC\", certSrcFilePath);\n        }\n\n        struct utimbuf time_buf;\n        time_buf.actime = src_stat.st_atime;\n        time_buf.modtime = src_stat.st_mtime;\n        if (utime(certFilePath.c_str(), &time_buf) != 0)\n        {\n            lg2::error(\"Failed to choutimewn certificate source file SRC:{SRC}\",\n                       \"SRC\", certSrcFilePath);\n        }\n}\n```"
                },
                {
                    "file": "certificate.cpp",
                    "line": 126,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "certificate.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -19
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 19
        }
    ]
}
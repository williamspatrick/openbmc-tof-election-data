{
    "project": "openbmc/ipmbbridge",
    "branch": "master",
    "id": "Ibbfd202118a69c270cbb4f047ef44f15ebf72bd6",
    "number": 69888,
    "subject": "Add delay between frame send retries",
    "owner": {
        "name": "cchoux",
        "email": "cosmo.chou@quantatw.com",
        "username": "cchoux"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/ipmbbridge/+/69888",
    "hashtags": [],
    "createdOn": 1709739897,
    "lastUpdated": 1725850846,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1709739897,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1709739926,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709739926,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1709739976,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80245/ : SUCCESS"
        },
        {
            "timestamp": 1709740275,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Patch Set 1:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1709744769,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1709827632,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709827652,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709827652,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1709827713,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80292/ : SUCCESS"
        },
        {
            "timestamp": 1709828112,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1709911714,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1709911742,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1709911742,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1709911817,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/80334/ : SUCCESS"
        },
        {
            "timestamp": 1712871081,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(7 comments)"
        },
        {
            "timestamp": 1725761189,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Code-Review-1 (copy condition: \"changekind:NO_CHANGE OR changekind:NO_CODE_CHANGE OR changekind:TRIVIAL_REBASE OR is:MIN\")\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725761279,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725761279,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1725761297,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91560/ : FAILURE"
        },
        {
            "timestamp": 1725780280,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725780345,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725780345,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1725780424,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91561/ : SUCCESS"
        },
        {
            "timestamp": 1725850846,
            "reviewer": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "message": "Patch Set 5:\n\n(7 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "125fcd1a412088e3f6412ab29fc61d77ec4ba1f0",
            "parents": [
                "0afdd8cc08adb5a5657766cc259fb7e98a0d807f"
            ],
            "ref": "refs/changes/88/69888/1",
            "uploader": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "createdOn": 1709739897,
            "author": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm very surprised there isn't a single value that would work for all cases.\n\nWhat I suspect is needed here is an exponential backoff\n\n1st retry immediate\n2nd retry 10ms\n3rd retry 100ms\n4th retry 1000ms\n\nAnd that we likely don't need a per-system configured value."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "Updated to 10ms, 20ms, 40ms ...\nThanks."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 291,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This is blocking in an async reactor, which blocks all transactions.  To do what you're wanting, you want to create a boost asio steady_timer, and arm it for the retry time."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 291,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "Updated. Thanks."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "ADDED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 34,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "85dca0b65fd1062b81d0ee3a7f19679da0e9eed5",
            "parents": [
                "0afdd8cc08adb5a5657766cc259fb7e98a0d807f"
            ],
            "ref": "refs/changes/88/69888/2",
            "uploader": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "createdOn": 1709827632,
            "author": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "ADDED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 49,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "933f38725f52c7b51e675293d024e87afaeb9254",
            "parents": [
                "0afdd8cc08adb5a5657766cc259fb7e98a0d807f"
            ],
            "ref": "refs/changes/88/69888/3",
            "uploader": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "createdOn": 1709911714,
            "author": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "ipmbbridged.cpp",
                    "line": 293,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Why do we need two branches here?  Can't we just set expires_after(0ms) and it will run immediately?  currentRetryCnt > 0 looks like it's trying to avoid the timer entirely."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 293,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "revised the logic."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 295,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This timer should be a variable on the IPMIChannel class to keep it alive.  We shouldn't need to construct/destroy the timer every loop."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 295,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "changed to member variable, \"retryTimer\"."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 297,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This needs documentation with an inline code comment, and to be done on a different line.  As written, I can't read this codde."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 297,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "revised the logic and comment."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 299,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "call this ec to be consistent."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 299,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "Done"
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 304,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Please put this in its own code block.  We're already in a lambda in this context (which per the coding guidelines, we shouldn't be), but this makes it worse."
                },
                {
                    "file": "ipmbbridged.cpp",
                    "line": 304,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "Done"
                },
                {
                    "file": "meson.build",
                    "line": 30,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "most of the time we use configure_file.  Any reason we'd use defines here?"
                },
                {
                    "file": "meson.build",
                    "line": 30,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "removed the option."
                },
                {
                    "file": "meson.options",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can we just try not having this as an option, and add it as an option if anything breaks?"
                },
                {
                    "file": "meson.options",
                    "line": 11,
                    "reviewer": {
                        "name": "cchoux",
                        "email": "cosmo.chou@quantatw.com",
                        "username": "cchoux"
                    },
                    "message": "removed the option."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "ADDED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.hpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "ipmbbridged.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 61,
            "sizeDeletions": 3
        },
        {
            "number": 4,
            "revision": "08005b87565346f83e3e0a435e8099b01a85152d",
            "parents": [
                "9898d612c3f3fbacd08daff934a83bdb2a7c0dd5"
            ],
            "ref": "refs/changes/88/69888/4",
            "uploader": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "createdOn": 1725761189,
            "author": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 3
        },
        {
            "number": 5,
            "revision": "fee832e2a01eca57f4a6123a162956df5f4b90cf",
            "parents": [
                "9898d612c3f3fbacd08daff934a83bdb2a7c0dd5"
            ],
            "ref": "refs/changes/88/69888/5",
            "uploader": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "createdOn": 1725780280,
            "author": {
                "name": "cchoux",
                "email": "cosmo.chou@quantatw.com",
                "username": "cchoux"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "ipmbbridged.cpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 3
        }
    ]
}
{
    "project": "openbmc/phosphor-logging",
    "branch": "master",
    "topic": "logging-cleared-event",
    "id": "I25a87fd65738e4debbe98f3473709f77d51777e9",
    "number": 75206,
    "subject": "lg2: commit: add methods for new sdbusplus events",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-logging/+/75206",
    "hashtags": [],
    "createdOn": 1728597556,
    "lastUpdated": 1731341842,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1728597556,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1728597586,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Topic set to logging-cleared-event"
        },
        {
            "timestamp": 1728597593,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1728597593,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1728597812,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/93061/ : FAILURE"
        },
        {
            "timestamp": 1728598896,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/93064/ : SUCCESS"
        },
        {
            "timestamp": 1728941027,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1730402160,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1730402204,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1730402204,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1730402791,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/93953/ : SUCCESS"
        },
        {
            "timestamp": 1730475347,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1730748251,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1730757443,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1730791771,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1730792301,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1730806960,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1730807814,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1730807817,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1730807854,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1730807854,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1730808839,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/94085/ : SUCCESS"
        },
        {
            "timestamp": 1730944568,
            "reviewer": {
                "name": "Thu Nguyen",
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1731087774,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1731088763,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1731340052,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1731341842,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "5759974c24f075e0bd3bbd97e066156297d55920",
            "parents": [
                "ea09e330fd55a77095ce270cd310cfe48ae98944"
            ],
            "ref": "refs/changes/06/75206/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1728597556,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "lib/lg2_commit.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "It was useful having the PID of the creator automatically added to the additional data.  Is there any way to do that here?"
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Done in the next commit."
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/basic_event_commit.cpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -23
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "type": "MODIFIED",
                    "insertions": 75,
                    "deletions": -6
                },
                {
                    "file": "test/log_manager_dbus_tests.cpp",
                    "type": "ADDED",
                    "insertions": 143,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 229,
            "sizeDeletions": 30
        },
        {
            "number": 2,
            "revision": "472f2cb2cf2fc6aec3a19bdc4a9be4d82799dfa4",
            "parents": [
                "e001cd79cfa9604a3b874566ba16c8b761c905e2"
            ],
            "ref": "refs/changes/06/75206/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1730402160,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "Do we any plan to support `add a compile option and Yocto DISTRO_FEATURE that can turn lg2::commit behavior into an OPENBMC_MESSAGE_ID record in the journal` Patrick?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Thu Nguyen",
                        "email": "thu@os.amperecomputing.com",
                        "username": "ThuBaNguyen"
                    },
                    "message": "I wonder how can I add a lg2::commit message which will be shown in the Redfish as \"OpenBMC.0.1.BIOSFirmwarePanicReason.Warning\" registry log?\nAs my understanding, I will need to set the `severity` as warning, but still not sure about `BIOSFirmwarePanicReason` reason."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yes.  The bmcweb support is still to come.  Trying to get the interfaces in place first so that others can use them."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "You will need to first define an event in phosphor-dbus-interfaces.\n\nAs I wrote in the design document though, I'd prefer if we deprecate the original \"OpenBMC.0.1\" registry entries.\n\nI don't believe you would ever get the \".Warning\" part of what you wrote, would you?  The severity isn't included in the MessageID."
                },
                {
                    "file": "test/log_manager_dbus_tests.cpp",
                    "line": 101,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Would it be useful to test that the correct path is being returned, since it would always be /xyz/openbmc_project/logging/event/1?"
                },
                {
                    "file": "test/log_manager_dbus_tests.cpp",
                    "line": 101,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I am actually not able to know which path will be returned.  Other test cases also write into the `/tmp` location and don't clean them up, so it becomes a race to claim \"1\" first.\n\nI could ensure that it starts with `/xyz/openbmc_project/logging` though."
                },
                {
                    "file": "test/log_manager_dbus_tests.cpp",
                    "line": 101,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/basic_event_commit.cpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -23
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "type": "MODIFIED",
                    "insertions": 75,
                    "deletions": -6
                },
                {
                    "file": "test/log_manager_dbus_tests.cpp",
                    "type": "ADDED",
                    "insertions": 143,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 231,
            "sizeDeletions": 30
        },
        {
            "number": 3,
            "revision": "f0af358f9c52cd58601397ef5f05ebfcaeb99590",
            "parents": [
                "e001cd79cfa9604a3b874566ba16c8b761c905e2"
            ],
            "ref": "refs/changes/06/75206/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1730807817,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "lib/lg2_commit.cpp",
                    "line": 79,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "You mentioned in that mbox review that commit() should be noexcept.  Can't these D-Bus calls throw on a fail?"
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "line": 79,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Good point.  I wasn't thinking about that when I wrote it but was just following what the existing `commit` already did.  We can potentially follow up and change both of them.\n\nI don't really want people sprinkling around try/catch around every commit call (either old ones or new ones).  I kind of think we should mark all those functions `noexcept` and let std::terminate be called if we have a catastrophic failure with phosphor-logging.\n\nI suspect right now people are either already ending up with the std::terminate handler called or they are ending up with an inadvertent catch because they wrapped a bunch of code in a generic try/catch(sdbusplus::exception).\n\nWhat are your thoughts?\n\n(This seems fairly minor and follows the existing code so I'd rather handle what ever conclusions we have as a minor commit.)"
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "line": 79,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Returning an optional or expected would be a lot easier to deal with than an exception, but yea can deal with in a different commit."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "test/meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "test/basic_event_commit.cpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -23
                },
                {
                    "file": "lib/lg2_commit.cpp",
                    "type": "MODIFIED",
                    "insertions": 75,
                    "deletions": -6
                },
                {
                    "file": "test/log_manager_dbus_tests.cpp",
                    "type": "ADDED",
                    "insertions": 153,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 241,
            "sizeDeletions": 30
        }
    ]
}
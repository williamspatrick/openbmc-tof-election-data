{
    "project": "openbmc/libmctp",
    "branch": "master",
    "topic": "mctp-static",
    "id": "I2598bb91026ccef01b268c52b06c0f8e20bebb1e",
    "number": 76463,
    "subject": "core: Reuse buffers for tx, allow message pools",
    "owner": {
        "name": "Matt Johnston",
        "email": "matt@codeconstruct.com.au",
        "username": "mkj"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/libmctp/+/76463",
    "hashtags": [],
    "createdOn": 1733899969,
    "lastUpdated": 1734584590,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1733899969,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1733900053,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1733900053,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1733900072,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/96293/ : FAILURE"
        },
        {
            "timestamp": 1733901805,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1733901860,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1733901860,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1733901879,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/96317/ : FAILURE"
        },
        {
            "timestamp": 1733902560,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1733902585,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1733902586,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1733902626,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/96329/ : SUCCESS"
        },
        {
            "timestamp": 1733974569,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Uploaded patch set 4: New patch set was added with same tree, parent tree, and commit message as Patch Set 3.\n\nCopied Votes:\n* Verified+1 (copy condition: \"**changekind:NO_CHANGE**\")\n"
        },
        {
            "timestamp": 1733974635,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1733974635,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1733974676,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/96410/ : SUCCESS"
        },
        {
            "timestamp": 1734504144,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 4:\n\n(5 comments)"
        },
        {
            "timestamp": 1734510454,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1734510492,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1734510492,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1734510534,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/96909/ : SUCCESS"
        },
        {
            "timestamp": 1734514285,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Patch Set 5:\n\n(5 comments)"
        },
        {
            "timestamp": 1734570186,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1734584590,
            "reviewer": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0d298c0f3e3a2c7076bbb42c3f41e468af6a9c70",
            "parents": [
                "f31c09038c7918ccec01aacc0b87f30c0b1a784d"
            ],
            "ref": "refs/changes/63/76463/1",
            "uploader": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "createdOn": 1733899969,
            "author": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "tests/test_core.c",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 260,
                    "deletions": -133
                },
                {
                    "file": "libmctp-alloc.h",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "alloc.c",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -11
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 52,
                    "deletions": -7
                }
            ],
            "sizeInsertions": 379,
            "sizeDeletions": 153
        },
        {
            "number": 2,
            "revision": "6071623ab7445d3194fd2a065f6eaaba6f00c9dd",
            "parents": [
                "3d65efd144ab08b4022e88414984ab2168f68a47"
            ],
            "ref": "refs/changes/63/76463/2",
            "uploader": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "createdOn": 1733901805,
            "author": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "serial.c",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -5
                },
                {
                    "file": "tests/test_cmds.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "tests/test_core.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 260,
                    "deletions": -133
                },
                {
                    "file": "tests/test_bridge.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "libmctp-alloc.h",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "alloc.c",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -11
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 64,
                    "deletions": -8
                },
                {
                    "file": "tests/test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 448,
            "sizeDeletions": 164
        },
        {
            "number": 3,
            "revision": "ce2204f24d38f9fc03a6603403f682fe0c52442b",
            "parents": [
                "3d65efd144ab08b4022e88414984ab2168f68a47"
            ],
            "ref": "refs/changes/63/76463/3",
            "uploader": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "createdOn": 1733902560,
            "author": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "serial.c",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -5
                },
                {
                    "file": "tests/test_cmds.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "tests/test_core.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 260,
                    "deletions": -133
                },
                {
                    "file": "tests/test_bridge.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "libmctp-alloc.h",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "alloc.c",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -11
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 64,
                    "deletions": -8
                },
                {
                    "file": "tests/test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 448,
            "sizeDeletions": 164
        },
        {
            "number": 4,
            "revision": "29bb0c9831f5be0f26542806771530077d79b247",
            "parents": [
                "55f68d03dd4e80136af5b55b1aa5591841ea2d28"
            ],
            "ref": "refs/changes/63/76463/4",
            "uploader": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "createdOn": 1733974569,
            "author": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "kind": "NO_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "nice."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "Acknowledged"
                },
                {
                    "file": "libmctp.h",
                    "line": 91,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Is this unused? or for API-user usage?"
                },
                {
                    "file": "libmctp.h",
                    "line": 91,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "Accidentally kept, was a prototype before it got moved to alloc.c"
                },
                {
                    "file": "libmctp.h",
                    "line": 152,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Seems odd that the message remains with the caller, except in error cases, where it is free()ed.\n\nDid you have a usage pattern in mind where this transfer of ownership is preferred, or is this more for the internal implementation in `mctp_message_tx`?\n\n... or is this comment now stale? Looks like the implementation doesn't free the (`const`!) `msg`."
                },
                {
                    "file": "libmctp.h",
                    "line": 152,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "I think the comment was copy-pasted from `mctp_message_tx_alloced()`, have updated."
                },
                {
                    "file": "libmctp.h",
                    "line": 179,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "This appears to be unused?"
                },
                {
                    "file": "libmctp.h",
                    "line": 179,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "Done"
                },
                {
                    "file": "libmctp.h",
                    "line": 199,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "`will be`"
                },
                {
                    "file": "libmctp.h",
                    "line": 199,
                    "reviewer": {
                        "name": "Matt Johnston",
                        "email": "matt@codeconstruct.com.au",
                        "username": "mkj"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "serial.c",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -5
                },
                {
                    "file": "tests/test_cmds.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "tests/test_core.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 260,
                    "deletions": -133
                },
                {
                    "file": "tests/test_bridge.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "libmctp-alloc.h",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "alloc.c",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -11
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 64,
                    "deletions": -8
                },
                {
                    "file": "tests/test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 448,
            "sizeDeletions": 164
        },
        {
            "number": 5,
            "revision": "4a09e1dc48831f20e15b5fe76bf3011eaf587dd9",
            "parents": [
                "ba5f7477974ae9d6fd4026b0cdc41ab6e7b26db0"
            ],
            "ref": "refs/changes/63/76463/5",
            "uploader": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "createdOn": 1734510454,
            "author": {
                "name": "Matt Johnston",
                "email": "matt@codeconstruct.com.au",
                "username": "mkj"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "serial.c",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -5
                },
                {
                    "file": "tests/test_cmds.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "tests/test_core.c",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "astlpc.c",
                    "type": "MODIFIED",
                    "insertions": 37,
                    "deletions": -5
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 260,
                    "deletions": -133
                },
                {
                    "file": "tests/test_bridge.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                },
                {
                    "file": "libmctp-alloc.h",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "alloc.c",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -11
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 50,
                    "deletions": -8
                },
                {
                    "file": "tests/test-utils.c",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 434,
            "sizeDeletions": 164
        }
    ]
}
{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "topic": "smbpbi",
    "id": "Ibbbd4fc279cb0278539cae1fd5eebf961f0f7a01",
    "number": 76692,
    "subject": "smbpbi: Add code to read entity-manager config",
    "owner": {
        "name": "Peter Delevoryas",
        "email": "peter@pjd.dev",
        "username": "peterdelevoryas"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/76692",
    "hashtags": [],
    "createdOn": 1734513564,
    "lastUpdated": 1734982545,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1734513564,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1734513605,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1734513605,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1734513648,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/96924/ : FAILURE"
        },
        {
            "timestamp": 1734543820,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1734544065,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Topic set to smbpbi"
        },
        {
            "timestamp": 1734547038,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1734547090,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1734547090,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1734547581,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/97132/ : FAILURE"
        },
        {
            "timestamp": 1734551022,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1734551424,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1734551424,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1734553017,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/97219/ : FAILURE"
        },
        {
            "timestamp": 1734553817,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(5 comments)"
        },
        {
            "timestamp": 1734554272,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1734554437,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1734554883,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1734554913,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1734554913,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1734555442,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/97225/ : FAILURE"
        },
        {
            "timestamp": 1734555708,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1734555748,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1734555749,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1734556346,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/97226/ : SUCCESS"
        },
        {
            "timestamp": 1734557540,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1734557609,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1734559236,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1734561775,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1734571483,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1734571553,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1734571896,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1734982545,
            "reviewer": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "message": "Abandoned\n\nin favor of https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/76545"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "a19f665fd0a72f3f205d81d7b7975db312d6e8f1",
            "parents": [
                "4bbd02dce8fe574ecae5efda089e02940178cac7"
            ],
            "ref": "refs/changes/92/76692/1",
            "uploader": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "createdOn": 1734513564,
            "author": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Peter Delevoryas",
                        "email": "peter@pjd.dev",
                        "username": "peterdelevoryas"
                    },
                    "message": "CI won't pass until the phosphor-dbus-interfaces changes here land:\n\nhttps://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/76680"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "type": "ADDED",
                    "insertions": 188,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/meson.build",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 234,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "d4a80d26a3ce02fbe1dbd737f6f13f4f17a7828f",
            "parents": [
                "4bbd02dce8fe574ecae5efda089e02940178cac7"
            ],
            "ref": "refs/changes/92/76692/2",
            "uploader": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "createdOn": 1734547038,
            "author": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "type": "ADDED",
                    "insertions": 192,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/meson.build",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 238,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "e58788cc33448acf9d8457362725fcda32c2adb6",
            "parents": [
                "4bbd02dce8fe574ecae5efda089e02940178cac7"
            ],
            "ref": "refs/changes/92/76692/3",
            "uploader": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "createdOn": 1734551022,
            "author": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 24,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Please add test section"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 24,
                    "reviewer": {
                        "name": "Peter Delevoryas",
                        "email": "peter@pjd.dev",
                        "username": "peterdelevoryas"
                    },
                    "message": "Done"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "This review is also adding support for smbpbi sensors"
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 35,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "I am not sure Prefix \"Linux\" here make sense."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 35,
                    "reviewer": {
                        "name": "Peter Delevoryas",
                        "email": "peter@pjd.dev",
                        "username": "peterdelevoryas"
                    },
                    "message": "This class is relying exclusively on Linux operating system interfaces. In contrast, I intend to introduce MockI2CBus and MockI2CDevice types in a subsequent commit to use in unit tests, which don't rely on any Linux operating system interfaces."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 122,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "should this be \"bytes.size() != sizeof(uint32_t)\"?"
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 122,
                    "reviewer": {
                        "name": "Peter Delevoryas",
                        "email": "peter@pjd.dev",
                        "username": "peterdelevoryas"
                    },
                    "message": "It could be, but doesn't have to be. The user can provide a buffer that has more than 4 bytes and the rest will be ignored."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 130,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "auto is used too much in this file IMO. Replace auto with the right simple type explicitly is more readable.\n\nuse static_cast<> for explicit type casting"
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 192,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Does the convention used by other services make sense here? It would be good to be consistent within the same repo."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 192,
                    "reviewer": {
                        "name": "Peter Delevoryas",
                        "email": "peter@pjd.dev",
                        "username": "peterdelevoryas"
                    },
                    "message": "Probably not actually, I'm following the direction Patrick has given for using phosphor-dbus-interfaces and coroutines instead of boost::asio. This would be one of the first sensors to do so (the leak detection daemon submitted by Jagpal is another example)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "type": "ADDED",
                    "insertions": 193,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/meson.build",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 239,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "23fc1c75da4c2bd3a8f68a0a39ab50897b7443a4",
            "parents": [
                "4bbd02dce8fe574ecae5efda089e02940178cac7"
            ],
            "ref": "refs/changes/92/76692/4",
            "uploader": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "createdOn": 1734554883,
            "author": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 28,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "type": "ADDED",
                    "insertions": 196,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/meson.build",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 244,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "3be224af20ca206e21edcbde26400adf7b77afc5",
            "parents": [
                "4bbd02dce8fe574ecae5efda089e02940178cac7"
            ],
            "ref": "refs/changes/92/76692/5",
            "uploader": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "createdOn": 1734555708,
            "author": {
                "name": "Peter Delevoryas",
                "email": "peter@pjd.dev",
                "username": "peterdelevoryas"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This needs to be reconciled with https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/76545"
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "You can't only check for config on startup."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Peter Delevoryas",
                        "email": "peter@pjd.dev",
                        "username": "peterdelevoryas"
                    },
                    "message": "I was curious if this would be a requirement: how come everything needs to be so, dynamic? Wouldn't it be reasonable to just make sure the systemd unit deploying this process waits for entity-manager to start first, and to restart the sensor unit whenever entity-manager restarts?\n\nIs entity-manager notifying systemd that it's \"ready\" before exporting all of the objects from fru discovery?\n\nI'm happy to go add a signal handler for this I guess, but it just seems like it's a lot of complexity, and I'm unfamiliar with the precedence for this."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Just waiting for entity-manager to start doesn't ensure that all of the devices have been adequately probed.  Depending on the system it is likely that parts of the system are dynamically plugged (as part of a repair scenario).  That might not be relevant for SMBPBI (because that is on a pretty high-power board that likely doesn't support hot-plug) but we generally want dbus-sensor daemons to do the globally correct thing and not the \"tailored thing that is right for that one daemon\" (because it usually sets up bad examples for [new] people that don't know any better)."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Devices can be detected at anytime.  The user can change the config (delete a device, change a threshold, etc) at any time.  When those things happen for one device, we can't tear every service and every piece of software down and startover from scratch.  (We used to do that, and changing a threshold was a horrifying procedure to watch in the logs).\n\nThat's why it's so dynamic."
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "BTW< there's already utility functions for this that set up the match for you.  They'd need to be ported to coroutines, but it sounded like Jagpal was already doing that for his patch?"
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "line": 146,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "I have defined an CRTP interface for EntityManager https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/75329/37/src/EntityManager.hpp. So, we can use that.\nHave also defined one for GPIOInterface and Systemd in case you need those."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 28,
                    "deletions": 0
                },
                {
                    "file": "src/meson.build",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/main.cpp",
                    "type": "ADDED",
                    "insertions": 197,
                    "deletions": 0
                },
                {
                    "file": "meson.options",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "src/smbpbi/meson.build",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 245,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I0baa710ca738bda37e14311bb919fb9e327cc311",
    "number": 72676,
    "subject": "Add email validation in handleGenerateCSRAction",
    "owner": {
        "name": "Farah Rasheed",
        "email": "Farah.Rasheed1@dell.com",
        "username": "FarahRasheed1"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/72676",
    "hashtags": [],
    "createdOn": 1721247059,
    "lastUpdated": 1721330435,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1721247059,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1721247103,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1721247115,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1721247115,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1721247161,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/88195/ : FAILURE"
        },
        {
            "timestamp": 1721247166,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1721247435,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1721247476,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1721247476,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1721247504,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/88196/ : FAILURE"
        },
        {
            "timestamp": 1721247547,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1721247580,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1721247580,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1721247741,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1721248535,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1721248864,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/88197/ : SUCCESS"
        },
        {
            "timestamp": 1721252678,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1721313743,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Uploaded patch set 5.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1721313771,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1721313771,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1721313799,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/88278/ : FAILURE"
        },
        {
            "timestamp": 1721324637,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1721324666,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1721324666,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1721324803,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1721324818,
            "reviewer": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "message": "Abandoned\n\nShould be submitting a patch in the backend certificate manager instead."
        },
        {
            "timestamp": 1721330435,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "08dad8938a6a2a1d4ab142cb99d19ef37f316def",
            "parents": [
                "fbfb788061e52ceac6156d9e24434e46aa1211d2"
            ],
            "ref": "refs/changes/76/72676/1",
            "uploader": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "createdOn": 1721247059,
            "author": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/lib/certificate_service_test.cpp",
                    "type": "ADDED",
                    "insertions": 39,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 78,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "b8f3dc2e32edcc1767c2740cf7d1c80a410193a1",
            "parents": [
                "fbfb788061e52ceac6156d9e24434e46aa1211d2"
            ],
            "ref": "refs/changes/76/72676/2",
            "uploader": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "createdOn": 1721247103,
            "author": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Couple issues with this:\n\n1. Any validation should be done in the certificate service that's CREATING the CSR, not in bmcweb.  Error codes should be handled appropriately when DBus returns an error such that Redfish works as expected, but because you might create a CSR from within openbmc, or create a CSR from another protocol like IPMI, this validation can't apply only to bmcweb.\n2. The commit message needs to describe _why_ we want to do this.  Are there cases of invalid emails being generated?  Do signing authorities reject bad emails?\n\nOverall, I wonder if this is something we should avoid as a feature, as any email validation we do will be subjective and error prone (as your very complicated regex already proves).\n\nIn terms of workflow, I would expect these fields are supposed to be verified by the certificate authority.  The BMC can't verify most of the fields in this for correctness.  Just because I provided a regex-matching email doesn't mean it's valid, or I'm authorized to create a CSR tied to that email.  I'd rather us do no validation than incomplete validation.\n\nIf we decide that this is in fact needed, PLEASE don't create this regex by hand.  There are many authorities that have regexes for verifying email correctness, and they are significantly more complex than what's in this patchset.   We should grab one and document in a code comment where we got it from, as well as document that we're following RFC5322.  Again, this assumes that we even want this supported at all."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Farah Rasheed",
                        "email": "Farah.Rasheed1@dell.com",
                        "username": "FarahRasheed1"
                    },
                    "message": "You have a valid point that the certificate service generating the CSR should handle the validation for the various fields, esp since duplication can be avoided across openbmc and other protocols. \n\nThe initial idea was the preempt the error by handling preliminary checks in bmcweb since if validation is not happening when CSR is created, the CSR will probably be rejected by signing authorities. \n\nBut, it can end up getting complicated. Considering that various fields that are used (or are optional), perhaps we can say that the onus is entirely when the CSR is created. I would be ok if we want to reject this code review and say that such checks will happen entirely in the certificate service instead."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Farah Rasheed",
                        "email": "Farah.Rasheed1@dell.com",
                        "username": "FarahRasheed1"
                    },
                    "message": "The more I think about it, it makes sense that the validation happen in the phosphor certificate manager or the backend service creating it. Gonna decline this PR."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm still of the opinion that we don't really want to do this type of verification, because in the workflow it's the signing authorities name, we should just verify that we can correctly create the CSR.\n\nSo before you go do a lot of work, lets have a discussion somewhere about what you're trying to accomplish in the overall CSR workflow."
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "line": 59,
                    "reviewer": {
                        "name": "Farah Rasheed",
                        "email": "Farah.Rasheed1@dell.com",
                        "username": "FarahRasheed1"
                    },
                    "message": "I started with a basic regex which kept getting complicated as I added more test cases for invalid e-mails. Open to simplifying this, but I think I have a decent set of valid/invalid test cases at this point."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/lib/certificate_service_test.cpp",
                    "type": "ADDED",
                    "insertions": 39,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 78,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "30bb59bb4d95f24bfbeef72fb0e4056502ab59d9",
            "parents": [
                "fbfb788061e52ceac6156d9e24434e46aa1211d2"
            ],
            "ref": "refs/changes/76/72676/3",
            "uploader": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "createdOn": 1721247435,
            "author": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/lib/certificate_service_test.cpp",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 84,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "651e594bd6fde997f2cd65385e454f620f79b092",
            "parents": [
                "fbfb788061e52ceac6156d9e24434e46aa1211d2"
            ],
            "ref": "refs/changes/76/72676/4",
            "uploader": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "createdOn": 1721247547,
            "author": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "line": 795,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Isn't this logic wrong?  Shouldn't it be\n\nif (optEmail && !isValidEmail(...))"
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "line": 795,
                    "reviewer": {
                        "name": "Farah Rasheed",
                        "email": "Farah.Rasheed1@dell.com",
                        "username": "FarahRasheed1"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/lib/certificate_service_test.cpp",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 85,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "a9b0e59a21feefa0a6bbf35d5a352cc719eca84a",
            "parents": [
                "fbfb788061e52ceac6156d9e24434e46aa1211d2"
            ],
            "ref": "refs/changes/76/72676/5",
            "uploader": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "createdOn": 1721313743,
            "author": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -2
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/lib/certificate_service_test.cpp",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 82,
            "sizeDeletions": 2
        },
        {
            "number": 6,
            "revision": "6925f31b6f421de79983c8b02e94783e07106cb0",
            "parents": [
                "fbfb788061e52ceac6156d9e24434e46aa1211d2"
            ],
            "ref": "refs/changes/76/72676/6",
            "uploader": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "createdOn": 1721324637,
            "author": {
                "name": "Farah Rasheed",
                "email": "Farah.Rasheed1@dell.com",
                "username": "FarahRasheed1"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/certificate_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "test/redfish-core/lib/certificate_service_test.cpp",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 81,
            "sizeDeletions": 0
        }
    ]
}
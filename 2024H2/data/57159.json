{
    "project": "openbmc/docs",
    "branch": "master",
    "id": "I89884a0155027342748dc5e759ab9e21daeb222c",
    "number": 57159,
    "subject": "Moving From PIM to EM",
    "owner": {
        "name": "Santosh Puranik",
        "email": "santosh.puranik.ibm@gmail.com",
        "username": "santoshpuranik"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/57159",
    "hashtags": [],
    "createdOn": 1663249906,
    "lastUpdated": 1736138357,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1663249906,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1663249946,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663249946,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1663249965,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50793/ : SUCCESS"
        },
        {
            "timestamp": 1663250287,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1663250371,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1663250371,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1663250476,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/50794/ : SUCCESS"
        },
        {
            "timestamp": 1663252103,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1663252247,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1663279767,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\nThis change is ready for review."
        },
        {
            "timestamp": 1663283238,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1663581992,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 2:\n\n(3 comments)"
        },
        {
            "timestamp": 1663584756,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1663649962,
            "reviewer": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1663659490,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1663682008,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1663849572,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@codeconstruct.com.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1728583271,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "dd3bcdcfa87149d5798bdc7d9177f1103c1327b5",
            "parents": [
                "0c548ec7175974d897251b23ee10c5ec407ac347"
            ],
            "ref": "refs/changes/59/57159/1",
            "uploader": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "createdOn": 1663249906,
            "author": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik@in.ibm.com",
                "username": ""
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "type": "ADDED",
                    "insertions": 160,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 177,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "c9f40b99d8b68a81e7cf14766d0d45ffcc82698b",
            "parents": [
                "0c548ec7175974d897251b23ee10c5ec407ac347"
            ],
            "ref": "refs/changes/59/57159/2",
            "uploader": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik.ibm@gmail.com",
                "username": "santoshpuranik"
            },
            "createdOn": 1663250287,
            "author": {
                "name": "Santosh Puranik",
                "email": "santosh.puranik@in.ibm.com",
                "username": ""
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "No progress in review , removing from my list"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "What is the difference between a FRU D-Bus object and in inventory D-Bus object?  Were these the same object under PIM?"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 67,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "Yes, they were the same object under PIM. From my viewpoint, a FRU D-Bus object contains data that EM can probe against - For ex: CCIN. In case of the VPD collection app, this object would contain the VPD data interface and properties that reflect the real VPD data."
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 94,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Can you provide more info on this, or is there some documentation we could look at?\n\nI appreciate you mentioning the PSU app, but I don't understand the proposed design."
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 94,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "Something like the \"detection daemon\" that is described here: https://github.com/openbmc/entity-manager/#implementation. This daemon would be, say the vpd-manager for FRUs detected via their EEPROMs.\n\nI guess in cases where multiple daemons do this detection, it would get tricky to keep them in \"sync\""
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "The phosphor-regulators application has system-specific JSON files that contain D-Bus object paths to inventory items.\n\nThese object paths are required for:\n* Obtaining VPD from a specific inventory item, such as the VDD VRM, CPU0, a Flett card, or the backplane containing the BMC.\n* Obtaining the presence of a specific inventory item, such as the VIO VRM, CPU3, a Flett card, etc.\n* Calling out the correct FRU for errors.  The \"CALLOUT_INVENTORY_PATH\" additional day keyword is set to the inventory path of the failing inventory item/FRU.\n\nThere is no requirement for a particular format of the object paths, such as hierarchical or how PIM defined them.\n\nHowever, the object paths need to be static.  The D-Bus object path to a specific VRM, CPU, or backplane needs to stay the same after a system has been brought up.  Otherwise they cannot be specified in the regulators JSON file.\n\nMatt Spinler mentioned that in some cases EM paths have some sort of '$index' in them.  So the path to the FRU would be dynamic depending on the order JSON is parsed in or something.  However, he mentioned for some work he did he used the location code instead of the index so that the inventory path was static.\n\nIf this is not possible, then how can applications get VPD and presence for a known entity, like the VDD VRM or CPU3?  It is not sufficient to do a mapper query to find all VRM objects; we need to know which one it is."
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "what if you used the unexpanded location code instead, like P1-C0?"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "> If this is not possible, then how can applications get VPD and presence for a known entity, like the VDD VRM or CPU3?  It is not sufficient to do a mapper query to find all VRM objects; we need to know which one it is.\n\nThe information needs to be structured such that the objects at each end of the association tell you how each is addressed relative to the other. This same information is necessary to construct deterministic paths, so there's no loss of functionality. With this the specific topology can be constructed by traversing the association graph. The mapper APIs need some more work to make this efficient, but there has already been discussion (at least in the TOF) about this.\n\nThis design document is relevant: https://gerrit.openbmc.org/c/openbmc/docs/+/54205"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "I'm with Matt on this one, we need to use \"something\" to uniquely identify object instances. For IBM systems, using the location code makes most sense (to me)."
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "How is the location code determined?"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Santosh Puranik",
                        "email": "santosh.puranik.ibm@gmail.com",
                        "username": "santoshpuranik"
                    },
                    "message": "That does not come from the VPD, unfortunately (it is attached to an instance of a part by system design). Some code would need to know this inherently based on the system type, probably the FRU detection daemon.\n\nHaving EM directly determine location code would not work, IMO. The same part can exist at different locations on two different systems.\n\nAs an alternative:\n\nIs there a way to tie two EM configs together somehow? Here's a case I'm thinking about:\n\npart P exists on two different backplanes B1 and B2, but at different location code. Can the EM config for B1 and B2 expose a different \"slot\" location for the part? And can the config for P pick up that location code and then expose the location as its own? Hopefully that made sense \ud83d\ude0a"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "EM does have a concept of Connectors, used now for some sort of fan stuff. Kinda like in the MRW, aren't location codes within the card a  constant, so maybe we could do the same, using the connectors to hold location codes?\n\nFor example if a card has T0 and T1 location codes on it, and plugs into one parent connector with a location of C0, and another with a parent of C3, then they could be assembled into C0-T0 and C3-T0 depending on what its plugged into?"
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@codeconstruct.com.au",
                        "username": "amboar"
                    },
                    "message": "> For example if a card has T0 and T1 location codes on it, and plugs into one parent connector with a location of C0, and another with a parent of C3, then they could be assembled into C0-T0 and C3-T0 depending on what its plugged into?\n\nRight.\n\nLocation codes can't be built from VPD as they have to be related to the device's position in the system, which is what EM is keeping track of with connectors and the associations proposal. With those two features, it's hard to see that we can't solve this in a relatively straight-forward way."
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "line": 130,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "Could you expain what are the disadvantages of PIM?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "designs/pim-to-entity-manager.md",
                    "type": "ADDED",
                    "insertions": 160,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 177,
            "sizeDeletions": 0
        }
    ]
}
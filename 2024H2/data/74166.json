{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "I327ee66c71a3e3a010a5620801b22c95f1108561",
    "number": 74166,
    "subject": "power-utils: Add support for override and compare",
    "owner": {
        "name": "Faisal Awada",
        "email": "faisal@us.ibm.com",
        "username": "faisal-awada"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-power/+/74166",
    "hashtags": [],
    "createdOn": 1724971031,
    "lastUpdated": 1725671108,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1724971031,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1724971065,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724971065,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1724971538,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/90994/ : SUCCESS"
        },
        {
            "timestamp": 1725045965,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1725071313,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 2: Commit message was updated.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725071331,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725071331,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1725071335,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1725071807,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91086/ : SUCCESS"
        },
        {
            "timestamp": 1725102160,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1725126245,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725126291,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725126291,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1725126357,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/91123/ : FAILURE"
        },
        {
            "timestamp": 1725127246,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1725127260,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1725127260,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1725127734,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91124/ : SUCCESS"
        },
        {
            "timestamp": 1725388052,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1725391500,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1725391569,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1725391650,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1725392868,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1725401247,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1725671108,
            "reviewer": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "message": "Abandoned\n\nDesign change decided not to use '--override --compare'"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "06bd6f9ee3e6a315427cf1065ff8d4516864cd1b",
            "parents": [
                "5dce1a746e3b4f567940afd2bacd16ee8e6e1fd6"
            ],
            "ref": "refs/changes/66/74166/1",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1724971031,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "can you include the return values here?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "I will add the return values"
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "line": 324,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I feel like you could simplify this down to:\n\n```\nif (versions.size() == 2)\n    return versions[1];\n\nlog<ERR>...\nreturn \"\"\n```\n\nor if you don't need the trace:\n\nreturn (versions.size() == 2) ? versions[1] : \"\";"
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "line": 324,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "I'm not sure we are on the same page, here we have to have two versions, then if the two versions don't match then we need the version different then the current PSU version\nNote: version[0] is the current PSU version\n      version[1] can be same as current version, newer version or older version."
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "line": 324,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "ok will make the change"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 68,
            "sizeDeletions": 2
        },
        {
            "number": 2,
            "revision": "a41829dade6d630e99f7e8b2513d29d87fb0732a",
            "parents": [
                "5dce1a746e3b4f567940afd2bacd16ee8e6e1fd6"
            ],
            "ref": "refs/changes/66/74166/2",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1725071313,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 74,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "5d4d0ee9401c811f2c632cefea72940fd7e86421",
            "parents": [
                "5dce1a746e3b4f567940afd2bacd16ee8e6e1fd6"
            ],
            "ref": "refs/changes/66/74166/3",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1725126245,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 65,
            "sizeDeletions": 2
        },
        {
            "number": 4,
            "revision": "f83f6ca471818ec940671d8e97314c287daa458f",
            "parents": [
                "5dce1a746e3b4f567940afd2bacd16ee8e6e1fd6"
            ],
            "ref": "refs/changes/66/74166/4",
            "uploader": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "createdOn": 1725127246,
            "author": {
                "name": "Faisal Awada",
                "email": "faisal@us.ibm.com",
                "username": "faisal-awada"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "So it seems like the caller is the one that needs a --override flag right?  And if that is specified, they get the current PSU version, and if that is different from the desired version, it moves straight to doing the update?"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "I don't see a reason for phosphor-psu-code-manager to call compare either the compare while it can select the latest FW level and move to update."
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "> I don't see a reason for phosphor-psu-code-manager to call psutils to do compare while it can select the latest FW level and move on to update."
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I guess I should ask, why even pass values into a program to do this, and not just do it in the caller?"
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "Good question I don't know why phosphor-psu-code-manager needs to call psutils to do level compare \"--compare ver1 ver2 \" and expect to get back the latest FW level (maybe flexibility and leave it up to psutils to decide which level need to flash). For IBM \"--override --compare ver1 ver2 \" means any level such as current level if they are the same, previous level or latest level if either different then current level."
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "I agree with Matt this enhancement is confusing.  My understanding is that --get-version will tell you the version installed on the PSU.  And --compare will tell you the newest version within a list of versions.\n\nIn the case of --override, you are saying the caller already knows what the PSU's current version is because it has to be the first argument.  And they already know they want the second version even if it is older.  So there is no point to calling --compare --override because it doesn't do anything right?"
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "line": 73,
                    "reviewer": {
                        "name": "Faisal Awada",
                        "email": "faisal@us.ibm.com",
                        "username": "faisal-awada"
                    },
                    "message": "The sequence of a calls for everyone to get current level, then call again with compare \"--compare current-level other-level\" and this is not any different with override."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/version.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": 0
                },
                {
                    "file": "tools/power-utils/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 66,
            "sizeDeletions": 2
        }
    ]
}
{
    "project": "openbmc/docs",
    "branch": "master",
    "topic": "ncsi-coredump",
    "id": "I71161daa79b8fa4650f54e6cc3caf295a490a4c7",
    "number": 74866,
    "subject": "update ncsi-coredump design",
    "owner": {
        "name": "Jagpal S Gill",
        "email": "paligill@gmail.com",
        "username": "jagpalgill"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/docs/+/74866",
    "hashtags": [],
    "createdOn": 1727250109,
    "lastUpdated": 1729172836,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1727250109,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1727250151,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1727250151,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1727250171,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/92249/ : SUCCESS"
        },
        {
            "timestamp": 1727314902,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 2.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1727314952,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Topic set to ncsi-coredump"
        },
        {
            "timestamp": 1727314956,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1727314956,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1727315158,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/92323/ : SUCCESS"
        },
        {
            "timestamp": 1727907531,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1727907569,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1727907569,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1727907731,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/92552/ : SUCCESS"
        },
        {
            "timestamp": 1729117893,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 4.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1729117928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1729117928,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1729118094,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/93293/ : SUCCESS"
        },
        {
            "timestamp": 1729163202,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "mdmii@outlook.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 4:\n\n(11 comments)"
        },
        {
            "timestamp": 1729172836,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "4e8e8b53d2d54038456b0f0c4d83228711a1d65f",
            "parents": [
                "dd27633867bde3e20c73cb6b28dad3865ec46814"
            ],
            "ref": "refs/changes/66/74866/1",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1727250109,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "type": "MODIFIED",
                    "insertions": 62,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 75,
            "sizeDeletions": 15
        },
        {
            "number": 2,
            "revision": "bb0a162e0320d1f94e2c0ec2a39f59825038a8c1",
            "parents": [
                "377ed14df4913010752ee2faff994a50e12a6316"
            ],
            "ref": "refs/changes/66/74866/2",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1727314902,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "type": "MODIFIED",
                    "insertions": 73,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 95,
            "sizeDeletions": 17
        },
        {
            "number": 3,
            "revision": "9de1fd0d12aa2ad462757bcd2bf28c52ad1b7c10",
            "parents": [
                "377ed14df4913010752ee2faff994a50e12a6316"
            ],
            "ref": "refs/changes/66/74866/3",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1727907531,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "type": "MODIFIED",
                    "insertions": 72,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 94,
            "sizeDeletions": 16
        },
        {
            "number": 4,
            "revision": "6b09bfee79b3d79d948fdf8c8704971242a3a8bc",
            "parents": [
                "377ed14df4913010752ee2faff994a50e12a6316"
            ],
            "ref": "refs/changes/66/74866/4",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1729117893,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "it's way to late and reading the background changed details of some of my perspectives."
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 27,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "I'm not finding the support for anything other than OEM packets\n\nhttps://github.com/torvalds/linux/blob/c964ced7726294d40913f2127c3f185a92cb4a41/net/ncsi/ncsi-cmd.c#L329C24-L329C52\n\nThis check and override was added to avoid userspace from injecting netlink packets that interfere with the kernel nc-si driver.\n\nInterjecting raw frames with netlink ethertype will cause conflicts and dropped packets when the 1 byte sequence number matches the kernel packet, where the NIC is allowed (encouraged) to assume the contents are unchanged and it was just a retransmission\n\nare there patches pending ?\n\nIt seems like we should add ncsi commands to create LDM in RBT (although we need to confer with CodeConstruct how it relates to AF_MCTP and PLDM in MCTP) and to stream this NC BLOCK data (which only seems to be identified by an initial block number then just a sequence)."
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 56,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "this seem to be a poor approachpproach.  nether of these are physical, they are both dynamically asigned each boot.\n\nThe contents of this decorator would have to be probed and dynamically evaluated each boot.\n\nIf you want an inventory decorator you should identify either the physical inentoriy item eg the adaptor  card in the corresponding pci slot and the port (eg sfp port) and deccorate that.  the ncsi address is formed by the rmii conection to the ncs-si port (not sure if redfish has this covered), the package strappinig (which should be a variable passed to the instance of the package as there are straps to select which of 3 package id is used), and the channel number (which is likely a fixed assignment for a given adapter and likely NIC).  (I'm not confirming the redfish names at this hour but know there are logical and physical entities)\n\n\nBottom line, I think the computation of this inventory decorator is not trivial and should be hosted somewhere; either an application or a library to walk inventory interfaces.  possibly several simple decorators and probably 1 or more associations will be needed to identify the package and port although I could see both when the package is a passed variable analogous to $bus for i2c)"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 59,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "this would be decorated at inventory on the adapter"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 62,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "and this would likely be fixed at the package"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 64,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "this should be pldm transport not NC SI transport\n\n(or show me the proposed nc-si flow vs a pldm flow)"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 65,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "replace netlink with RBT\n\nRBT is the NC SI term for rmii based transport, which uses Ethernet frames over an extension of a rmii (reduced (pin count ) management interface (designed for connecting a MAC to a phy).\n\nnetlink is an interface to the kernel network stack.\n\n\nWhen I saw this diff (until I read the reference material liinks and the whole document) I assumed this was a dump using PLDM conmmands over some transport.\n\nis nc-si over smbus // i2c defined? it was implemented.  due to transport speed it might only be usable for small dumps like a backtrace or kernel oops equivalent.\n\n(why capitalize netlink it's not an acrony?)"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 74,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "this name seems to be from a different proposal"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 77,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "(rework after above considerations)"
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 85,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "if you are dumping a device it should be attached to a package which is a package level property.  if it's only dumping a specific port then the decorator would be attached to the port interface or logical interface.\n\nI dont know if the channel is always required or ignored or its upto the NIC firmware and its architecture."
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 89,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "mdmii@outlook.com",
                        "username": "mdmillerii"
                    },
                    "message": "I understand having a NIC object with an interface to describe the parameters to request the dump and pump packets towards it sounds useful, but it's not an invenntory decorator its an object computed from the inventory pieces.\n\n\nEDIT: this nextp paragrapge was before I read that its actually a NCSI not a PLDM transport\n> Also, this seems to totally ignore the (stale but open on last check) proposals to NCSI endpoints and the RMII and corresponding MCTP associations based on their GUID property.   While I had lots of questions to those since I hadn't read ncsi 1.2 at the time and understood less of mctp, pldm and their layering, my chief concern was how it was going to integrate with and not conflict with the kernel NC-SI stack.\n\nDo you have patches for kernel nc-si to allow sending and reciving RMII correction NC Block Data?   Note that kernel support is required if the kernel stack is required because of how the anti-replay works (and last i checked only OEM messages were permitted to be generated from a netlink).  (Yes I've seen the userspace netlink-util patches but not the kernel)  Prevviosly I was assuming the users were using something like the  gbmc userspace nc-si stack.\n\n\n(Note: having read and understood the nc-si spec and some of the linux network driver / interface architecture I have thoughts on how to rewrite it to truly support the spec but its about item 4 on my major projects hobby list)."
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "line": 162,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "Can you elaborate , what exactly system dump means here ? PDC also uses system dump in different context in the existing design documents. This is avoid confusion the terminology.\n\nAlso please include information how this dump look , is it going to be system scope , or again multiple entry for each Nics?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "designs/ncsi-coredump.md",
                    "type": "MODIFIED",
                    "insertions": 80,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 102,
            "sizeDeletions": 16
        }
    ]
}
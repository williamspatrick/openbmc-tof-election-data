{
    "project": "openbmc/phosphor-virtual-sensor",
    "branch": "master",
    "id": "I224277308e1d78eaef2d60843eccdfa6d9e69436",
    "number": 75451,
    "subject": "Refactor dbus utils",
    "owner": {
        "name": "George Liu",
        "email": "liuxiwei@ieisystem.com",
        "username": "lxwinspur"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-virtual-sensor/+/75451",
    "hashtags": [],
    "createdOn": 1729672094,
    "lastUpdated": 1730364866,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1729672094,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1729672128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1729672128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1729672287,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/93592/ : SUCCESS"
        },
        {
            "timestamp": 1729846313,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1729846364,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1729846364,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1729846528,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/93726/ : SUCCESS"
        },
        {
            "timestamp": 1729890416,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(2 comments)"
        },
        {
            "timestamp": 1730077372,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1730318043,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1730364866,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "bc9ce0653b322232650a74048f3022cc871ae1f3",
            "parents": [
                "374641d33246511d68e4452d8cf5e22826185fec"
            ],
            "ref": "refs/changes/51/75451/1",
            "uploader": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "createdOn": 1729672094,
            "author": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "dbusUtils.cpp",
                    "type": "MODIFIED",
                    "insertions": 32,
                    "deletions": -14
                },
                {
                    "file": "dbusUtils.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -29
                },
                {
                    "file": "dbusSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 45
        },
        {
            "number": 2,
            "revision": "134c4e2b4d3410f141a82df1494e4c4a3d79a6ec",
            "parents": [
                "b354f58bcb5e1e6f50b7eb8f11f6fe68c033b6da"
            ],
            "ref": "refs/changes/51/75451/2",
            "uploader": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "createdOn": 1729846313,
            "author": {
                "name": "George Liu",
                "email": "liuxiwei@ieisystem.com",
                "username": "lxwinspur"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I don't understand how removing a template is an optimization.  Can you explain?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "Two problems are solved here:\n\nThis template does not support all types, std::numeric_limits<T>::quiet_NaN(); only supports double, float types.\nThe method has been captured when it is called, and the value has been set to Nan in the catch (https://github.com/openbmc/phosphor-virtual-sensor/blob/d98174e9c83d1eb585b58aa0c7c24e745b4a9688/dbusSensor.cpp#L65-L71)\nTherefore, there is no need to declare this method as a template, and you want the caller to capture the exception"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "> This template does not support all types, std::numeric_limits<T>::quiet_NaN(); only supports double, float types.\n\nThere is currently one user of this function.  The line you linked to above.  It only uses double."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "Yes, but this defeats the purpose of using templates.\n\nAnd because the getProperty method is declared a template, it must be implemented in hpp. Although this is not a problem, I think it is also an optimization item \ud83d\ude0a\n\nAlso, if we think that the user only uses `double` when calling, then I don't think it is necessary to use a template here, and then directly `return std::numeric_limits<double>::quiet_NaN();` when hitting the catch."
                },
                {
                    "file": "dbusUtils.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "You now removed all the error handling.  Why?"
                },
                {
                    "file": "dbusUtils.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "As above"
                },
                {
                    "file": "dbusUtils.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "But the code was explicit before where as now it is implicit.  Now if someone makes changes elsewhere and doesn't know that this is an exception they need to handle, introduce a bug.  This change just moves an implementation detail from a centralized place to a decentralized place; I don't see that as a net positive."
                },
                {
                    "file": "dbusUtils.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@ieisystem.com",
                        "username": "lxwinspur"
                    },
                    "message": "As mentioned above, I think this is where we disagree. I prefer to remove the template and try-catch, and hope that the caller will handle the exception.\n\nBecause there may be different ways to handle exceptions for different callers.\n\nIf we insist that the caller only uses double, then I accept handling exceptions in getProperty and returning `return std::numeric_limits<double>::quiet_NaN();`, but this also loses the meaning of using templates."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "dbusUtils.cpp",
                    "type": "MODIFIED",
                    "insertions": 32,
                    "deletions": -14
                },
                {
                    "file": "dbusUtils.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -29
                },
                {
                    "file": "dbusSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 52,
            "sizeDeletions": 45
        }
    ]
}
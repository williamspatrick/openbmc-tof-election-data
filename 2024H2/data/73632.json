{
    "project": "openbmc/phosphor-bmc-code-mgmt",
    "branch": "master",
    "id": "I93b6a6ae36e2d0a06e8f5f97d04007da7707f1d6",
    "number": 73632,
    "subject": "Skip updateable association for functional BMC",
    "owner": {
        "name": "Jagpal S Gill",
        "email": "paligill@gmail.com",
        "username": "jagpalgill"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/73632",
    "hashtags": [
        "redfish-updateservice-use-dbus"
    ],
    "createdOn": 1723504313,
    "lastUpdated": 1734118609,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1723504313,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1723504352,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1723504352,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1723504446,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1723504480,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1723504480,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1723504484,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/89587/ : ABORTED"
        },
        {
            "timestamp": 1723504638,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/89589/ : SUCCESS"
        },
        {
            "timestamp": 1723671279,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1723671308,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1723671308,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1723671464,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/89727/ : SUCCESS"
        },
        {
            "timestamp": 1724717469,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1724717519,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724717520,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: -Ok-To-Test"
        },
        {
            "timestamp": 1724717544,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/90710/ : FAILURE"
        },
        {
            "timestamp": 1724720059,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased.\n\nOutdated Votes:\n* Verified-1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1724720114,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1724720114,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1724720377,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/90719/ : SUCCESS"
        },
        {
            "timestamp": 1725569120,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1726095696,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 6.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1726095734,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726095734,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1726095917,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91689/ : SUCCESS"
        },
        {
            "timestamp": 1726096004,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 7: Commit message was updated.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1726096033,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1726096033,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: -Ok-To-Test"
        },
        {
            "timestamp": 1726096063,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 7:\n\n(1 comment)"
        },
        {
            "timestamp": 1726096221,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/91695/ : SUCCESS"
        },
        {
            "timestamp": 1726519940,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@us.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 7: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1726521669,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Change has been successfully merged"
        },
        {
            "timestamp": 1734118609,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Hashtag added: redfish-updateservice-use-dbus"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "7541a2eea075722f5da489c507f3782b7dd26b39",
            "parents": [
                "ca5a5573612f7c9037044e8757eac60800438f50"
            ],
            "ref": "refs/changes/32/73632/1",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1723504313,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 10
        },
        {
            "number": 2,
            "revision": "aac9b844d84c8f0470d3db4919573de1c81337de",
            "parents": [
                "ca5a5573612f7c9037044e8757eac60800438f50"
            ],
            "ref": "refs/changes/32/73632/2",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1723504446,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 10
        },
        {
            "number": 3,
            "revision": "b86c8d6c8eb65aa5bc76c5030967e865532d9707",
            "parents": [
                "66f2796f36448e8f9ccbedecd6a2e82cfce326cf"
            ],
            "ref": "refs/changes/32/73632/3",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1723671279,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 10
        },
        {
            "number": 4,
            "revision": "8cc3ac8445bc637683477b6804d64d87f6b69e8e",
            "parents": [
                "81418173444141de1323db39295192e7755a1347"
            ],
            "ref": "refs/changes/32/73632/4",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1724717469,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 10
        },
        {
            "number": 5,
            "revision": "ab00c58b36411e518f02a11c8637ee9afa239ba0",
            "parents": [
                "6d131aa7088d23c5a03a4693e168f1e1cd582c98"
            ],
            "ref": "refs/changes/32/73632/5",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1724720059,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "item_updater.cpp",
                    "line": 420,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Talked with Jagpal a bit on this because we're going to need a different approach since currently we don't have a variable that defines if a configuration supports dual versions or not. The STATIC_DUAL_IMAGE is one, but also MMC and UBI. Instead of having to manually add ifdef checks for all existing ones and new ones to come, let's try to do this programatically.\n\nAn option could be to add some logic at the end of the \"for\" loop that starts on line 271. After the loop, the versions map would had been populated. We can then iterate over the map as follows:\n\n```\nfor (const auto& versionIt : versions)\n{\n    if ((versions.size() == 1) ||\n        (versions.size() > 1) && (!versionIt.second->isFunctional())\n    {\n        if (versionIt.second->purpose() != VersionPurpose::BMC)\n        {\n           continue;\n        }\n        // This is the only BMC version, or the non-functional version\n        // in a system with more than one version, create Update object\n        // via \"createUpdateObject()\" and updateable association via\n        // \"createUpdateableAssociation\", version id can be accessed via\n        // versionIt.first, path can be accessed via versionIt.second->path().\n    }\n}\n```"
                },
                {
                    "file": "item_updater.cpp",
                    "line": 420,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "Done.\n\nThanks for looking into this. I made few changes to your suggestion. Please let me know if there are any concerns -\n1. Since, this is processBMCImage API we don't need VersionPurpose check. Also, for BIOS, there is a different Updater instance so different versions map will be used.\n2. We don't need \"(versions.size() > 1) && \" check as we will only enter this condition if versions.size() > 1 (implicitly).\n3. I had to add objPath to version class as Path refers to FilePath object here."
                },
                {
                    "file": "item_updater.cpp",
                    "line": 420,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@us.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Thanks Jagpal. Changes look good."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 10
        },
        {
            "number": 6,
            "revision": "b62bed7c753b839bad4f58ad6c6f121233a53695",
            "parents": [
                "463917e1a7979f4bbdc9428837916f51cc81bd74"
            ],
            "ref": "refs/changes/32/73632/6",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1726095696,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "version.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 11
        },
        {
            "number": 7,
            "revision": "c111b93ced1760d90e5c84598f67367383387f8c",
            "parents": [
                "463917e1a7979f4bbdc9428837916f51cc81bd74"
            ],
            "ref": "refs/changes/32/73632/7",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1726096004,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 42,
                    "deletions": 0
                },
                {
                    "file": "version.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                },
                {
                    "file": "item_updater.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": -10
                }
            ],
            "sizeInsertions": 62,
            "sizeDeletions": 11
        }
    ]
}
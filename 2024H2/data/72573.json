{
    "project": "openbmc/webui-vue",
    "branch": "master",
    "id": "I81dc881193440d8d252dcd283b99915bd08c0c5e",
    "number": 72573,
    "subject": "Use auth token when not communicating with bmcweb",
    "owner": {
        "name": "Paul Fertser",
        "email": "fercerpav@gmail.com",
        "username": "paulfertser"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/webui-vue/+/72573",
    "hashtags": [],
    "createdOn": 1720017058,
    "lastUpdated": 1724766899,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1720017058,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1720017085,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1720017085,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1720017132,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1720017169,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/87252/ : SUCCESS"
        },
        {
            "timestamp": 1720017365,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1721411193,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1721411232,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1721411232,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1721411307,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/88365/ : SUCCESS"
        },
        {
            "timestamp": 1721416445,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1721418244,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1721419851,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1721420336,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1723453067,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Uploaded patch set 3.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1723453128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1723453128,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: -Ok-To-Test"
        },
        {
            "timestamp": 1723453204,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/89547/ : SUCCESS"
        },
        {
            "timestamp": 1723453477,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1724163002,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1724169345,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1724699172,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gunnar@gmills.xyz",
                "username": "gtmills"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1724744813,
            "reviewer": {
                "name": "Nikhil Ashoka",
                "email": "a.nikhil@ibm.com",
                "username": "Nikhil-Ashoka"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1724766899,
            "reviewer": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "message": "Change has been successfully rebased and submitted as 09a3b9e0b51c8c0a4ffff29581834c5f3b69b79e"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "78c8103a0dcb5b5ed787edc840ebdb5e425cb4f2",
            "parents": [
                "1c8f0b141cd83bcb4ef2dcf8e5d79f3fa977c435"
            ],
            "ref": "refs/changes/73/72573/1",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1720017058,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Screenshot showing connecting to MegaRAC: https://i.ibb.co/LQTRCbH/webui-vue-vs-megarac.png"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "BTW, the AMI Web frontend is not using Redfish at all, they re-implement everything using unrelated API. And also they do not clean LocalStorage on logout so the next time it knows what user name you're likely to use."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -2
                },
                {
                    "file": "src/store/api.js",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 2
        },
        {
            "number": 2,
            "revision": "330ff93898781dc1776c525498a6f4100e669131",
            "parents": [
                "1ff8e89fd2397c468ab0237158e5aeeff2692413"
            ],
            "ref": "refs/changes/73/72573/2",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1721411193,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Hello Ed, thank you for reviewing, please see inline."
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 38,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can we get a lot more comments here about the background?\n\nThis line storing the x-auth-token into local storage is actively defying OWASP for non OpenBMC systems;  That's fine, but we need to have inline comments that:\n\n1. Acknowledges that this _might be_ less secure (I realize this is subjective).\n2. Documents the parts of OWASP that say to not do this.\n3. Documents that there's a conflict between what OWASP says and what Redfish supports.\n4. Document that OpenBMC will never hit this branch, so is therefore meets the intent of OWASP.\n\nIf we don't document that here, it increases the likelihood that some security researcher files a CVE pointing to this code."
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 38,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> Can we get a lot more comments here about the background?\n\nSure, will add a note once we discuss it over.\n\n> This line storing the x-auth-token into local storage is actively defying OWASP for non OpenBMC systems;  That's fine, but we need to have inline comments that:\n\nThere's no storing the token into local storage anymore, I removed that as we agreed for the patch splitting, I might try to re-introduce it later but for now this code you're reviewing should be fully OWASP-compliant in all cases.\n\n> 1. Acknowledges that this _might be_ less secure (I realize this is subjective).\n> 2. Documents the parts of OWASP that say to not do this.\n> 3. Documents that there's a conflict between what OWASP says and what Redfish supports.\n> 4. Document that OpenBMC will never hit this branch, so is therefore meets the intent of OWASP.\n\nAll good points, if I try to introduce that feature in the future I'll will certainly follow this list, thank you.\n\n> If we don't document that here, it increases the likelihood that some security researcher files a CVE pointing to this code.\n\nI understand the motivation, thanks for making it crystal clear here."
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 38,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> > Can we get a lot more comments here about the background?\n> \n> Sure, will add a note once we discuss it over.\n> \n> > This line storing the x-auth-token into local storage is actively defying OWASP for non OpenBMC systems;  That's fine, but we need to have inline comments that:\n> \n> There's no storing the token into local storage anymore, I removed that as we agreed for the patch splitting, I might try to re-introduce it later but for now this code you're reviewing should be fully OWASP-compliant in all cases.\n\nAh, it's only being stored in the local scope now.  I didn't catch that in the patch.  Ignore my other comments."
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 38,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "Acknowledged"
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 49,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This line looks odd?  Any reason we need to clear this but didn't need to before?"
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 49,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "> This line looks odd?  Any reason we need to clear this but didn't need to before?\n\nWhat api.set_auth_token() does is it asks Axios which is responsible for all HTTP requests to add a certain X-Auth-Token header to every HTTP request it makes. When  we just logged out it makes sense to drop the header (if we had one) because it's not going to be valid for anything anymore, and so the next request to the server shouldn't have it. I do not see any reason to make this clearing conditional, same as the other data is cleared there no matter if was used or not during the session."
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "line": 49,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "ACK"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -2
                },
                {
                    "file": "src/store/api.js",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 42,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "d0a083e1f2ecafc5e2924e7220156ea54d3eecef",
            "parents": [
                "6de03414859a6a37d0d21bb493bd444e4a308f3b"
            ],
            "ref": "refs/changes/73/72573/3",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1723453067,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Paul Fertser",
                        "email": "fercerpav@gmail.com",
                        "username": "paulfertser"
                    },
                    "message": "I've added a comment and rebased. Hope this clarifies all the questions now."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -2
                },
                {
                    "file": "src/store/api.js",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 2
        },
        {
            "number": 4,
            "revision": "09a3b9e0b51c8c0a4ffff29581834c5f3b69b79e",
            "parents": [
                "b2acbcaa9cf7b1aa053216ca93ad2ad1f9846544"
            ],
            "ref": "refs/changes/73/72573/4",
            "uploader": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "createdOn": 1724766899,
            "author": {
                "name": "Paul Fertser",
                "email": "fercerpav@gmail.com",
                "username": "paulfertser"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "src/store/modules/Authentication/AuthenticanStore.js",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -2
                },
                {
                    "file": "src/store/api.js",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 2
        }
    ]
}
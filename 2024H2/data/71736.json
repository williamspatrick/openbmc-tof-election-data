{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I311d8048d80616cc8933c3e32ca44b4cfa64b1e9",
    "number": 71736,
    "subject": "update service: update applytime value",
    "owner": {
        "name": "Jagpal S Gill",
        "email": "paligill@gmail.com",
        "username": "jagpalgill"
    },
    "url": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/71736",
    "hashtags": [
        "redfish-updateservice-use-dbus"
    ],
    "createdOn": 1717377458,
    "lastUpdated": 1734115858,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1717377458,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1717377482,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1717377482,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: -Ok-To-Test"
        },
        {
            "timestamp": 1717378917,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/85222/ : SUCCESS"
        },
        {
            "timestamp": 1717397639,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased.\n\nOutdated Votes:\n* Verified+1 (copy condition: \"changekind:NO_CHANGE\")\n"
        },
        {
            "timestamp": 1717397668,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1717397669,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Ok-To-Test"
        },
        {
            "timestamp": 1717398830,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/85231/ : SUCCESS"
        },
        {
            "timestamp": 1717431812,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717433679,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717459059,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717461004,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717461576,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717463302,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717530975,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1717534588,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1717534590,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 049079f651fbfc465f136c8e9fe6acbd67f0434a"
        },
        {
            "timestamp": 1734115858,
            "reviewer": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "message": "Hashtag added: redfish-updateservice-use-dbus"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0b3c6e0c49e7208795c4e7590197065bd02c8b26",
            "parents": [
                "de0c960c4262169ea92a4b852dd5ebbe3810bf00"
            ],
            "ref": "refs/changes/36/71736/1",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1717377458,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/update_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 30,
            "sizeDeletions": 17
        },
        {
            "number": 2,
            "revision": "d9536cd45f0c741e14d06dd602ca0a6229cf5d32",
            "parents": [
                "20fa6a2c6cea77a4b411634dfca67eef6c8f430f"
            ],
            "ref": "refs/changes/36/71736/2",
            "uploader": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "createdOn": 1717397639,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Does this have any compatibility impacts for the majority of systems that don't yet have the update service dbus meson option set?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "No, this won't impact existing systems.\n\nThis change is for StartUpdate D-Bus interface to use the ApplyTime enum from existing ApplyTime interface as i was doing some conversions which didn't seemed required if i use the same enum type."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> No, this won't impact existing systems.\n> \n> This change is for StartUpdate D-Bus interface to use the ApplyTime enum from existing ApplyTime interface as i was doing some conversions which didn't seemed required if i use the same enum type.\n\n\nBut setApplyTime is called from more than just the new dbus update code?\nhttps://github.com/openbmc/bmcweb/blob/20fa6a2c6cea77a4b411634dfca67eef6c8f430f/redfish-core/lib/update_service.hpp#L1241\n\nSo you're changing what's being set in that path. Maybe I'm missing something?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Ok, I see what's going on, we've changed the new flow, the old flow looks like it has the same enums.\n\nGiven that the old code was tested and working, is there a patch required that's moving the backend to this new enum?  Can you link it?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "There is no change to the old code and it is an old enum.\nI suppose u r looking for the patch for the new Code Updater daemon with StartUpdate API which would be using this old enum? If yes, then its here https://gerrit.openbmc.org/c/openbmc/phosphor-bmc-code-mgmt/+/70668."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "What I mean is that we have code where we had tested the existing enum, and it worked, which meant the backend accepted it.  In this patch we're changing the enum, so one of three things is true:\n1. We never tested the previous patch (which is honestly fine if that's true, this is new code).\n2. We wrote a code change to change the enum in the backend (which I don't see in the patch that you linked.  That looks like just the initial implementation, maybe it was in between two patches on that series?)\n3. The backend supported both enum namespaces somehow and either enum works.\n\n\nI thought it was #2, but maybe not?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Jagpal S Gill",
                        "email": "paligill@gmail.com",
                        "username": "jagpalgill"
                    },
                    "message": "The backend code which supported older enum was never changed and the code to support new enum was added as part of new daemon patch (which i shared above). The backend supports both the flows.\n\nIn this BMCWeb patch i am changing the D-Bus interface to use old enum (xyz.openbmc_project.Software.ApplyTime.RequestedApplyTimes.*) instead of new enum (xyz.openbmc_project.Software.Update.ApplyTimes.*) based on this D-Bus interface change https://gerrit.openbmc.org/c/openbmc/phosphor-dbus-interfaces/+/71734. I have just refactored the enum conversion code to convertApplyTime and used it in both the places."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Understood."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/update_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 30,
            "sizeDeletions": 17
        },
        {
            "number": 3,
            "revision": "049079f651fbfc465f136c8e9fe6acbd67f0434a",
            "parents": [
                "38221509e6cc06a6897e8b9b2aa049a70c033840"
            ],
            "ref": "refs/changes/36/71736/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1717534590,
            "author": {
                "name": "Jagpal S Gill",
                "email": "paligill@gmail.com",
                "username": "jagpalgill"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 27,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/update_service.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -17
                }
            ],
            "sizeInsertions": 30,
            "sizeDeletions": 17
        }
    ]
}
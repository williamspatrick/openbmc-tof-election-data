{
    "project": "openbmc/phosphor-nvme",
    "branch": "master",
    "id": "Ie67d47ce3c99aedba5bfb6aa8d28e60d29856fc0",
    "number": 37943,
    "subject": "Add NVMe power control service",
    "owner": {
        "name": "George Hung",
        "email": "george.hung@quantatw.com",
        "username": "georgehung1210"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-nvme/+/37943",
    "commitMessage": "Add NVMe power control service\n\nThis daemon is to generate NVMe SSD power enable/disable D-Bus\nand could be set by D-Bus to control NVMe SSD power\n\nD-Bus service: xyz.openbmc_project.Control.Nvme.Power\nD-Bus interface: xyz.openbmc_project.Control.Nvme.Power\nD-Bus path: /xyz/openbmc_project/control/nvme/<gpio_line_name>\n\nProvide the GPIOs json config to set your owned GPIO line name\n\nNote:\nTo enable this feature, the build option flag 'nvme-power-control'\nneed to be set\n\nSigned-off-by: George Hung <george.hung@quantatw.com>\nChange-Id: Ie67d47ce3c99aedba5bfb6aa8d28e60d29856fc0\n",
    "createdOn": 1604478764,
    "lastUpdated": 1620375767,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1604478764,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1604478779,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1604478834,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/7305/ : FAILURE"
        },
        {
            "timestamp": 1604496209,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1604496230,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1604496279,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/7322/ : FAILURE"
        },
        {
            "timestamp": 1604559514,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1604559528,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1604559625,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/7367/ : SUCCESS"
        },
        {
            "timestamp": 1605751538,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1620086598,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1620216911,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1620216922,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1620216965,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/16703/ : SUCCESS"
        },
        {
            "timestamp": 1620350081,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1620375384,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1620375400,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1620375423,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/16849/ : FAILURE"
        },
        {
            "timestamp": 1620375615,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 6."
        },
        {
            "timestamp": 1620375630,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1620375675,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/16850/ : SUCCESS"
        },
        {
            "timestamp": 1620375767,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 6:\n\n(4 comments)"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "fcd567615d8ea4ce264c57331463fdca8c845fd3",
            "parents": [
                "9b771e221e3854bbbf45a56bbcab97c62b0a05ec"
            ],
            "ref": "refs/changes/43/37943/1",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1604478764,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/meson.build",
                    "type": "ADDED",
                    "insertions": 33,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_power_gpio.json",
                    "type": "ADDED",
                    "insertions": 66,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "type": "ADDED",
                    "insertions": 206,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/xyz.openbmc_project.Control.Nvme.Power.service.in",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 325,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "ac29958b577674a0ed92a8f2beeff583b9d63f86",
            "parents": [
                "9b771e221e3854bbbf45a56bbcab97c62b0a05ec"
            ],
            "ref": "refs/changes/43/37943/2",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1604496209,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/meson.build",
                    "type": "ADDED",
                    "insertions": 33,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_power_gpio.json",
                    "type": "ADDED",
                    "insertions": 66,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "type": "ADDED",
                    "insertions": 206,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/xyz.openbmc_project.Control.Nvme.Power.service.in",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 325,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "2cdac5c1a68b35e80dbf03164c8961cd5178aa84",
            "parents": [
                "9b771e221e3854bbbf45a56bbcab97c62b0a05ec"
            ],
            "ref": "refs/changes/43/37943/3",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1604559514,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "nvme-pwr-ctrl/nvme_power_gpio.json",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I noticed that this json file has up to 16 nvme, vs 8 in the other nvme_config.json.\n\nI see that we do json parsing in nvme_pwr_ctrl.cpp - is the user expected to change this json file to accommodate for their platform?"
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_power_gpio.json",
                    "line": 0,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Also change to 8 as default for the nvme_power_gpio.json"
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "line": 0,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Unit tests would be good to have in this repository."
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "line": 0,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Done"
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "line": 12,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Can we split this out as class instead?"
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "line": 12,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Done"
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "line": 174,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I had to recently create a discrete IPMI sensor and William suggested that I overload the property's getter function instead - then in the getter function, create a matcher that waits for the systemd to finish and determine its status.\n\nThe benefit of doing it this way is that we can make the systemd call blocking (until it finishes) and report its status. Also, it makes it so that we can toggle both the assert and deassert event via 0x01 instead of having to change the `ipmitool raw` command (0x10 for assert, 0x03 for deassert, etc.)\n\nSample code of how the matcher would look like: https://github.com/openbmc/phosphor-ipmi-flash/blob/master/bmc/general_systemd.cpp#L45"
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "line": 174,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Sorry, I'm not quite understanding how to change like what you suggested, but I custom the register_property method to set GPIO value and property value by boolean value instead of the event string value, maybe it's little close to what you said to toggle via 0x01/0x00.\n\nBTW, due to this change, it also needs to modify the nvme power sensors event offset type as boolean instead of the string for gbs-ipmi-sensor.yaml"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "ADDED",
                    "insertions": 1,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/meson.build",
                    "type": "ADDED",
                    "insertions": 33,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_power_gpio.json",
                    "type": "ADDED",
                    "insertions": 66,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/nvme_pwr_ctrl.cpp",
                    "type": "ADDED",
                    "insertions": 217,
                    "deletions": 0
                },
                {
                    "file": "nvme-pwr-ctrl/xyz.openbmc_project.Control.Nvme.Power.service.in",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 336,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "24f2e7d0e76f2328e4dbc13ff52133d1faee427f",
            "parents": [
                "9b771e221e3854bbbf45a56bbcab97c62b0a05ec"
            ],
            "ref": "refs/changes/43/37943/4",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1620216911,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "ADDED",
                    "insertions": 4,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/meson.build",
                    "type": "ADDED",
                    "insertions": 39,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control.cpp",
                    "type": "ADDED",
                    "insertions": 91,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control.hpp",
                    "type": "ADDED",
                    "insertions": 111,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_gpio.json",
                    "type": "ADDED",
                    "insertions": 66,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/xyz.openbmc_project.Control.Nvme.Power.service.in",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 329,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "d23bea1f6cac34aa48bbaeb0dbd04e10625ffbd4",
            "parents": [
                "9b771e221e3854bbbf45a56bbcab97c62b0a05ec"
            ],
            "ref": "refs/changes/43/37943/5",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1620375384,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/meson.build",
                    "type": "ADDED",
                    "insertions": 63,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control.cpp",
                    "type": "ADDED",
                    "insertions": 101,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control.hpp",
                    "type": "ADDED",
                    "insertions": 79,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control_main.cpp",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_gpio.json",
                    "type": "ADDED",
                    "insertions": 66,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/test/utest.cpp",
                    "type": "ADDED",
                    "insertions": 32,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/xyz.openbmc_project.Control.Nvme.Power.service.in",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 390,
            "sizeDeletions": 0
        },
        {
            "number": 6,
            "revision": "992662dd45f639fb0cd28c9c58a86b69b8aef51d",
            "parents": [
                "9b771e221e3854bbbf45a56bbcab97c62b0a05ec"
            ],
            "ref": "refs/changes/43/37943/6",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1620375615,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "meson_options.txt",
                    "type": "ADDED",
                    "insertions": 7,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/meson.build",
                    "type": "ADDED",
                    "insertions": 63,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control.cpp",
                    "type": "ADDED",
                    "insertions": 101,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control.hpp",
                    "type": "ADDED",
                    "insertions": 79,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_control_main.cpp",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/nvme_power_gpio.json",
                    "type": "ADDED",
                    "insertions": 66,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/test/utest.cpp",
                    "type": "ADDED",
                    "insertions": 32,
                    "deletions": 0
                },
                {
                    "file": "nvme-power-control/xyz.openbmc_project.Control.Nvme.Power.service.in",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 390,
            "sizeDeletions": 0
        }
    ]
}
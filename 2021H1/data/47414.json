{
    "project": "openbmc/google-misc",
    "branch": "master",
    "id": "I69c927cb41fe571e8efeb576597c858cb892fdbf",
    "number": 47414,
    "subject": "flashupdate: Implement updateStatedVersion command",
    "owner": {
        "name": "Willy Tu",
        "email": "wltu@google.com",
        "username": "wltu"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/google-misc/+/47414",
    "commitMessage": "flashupdate: Implement updateStatedVersion command\n\nThe updateStatedVersion read the firmware version with CR51 from the\ninput argument. It will validate the firmware and update the staged\nversion to the EEPROM.\n\nChange-Id: I69c927cb41fe571e8efeb576597c858cb892fdbf\nSigned-off-by: Willy Tu <wltu@google.com>\n",
    "hashtags": [
        "flashupdate-wltu"
    ],
    "createdOn": 1633113318,
    "lastUpdated": 1634246516,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1633113318,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1633113341,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633113362,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/27309/ : FAILURE"
        },
        {
            "timestamp": 1633113461,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Hashtag added: flashupdate-wltu"
        },
        {
            "timestamp": 1633390492,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1633563792,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1633563807,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633564200,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/27668/ : FAILURE"
        },
        {
            "timestamp": 1633577263,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1633577273,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633577491,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/27683/ : FAILURE"
        },
        {
            "timestamp": 1633624614,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1633624633,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633624658,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/27736/ : FAILURE"
        },
        {
            "timestamp": 1633625004,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1633625023,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633625050,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/27747/ : FAILURE"
        },
        {
            "timestamp": 1633625725,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1633633286,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1633638836,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 6."
        },
        {
            "timestamp": 1633638845,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633639328,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/27772/ : SUCCESS"
        },
        {
            "timestamp": 1633639469,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1633639552,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1633639599,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1633646758,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1634246516,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Set Work In Progress"
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "2ac41beab15d6829b6aad6148cab4b26a1c83d85",
            "parents": [
                "7dd310481a1be7680a72bcba4cb4e39936ea199b"
            ],
            "ref": "refs/changes/14/47414/1",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1633113318,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "line": 131,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "What is this doing? Could we have more comments around this block?"
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "line": 131,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 18,
            "sizeDeletions": 2
        },
        {
            "number": 2,
            "revision": "ef964e984a1df0e399434e368dca1c8d2a57a091",
            "parents": [
                "6fe8841b0f4ab2b764025f2b349d80d85f86f81f"
            ],
            "ref": "refs/changes/14/47414/2",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1633563792,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 18,
            "sizeDeletions": 2
        },
        {
            "number": 3,
            "revision": "691dd7941b009ab94d8358c7ecb251f4c80f3f68",
            "parents": [
                "8032eb9f6bb6804fa7b1c5bc7d49f88f343c398b"
            ],
            "ref": "refs/changes/14/47414/3",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1633577263,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "subprojects/flashupdate/include/flashupdate/cr51.hpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/internal/flashupdate/args.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/args.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                },
                {
                    "file": "subprojects/flashupdate/test/args.cpp",
                    "type": "MODIFIED",
                    "insertions": 74,
                    "deletions": -74
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 164,
            "sizeDeletions": 81
        },
        {
            "number": 4,
            "revision": "0449b02209aa64bec5c107ebf78ad6d6644a9719",
            "parents": [
                "f7f3dbf90335d8e2083ea19786e2d091c8fdc097"
            ],
            "ref": "refs/changes/14/47414/4",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1633624614,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "subprojects/flashupdate/include/flashupdate/ops.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -3
                },
                {
                    "file": "subprojects/flashupdate/internal/flashupdate/args.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/args.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 89,
            "sizeDeletions": 8
        },
        {
            "number": 5,
            "revision": "765db747832d053806a68b800a88bbdd735928b7",
            "parents": [
                "d7d7b5bfb31478d425d98fcaea60392c53c0ca25"
            ],
            "ref": "refs/changes/14/47414/5",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1633625004,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "subprojects/flashupdate/src/args.cpp",
                    "line": 55,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "should the mockHelper be injected like this? or with the constructor?"
                },
                {
                    "file": "subprojects/flashupdate/src/args.cpp",
                    "line": 55,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "I usually make the constructor take a parameter and then initialize at the initializer list, bt I don't think this is all too bad.\n\nLooking back at this, should the unique ptr be called cr51Helper and the pointer we get from .get() be called cr51HelperPtr instead?"
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "line": 158,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "I have injected the mockHelper in here. Is that the best way. Maybe create a Args constructor that take in custom helper is better?"
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "line": 161,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "nit: should this be testing with stageVersion"
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "line": 161,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "The version in the eeprom is stageVersion right now. We want to write some other version there.\n\nI have used another variable for it to be less confusing."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "subprojects/flashupdate/include/flashupdate/ops.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -3
                },
                {
                    "file": "subprojects/flashupdate/internal/flashupdate/args.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/args.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 80,
            "sizeDeletions": 8
        },
        {
            "number": 6,
            "revision": "cc1bd3a4bb9d40b3a97f93234057c5ab755f3cb4",
            "parents": [
                "4c6b7007debf670f256b33d5cf56823ed52fde39"
            ],
            "ref": "refs/changes/14/47414/6",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1633638836,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "subprojects/flashupdate/include/flashupdate/ops.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/internal/flashupdate/args.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/args.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -1
                },
                {
                    "file": "subprojects/flashupdate/src/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                },
                {
                    "file": "subprojects/flashupdate/test/ops.cpp",
                    "type": "MODIFIED",
                    "insertions": 30,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 82,
            "sizeDeletions": 6
        }
    ]
}
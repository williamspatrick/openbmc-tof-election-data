{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I71a4c2103b0aaefd94174755eec091355c6460a4",
    "number": 39006,
    "subject": "Redfish: Allow disabling HTTPS",
    "owner": {
        "name": "Albert Zhang",
        "email": "zhanghaodi@inspur.com",
        "username": "zhanghaodi"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/39006",
    "commitMessage": "Redfish: Allow disabling HTTPS\n\nThis patch adds support for disabling HTTPS using\nRedfish API.\n\nTested:\n1) Ran the Redfish Validator.\n2) Disabled HTTPS from Redfish and verified bmcweb\n   stopped and verified ProtocolEnabled is false for HTTPS.\n\n   curl -k -H \"X-Auth-Token: $token\" -X  GET https://${bmc}/redfish/v1/\n   Managers/bmc/NetworkProtocol/\n {\n  \"@odata.id\": \"/redfish/v1/Managers/bmc/NetworkProtocol\",\n  \"@odata.type\": \"#ManagerNetworkProtocol.v1_5_0.ManagerNetworkProtocol\",\n  \"Description\": \"Manager Network Service\",\n  ...\n  \"HTTPS\": {\n    \"Certificates\": {\n    \"@odata.id\": \"/redfish/v1/Managers/bmc/NetworkProtocol/HTTPS/Certificates\"\n    },\n    \"Port\": 443,\n    \"ProtocolEnabled\": true\n  },\n  ...\n }\n\n   curl -k -H \"X-Auth-Token: $token\" -X PATCH '-d {\"HTTPS\": {\"ProtocolEnabled\": false}}'\n   https://${bmc}/redfish/v1/Managers/bmc/NetworkProtocol/\ncurl: (35) OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to 127.0.0.1:2443\n\nD-bus has changed to :\n\n            busctl introspect xyz.openbmc_project.Control.Service.Manager\n            /xyz/openbmc_project/control/service/bmcweb\n            xyz.openbmc_project.Control.Service.Attributes\nNAME                      TYPE      SIGNATURE RESULT/VALUE FLAGS\n.Enabled                  property  b         false        emits-change writable\n.Masked                   property  b         false        emits-change writable\n.Running                  property  b         false        emits-change writable\n\nSigned-off-by: Albert Zhang <zhanghaodi@inspur.com>\nChange-Id: I71a4c2103b0aaefd94174755eec091355c6460a4\n",
    "createdOn": 1607930074,
    "lastUpdated": 1613975164,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1607930074,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1607930092,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1607931098,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/9707/ : SUCCESS"
        },
        {
            "timestamp": 1607939674,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 1:\n\n(5 comments)"
        },
        {
            "timestamp": 1607966779,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1608168208,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1608168223,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608168700,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 2:\n\n(6 comments)"
        },
        {
            "timestamp": 1608169959,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/9981/ : SUCCESS"
        },
        {
            "timestamp": 1608176015,
            "reviewer": {
                "name": "George Liu",
                "email": "liuxiwei@inspur.com",
                "username": "lxwinspur"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1608191123,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1608191136,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608191388,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 3:\n\n(1 comment)\n\n> Patch Set 2:\n> \n> (1 comment)"
        },
        {
            "timestamp": 1608192861,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/9987/ : SUCCESS"
        },
        {
            "timestamp": 1608602059,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1608663486,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1608663683,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1609811655,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1609811667,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1609811783,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1609812666,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/10477/ : SUCCESS"
        },
        {
            "timestamp": 1609864219,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1609869106,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1609894503,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1609898359,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1610328194,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Uploaded patch set 5: Commit message was updated."
        },
        {
            "timestamp": 1610328294,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1610559588,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 5:\n\n(1 comment)\n\nLet's discuss which interfaces we want to allow BMC admins to disable.  I'll start an email thread."
        },
        {
            "timestamp": 1610560416,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1611854853,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 5:\n\n(1 comment)\n\nProposed issue resolution allow this change, and push this issue into the https://github.com/openbmc/service-config-manager"
        },
        {
            "timestamp": 1611855334,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1611879256,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 5:\n\n(1 comment)\n\nFurther designing is needed."
        },
        {
            "timestamp": 1611882010,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1613435615,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 5:\n\nPer agenda item 1 dated 2020-02-03 from the security working group meeting (https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI): Redfish should not have an interface to disable HTTPS because the Redfish interface is built on top of HTTPS.  If this were allowed, the user could lock themselves out of the BMC too easily.\n\nAt that same security working group meeting: we also discussed enhancing the config-service-manager, but rejected the ideas because of the additional complexity.  Some examples:\n1. The config-service-manager could disallow requests to disable HTTPS when that request came from an HTTPS source (like BMCWeb).  \n2. The config-service-manager could allow Redfish to disable HTTPS and (somehow) if it could ensure that at least one interface capable of re-enabling HTTPS remained enabled.\n\nCan you explain what problem you are trying to solve or point to an issue?  If you need an interface to disable HTTPS, you can disable it from some other interface (such as IPMI, or via a host interface)?"
        },
        {
            "timestamp": 1613609775,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Patch Set 5:\n\n> Patch Set 5:\n> \n> Per agenda item 1 dated 2020-02-03 from the security working group meeting (https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI): Redfish should not have an interface to disable HTTPS because the Redfish interface is built on top of HTTPS.  If this were allowed, the user could lock themselves out of the BMC too easily.\n> \n> At that same security working group meeting: we also discussed enhancing the config-service-manager, but rejected the ideas because of the additional complexity.  Some examples:\n> 1. The config-service-manager could disallow requests to disable HTTPS when that request came from an HTTPS source (like BMCWeb).  \n> 2. The config-service-manager could allow Redfish to disable HTTPS and (somehow) if it could ensure that at least one interface capable of re-enabling HTTPS remained enabled.\n> \n> Can you explain what problem you are trying to solve or point to an issue?  If you need an interface to disable HTTPS, you can disable it from some other interface (such as IPMI, or via a host interface)?\n\nYes, I have made many attempts to disable HTTPS through this interface, it's easy to lock yourself out of the BMC,I re-enable HTTPS through D-bus.And there should be another way to re-enable HTTPS by adding an IPMI OEM command to your own machine, but this is very troublesome. \nThere are indeed some problems, if there are no other comments, I will abandon it."
        },
        {
            "timestamp": 1613615002,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n> Patch Set 5:\n> \n> > Patch Set 5:\n> > \n> > Per agenda item 1 dated 2020-02-03 from the security working group meeting (https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI): Redfish should not have an interface to disable HTTPS because the Redfish interface is built on top of HTTPS.  If this were allowed, the user could lock themselves out of the BMC too easily.\n> > \n> > At that same security working group meeting: we also discussed enhancing the config-service-manager, but rejected the ideas because of the additional complexity.  Some examples:\n> > 1. The config-service-manager could disallow requests to disable HTTPS when that request came from an HTTPS source (like BMCWeb).  \n> > 2. The config-service-manager could allow Redfish to disable HTTPS and (somehow) if it could ensure that at least one interface capable of re-enabling HTTPS remained enabled.\n> > \n> > Can you explain what problem you are trying to solve or point to an issue?  If you need an interface to disable HTTPS, you can disable it from some other interface (such as IPMI, or via a host interface)?\n> \n> Yes, I have made many attempts to disable HTTPS through this interface, it's easy to lock yourself out of the BMC,I re-enable HTTPS through D-bus.And there should be another way to re-enable HTTPS by adding an IPMI OEM command to your own machine, but this is very troublesome. \n> There are indeed some problems, if there are no other comments, I will abandon it.\n\nI think that's the right thing to do.\n\nIf you wanted to push your cleanups (making the exact protocol a separate function) as it's own patchset, separate from allowing https disabling, it would be appreciated."
        },
        {
            "timestamp": 1613975164,
            "reviewer": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "message": "Abandoned\n\nWhen HTTPS is disabled through this interface, it is easy to cause yourself to be locked out of BMC."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "2d9223db2538c6ab638fcba5a5a92556e5f14019",
            "parents": [
                "9e319cf0c5ee714cdd879a1d2a6e5b5ac96c7f1d"
            ],
            "ref": "refs/changes/06/39006/1",
            "uploader": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "createdOn": 1607930074,
            "author": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm not really following why you would want to disable HTTPS from an HTTPS interface.\n\nAlso, bmcweb is not designed to host multiple copies of the service on a single bmc.  If you're doing that, be prepared for bugs."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Redfish: Allow disabling SSH and HTTP (the redirect) #1763 mentioned, so I want to disable HTTPS through the redfish interface"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "You want to disable HTTPS through HTTPS, thereby disabling your interface to the BMC?\n\nThat seems like a possible DOS vector.  I wonder if we should limit disabling of interfaces to not be allowed on the interface they came in on.\n\nDisabling HTTP redirect seems reasonable, as does disabling SSH"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "I agree with disabling HTTP redirect seems reasonable, as does disabling SSH.. which I believe is what the issue is talking about."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> I agree with disabling HTTP redirect seems reasonable, as does disabling SSH.. which I believe is what the issue is talking about.\n\nBut that's not what the code does.  It disables the main https port."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Yes, this is to disable main https port."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "remove"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 17,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "if the data is irrelevant to this commit, I think you can use `...`"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 23,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 41,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "as above"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 41,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 47,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "D-Bus"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 47,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 49,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "remove"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 49,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 539,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This code is 2 lines different than the IPMI code.  Please deduplicate."
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 539,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 58,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 77,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 77,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "946dcc605eaa78c46610338a2230c87a418d8137",
            "parents": [
                "9e319cf0c5ee714cdd879a1d2a6e5b5ac96c7f1d"
            ],
            "ref": "refs/changes/06/39006/2",
            "uploader": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "createdOn": 1608168208,
            "author": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 475,
                    "reviewer": {
                        "name": "George Liu",
                        "email": "liuxiwei@inspur.com",
                        "username": "lxwinspur"
                    },
                    "message": "Blank line"
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 475,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 50,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -16
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 16
        },
        {
            "number": 3,
            "revision": "e04ac9577bbc33120f30c534ced62c366c7b0652",
            "parents": [
                "9e319cf0c5ee714cdd879a1d2a6e5b5ac96c7f1d"
            ],
            "ref": "refs/changes/06/39006/3",
            "uploader": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "createdOn": 1608191123,
            "author": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 425,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "pass string_view by value."
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 425,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 429,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This causes lifetime issues.  String_view points to memory that might have been destroyed already."
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "line": 429,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 50,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 15
        },
        {
            "number": 4,
            "revision": "3f5a7e44cc0e07961b58d2acd888fd282fd0c579",
            "parents": [
                "9e319cf0c5ee714cdd879a1d2a6e5b5ac96c7f1d"
            ],
            "ref": "refs/changes/06/39006/4",
            "uploader": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "createdOn": 1609811655,
            "author": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can you please remove this.  It's not correct so far as I'm aware."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Albert Zhang",
                        "email": "zhanghaodi@inspur.com",
                        "username": "zhanghaodi"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Please add more details around WHY you would want to do this.  Disabling the interface you're currently using isn't a very common operation, and can lead to the possibility of the user locking themselves out of the system, hence why it's not implemented today.  So lets get your use case understood, then hopefully we can give you some advice about how to proceed."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "I do not have a use case to disable HTTPS.  The Redfish spec allows it (ManagerNetworkProtocol.json) and some OpenBMC downstream users might want it (specifically, systems that manage their BMC via the host).  I would be okay with this function if I could remove it from my image.  Because (like Ed said) I don't want to give my users a way to disable HTTPS.\n\nI believe this review is associated with https://github.com/ibm-openbmc/dev/issues/1763 which calls for a way to disable SSH and HTTP and SSH."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> I do not have a use case to disable HTTPS.  The Redfish spec allows it (ManagerNetworkProtocol.json) and some OpenBMC downstream users might want it (specifically, systems that manage their BMC via the host).  I would be okay with this function if I could remove it from my image.  Because (like Ed said) I don't want to give my users a way to disable HTTPS.\n> \n> I believe this review is associated with https://github.com/ibm-openbmc/dev/issues/1763 which calls for a way to disable SSH and HTTP and SSH.\n\nMy worry here is that we're opening a DOS vector.  If users have a way to disable an interface from said interface, that leaves a user open to accidentally locking themselves out.  That's why this wasn't implemented before.  I'd fully support disabling the HTTPS interface over a different API (ipmi, ect) or if we could differentiate enablement based on channels, so it wasn't possible for a user to lock themselves out of a system, but as written, this patchset seems really dangerous to have."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 50,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 15
        },
        {
            "number": 5,
            "revision": "fc35eb1447c9a3d823cb03fa45722700b2109087",
            "parents": [
                "9e319cf0c5ee714cdd879a1d2a6e5b5ac96c7f1d"
            ],
            "ref": "refs/changes/06/39006/5",
            "uploader": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "createdOn": 1610328194,
            "author": {
                "name": "Albert Zhang",
                "email": "zhanghaodi@inspur.com",
                "username": "zhanghaodi"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "(continuing from the PS4 comment)\nWe discussed this in the 2020-01-20 meeting on the OpenBMC security working group https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI\nThere are some use cases to disable the HTTPS interface, for example, on a BMC controlled by KCS.  Therefore this interface is worthwhile to add to BMCWeb.  We discussed the idea of using a \"block list\" to block users from disabling HTTPS; that block list would not be in BMCWeb but would be at the D-Bus API layer (xyz.openbmc_project.Control.Service.Attributes at /xyz/openbmc_project/control/service/).  The default would be that HTTPS is blocked (meaning it would always stay enabled).\n\nWith this model, the D-Bus service manager would handle scenarios where the user locks themselves out.  For example, if IPMI and HTTPS are the only two interfaces available, then the service manager should not allow both of them to be disabled.\n\nDoes this resolve this comment?  If so, I propose creating an issue to enhance the service manager, and proceed with this commit."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> (continuing from the PS4 comment)\n> We discussed this in the 2020-01-20 meeting on the OpenBMC security working group https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI\n> There are some use cases to disable the HTTPS interface, for example, on a BMC controlled by KCS.  Therefore this interface is worthwhile to add to BMCWeb.\n\nThis is not my recollection of this discussion.   I thought we agreed that disabling the HTTPS interface FROM the HTTPS interface should not be allowed, because it allows a user to inadvertently lock themselves out.  Disabling HTTPS from IPMI is completely reasonable.\n\n>  We discussed the idea of using a \"block list\" to block users from disabling HTTPS; that block list would not be in BMCWeb but would be at the D-Bus API layer (xyz.openbmc_project.Control.Service.Attributes at /xyz/openbmc_project/control/service/).  The default would be that HTTPS is blocked (meaning it would always stay enabled).\n> \n> With this model, the D-Bus service manager would handle scenarios where the user locks themselves out.\n\ndbus service manager doesn't have the channel information, so it can't prevent this issue.\n\n>  For example, if IPMI and HTTPS are the only two interfaces available, then the service manager should not allow both of them to be disabled.\n> \n> Does this resolve this comment?  If so, I propose creating an issue to enhance the service manager, and proceed with this commit.\n\nDisagree.  IF that's the plan, the merging of that feature into service cfg manager would be a pre-req of this patch.\n\nLets regroup in the next security WG and see if we just got our wires crossed."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Yes, we did agree to that. It was not my intention to repeat all the details in the review comments here (so apologies for being unclear).  Did you think BMCWeb itself would block disabling HTTPS, or that would be handled by the service manager?\n\nI had thought we would have to enhance the service manager D-Bus information to provide channel information.  I also had not understood the service manager enhancement would be a pre-req.\n\nSo let's discuss in email or Security WG."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Yes, we did agree to that. It was not my intention to repeat all the details in the review comments here (so apologies for being unclear).  Did you think BMCWeb itself would block disabling HTTPS, or that would be handled by the service manager?\n\nI'm not sure how service manager would do that;  it has no idea what channel is actually requesting the thing to shutdown.  In this case, i'd much prefer we just put it in each daemon, as when/if Redfish supports host interface or RDE, those will need to be special cased, and service manager can't really do that.\n\n> \n> I had thought we would have to enhance the service manager D-Bus information to provide channel information.  I also had not understood the service manager enhancement would be a pre-req.\n> \n> So let's discuss in email or Security WG.\n\nsounds good"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 49,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/network_protocol.hpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -15
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 15
        }
    ]
}
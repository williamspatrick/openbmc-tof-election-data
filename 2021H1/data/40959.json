{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "I0d887541384cda045f15ae756ef0f82da29d839f",
    "number": 40959,
    "subject": "Fan: Memorize the used sensor config through flat_set",
    "owner": {
        "name": "Yong Zhao",
        "email": "yozhao@google.com",
        "username": "YongZhao12"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/40959",
    "commitMessage": "Fan: Memorize the used sensor config through flat_set\n\nThis prevents a used sensor from being reconsidered again, improving\nthe performance.\n\nTested: The sensor configs that have been used won't be checked again.\n\nChange-Id: I0d887541384cda045f15ae756ef0f82da29d839f\nSigned-off-by: Yong Zhao <yozhao@google.com>\n",
    "createdOn": 1614289768,
    "lastUpdated": 1630088428,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1614289768,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1614289790,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1614289927,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/13071/ : FAILURE"
        },
        {
            "timestamp": 1614290279,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1614290293,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1614290339,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1614290348,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1614290350,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/13074/ : ABORTED"
        },
        {
            "timestamp": 1614290536,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/13075/ : SUCCESS"
        },
        {
            "timestamp": 1623089955,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\nIs this patchset still being worked?  Apologies, for whatever reason this fell off my to-review list."
        },
        {
            "timestamp": 1623092980,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Patch Set 3:\n\n> Patch Set 3:\n> \n> Is this patchset still being worked?  Apologies, for whatever reason this fell off my to-review list.\n\nIt was working before, and it should continue to work. But I have not checked it for a while, and I will try it out soon."
        },
        {
            "timestamp": 1623092999,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Patch Set 4: Patch Set 3 was rebased"
        },
        {
            "timestamp": 1623093012,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1623093149,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/18884/ : SUCCESS"
        },
        {
            "timestamp": 1623112510,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1623115824,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1623170774,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1623178548,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1623194081,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1629872259,
            "reviewer": {
                "email": "rashmi.r.v@linux.intel.com",
                "username": "Rashmi-RV"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1629913833,
            "reviewer": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1630088428,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\nAbandoned at the submitters request."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "22b3c5166351e0d65f1ca91209dfc9219df941a5",
            "parents": [
                "7e219125b85359cea93ef1197776cdb0e6218cd1"
            ],
            "ref": "refs/changes/59/40959/1",
            "uploader": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "createdOn": 1614289768,
            "author": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 16,
            "sizeDeletions": 8
        },
        {
            "number": 2,
            "revision": "bd659890abdaf370a439fc84fec2c241c9bea03f",
            "parents": [
                "7e219125b85359cea93ef1197776cdb0e6218cd1"
            ],
            "ref": "refs/changes/59/40959/2",
            "uploader": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "createdOn": 1614290279,
            "author": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 8
        },
        {
            "number": 3,
            "revision": "1bcc2a137b2a3fb7a12ff62d6e7e5461ddbdf272",
            "parents": [
                "7e219125b85359cea93ef1197776cdb0e6218cd1"
            ],
            "ref": "refs/changes/59/40959/3",
            "uploader": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "createdOn": 1614290339,
            "author": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 18,
            "sizeDeletions": 8
        },
        {
            "number": 4,
            "revision": "be79de5f3e0aaf68a77466ee635503c771b2e7d2",
            "parents": [
                "1263c3dad3a723f4ebbd05e4031e4d5ff45f349c"
            ],
            "ref": "refs/changes/59/40959/4",
            "uploader": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "createdOn": 1623092999,
            "author": {
                "name": "Yong Zhao",
                "email": "yozhao@google.com",
                "username": "YongZhao12"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "email": "rashmi.r.v@linux.intel.com",
                        "username": "Rashmi-RV"
                    },
                    "message": "How much is the performance gain? Just trying to understand the impact."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Yong Zhao",
                        "email": "yozhao@google.com",
                        "username": "YongZhao12"
                    },
                    "message": "I did not measure it. Theoretically, it should improve from O(M*N) to O(N). \n\nAnyway, I should have abandoned this CL."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This seems like a bug.  What happens when the sensor configs change, does the sensor get re-inited?  can you please add changing a threshold to your test procedure?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Yong Zhao",
                        "email": "yozhao@google.com",
                        "username": "YongZhao12"
                    },
                    "message": "How to add changing a threshold? I have never done that before, can you elaborate?\n\nMaybe I should have put it this way \"The sensor configs that have been used won't be checked again during the current createSensors().\" I think if sensor configs change, the sensor will get re-inited as long as createSensors() is re-entered."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Thinking about this more, there's a reason we don't do that.  sensors might need initted multiple times if the configuration changes during startup.  Ideally we'd coalesce and make sure we only init the last sensor of a given name, but that's not what this patch is doing."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Yong Zhao",
                        "email": "yozhao@google.com",
                        "username": "YongZhao12"
                    },
                    "message": "Oh, I did not know that before. So you mean there could be multiple sensorConfigurations for an object_path? If there are multiple and according to the old logic the last entry for a certain object_path  overwrites the prior sensorConfigurations in the end, we could start the looping from the back rather than the front in my change. Do you see any need to pursue that or should I just abandon this change?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "In theory looping from the back would work, but I'm not really sure how to test that change effectively."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "src/FanMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 18,
            "sizeDeletions": 8
        }
    ]
}
{
    "project": "openbmc/phosphor-nvme",
    "branch": "master",
    "id": "I107f756eab790bed2416e7c0c8d7193a79ed7954",
    "number": 43384,
    "subject": "Emit the threshold alarm signals to trigger SEL logs",
    "owner": {
        "name": "George Hung",
        "email": "george.hung@quantatw.com",
        "username": "georgehung1210"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-nvme/+/43384",
    "commitMessage": "Emit the threshold alarm signals to trigger SEL logs\n\nEmit the thresold alarm signals on sensor threshold interface:\nhttps://gerrit.openbmc-project.xyz/39899\n\nSigned-off-by: George Hung <george.hung@quantatw.com>\nChange-Id: I107f756eab790bed2416e7c0c8d7193a79ed7954\n",
    "createdOn": 1621476347,
    "lastUpdated": 1623980529,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1621476347,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1621476360,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1621476406,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/17648/ : SUCCESS"
        },
        {
            "timestamp": 1621987091,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1622021121,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1622045718,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1622109091,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1622109120,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1622109173,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/18229/ : SUCCESS"
        },
        {
            "timestamp": 1622109738,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1622161450,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\nSorry for the f"
        },
        {
            "timestamp": 1622456320,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1622696425,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1622699033,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1622699047,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1622699096,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/18609/ : SUCCESS"
        },
        {
            "timestamp": 1622699150,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1622761886,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 3:\n\n(2 comments)\n\nBenjamin is out for the week so he can't +2 this change this week."
        },
        {
            "timestamp": 1622772329,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1622772341,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1622772386,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/18680/ : SUCCESS"
        },
        {
            "timestamp": 1622772675,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1622785221,
            "reviewer": {
                "name": "Brandon Kim",
                "email": "brandonkim@google.com",
                "username": "brandonkimbk"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1623844121,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 4:\n\nGently ping for this, thanks."
        },
        {
            "timestamp": 1623980114,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 4:\n\n> Patch Set 4:\n> \n> Gently ping for this, thanks.\n\nHi Benjamin,\ncould you help to review this change ?\nThanks."
        },
        {
            "timestamp": 1623980290,
            "reviewer": {
                "name": "Benjamin Fair",
                "email": "benjaminfair@google.com",
                "username": "BenjaminFair"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1623980515,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Patch Set 4:\n\nThanks a lot."
        },
        {
            "timestamp": 1623980529,
            "reviewer": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "message": "Change has been successfully merged by George Hung"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "109d6c1cbfbc518dc8580b70936d0317b668c2a0",
            "parents": [
                "d5838d1bbb26e9aa7ffc19c4fc57f4ee1237e22a"
            ],
            "ref": "refs/changes/84/43384/1",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1621476347,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Should these conditionals match what's used above in 24, 26, 28, 30? and if so, (since we're using the same conditional 3 times), should we just store the bools and reuse them?"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "They are different, line 24/26/28/30 are belong to the original threshold alarm property change and for the new threshold alarm asserted/de-asserted signals, we need to send these signals additionally for phosphor-sel-logger.\n\nref: https://github.com/openbmc/phosphor-hwmon/blob/e32ce16bb6cc527b2e46b6e90ef7ac47404da173/thresholds.hpp#L84"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "What I meant was, could we store `bool criticalHighAlarm = value >= criticalHigh` at the top? and then use it throughout the function - it's a nit, since the compiler probably will optimize? but this may be easier to read possibly.\n\nI was curious as to why line 24/26/28/30 used > and < instead of >= and <= here though (and maybe that's what you were explaining here?)"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Sorry, I got your point and I modify them done."
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Sorry for the confusion. Since the conditionals are not the same (greater than vs. greater than and equals), maybe this is not what we want. Looking at patchset 1 and patchset 2, if the equals is important, then the meaning of the code changed as we no longer check for equals in line 36.\n\nI think it makes sense to have a precomputed boolean if all 3 conditionals can be the same, but if it's only 2 (if we want to go with this, we'll have to change the boolean usage to keep the same meaning) I'm not sure if it's much better.\n\nMaybe others can chime in?"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Is the current question about greater than or greater than and equals ? if so, maybe we can follow the phosphor-hwmon, it should be greater than and equals. What do you think ?"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "Yes, it seems hwmon is greater / less than and equal to.\n\nLet's match that and make all the conditional the same so we can use it at all 3 places."
                },
                {
                    "file": "nvmes.cpp",
                    "line": 32,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "nvmes.cpp",
                    "type": "MODIFIED",
                    "insertions": 49,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 49,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "c63cbc5d07c540a9399437adc4a313543e82f283",
            "parents": [
                "d5838d1bbb26e9aa7ffc19c4fc57f4ee1237e22a"
            ],
            "ref": "refs/changes/84/43384/2",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1622109091,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "nvmes.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 4
        },
        {
            "number": 3,
            "revision": "74206872cce8d1a8005daa06ee73fa5c99d30cc4",
            "parents": [
                "d5838d1bbb26e9aa7ffc19c4fc57f4ee1237e22a"
            ],
            "ref": "refs/changes/84/43384/3",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1622699033,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "nvmes.cpp",
                    "line": 38,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "can't we replace these conditional with the bool now since it's the same? criticalAlarmHigh here for example"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 38,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Sorry, I didn't notice that and now I replace these conditional with bool."
                },
                {
                    "file": "nvmes.cpp",
                    "line": 71,
                    "reviewer": {
                        "name": "Brandon Kim",
                        "email": "brandonkim@google.com",
                        "username": "brandonkimbk"
                    },
                    "message": "same here"
                },
                {
                    "file": "nvmes.cpp",
                    "line": 71,
                    "reviewer": {
                        "name": "George Hung",
                        "email": "george.hung@quantatw.com",
                        "username": "georgehung1210"
                    },
                    "message": "Also updated."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "nvmes.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 4
        },
        {
            "number": 4,
            "revision": "9ebfa481ce15ebbdf86abd21512999415dd6ef03",
            "parents": [
                "d5838d1bbb26e9aa7ffc19c4fc57f4ee1237e22a"
            ],
            "ref": "refs/changes/84/43384/4",
            "uploader": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "createdOn": 1622772329,
            "author": {
                "name": "George Hung",
                "email": "george.hung@quantatw.com",
                "username": "georgehung1210"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "nvmes.cpp",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 4
        }
    ]
}
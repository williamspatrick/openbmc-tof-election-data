{
    "project": "openbmc/phosphor-fan-presence",
    "branch": "master",
    "id": "Ic2c6848f24511c9dc763227e05bbebb4c8c80cd1",
    "number": 40295,
    "subject": "monitor: Support for running with power off",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-fan-presence/+/40295",
    "commitMessage": "monitor: Support for running with power off\n\nPut in the remaining changes necessary so that fan monitor doesn't need\nto be killed when power turns off.\n\nThis includes things like:\n* Support for starting before the Present property is on D-Bus.\n* Support for starting before the config file name is available.\n* Stopping any running timers when power is turned off.\n* Checking the power off rules when power turns on.\n\nMost, but not all, of the changes are common between the JSON and YAML\nmodes, but this only truly supported when compiled for JSON.\n\nThis also removes the init vs monitor modes of operation, if compiled\nfor JSON.\n\nSigned-off-by: Matt Spinler <spinler@us.ibm.com>\nChange-Id: Ic2c6848f24511c9dc763227e05bbebb4c8c80cd1\n",
    "createdOn": 1612464724,
    "lastUpdated": 1613666198,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1612464724,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1612464748,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612464871,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/11923/ : FAILURE"
        },
        {
            "timestamp": 1612466747,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1612466757,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612466894,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11928/ : SUCCESS"
        },
        {
            "timestamp": 1612545058,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1612545070,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612545213,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11967/ : SUCCESS"
        },
        {
            "timestamp": 1613140516,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1613140530,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1613140678,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12379/ : SUCCESS"
        },
        {
            "timestamp": 1613582886,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1613582900,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1613582987,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12558/ : SUCCESS"
        },
        {
            "timestamp": 1613597372,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1613659182,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 6."
        },
        {
            "timestamp": 1613659182,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 6:\n\n(3 comments)"
        },
        {
            "timestamp": 1613659196,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1613659327,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12597/ : SUCCESS"
        },
        {
            "timestamp": 1613665534,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 6: Code-Review+2"
        },
        {
            "timestamp": 1613666198,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully rebased and submitted as 7d1356417198739e37eff230c5ea75b75bd048de by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "f0828628e29ae6fe63abd3dfafc328086a6c6b59",
            "parents": [
                "ac37297dd327028f8ac41e4459eeb539144292a6"
            ],
            "ref": "refs/changes/95/40295/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1612464724,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 118,
                    "deletions": -19
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 222,
            "sizeDeletions": 69
        },
        {
            "number": 2,
            "revision": "b368968ef54af75aa363904400ab806b357cc55e",
            "parents": [
                "ac37297dd327028f8ac41e4459eeb539144292a6"
            ],
            "ref": "refs/changes/95/40295/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1612466747,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 118,
                    "deletions": -19
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 222,
            "sizeDeletions": 69
        },
        {
            "number": 3,
            "revision": "039a10dbb1899b034cc51bdf4d10ecf62acd1057",
            "parents": [
                "ac37297dd327028f8ac41e4459eeb539144292a6"
            ],
            "ref": "refs/changes/95/40295/3",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1612545058,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 122,
                    "deletions": -22
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 226,
            "sizeDeletions": 72
        },
        {
            "number": 4,
            "revision": "6ec90154186a54da284bce3fef755278aed8303e",
            "parents": [
                "1551c70d3e51a636ce1f022190b68153eeae7dcc"
            ],
            "ref": "refs/changes/95/40295/4",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1613140516,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 122,
                    "deletions": -22
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 226,
            "sizeDeletions": 72
        },
        {
            "number": 5,
            "revision": "562fc567f33d22d47e1111de847ad7a625e14e85",
            "parents": [
                "bcc12cb3d10f9d4234515a1c5a755b22293b5b67"
            ],
            "ref": "refs/changes/95/40295/5",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1613582886,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "monitor/main.cpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Should wrap these with a `#ifdef MONITOR_USE_JSON`"
                },
                {
                    "file": "monitor/main.cpp",
                    "line": 23,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 35,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "What was this added for? I dont see the use."
                },
                {
                    "file": "monitor/system.cpp",
                    "line": 35,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "monitor/system.hpp",
                    "line": 114,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "nit: The config file path"
                },
                {
                    "file": "monitor/system.hpp",
                    "line": 114,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 122,
                    "deletions": -22
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 226,
            "sizeDeletions": 72
        },
        {
            "number": 6,
            "revision": "6103b819142e9a338f357ba76047177849d547fa",
            "parents": [
                "bcc12cb3d10f9d4234515a1c5a755b22293b5b67"
            ],
            "ref": "refs/changes/95/40295/6",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1613659182,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 122,
                    "deletions": -22
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 226,
            "sizeDeletions": 72
        },
        {
            "number": 7,
            "revision": "7d1356417198739e37eff230c5ea75b75bd048de",
            "parents": [
                "05ae4fe47134223f8f543d50c1f3f7dd57997742"
            ],
            "ref": "refs/changes/95/40295/7",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1613666198,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "monitor/fan.cpp",
                    "type": "MODIFIED",
                    "insertions": 122,
                    "deletions": -22
                },
                {
                    "file": "monitor/fan.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "monitor/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 16,
                    "deletions": -13
                },
                {
                    "file": "monitor/power_off_rule.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": -24
                },
                {
                    "file": "monitor/system.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -12
                },
                {
                    "file": "monitor/system.hpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 226,
            "sizeDeletions": 72
        }
    ]
}
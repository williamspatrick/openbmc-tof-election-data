{
    "project": "openbmc/openbmc",
    "branch": "master",
    "topic": "mctp",
    "id": "Id606b6ad7368716ad764f45de929c5cafcdf8873",
    "number": 46442,
    "subject": "mctp: Add systemd service for mctpd",
    "owner": {
        "name": "Jeremy Kerr",
        "email": "jk@ozlabs.org",
        "username": "jk-ozlabs"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/46442",
    "commitMessage": "mctp: Add systemd service for mctpd\n\nThe mctp repo provides a .service file for the mctpd daemon, so add an\ninstall append for this.\n\nSigned-off-by: Jeremy Kerr <jk@codeconstruct.com.au>\nChange-Id: Id606b6ad7368716ad764f45de929c5cafcdf8873\n",
    "createdOn": 1630571869,
    "lastUpdated": 1639013998,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1630571869,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1630571933,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nUser not approved, see admin, no CI"
        },
        {
            "timestamp": 1630573190,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1: Ok-To-Test+1"
        },
        {
            "timestamp": 1630575458,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/6442/"
        },
        {
            "timestamp": 1630576442,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/6442/ : SUCCESS"
        },
        {
            "timestamp": 1630577625,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1630982413,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Uploaded patch set 2: Commit message was updated."
        },
        {
            "timestamp": 1631029248,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631029254,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: -Verified\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/6524/"
        },
        {
            "timestamp": 1631037103,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/6524/ : SUCCESS"
        },
        {
            "timestamp": 1631038296,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1631068882,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 2:\n\nMoving from wip to ready."
        },
        {
            "timestamp": 1631101427,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1631156729,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1631156765,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631156774,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/6572/"
        },
        {
            "timestamp": 1631159316,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/6572/ : SUCCESS"
        },
        {
            "timestamp": 1631160589,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1632358584,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1633651748,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1633974661,
            "reviewer": {
                "name": "John Broadbent",
                "email": "jebr@google.com",
                "username": "jebr224"
            },
            "message": "Patch Set 3:\n\n(1 comment)\n\nnit"
        },
        {
            "timestamp": 1639001440,
            "reviewer": {
                "name": "Hao Jiang",
                "email": "jianghao@google.com",
                "username": "drakedog2008"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1639013963,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Patch Set 3:\n\n(3 comments)\n\nResponding to a couple of review here, but I'll close this change and create a new one that builds on the recipe that's now present in meta-openembedded."
        },
        {
            "timestamp": 1639013998,
            "reviewer": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "message": "Abandoned\n\nRe-working to use meta-openembedded layer instead."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "909dead18282f6aabf10981f5a3525acd7745593",
            "parents": [
                "79e19136d07a5116efa0097d0aec00b56432e723"
            ],
            "ref": "refs/changes/42/46442/1",
            "uploader": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "createdOn": 1630571869,
            "author": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/mctp/mctp_git.bb",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 9,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "795e19af3e3c7a4cf0603fc2f91d39b894078337",
            "parents": [
                "79e19136d07a5116efa0097d0aec00b56432e723"
            ],
            "ref": "refs/changes/42/46442/2",
            "uploader": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "createdOn": 1630982413,
            "author": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "meta-phosphor/recipes-phosphor/mctp/mctp_git.bb",
                    "line": 23,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I think the preference is for these to be done by the package itself now, rather than as install directives.  Is there a reason it can't be done by the package?"
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/mctp/mctp_git.bb",
                    "line": 23,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "The package's install target doesn't (and shouldn't) assume a systemd-based distribution, nor which targets are to be used for distribution integration of the mctp stack (provided in later patches in this series).\n\nInstead, it ships the example files, which suit OpenBMC's structure, but it's really distro config for the final systemd setup."
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/mctp/mctp_git.bb",
                    "line": 23,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "> The package's install target doesn't (and shouldn't) assume a systemd-based distribution\n\nIt doesn't need to assume anything.  You can have a --with-systemd type of option.  \n\n> but it's really distro config for the final systemd setup.\n\nAre you sure this is universally true?  I spent five minutes looking and found these:\n\nhttps://gitlab.gnome.org/GNOME/tracker/-/blob/master/src/portal/tracker-xdg-portal.service.in\nhttps://gitlab.gnome.org/GNOME/gdm/-/blob/main/data/gdm.service.in\n\nand if Gnome doesn't count for some reason:\n\nhttps://git.linux-nfs.org/?p=steved/nfs-utils.git;a=tree;f=systemd;h=0573f88958a2b0dc0bedfe2cef75441dcdd6b499;hb=HEAD\n\nAre these other projects that are installing systemd unit files doing it wrong?"
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/mctp/mctp_git.bb",
                    "line": 23,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Yep there's deinitely precedence for the service definitions, but they're not what I'm referring to as \"final systemd setup\" here.\n\nI'm OK with shipping (and installing) the base service definition with mctpd, as it looks like there's a decent precedent there - so I'll submit the updated recipe using this.\n\nHowever, we do have a few things that are distro-specific (like how we configure EIDs), but we should be able to do those with overrides within openbmc.."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/mctp/mctp_git.bb",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 9,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "68a1958347275640155791f204bb288801d91f1d",
            "parents": [
                "19e757696c03252061d522ac5d5d011b97fc2174"
            ],
            "ref": "refs/changes/42/46442/3",
            "uploader": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "createdOn": 1631156729,
            "author": {
                "name": "Jeremy Kerr",
                "email": "jk@ozlabs.org",
                "username": "jk-ozlabs"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "meta-phosphor/recipes-connectivity/mctp/mctp_git.bb",
                    "line": 20,
                    "reviewer": {
                        "name": "John Broadbent",
                        "email": "jebr@google.com",
                        "username": "jebr224"
                    },
                    "message": "nit: can you use spaces instead of tabs"
                },
                {
                    "file": "meta-phosphor/recipes-connectivity/mctp/mctp_git.bb",
                    "line": 20,
                    "reviewer": {
                        "name": "Hao Jiang",
                        "email": "jianghao@google.com",
                        "username": "drakedog2008"
                    },
                    "message": "Can the install done by autotools instead of manual? \n\nAnd if it can migrate to meson, that will be preferred in the long run."
                },
                {
                    "file": "meta-phosphor/recipes-connectivity/mctp/mctp_git.bb",
                    "line": 20,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Yep, that's along the lines of Brad's reviews elsewhere. I'll look at doing this within the package instead.\n\n(and yes, the new version of this uses meson too :) )"
                },
                {
                    "file": "meta-phosphor/recipes-connectivity/mctp/mctp_git.bb",
                    "line": 20,
                    "reviewer": {
                        "name": "Jeremy Kerr",
                        "email": "jk@ozlabs.org",
                        "username": "jk-ozlabs"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-connectivity/mctp/mctp_git.bb",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 9,
            "sizeDeletions": 1
        }
    ]
}
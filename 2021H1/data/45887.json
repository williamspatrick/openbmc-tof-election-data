{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "I438543513e4abb7a553a044ee90e24a48dae02b7",
    "number": 45887,
    "subject": "dbus-sensors: Update escapePathForDbus to use object_path encoding",
    "owner": {
        "name": "Willy Tu",
        "email": "wltu@google.com",
        "username": "wltu"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/45887",
    "commitMessage": "dbus-sensors: Update escapePathForDbus to use object_path encoding\n\nThe object_path encoding is based on sdbus path encoding and is decoded\nwith object_path.filename(). This will allow the client of the sensors\nto decode it that way without loosing any information.\n\nTested:\n\nThe sensor names are `test_9 {tbackvr/tfrntvr...}`\n\n`t` -> _74\n`_` -> _5f\n` ` -> _20\n\n```\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f2_20tbackvr\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f2_20tfrntvr\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f2_20tpwrseq\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f3_20tbackvr\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f3_20tfrntvr\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f3_20tpwrseq\n| |-/xyz/openbmc_project/sensors/temperature/_74est_5f9_20tbackvr\n| `-/xyz/openbmc_project/sensors/temperature/_74est_5f9_20tpwrseq\n```\n\nChange-Id: I438543513e4abb7a553a044ee90e24a48dae02b7\nSigned-off-by: Willy Tu <wltu@google.com>\n",
    "createdOn": 1628865745,
    "lastUpdated": 1629418365,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1628865745,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1628865781,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1628865791,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1628865808,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/24340/ : FAILURE"
        },
        {
            "timestamp": 1628877191,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1628877201,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1628877386,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/24347/ : SUCCESS"
        },
        {
            "timestamp": 1628877542,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 4: Commit message was updated."
        },
        {
            "timestamp": 1629142888,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1629153386,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1629215966,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1629322153,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5: Patch Set 4 was rebased"
        },
        {
            "timestamp": 1629322166,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1629322577,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/24599/ : SUCCESS"
        },
        {
            "timestamp": 1629384153,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1629417732,
            "reviewer": {
                "name": "Josh Lehan",
                "email": "krellan@google.com",
                "username": "Krellan"
            },
            "message": "Patch Set 5:\n\nI did this already, but the patch was not submitted: https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/41453\n\nMy patch took a different approach, more complicated, but also allowed sensors to remember their own object paths, which in turn simplified a lot of common cut-and-paste code in sensor constructors.\n\nNice tests. I have some more test cases that I did manually, but it's better to automate them here, as you did."
        },
        {
            "timestamp": 1629418365,
            "reviewer": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "message": "Patch Set 5:\n\n> Patch Set 5:\n> \n> I did this already, but the patch was not submitted: https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/41453\n> \n> My patch took a different approach, more complicated, but also allowed sensors to remember their own object paths, which in turn simplified a lot of common cut-and-paste code in sensor constructors.\n> \n> Nice tests. I have some more test cases that I did manually, but it's better to automate them here, as you did.\n\noh right. I forgot about it. It seems like this will cause some error and needs to be address first."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "fd6cbb887596c308e6f81f7965ab33f2178bd758",
            "parents": [
                "5cf0f99210890d0cd52d5929e919316d238a5701"
            ],
            "ref": "refs/changes/87/45887/1",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1628865745,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 14,
                    "deletions": 0
                },
                {
                    "file": "src/ADCSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/CPUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/CPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -5
                },
                {
                    "file": "src/ExternalSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/HwmonTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/IpmbSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/MCUTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/NVMeSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/PSUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/SensorPaths.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/TachSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "tests/meson.build",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 31
        },
        {
            "number": 2,
            "revision": "12fa84f0125cc369c3a25d67e7384254a43370cb",
            "parents": [
                "5cf0f99210890d0cd52d5929e919316d238a5701"
            ],
            "ref": "refs/changes/87/45887/2",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1628865791,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "src/ADCSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/CPUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/CPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -5
                },
                {
                    "file": "src/ExternalSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/HwmonTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/IpmbSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/MCUTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/NVMeSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/PSUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/SensorPaths.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/TachSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "tests/meson.build",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 37,
            "sizeDeletions": 31
        },
        {
            "number": 3,
            "revision": "5610d316459291c10fc664dc93e15cea48c471de",
            "parents": [
                "5cf0f99210890d0cd52d5929e919316d238a5701"
            ],
            "ref": "refs/changes/87/45887/3",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1628877191,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "src/ADCSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/CPUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/CPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -5
                },
                {
                    "file": "src/ExternalSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/HwmonTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/IpmbSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/MCUTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/NVMeSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/PSUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/SensorPaths.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/TachSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "tests/meson.build",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "tests/test_SensorPaths.cpp",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 31
        },
        {
            "number": 4,
            "revision": "461a6f605c6dbe04bc109d214a41af8b080cb603",
            "parents": [
                "5cf0f99210890d0cd52d5929e919316d238a5701"
            ],
            "ref": "refs/changes/87/45887/4",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1628877542,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "A dbus level test isn't really sufficient here, as this is very likely to break both IPMI and/or Redfish (both of which rely on these names).  I would expect we need to test each of those, and ensure that in Redfish, walking the tree isn't broken, and in IPMI, that the SDR generates properly."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "For the most part, we just need to make sure that all of them are using filename() to decode the name, right?\n\nI will do a more detailed system integration tests.\n\nRedfish: RedfishValidator\n\nIPMI: ipmisdr with dynamic sensor stack."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> For the most part, we just need to make sure that all of them are using filename() to decode the name, right?\n\nIn theory, that's part of it, but there's other things like, redfish uses the name field in the URI.  If the name can now include spaces, bmcweb needs to ensure that the URI is being encoded.  so in practice, we also need to make sure the redfish tree is walkable and sane.\n\n> \n> I will do a more detailed system integration tests.\n> \n> Redfish: RedfishValidator\n\nThat would work.\n\n> \n> IPMI: ipmisdr with dynamic sensor stack.\n\nalso an \"IPMI sensor list\" and make sure that the names of the sensors are correct.  Considering that IPMI is also limited to ascii (I think, verify this with the spec) we should also verify non-ascii characters get escaped to something reasonable."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 29,
                    "reviewer": {
                        "name": "Willy Tu",
                        "email": "wltu@google.com",
                        "username": "wltu"
                    },
                    "message": "I was testing it out and ipmitool sdr/sensor are fine but bmcweb will fail because it cannot support spaces in the URI.\n\nipmitool sdr/sensor can havne names with spaces so it doesn't break anything.\n\nI wonder if we want to force people to not have any spaces in their sensors.\n\nreplace ` ` with `_` like before on top of the the encoding. then does not convert it back to spaces on the client side."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 33,
                    "deletions": 0
                },
                {
                    "file": "src/ADCSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/CPUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/CPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -5
                },
                {
                    "file": "src/ExternalSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/HwmonTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/IpmbSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/MCUTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/NVMeSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/PSUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/SensorPaths.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/TachSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "tests/meson.build",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "tests/test_SensorPaths.cpp",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 31
        },
        {
            "number": 5,
            "revision": "f3620d561fe35f86097cb927cb7720d7cc632276",
            "parents": [
                "f1ace50bbb781c0febd15387110d1a03b11391f9"
            ],
            "ref": "refs/changes/87/45887/5",
            "uploader": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "createdOn": 1629322153,
            "author": {
                "name": "Willy Tu",
                "email": "wltu@google.com",
                "username": "wltu"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 33,
                    "deletions": 0
                },
                {
                    "file": "src/ADCSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/CPUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/CPUSensorMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -5
                },
                {
                    "file": "src/ExternalSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/HwmonTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/IpmbSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/MCUTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/NVMeSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -2
                },
                {
                    "file": "src/PSUSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "src/SensorPaths.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -1
                },
                {
                    "file": "src/TachSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "tests/meson.build",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "tests/test_SensorPaths.cpp",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 60,
            "sizeDeletions": 31
        }
    ]
}
{
    "project": "openbmc/phosphor-fan-presence",
    "branch": "master",
    "id": "If66a74b432481f337f02813f2e61ae5767a57d1d",
    "number": 48466,
    "subject": "fanctl: Add query_dump cmd to search dump contents",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-fan-presence/+/48466",
    "commitMessage": "fanctl: Add query_dump cmd to search dump contents\n\nAdd a 'query_dump' subcommand to fanctl to assist in looking at the\ncontent of the dump file /tmp/fan_control.json generated by the 'fanctl\ndump' command.  This dump file contains the flight recorder as well as\nfan control's objects, service, and parameter cache.\n\nThe command's output is in JSON.\n\nIt has the following parameters:\n--section\n   The section of the dump: objects, parameters, or services\n\n--name\n   The name of the top level JSON dictionary key to match on.\n   This can match on substrings, like 'sensors' for all sensors.\n   Optional - if not provided it matches on every name.\n\n--properties\n   List of property names to match on.\n   Geared toward printing property values from the objects cache.\n   Optional, if not provided the whole JSON objects under the\n   name is printed.\n\nExamples:\n\nPrint the flight recorder:\nfanctl query_dump --section flight_recorder\n{\n    \"0\": \"Oct 29 03:41:29.468444: main: Startup\"\n}\n\nPrint the altitude:\nfanctl query_dump -s objects -n Altitude -p Value\n{\n    \"/xyz/openbmc_project/sensors/altitude/Altitude\": {\n        \"Value\": 1032.82\n    }\n}\n\nPrint all temperatures:\nfanctl query_dump -s objects -n sensors/temp -p Value\n{\n    \"/xyz/openbmc_project/sensors/temperature/Ambient_Virtual_Temp\": {\n        \"Value\": 25.0\n    },\n    ...\n}\n\nPrint every interface and property of the ambient sensor\nfanctl query_dump -s objects -n Ambient\n{\n   ... interfaces with their property names and values ...\n}\n\nPrint every Value property in the cache:\nfanctl query_dump -s objects -p Value\n{\n    \"/xyz/openbmc_project/sensors/altitude/Altitude\": {\n        \"Value\": 1032.82\n    },\n    \"/xyz/openbmc_project/sensors/temperature/Ambient_Virtual_Temp\": {\n        \"Value\": 25.0\n    }\n}\n\nSigned-off-by: Matt Spinler <spinler@us.ibm.com>\nChange-Id: If66a74b432481f337f02813f2e61ae5767a57d1d\n",
    "createdOn": 1635532995,
    "lastUpdated": 1635881290,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1635532995,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1635533008,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635533037,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/29386/ : FAILURE"
        },
        {
            "timestamp": 1635533426,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1635533438,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635533539,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29387/ : SUCCESS"
        },
        {
            "timestamp": 1635541459,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\nIt occurs to me that this basically behaves like 'jq' does, and I should probably (also) push for pulling jq into the image since there's even already a recipe for it."
        },
        {
            "timestamp": 1635619214,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1635619241,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635619344,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29414/ : SUCCESS"
        },
        {
            "timestamp": 1635783303,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 3:\n\n(5 comments)"
        },
        {
            "timestamp": 1635785919,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1635790462,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1635790462,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1635790478,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635790577,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29456/ : SUCCESS"
        },
        {
            "timestamp": 1635862585,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1635862689,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1635881290,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully rebased and submitted as b564e15a676361b6583dcdc4503d2c7a10e924f3 by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "704c5f669923ee9b43454913805682faadea73ed",
            "parents": [
                "71082ac413235e02998d4e5ab7eef8dd41e2bdaa"
            ],
            "ref": "refs/changes/66/48466/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635532995,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 74,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "control/fanctl.cpp",
                    "type": "MODIFIED",
                    "insertions": 101,
                    "deletions": -3
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 114,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "67066d9abc5d7c2383f1a25d5bb6c8c689010173",
            "parents": [
                "71082ac413235e02998d4e5ab7eef8dd41e2bdaa"
            ],
            "ref": "refs/changes/66/48466/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635533426,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 74,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "control/fanctl.cpp",
                    "type": "MODIFIED",
                    "insertions": 101,
                    "deletions": -4
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 114,
            "sizeDeletions": 5
        },
        {
            "number": 3,
            "revision": "cbfca5def1cd19425bb34e8d0b4ce2c093ef5b67",
            "parents": [
                "71082ac413235e02998d4e5ab7eef8dd41e2bdaa"
            ],
            "ref": "refs/changes/66/48466/3",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635619214,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "control/fanctl.cpp",
                    "line": 567,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "These are the default values for these parameters, so no need to have them here."
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 567,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 596,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Another future improvement maybe to be a case-insensitive and/or string contains check for dumping properties."
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 596,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Would be easy enough, though then 'value' would also match on 'MinValue' and 'MaxValue' which are pretty uninteresting."
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 596,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Right, definitely something we can look into in the future as time permits (maybe add a case-insensitive flag and/or wildcard support)"
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 692,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Wrap this with the ifdef CONTROL_USE_JSON\n```\n#ifdef CONTROL_USE_JSON\n.\n.\n.\n#endif\n```"
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 692,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                },
                {
                    "file": "control/fanctl.cpp",
                    "line": 744,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Wrap this with the ifdef CONTROL_USE_JSON\n```\n#ifdef CONTROL_USE_JSON\n.\n.\n.\n#endif\n```"
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "line": 118,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "For completeness, add a `dump` example too?"
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "line": 118,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 74,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "control/fanctl.cpp",
                    "type": "MODIFIED",
                    "insertions": 101,
                    "deletions": -4
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 114,
            "sizeDeletions": 5
        },
        {
            "number": 4,
            "revision": "1ae85a1f6e1ded7934c8680efcf1eeca3e3a147f",
            "parents": [
                "71082ac413235e02998d4e5ab7eef8dd41e2bdaa"
            ],
            "ref": "refs/changes/66/48466/4",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635790462,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 74,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "control/fanctl.cpp",
                    "type": "MODIFIED",
                    "insertions": 105,
                    "deletions": -4
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 121,
            "sizeDeletions": 5
        },
        {
            "number": 5,
            "revision": "b564e15a676361b6583dcdc4503d2c7a10e924f3",
            "parents": [
                "b5c21a24f185b981bd43d591aa6e31bf4c368c6a"
            ],
            "ref": "refs/changes/66/48466/5",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1635881290,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 74,
                    "deletions": 0
                },
                {
                    "file": ".gitignore",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "control/fanctl.cpp",
                    "type": "MODIFIED",
                    "insertions": 105,
                    "deletions": -4
                },
                {
                    "file": "docs/control/fanctl/README.md",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 121,
            "sizeDeletions": 5
        }
    ]
}
{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "I6e674f29e804e0d2e15b669e8420bc4e772bdfaa",
    "number": 45337,
    "subject": "amperecpu: Support \"<label>_AddAssoc\" option",
    "owner": {
        "email": "thu@os.amperecomputing.com",
        "username": "ThuBaNguyen"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/45337",
    "commitMessage": "amperecpu: Support \"<label>_AddAssoc\" option\n\nBydefault, Ampere CPU daemon will add all of the host sensors to\nAssociation interface. BMC web will displayed these sensors in\nsensor->health page. But some sensors are used as the source sensors\nof the virtual sensors and should be hidden in Bmc Web.\n\nThis commit supports \"<label>_AddAssoc\" option in the sensor config.\nThe sensors with \"<label>_AddAssoc\":\"false\" will not be added to\nAssociation interface. The sensor without this option or\n\"<label>_AddAssos\":\"true\" will be added to the interface.\n\nTested:\n    1. Add \"<label>_AddAssoc\":\"false\" in the sensors config.\n    2. The sensor should be available in zyx.openbmc_project.CPUSensor\n    3. The sensors with \"<label>_AddAssoc\":\"false\" should be hidden in\n       BMC Web and Redfish.\n\nSigned-off-by: ThuBaNguyen <thu@os.amperecomputing.com>\nChange-Id: I6e674f29e804e0d2e15b669e8420bc4e772bdfaa\n",
    "createdOn": 1627476520,
    "lastUpdated": 1635761840,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1627476520,
            "reviewer": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1627476542,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627476616,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/23073/ : FAILURE"
        },
        {
            "timestamp": 1627478864,
            "reviewer": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1627478887,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627479247,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/23077/ : FAILURE"
        },
        {
            "timestamp": 1627547568,
            "reviewer": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1627547593,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627547762,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/23147/ : SUCCESS"
        },
        {
            "timestamp": 1627923240,
            "reviewer": {
                "name": "Mohaimen Alsamarai",
                "email": "mohaimen.alsamarai@fii-na.com",
                "username": "MohaimenAlsamarai"
            },
            "message": "Patch Set 3: Code-Review+1\n\nwe test it with our meta-kudo and work"
        },
        {
            "timestamp": 1628273724,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1628506332,
            "reviewer": {
                "name": "Thang Q. Nguyen",
                "email": "thang@os.amperecomputing.com",
                "username": "thangqn-ampere"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1628522346,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1630912042,
            "reviewer": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1630912067,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1630912590,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/25739/ : SUCCESS"
        },
        {
            "timestamp": 1635470051,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Removed reviewer Andrew Jeffery."
        },
        {
            "timestamp": 1635761840,
            "reviewer": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "message": "Abandoned\n\nremove patches base on the feedback of community."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "a280faf0c9dee491d3b67500d828ac8aedda1478",
            "parents": [
                "fbd99193fe4637227869efac7c461f00a12d2713"
            ],
            "ref": "refs/changes/37/45337/1",
            "uploader": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "createdOn": 1627476520,
            "author": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "include/AmpereCPU.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "include/sensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                },
                {
                    "file": "src/AmpereCPU.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -7
                },
                {
                    "file": "src/AmpereCPUMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 45,
            "sizeDeletions": 13
        },
        {
            "number": 2,
            "revision": "080779576fcb2480fa55f5d1a3ce5dfdfddc804a",
            "parents": [
                "be275189dfedcb16e25c5e222bf159e0ce9355e2"
            ],
            "ref": "refs/changes/37/45337/2",
            "uploader": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "createdOn": 1627478864,
            "author": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "include/AmpereCPU.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "include/sensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                },
                {
                    "file": "src/AmpereCPU.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -7
                },
                {
                    "file": "src/AmpereCPUMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 45,
            "sizeDeletions": 13
        },
        {
            "number": 3,
            "revision": "5c73b27d5c08653892106572505976216f9b53ed",
            "parents": [
                "91028cfeb742679a533e18a0cdd091f0ecdba6dd"
            ],
            "ref": "refs/changes/37/45337/3",
            "uploader": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "createdOn": 1627547568,
            "author": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Hiding sensors is a generalized feature that will need a design doc.  Today, bmcweb does not hide any sensors, and it's expected that all sensors will have an interface."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Thang Q. Nguyen",
                        "email": "thang@os.amperecomputing.com",
                        "username": "thangqn-ampere"
                    },
                    "message": "bmcweb shows all sensors from Redfish and no problem with this. The problem is that dbus-sensor adds all sensors into association. By the use of phosphor-virtual-sensor, sensors that are used in the formation for virtual sensors should not be added into association and this change support the option to remove the sensor added to association."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 12,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> bmcweb shows all sensors from Redfish and no problem with this. The problem is that dbus-sensor adds all sensors into association. \n\nThat's not really a \"problem\" that's by design.\n\n> By the use of phosphor-virtual-sensor, sensors that are used in the formation for virtual sensors should not be added into association and this change support the option to remove the sensor added to association.\n\nAgain.... this needs a design doc for exactly the reason you've pointed out.  the Sensor interfaces are spread across many different repositories, and will all need updated if we were able to \"hide\" sensors, although I suspect my personal opinion is that we shouldn't be hiding sensor values at all."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Why does this need to be configurable at all?  This is likely not the way to do this in the config format, as it explicitly mentions associations, which should be avoided where possible."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Thang Q. Nguyen",
                        "email": "thang@os.amperecomputing.com",
                        "username": "thangqn-ampere"
                    },
                    "message": "Do you thing <label>_RmAssoc is better? All sensors are added to association by default. Any sensors that we don't want to be in association will use this attribute to configure?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "No I don't like that better, I'd like to see a consistent set of sensors across systems.  Unless there's a good reason why one system might hide a sensor, and another system wouldn't (which I can't think of off the top of my head) there's no reason to allow it to be configurable like this."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "include/AmpereCPU.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -2
                },
                {
                    "file": "include/sensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                },
                {
                    "file": "src/AmpereCPU.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -7
                },
                {
                    "file": "src/AmpereCPUMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 26,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 45,
            "sizeDeletions": 13
        },
        {
            "number": 4,
            "revision": "e3bb4fd4b1d5f2459c2a20f0116b627e22590cbf",
            "parents": [
                "ce6e138bb06596962fd5bb898185869cde765be0"
            ],
            "ref": "refs/changes/37/45337/4",
            "uploader": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "createdOn": 1630912042,
            "author": {
                "email": "thu@os.amperecomputing.com",
                "username": "ThuBaNguyen"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 26,
                    "deletions": 0
                },
                {
                    "file": "include/AmpereCPU.hpp",
                    "type": "MODIFIED",
                    "insertions": 7,
                    "deletions": -4
                },
                {
                    "file": "include/sensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -2
                },
                {
                    "file": "src/AmpereCPU.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -5
                },
                {
                    "file": "src/AmpereCPUMain.cpp",
                    "type": "MODIFIED",
                    "insertions": 32,
                    "deletions": -6
                }
            ],
            "sizeInsertions": 56,
            "sizeDeletions": 17
        }
    ]
}
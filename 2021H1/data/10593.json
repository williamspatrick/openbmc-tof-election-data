{
    "project": "openbmc/openbmc",
    "branch": "master",
    "topic": "3176",
    "id": "If2d48c87d9f1db1588e592cb56be7acc334325cd",
    "number": 10593,
    "subject": "wspoon: Create dump when fan watchdog trips",
    "owner": {
        "name": "Matthew Barth",
        "email": "msbarth@linux.ibm.com",
        "username": "msbarth"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/10593",
    "commitMessage": "wspoon: Create dump when fan watchdog trips\n\nTo help determine what may have caused the fan watchdog to trip, a dump\nis collected at the time the fan watchdog service exits.\n\nResolves: openbmc/openbmc#3176\n\nTested:\n    Verified new service is within build image\n    Powered on system, then started the fan watchdog takeover target\n    Verified dump with name obmcdump_fan_watchdog created in /tmp\n\nChange-Id: If2d48c87d9f1db1588e592cb56be7acc334325cd\nSigned-off-by: Matthew Barth <msbarth@us.ibm.com>\n",
    "createdOn": 1526318000,
    "lastUpdated": 1614807620,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1526318000,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1526318022,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1526318034,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1:\n\nBuild Started https://openpower.xyz/job/openbmc-build-gerrit-trigger-multi/9341/"
        },
        {
            "timestamp": 1526319239,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://openpower.xyz/job/openbmc-build-gerrit-trigger-multi/9341/ : SUCCESS"
        },
        {
            "timestamp": 1526319253,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1:\n\nBuild Started \n\nReal hardware build started"
        },
        {
            "timestamp": 1526320005,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 1: Code-Review-1\n\nJust noticed the timestamps on the dump created show its created at poweron and not when the takeover target is started."
        },
        {
            "timestamp": 1526320448,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 1:\n\nReal Hardware Build Successful"
        },
        {
            "timestamp": 1526410594,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1526410613,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1526410626,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2:\n\nBuild Started https://openpower.xyz/job/openbmc-build-gerrit-trigger-multi/9353/"
        },
        {
            "timestamp": 1526412169,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://openpower.xyz/job/openbmc-build-gerrit-trigger-multi/9353/ : SUCCESS"
        },
        {
            "timestamp": 1526412185,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2:\n\nBuild Started \n\nReal hardware build started"
        },
        {
            "timestamp": 1526413368,
            "reviewer": {
                "name": "Jenkins",
                "email": "openbmc-ci-admin@ozlabs.org",
                "username": "jenkins-openbmc"
            },
            "message": "Patch Set 2:\n\nReal Hardware Build Successful"
        },
        {
            "timestamp": 1526415751,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Removed reviewer Matthew Barth."
        },
        {
            "timestamp": 1526582380,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1526582511,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1526590969,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1526624830,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(1 comment)"
        },
        {
            "timestamp": 1526649305,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1526656188,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(1 comment)\n\nNeed to update to call program that just created an InternalFailure for dump creation"
        },
        {
            "timestamp": 1533327390,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1533563933,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2:\n\nStill not ready . Devender is looking this work now."
        },
        {
            "timestamp": 1537893141,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2:\n\nJayanth,\nI've been out for awhile, has there been progress on triggering a dump thru an elog?"
        },
        {
            "timestamp": 1537932062,
            "reviewer": {
                "name": "Jayanth Othayoth",
                "email": "ojayanth@gmail.com",
                "username": "ojayanth"
            },
            "message": "Patch Set 2:\n\nNo real progress, planing to start work on this work aftre current high priority items."
        },
        {
            "timestamp": 1552222750,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1614807620,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Abandoned\n\nWill re-visit later if functionality requested."
        }
    ],
    "wip": true,
    "patchSets": [
        {
            "number": 1,
            "revision": "f5e67d6a635288731a31136b400bafe4c0ea6558",
            "parents": [
                "b439d3ee32a9ee2453f4adba59284077f5056abf"
            ],
            "ref": "refs/changes/93/10593/1",
            "uploader": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "createdOn": 1526318000,
            "author": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog.bb",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -1
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog/witherspoon-fan-watchdog-dump.service",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 15,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "b095954b31c7c02d9251ce1cfcda4fd01603a519",
            "parents": [
                "b439d3ee32a9ee2453f4adba59284077f5056abf"
            ],
            "ref": "refs/changes/93/10593/2",
            "uploader": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "createdOn": 1526410594,
            "author": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 18,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Do you think this is worth testing 2 boots in a row, or maybe you already did?  Just to be sure the target is in the right state again on the next power on. \n\n1) power on\n2) killall -KILL watchdog\n3) check for dump\n4) power off\n5) repeat 1 -> 4"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 18,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Yep, I did already. I did 3 boots total basically the same as you noted here except for 2) I started the watchdog takeover target to trip the watchdog and run this service creating a dump."
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog/witherspoon-fan-watchdog-dump.service",
                    "line": 0,
                    "reviewer": {
                        "name": "Jayanth Othayoth",
                        "email": "ojayanth@gmail.com",
                        "username": "ojayanth"
                    },
                    "message": "This approach will break existing dump design strategy. Dump follows Naming convention which includes dump ID and the Dump path , which is used for REST based external Usage. \nWe already working on generic elog based dump proposal,which is extension of existing internal failure type dump."
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog/witherspoon-fan-watchdog-dump.service",
                    "line": 0,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "I dont quite follow what's the issue here, is it that I'm not following the default naming that dreport uses in producing a dump or due to manually calling dreport?\n\nThe intention is to collect all the system info state at the time the fan watchdog trips to be able to determine what may have caused it to happen. If the issue is with calling dreport directly to collect a dump when the fan watchdog trips, do you have a suggestion that's available at this time to be able to collect the same data?"
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog/witherspoon-fan-watchdog-dump.service",
                    "line": 0,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Discussed further at design call and determined this service can call a program in phosphor-logging that creates an InternalFailure that would cause a dump to be created."
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog/witherspoon-fan-watchdog-dump.service",
                    "line": 0,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Jayanth,\nHas there been progress on elog based dump creation?\nI've tried a few different methods to invoke the creation of a dump following the naming conventions, etc.. but have been unsuccessful. Do you have a current method in which a dump can be created such that when the fan watchdog trips, we can collect and store a dump to have the possible information to determine why the watchdog tripped?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 20,
                    "deletions": 0
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog.bb",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -2
                },
                {
                    "file": "meta-openbmc-machines/meta-openpower/meta-ibm/meta-witherspoon/recipes-phosphor/fans/witherspoon-fan-watchdog/witherspoon-fan-watchdog-dump.service",
                    "type": "ADDED",
                    "insertions": 9,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 15,
            "sizeDeletions": 2
        }
    ]
}
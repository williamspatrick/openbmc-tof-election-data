{
    "project": "openbmc/telemetry",
    "branch": "master",
    "topic": "telemetry",
    "id": "I1b2cc4440d03e0fe45151b630f4e439839ed8589",
    "number": 44511,
    "subject": "Refactor metadata returned by Readings property",
    "owner": {
        "name": "Szymon Dompke",
        "email": "szymon.dompke@intel.com",
        "username": "sdompke"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/telemetry/+/44511",
    "commitMessage": "Refactor metadata returned by Readings property\n\nReading metadata is now JSON containg SensorDbusPath and SensorRedfishUri.\nIt is returned only if JSON metadata was provided during Report creation,\notherwise old behavior is maintained.\n\nAdditionally, json.hpp was removed as LabeledTupple is now used for\nserialization and deserialization of metric and reading metadata.\n\nTesting done:\n- Unit test is passing as metric is returning proper metadata.\n- Redfish get on redfish/v1/TelemetryService/MetricReports is containing\n  MetricDefinition property, which utilizes SensorDbusPath metadata..\n  Done on custom version of bmcweb.\n\nChange-Id: I1b2cc4440d03e0fe45151b630f4e439839ed8589\nSigned-off-by: Szymon Dompke <szymon.dompke@intel.com>\n",
    "createdOn": 1624875148,
    "lastUpdated": 1627455168,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1624875148,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1624875161,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1624875165,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Topic set to telemetry"
        },
        {
            "timestamp": 1624875255,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1624875265,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1624875268,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/20907/ : ABORTED"
        },
        {
            "timestamp": 1624875967,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/20908/ : SUCCESS"
        },
        {
            "timestamp": 1626353264,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1626711819,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1626711847,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626712495,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22283/ : SUCCESS"
        },
        {
            "timestamp": 1626712869,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1626712882,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1626712908,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1626713527,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22284/ : SUCCESS"
        },
        {
            "timestamp": 1627027600,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1627027615,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627028260,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22663/ : SUCCESS"
        },
        {
            "timestamp": 1627035539,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1627041060,
            "reviewer": {
                "name": "Lukasz Kazmierczak",
                "email": "lukasz.kazmierczak@intel.com",
                "username": "kazmierczak-lukasz"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1627044279,
            "reviewer": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1627289557,
            "reviewer": {
                "name": "Lukasz Kazmierczak",
                "email": "lukasz.kazmierczak@intel.com",
                "username": "kazmierczak-lukasz"
            },
            "message": "Patch Set 5: Code-Review+2\n\n(1 comment)"
        },
        {
            "timestamp": 1627391088,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Uploaded patch set 6: New patch set was added with same tree, parent, and commit message as Patch Set 5."
        },
        {
            "timestamp": 1627391099,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: -Ok-To-Test"
        },
        {
            "timestamp": 1627391102,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627391755,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6:\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/22946/ : SUCCESS"
        },
        {
            "timestamp": 1627455168,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Change has been successfully merged by Krzysztof Grobelny"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "42b15296aefbf537146d31370e8781fcbaf327c3",
            "parents": [
                "2345680569403a4eccde1b5c1a753ad03b7cac76"
            ],
            "ref": "refs/changes/11/44511/1",
            "uploader": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "createdOn": 1624875148,
            "author": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -11
                },
                {
                    "file": "src/utils/json.hpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -63
                },
                {
                    "file": "src/utils/tstring.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 55,
            "sizeDeletions": 77
        },
        {
            "number": 2,
            "revision": "61ada016adac4edac9a90a794ce83cd2408c0b91",
            "parents": [
                "2345680569403a4eccde1b5c1a753ad03b7cac76"
            ],
            "ref": "refs/changes/11/44511/2",
            "uploader": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "createdOn": 1624875255,
            "author": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "tests/src/test_metric.cpp",
                    "line": 85,
                    "reviewer": {
                        "name": "Krzysztof Grobelny",
                        "email": "krzysztof.grobelny@intel.com",
                        "username": "krzysztof-i"
                    },
                    "message": "Consider using ReadingMetadata(\"\", \"sensor1\").dump() here instead, consider adding dump method to LabeledTuple"
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "line": 85,
                    "reviewer": {
                        "name": "Szymon Dompke",
                        "email": "szymon.dompke@intel.com",
                        "username": "sdompke"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -11
                },
                {
                    "file": "src/utils/json.hpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -63
                },
                {
                    "file": "src/utils/tstring.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 54,
            "sizeDeletions": 77
        },
        {
            "number": 3,
            "revision": "a15bc18a00804d1b79f83d57563470abfe4461ae",
            "parents": [
                "e8cd2ceb1a62f65746774c6dd2ac6134634ea5d4"
            ],
            "ref": "refs/changes/11/44511/3",
            "uploader": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "createdOn": 1626711819,
            "author": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -11
                },
                {
                    "file": "src/utils/json.hpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -63
                },
                {
                    "file": "src/utils/tstring.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 12,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 54,
            "sizeDeletions": 77
        },
        {
            "number": 4,
            "revision": "ef3ffe1e0ca8556aef7b14619ba53eb9138bc566",
            "parents": [
                "e8cd2ceb1a62f65746774c6dd2ac6134634ea5d4"
            ],
            "ref": "refs/changes/11/44511/4",
            "uploader": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "createdOn": 1626712869,
            "author": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -11
                },
                {
                    "file": "src/utils/json.hpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -63
                },
                {
                    "file": "src/utils/labeled_tuple.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/utils/tstring.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 77
        },
        {
            "number": 5,
            "revision": "b37beb35b09acd6c5a6466848cb154ae8d664fd3",
            "parents": [
                "dcc4e1936173a93251a02066432bc2bcbc386240"
            ],
            "ref": "refs/changes/11/44511/5",
            "uploader": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "createdOn": 1627027600,
            "author": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/metric.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Lukasz Kazmierczak",
                        "email": "lukasz.kazmierczak@intel.com",
                        "username": "kazmierczak-lukasz"
                    },
                    "message": "There is a redundancy of aliases: ReadingMetadata set here and in tests/src/test_metric.cpp:74. Can it be updated by increasing visibility of single alias ReadingMetadata for use here and in test_metric.cpp?"
                },
                {
                    "file": "src/metric.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Szymon Dompke",
                        "email": "szymon.dompke@intel.com",
                        "username": "sdompke"
                    },
                    "message": "If we look at telemetry and UTs as separate binaries, both only need this type in single function and single test case. So my reasoning was that specifying this type globally would be an overkill, and local type would be enough."
                },
                {
                    "file": "src/metric.cpp",
                    "line": 75,
                    "reviewer": {
                        "name": "Lukasz Kazmierczak",
                        "email": "lukasz.kazmierczak@intel.com",
                        "username": "kazmierczak-lukasz"
                    },
                    "message": "Ok, but still in case of related change need there are two places in the code to update.\n\nAdditionally, you have created labels for tuples but these labels are not used later on in the code, seems it makes sense only for readability."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -11
                },
                {
                    "file": "src/utils/json.hpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -63
                },
                {
                    "file": "src/utils/labeled_tuple.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/utils/tstring.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 77
        },
        {
            "number": 6,
            "revision": "3a617023eacf8a7fcc49e15d5767b35f47c7c089",
            "parents": [
                "dcc4e1936173a93251a02066432bc2bcbc386240"
            ],
            "ref": "refs/changes/11/44511/6",
            "uploader": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "createdOn": 1627391088,
            "author": {
                "name": "Szymon Dompke",
                "email": "szymon.dompke@intel.com",
                "username": "sdompke"
            },
            "kind": "NO_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": -11
                },
                {
                    "file": "src/utils/json.hpp",
                    "type": "DELETED",
                    "insertions": 0,
                    "deletions": -63
                },
                {
                    "file": "src/utils/labeled_tuple.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": 0
                },
                {
                    "file": "src/utils/tstring.hpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "tests/src/test_metric.cpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 57,
            "sizeDeletions": 77
        }
    ]
}
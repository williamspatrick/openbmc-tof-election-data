{
    "project": "openbmc/openbmc",
    "branch": "master",
    "topic": "ibm3097",
    "id": "I51a6fd9cafb72cde3dc8a0b37423dd56d1184a21",
    "number": 44293,
    "subject": "fans: Link phosphor-fan-control service for JSON vs YAML",
    "owner": {
        "name": "Matthew Barth",
        "email": "msbarth@linux.ibm.com",
        "username": "msbarth"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/44293",
    "commitMessage": "fans: Link phosphor-fan-control service for JSON vs YAML\n\nJSON configured phosphor-fan-control only uses the non-init service to\nstart phosphor-fan-control at multi-user.target and poweron in case its\nstopped after multi-user.target is loaded.\n\nYAML configured phosphor-fan-control continues to use both the init and\nnon-init service files without changing the targets each is linked to.\n\nChange-Id: I51a6fd9cafb72cde3dc8a0b37423dd56d1184a21\nSigned-off-by: Matthew Barth <msbarth@us.ibm.com>\n",
    "createdOn": 1624301299,
    "lastUpdated": 1625608401,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1624301299,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1624301346,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1624301355,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/4762/"
        },
        {
            "timestamp": 1624301653,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1624301803,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 1:\n\nDependent on bump after https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-fan-presence/+/44200 is merged."
        },
        {
            "timestamp": 1624302591,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/4762/ : SUCCESS"
        },
        {
            "timestamp": 1624303840,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1624547409,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1624547461,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1624547992,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/4927/"
        },
        {
            "timestamp": 1624549235,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/4927/ : SUCCESS"
        },
        {
            "timestamp": 1624551472,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1624562914,
            "reviewer": {
                "name": "Mike Capps",
                "email": "mikepcapps@gmail.com",
                "username": "mikecgithub"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1624571104,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1625603512,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 2: Code-Review+2\n\n(2 comments)"
        },
        {
            "timestamp": 1625608007,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1625608302,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1625608401,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Change has been successfully rebased and submitted as cd9db6b70866d3ec78a420c8809d97ac1621e365 by Matthew Barth"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "68f386c290988d2b56497f8524d8526b08a06e02",
            "parents": [
                "e4dbfcb0b09187a06ab68b74252a198f415ddccf"
            ],
            "ref": "refs/changes/93/44293/1",
            "uploader": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "createdOn": 1624301299,
            "author": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/fans/phosphor-fan_git.bb",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 3
        },
        {
            "number": 2,
            "revision": "3dce44a91d0d47a1ab54e9ca75e03068307d62cf",
            "parents": [
                "16a7312deb51175733801cf5a33ea6a17ee4c43a"
            ],
            "ref": "refs/changes/93/44293/2",
            "uploader": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "createdOn": 1624547409,
            "author": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "This is aimed at protecting a set of users that log into the bmc and manually stop fan control, but don't really understand why they want that or what the impact of doing that is.  Do you have users like that?  If you do...ok.  But if not, this gets in the way for users that do understand what they are doing - and it makes your life more difficult because you have to support extra unit file dependencies."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Yes, partially. This is to ensure phosphor-fan-control is running when a system is powered on in case it was stopped by a user and forgotten and to also cover the current fan watchdog service setup.\n\nIf there is a user that does understand what they are doing, the phosphor-fan-control service can be disabled instead of just stopped after multi-user.target. That should keep it from getting started at poweron."
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/fans/phosphor-fan_git.bb",
                    "line": 88,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "A slightly more idiomatic way would be to add these targets to your unit file in the install section.  Then you can make bitbake instantiate them with this:\n\n def get_phosphor_fan_control_units(d):\n     units = [ 'phosphor-fan-control@{}.service'.format(x) for x in d.getVar(\"OBMC_CHASSIS_INSTANCES\").split() ]\n     return ' '.join(units)\n   \n SYSTEMD_SERVICE_${PN}-control += \"${@get_phosphor_fan_control_units(d)}\"\n\nThis has the added benefit that it doesn't rely on obmc-phosphor-systemd in any way (obmc-phosphor-systemd is buggy and deprecated).\n\nWith that said I'm happy to see these unit files leaving the bitbake metadata so my suggestion is exactly that - just a suggestion."
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/fans/phosphor-fan_git.bb",
                    "line": 88,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/fans/phosphor-fan_git.bb",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 3
        },
        {
            "number": 3,
            "revision": "cd9db6b70866d3ec78a420c8809d97ac1621e365",
            "parents": [
                "46c282b7fddfead985460ebb7029ce26e7c6a946"
            ],
            "ref": "refs/changes/93/44293/3",
            "uploader": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "createdOn": 1625608401,
            "author": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "meta-phosphor/recipes-phosphor/fans/phosphor-fan_git.bb",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -3
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 3
        }
    ]
}
{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "topic": "telemetry",
    "id": "Ia620c07b1fe93b73cf00910b0b49b26fbeacd36a",
    "number": 46977,
    "subject": "POC: MetricDefinition schema implementation",
    "owner": {
        "name": "Krzysztof Grobelny",
        "email": "krzysztof.grobelny@intel.com",
        "username": "krzysztof-i"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/46977",
    "commitMessage": "POC: MetricDefinition schema implementation\n\nAs a proof of concept MetricDefinition schema was implemented in\ntelemetry service which allowed to speed up GET requests on\nMetricDefinitions.\n\nTest scenario which performs:\nGET /redfish/v1/TelemetryService/MetricDefinitions\nGET on every @odata.id in Members collection\n\nTest scenario executed 80% faster when implemented in telemetry service.\n\nTested:\n  - Get requests on MetricDefinitions correct results\n\nSigned-off-by: Krzysztof Grobelny <krzysztof.grobelny@intel.com>\nChange-Id: Ia620c07b1fe93b73cf00910b0b49b26fbeacd36a\n",
    "createdOn": 1631890662,
    "lastUpdated": 1635489900,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1631890662,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1631890680,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631890713,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/26520/ : FAILURE"
        },
        {
            "timestamp": 1631890720,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Set private"
        },
        {
            "timestamp": 1631890724,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Removed reviewer Gunnar Mills."
        },
        {
            "timestamp": 1631890726,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Removed reviewer Ed Tanous."
        },
        {
            "timestamp": 1631890728,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Removed reviewer Jason Bills."
        },
        {
            "timestamp": 1631891704,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Topic telemetry%private removed"
        },
        {
            "timestamp": 1631891708,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Topic set to telemetry"
        },
        {
            "timestamp": 1632294550,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Unset private"
        },
        {
            "timestamp": 1632295444,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1632295461,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1632295521,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/26728/ : FAILURE"
        },
        {
            "timestamp": 1632301419,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1632301437,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1632301996,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26743/ : SUCCESS"
        },
        {
            "timestamp": 1632585914,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(5 comments)"
        },
        {
            "timestamp": 1634206506,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Patch Set 4: Patch Set 3 was rebased"
        },
        {
            "timestamp": 1634206520,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634206985,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28273/ : SUCCESS"
        },
        {
            "timestamp": 1635489900,
            "reviewer": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "message": "Abandoned"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "130c30e570bf4c82f424df375a53e38dbbfe6708",
            "parents": [
                "877044644f53d4dd93499d3a99d8c227694fd3a5"
            ],
            "ref": "refs/changes/77/46977/1",
            "uploader": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "createdOn": 1631890662,
            "author": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "type": "ADDED",
                    "insertions": 148,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 148,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "35c59111b4da504cc86d9266ad5ef880478e9747",
            "parents": [
                "a3e65892add97ce68816c1544c0aa21591239fc7"
            ],
            "ref": "refs/changes/77/46977/2",
            "uploader": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "createdOn": 1632295444,
            "author": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "include/json_html_serializer.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -3
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "type": "ADDED",
                    "insertions": 148,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 150,
            "sizeDeletions": 3
        },
        {
            "number": 3,
            "revision": "b70b49b671006f789c4c4287076e33d441078248",
            "parents": [
                "a3e65892add97ce68816c1544c0aa21591239fc7"
            ],
            "ref": "refs/changes/77/46977/3",
            "uploader": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "createdOn": 1632301419,
            "author": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "line": 13,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm not really understanding why this struct is even required, or why we have to make a very expensive copy, but lets focus on the intent or this handler first, then we can circle back around to this thing."
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "line": 55,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Shouldn't this be MetricDefinitions?"
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "line": 69,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Please see common_errors.md.  This method is called out by name."
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Same as above."
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "line": 132,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Overall, I don't really think this method of getting Redfish JSON directly from dbus is in line with the OpenBMC architecture.  One of the core tenants is that DBus is protocol agnostic, so that we can reuse code as much as possible.  Getting all these properties from dbus also means that:\n\n1. Every time we add any unit to dbus, now we need a patchset to telemetry service AND bmcweb to add support.  Same goes for some of the other properties.\n2. It puts telemetry service in control of the schema, and ID, which means that when we do something like generic caching, we need to coordinate with telemetry service on parameter naming.  If we had to do this with every service, it would never get done.\n3. It makes it much harder to replace telemetry service in the future.\n4. (minor)This doesn't have any json type checking, which makes it possible to drop the wrong schemas on dbus and fail the validator.  That should not be possible given the way bmcweb is architected."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "type": "ADDED",
                    "insertions": 148,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 148,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "324bc29c34a7f667a74abed0872ba22a2c375bea",
            "parents": [
                "a8544a5bb3406e7f36e850a500f2dd5f5b4285c3"
            ],
            "ref": "refs/changes/77/46977/4",
            "uploader": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "createdOn": 1634206506,
            "author": {
                "name": "Krzysztof Grobelny",
                "email": "krzysztof.grobelny@intel.com",
                "username": "krzysztof-i"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/metric_definition.hpp",
                    "type": "ADDED",
                    "insertions": 148,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 148,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/sdbusplus",
    "branch": "master",
    "id": "Ie238ca7807960bf1577dcbb272226f197de84b01",
    "number": 37331,
    "subject": "server: un-inline various large functions",
    "owner": {
        "name": "Patrick Williams",
        "email": "patrick@stwcx.xyz",
        "username": "williamspatrick"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/sdbusplus/+/37331",
    "commitMessage": "server: un-inline various large functions\n\nSave approximiately 70k (ARM32) of size from the generated library of\nlibphosphor-dbus.so by un-inlining various large functions.\n\nSigned-off-by: Patrick Williams <patrick@stwcx.xyz>\nChange-Id: Ie238ca7807960bf1577dcbb272226f197de84b01\n",
    "createdOn": 1602523895,
    "lastUpdated": 1612184850,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1602523895,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1602523914,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1602523922,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/6164/"
        },
        {
            "timestamp": 1602523935,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/6164/ : FAILURE"
        },
        {
            "timestamp": 1602524142,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1602524155,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1602524162,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/6165/"
        },
        {
            "timestamp": 1602524814,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/6165/ : SUCCESS"
        },
        {
            "timestamp": 1602532684,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1602532696,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1602532704,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/6172/"
        },
        {
            "timestamp": 1602533369,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/6172/ : SUCCESS"
        },
        {
            "timestamp": 1602828844,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1609855344,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1612099142,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1612099213,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1612099233,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612099272,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/11658/ : FAILURE"
        },
        {
            "timestamp": 1612099444,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased."
        },
        {
            "timestamp": 1612099464,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612100273,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11661/ : SUCCESS"
        },
        {
            "timestamp": 1612148730,
            "reviewer": {
                "name": "Lei YU",
                "email": "yulei.sh@bytedance.com",
                "username": "mine260309"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1612184836,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1612184850,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully merged by Patrick Williams"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3a1737de0f2700a6bc12aa9d70e38572db271245",
            "parents": [
                "ba480895b44e2a6d24126e4937ce8a2adcd7e896"
            ],
            "ref": "refs/changes/31/37331/1",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1602523895,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/bus.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -12
                },
                {
                    "file": "include/sdbusplus/sdbuspp_support/server.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -8
                },
                {
                    "file": "include/sdbusplus/server/interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -28
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -62
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/bus.cpp",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/server/interface.cpp",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "src/server/transaction.cpp",
                    "type": "MODIFIED",
                    "insertions": 82,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 177,
            "sizeDeletions": 110
        },
        {
            "number": 2,
            "revision": "de974d98b721b0b6bad3d95ae4cda953e1f0b8c2",
            "parents": [
                "ba480895b44e2a6d24126e4937ce8a2adcd7e896"
            ],
            "ref": "refs/changes/31/37331/2",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1602524142,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/bus.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -12
                },
                {
                    "file": "include/sdbusplus/sdbuspp_support/server.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -8
                },
                {
                    "file": "include/sdbusplus/server/interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -28
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -62
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/bus.cpp",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/server/interface.cpp",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "src/server/transaction.cpp",
                    "type": "MODIFIED",
                    "insertions": 81,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 176,
            "sizeDeletions": 110
        },
        {
            "number": 3,
            "revision": "0492982e7ae6d2c5957df6a77e0cd5f3206e30c4",
            "parents": [
                "8a45b27f71b654e03fcab88eb7827553b47ebfd4"
            ],
            "ref": "refs/changes/31/37331/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1602532684,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "The saved size potentially means a bit overhead of runtime.\nDo we really such size?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Brad Bishop",
                        "email": "bradleyb@fuzziesquirrel.com",
                        "username": "bradbishop"
                    },
                    "message": "> The saved size potentially means a bit overhead of runtime\n\nIn functions that are called infrequently.  I really doubt the handful of instructions saved have any meaningful impact on runtime throughput.\n\n>  Do we really such size?\n\nYes, when the footprint improvment is essentially free (see above)."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Yes, I agree with Brad.  The performance impact of an indirection is negligible even if it were called often.  I'd want to see it show up on a profiler before being worried about it.\n\nOriginally when I wrote this library I strived to make it all header-only.  There is too much going on to actually achieve that with a reasonable code size.  I'm trying to inline a number of functions to reduce the size of both phosphor-dbus-interfaces and across all the callers.  We can certainly cycle back and profile some of it if we think sdbusplus ends up having a performance impact on real applications."
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "line": 106,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "This seems a new function, maybe it's better to add it in a separated commit?"
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "line": 106,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "It is related to the space optimization.  There was this boilerplate in a number of generated functions:\n\n        auto tbus = m.get_bus();\n        sdbusplus::server::transaction::Transaction t(tbus, m);\n        sdbusplus::server::transaction::set_id(\n            std::hash<sdbusplus::server::transaction::Transaction>{}(t));\n\nIt is now enclosed in this set_id function.\n\nI don't see a significant value in putting that part into a separate commit."
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "line": 106,
                    "reviewer": {
                        "name": "Lei YU",
                        "email": "yulei.sh@bytedance.com",
                        "username": "mine260309"
                    },
                    "message": "Ack"
                },
                {
                    "file": "src/server/transaction.cpp",
                    "line": 33,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "This is the new function implementation."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/bus.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -12
                },
                {
                    "file": "include/sdbusplus/sdbuspp_support/server.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -8
                },
                {
                    "file": "include/sdbusplus/server/interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -28
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -62
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/bus.cpp",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/server/interface.cpp",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "src/server/transaction.cpp",
                    "type": "MODIFIED",
                    "insertions": 81,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 176,
            "sizeDeletions": 110
        },
        {
            "number": 4,
            "revision": "1f914bf7f109bf31cdfad4f4996d3cf4817f8be5",
            "parents": [
                "ea2917278b8d3e910e65dba193a5f0ce16cf4974"
            ],
            "ref": "refs/changes/31/37331/4",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1612099213,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/bus.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -12
                },
                {
                    "file": "include/sdbusplus/sdbuspp_support/server.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -8
                },
                {
                    "file": "include/sdbusplus/server/interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -28
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -62
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/bus.cpp",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/server/interface.cpp",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "src/server/transaction.cpp",
                    "type": "MODIFIED",
                    "insertions": 81,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 176,
            "sizeDeletions": 110
        },
        {
            "number": 5,
            "revision": "32ffb03dc854ba61747849246805ea7597e97130",
            "parents": [
                "e659436de16d31362921e08183a617848660e724"
            ],
            "ref": "refs/changes/31/37331/5",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1612099444,
            "author": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "include/sdbusplus/bus.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -12
                },
                {
                    "file": "include/sdbusplus/sdbuspp_support/server.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -8
                },
                {
                    "file": "include/sdbusplus/server/interface.hpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -28
                },
                {
                    "file": "include/sdbusplus/server/transaction.hpp",
                    "type": "MODIFIED",
                    "insertions": 14,
                    "deletions": -62
                },
                {
                    "file": "meson.build",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "src/bus.cpp",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "src/server/interface.cpp",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "src/server/transaction.cpp",
                    "type": "MODIFIED",
                    "insertions": 81,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 176,
            "sizeDeletions": 110
        }
    ]
}
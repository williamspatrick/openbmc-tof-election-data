{
    "project": "openbmc/docs",
    "branch": "master",
    "topic": "bmc-quiesced",
    "id": "I0527213bcf2c5886554d02c238cb963cc00f0f87",
    "number": 46690,
    "subject": "bmc-service-failure: handling a service in the fail state",
    "owner": {
        "name": "Andrew Geissler",
        "email": "geissonator@yahoo.com",
        "username": "geissonator"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/46690",
    "commitMessage": "bmc-service-failure: handling a service in the fail state\n\nThis commit adds additional details and requirements on how to handle an\nOpenBMC systemd service that enters the fail state.\n\nThe service should not just silently fail, it needs to be reported to\nthe system owner and appropriate debug data needs to be generated so\nroot cause can be identified.\n\nChange-Id: I0527213bcf2c5886554d02c238cb963cc00f0f87\nSigned-off-by: Andrew Geissler <geissonator@yahoo.com>\n",
    "createdOn": 1631135070,
    "lastUpdated": 1639704317,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1631135070,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1631135649,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 2: Commit message was updated."
        },
        {
            "timestamp": 1632426342,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Topic set to bmc-quiesced"
        },
        {
            "timestamp": 1632625017,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1632938908,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1632939924,
            "reviewer": {
                "name": "Milton D. Miller II",
                "email": "miltonm@us.ibm.com",
                "username": "mdmillerii"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1633449977,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 2: Code-Review+1\n\nAgree with Milton that a clarification can be added earlier in the doc. It's helpful at least that the headlines have been updated to add \"platform-data-provider\" to specify who's responsible for what."
        },
        {
            "timestamp": 1633470766,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1633470766,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1633554753,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1639150230,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1639704317,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3: Code-Review-1\n\n(9 comments)\n\nSorry for taking so long to review this, especially as it turns out I have Opinions :sweat_smile:"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "4aa6514dfcae1ada068f699cc30f616642f90f35",
            "parents": [
                "b38b0a4c9962e7218c78dee26006bb9251053628"
            ],
            "ref": "refs/changes/90/46690/1",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1631135070,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 73,
                    "deletions": -7
                }
            ],
            "sizeInsertions": 73,
            "sizeDeletions": 7
        },
        {
            "number": 2,
            "revision": "42b3a61117d669644d3d476d26ea8f862e08e032",
            "parents": [
                "b38b0a4c9962e7218c78dee26006bb9251053628"
            ],
            "ref": "refs/changes/90/46690/2",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1631135649,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 53,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "Should be service (but not related to this change)"
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 53,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "ok. I'm going to keep this review focused on the changes I need for BMC Quiesce."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 302,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "It was noted in the PDI review that if the target is going to cause a BMC Quiesce state then we should name the target to reflect that."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 315,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "This proposed design and the requirements reads as each service vs on the system presumably by a failure collection/notification service."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 315,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Hmm, can you provide some more detail here Milton? Each service will need to have this \"OnFailure\" added to it to call this new target. There will be a default service in that target to log an error by system owners have the option to install whatever other services they would like into that target to handle these failures."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 315,
                    "reviewer": {
                        "name": "Milton D. Miller II",
                        "email": "miltonm@us.ibm.com",
                        "username": "mdmillerii"
                    },
                    "message": "I'm fine with such an implementation just stating I didn't read that in this proposed design.  It read to me as being part of each daemon which I didn't think was intended nor reasonable.\n\nHmmm maybe I read this paragraph too quickly.   But can you put a preview of the service target / new application doing the logging near 166-170?"
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 315,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "ok, tried to add some more details up there"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 73,
                    "deletions": -7
                }
            ],
            "sizeInsertions": 73,
            "sizeDeletions": 7
        },
        {
            "number": 3,
            "revision": "f9cff5c163534189f4205183c34a5a9a6169d1f7",
            "parents": [
                "b38b0a4c9962e7218c78dee26006bb9251053628"
            ],
            "ref": "refs/changes/90/46690/3",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1633470766,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 21,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Let's drop the specific service manager implementation here. This part is meant to be pretty abstract."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 166,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "\"The requirements for OpenBMC when a platform-data-provider service enters a failure state are that the BMC:"
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 167,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "\"Logs an error\""
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 168,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "\"Collects\""
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 169,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "\"Changes\""
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 173,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "In the application service unit, set `OnFailure=...`"
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 322,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I think the document should be structured with separate \"chapters\" - one to address platform-data-provider failure handling and one to address platform-data-transport-provider handling. The document was written with the latter as the focus and I think it's disruptive to the flow of the argument to have discussion of platform-data-provider failure handling spread throughout."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 452,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Is there anything we can do to simply monitor for failed services and have an allow/block list of ones for which we react?  I'm not sure the quiesce target is great because it means you only get one-shot at collecting failures per BMC reboot, right?"
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 459,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "\"intents and\" ?"
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 460,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Seems a bit casual given the style in the rest of the document \ud83d\ude0a"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 17,
                    "deletions": 0
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 80,
                    "deletions": -7
                }
            ],
            "sizeInsertions": 80,
            "sizeDeletions": 7
        }
    ]
}
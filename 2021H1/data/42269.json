{
    "project": "openbmc/phosphor-post-code-manager",
    "branch": "master",
    "id": "Ieff2acd81ee6fbd74ad8005680499e6753860037",
    "number": 42269,
    "subject": "Add the BIOSPostCode events into the BMCWeb EventService",
    "owner": {
        "name": "Alan Kuo",
        "email": "Alan_Kuo@quantatw.com",
        "username": "Alan-Kuo-TW"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-post-code-manager/+/42269",
    "commitMessage": "Add the BIOSPostCode events into the BMCWeb EventService\n\n- Add BIOSPostCode events to the bmcweb redfish event log, so that\n  users can collect BIOSPOSTCode events through redfish EventService.\n  Refer to:\n  https://github.com/openbmc/docs/blob/master/architecture/redfish-logging-in-bmcweb.md\n- Add CMake option to trun on/off the log of post code.\n  The default setting is off.\n\nTested:\n  - Tested build OK.\n  - Check /var/log/redfish OK.\n    1970-01-01T00:05:06.042545+00:00 OpenBMC.0.1.BIOSPOSTCode,1,267.5030,0x15\n    1970-01-01T00:05:06.182087+00:00 OpenBMC.0.1.BIOSPOSTCode,1,267.5813,0x7f\n    1970-01-01T00:05:06.276475+00:00 OpenBMC.0.1.BIOSPOSTCode,1,267.7245,0x00\n\nSigned-off-by: Alan Kuo <Alan_Kuo@quantatw.com>\nChange-Id: Ieff2acd81ee6fbd74ad8005680499e6753860037\n",
    "createdOn": 1618455296,
    "lastUpdated": 1618970038,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1618455296,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1618455309,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1618455383,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/15457/ : SUCCESS"
        },
        {
            "timestamp": 1618457295,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1618457361,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1618465084,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1618465103,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1618465179,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/15464/ : SUCCESS"
        },
        {
            "timestamp": 1618465183,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1618465262,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1618795731,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Patch Set 3:\n\nHi Kuiying Wang,\n\nCould you please review this commit and let me know if any comments.\n\nThanks"
        },
        {
            "timestamp": 1618818500,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1618859244,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1618888274,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1618890944,
            "reviewer": {
                "name": "Nan Zhou",
                "email": "nanzhoumails@gmail.com",
                "username": "FighterNan"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1618907554,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1618907565,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1618907715,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/15792/ : SUCCESS"
        },
        {
            "timestamp": 1618943234,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1618967304,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1618970038,
            "reviewer": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "message": "Change has been successfully merged by Alan Kuo"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "d47166befb4d0404d5adc48c18d1d676de6ba2f2",
            "parents": [
                "84a4c19c48ad28b537cfcce15df39e841e1ed565"
            ],
            "ref": "refs/changes/69/42269/1",
            "uploader": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "createdOn": 1618455296,
            "author": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Can you add a paragraph describing what we are trying to do? \"push model\" is not clear enough for reviewers who don't have context. Like \"Add journal logging to add the BIOSPostCode event into BMCWeb EventService.\" Please also link this doc https://github.com/openbmc/docs/blob/master/architecture/redfish-logging-in-bmcweb.md."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Alan Kuo",
                        "email": "Alan_Kuo@quantatw.com",
                        "username": "Alan-Kuo-TW"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 107,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "nit: extra space"
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 107,
                    "reviewer": {
                        "name": "Alan Kuo",
                        "email": "Alan_Kuo@quantatw.com",
                        "username": "Alan-Kuo-TW"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 21,
                    "deletions": 0
                },
                {
                    "file": "CMakeLists.txt",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "src/post_code.cpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "d70c557e1eee2880a28fb9d4df9c45e19df668cd",
            "parents": [
                "84a4c19c48ad28b537cfcce15df39e841e1ed565"
            ],
            "ref": "refs/changes/69/42269/2",
            "uploader": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "createdOn": 1618465084,
            "author": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "CMakeLists.txt",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "src/post_code.cpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "dfd4065362ffe14de1171da4b20b48ed24577f33",
            "parents": [
                "84a4c19c48ad28b537cfcce15df39e841e1ed565"
            ],
            "ref": "refs/changes/69/42269/3",
            "uploader": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "createdOn": 1618465183,
            "author": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "src/post_code.cpp",
                    "line": 95,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "nit: switch the order here\nusTimeOffset =  std::chrono::duration_cast<std::chrono::microseconds>(\n                   postCodeTimeSteady - firstPostCodeTimeSteady)\n                   .count();\ntsUS = usTimeOffset + firstPostCodeUsSinceEpoch;"
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 95,
                    "reviewer": {
                        "name": "Alan Kuo",
                        "email": "Alan_Kuo@quantatw.com",
                        "username": "Alan-Kuo-TW"
                    },
                    "message": "Ack"
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 104,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Why is the secondary post code not included here?"
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 104,
                    "reviewer": {
                        "name": "Alan Kuo",
                        "email": "Alan_Kuo@quantatw.com",
                        "username": "Alan-Kuo-TW"
                    },
                    "message": "I think the event log should be consistent with redfish /redfish/v1/Systems/system/LogServices/PostCodes/Entries/.\nSo I did not consider the secondary post.\n\nIf there is a need to add a secondary post, what format do we need to display?\nCould you give me some advice?"
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 104,
                    "reviewer": {
                        "name": "Nan Zhou",
                        "email": "nanzhoumails@gmail.com",
                        "username": "FighterNan"
                    },
                    "message": "Hi Zhikui, thanks for your feedback. As Alan said, our first step is to implement the primary post code in EventService, which is aligned to the current MessageRegistry schema (https://github.com/openbmc/bmcweb/blob/master/redfish-core/include/registries/openbmc_message_registry.hpp#L189). We would like to consider secondary POST codes as a future work which might involve modification to the MessageRegistry and existing LogService."
                },
                {
                    "file": "src/post_code.cpp",
                    "line": 104,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "ACK. Secondary boot code is a recent addition. I am ok with address it in a different/later patch"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "CMakeLists.txt",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "src/post_code.cpp",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 32,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "0171dd6bce9004e187c957f160809b729322f37d",
            "parents": [
                "84a4c19c48ad28b537cfcce15df39e841e1ed565"
            ],
            "ref": "refs/changes/69/42269/4",
            "uploader": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "createdOn": 1618907554,
            "author": {
                "name": "Alan Kuo",
                "email": "Alan_Kuo@quantatw.com",
                "username": "Alan-Kuo-TW"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 24,
                    "deletions": 0
                },
                {
                    "file": "CMakeLists.txt",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": 0
                },
                {
                    "file": "src/post_code.cpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": -4
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 4
        }
    ]
}
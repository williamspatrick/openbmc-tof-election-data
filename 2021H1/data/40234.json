{
    "project": "openbmc/phosphor-fan-presence",
    "branch": "master",
    "id": "I66571b6acaba180ab210cd41701014942d2dc050",
    "number": 40234,
    "subject": "sensor-mon: Handle propertiesChanged",
    "owner": {
        "name": "Matt Spinler",
        "email": "spinler@us.ibm.com",
        "username": "spinler"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-fan-presence/+/40234",
    "commitMessage": "sensor-mon: Handle propertiesChanged\n\nFill in the propertiesChanged handler to check if any event logs need to\nbe created.\n\nWhen a sensor is added to D-Bus after this application starts, the code\nsees it via the propertiesChanged signal.  It knows its new because\nthere is no previous value saved, so it knows to only care about an\nalarm value of true by making up a previous value of false.\n\nSigned-off-by: Matt Spinler <spinler@us.ibm.com>\nChange-Id: I66571b6acaba180ab210cd41701014942d2dc050\n",
    "createdOn": 1612295268,
    "lastUpdated": 1614012108,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1612295268,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1612295283,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612295426,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11813/ : SUCCESS"
        },
        {
            "timestamp": 1612458823,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1612458869,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612459732,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11914/ : SUCCESS"
        },
        {
            "timestamp": 1612800085,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 3: Patch Set 2 was rebased."
        },
        {
            "timestamp": 1612800131,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1612800294,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12103/ : SUCCESS"
        },
        {
            "timestamp": 1612997132,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1613078722,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1613078802,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1613078821,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1613079595,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12327/ : SUCCESS"
        },
        {
            "timestamp": 1613150239,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1613417978,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1613422895,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 4: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1613424114,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1613576035,
            "reviewer": {
                "name": "Matthew Barth",
                "email": "msbarth@linux.ibm.com",
                "username": "msbarth"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1614012108,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Change has been successfully rebased and submitted as f5d3be40ab9a599ffe7b5654e6ac3c5a25b647f7 by Matt Spinler"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "1d29cdcf74d814bdd318cf905b40a6a239ad3cea",
            "parents": [
                "ea62a1d6801f7ded8972e4115fc9a87cb31bce1e"
            ],
            "ref": "refs/changes/34/40234/1",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1612295268,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "7a4448684983c748ed0a93323837fd28169974e7",
            "parents": [
                "ffcf8f7619c83ce0510cc926281a9be13b79114c"
            ],
            "ref": "refs/changes/34/40234/2",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1612458823,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "b80361b67a48ad75d8302b7f7084f8f283f9ae93",
            "parents": [
                "477d6e96ecdb06b3771dfc6598534166678cdd7c"
            ],
            "ref": "refs/changes/34/40234/3",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1612800085,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Do we need to be subscribing to interfacesRemoved signals to remove (or set back to false) any of these alarms when the service that provides them goes away?"
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "trying to decide...\n\nas it is now:\n* if alarm is high and sensor is removed and readded:\n    * when sensor show up again, alarm would (most likely) be off, code will create the info event log saying temp is now under limit\n\nwith interfaces removed:\n* if alarm is high and sensor is removed and readded:\n    * when sensor shows up again, no info event log\n\nmaybe the latter is slightly better.  I'm not really sure how to test this though, as killing an app doesn't send interfacesRemoved, unless it does so when it's restarted."
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "I recall terminating an application did cause the interfacesRemoved signals to be sent on dbus. This is how I tested handling those signals in the fan control application.\n\nWhat will happen if an alarm is high and the sensor is removed and doesnt come back though? Would we want to handle the alarm as if its critical since the sensor is now in an unknown state? or do we want to just log that the sensor disappeared nullifying the alarm?"
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "I still haven't been able to generate an interfacesRemoved by stopping either hwmontempsensor or phosphor-hwmon-readd, so at the moment I don't plan on putting in handling for interfacesRemoved.\n\nI was looking at the dbus-sensors/hwmontempsensor code, and I don't see code in there to remove a sensor from D-Bus when the underlying entity-manager config interface goes away.  That means in the case of a removable card being unplugged, the sensor wouldn't go away anyway."
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "line": 142,
                    "reviewer": {
                        "name": "Matthew Barth",
                        "email": "msbarth@linux.ibm.com",
                        "username": "msbarth"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "d1aca10d400fda1040f5bf45c957eb9ff04813a2",
            "parents": [
                "5e5b4dc6cc12609123e1246e4472b21e995cf664"
            ],
            "ref": "refs/changes/34/40234/4",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1613078802,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 1
        },
        {
            "number": 5,
            "revision": "f5d3be40ab9a599ffe7b5654e6ac3c5a25b647f7",
            "parents": [
                "50bf816a6e4801d4f529a1bd2252a97366df880a"
            ],
            "ref": "refs/changes/34/40234/5",
            "uploader": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "createdOn": 1614012108,
            "author": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "sensor-monitor/threshold_alarm_logger.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 1
        }
    ]
}
{
    "project": "openbmc/docs",
    "branch": "master",
    "topic": "power-recovery",
    "id": "I5ff93de04bb8b5b321686adaac318f9c03e7f8b5",
    "number": 48210,
    "subject": "power-recovery: uninterruptible power supplies",
    "owner": {
        "name": "Andrew Geissler",
        "email": "geissonator@yahoo.com",
        "username": "geissonator"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/48210",
    "commitMessage": "power-recovery: uninterruptible power supplies\n\nAdd a section on handling a UPS and the requirements around it\n\nChange-Id: I5ff93de04bb8b5b321686adaac318f9c03e7f8b5\nSigned-off-by: Andrew Geissler <geissonator@yahoo.com>\n",
    "createdOn": 1635198465,
    "lastUpdated": 1639152808,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1635198465,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1635364437,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 2: Patch Set 1 was rebased."
        },
        {
            "timestamp": 1635432105,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Topic set to power-recovery"
        },
        {
            "timestamp": 1635435803,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 2:\n\n(5 comments)"
        },
        {
            "timestamp": 1635798242,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1635798242,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 3:\n\n(5 comments)"
        },
        {
            "timestamp": 1636046882,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1636145362,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 4: Patch Set 3 was rebased."
        },
        {
            "timestamp": 1636145362,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1636405890,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1636408086,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1636492621,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1636492621,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1636993537,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1637268705,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 6: Patch Set 5 was rebased."
        },
        {
            "timestamp": 1637273839,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1638670115,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 6: Code-Review+1"
        },
        {
            "timestamp": 1638784969,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 6:\n\n(1 comment)"
        },
        {
            "timestamp": 1638806764,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 6:\n\n(3 comments)"
        },
        {
            "timestamp": 1638822703,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 6: -Code-Review\n\n(3 comments)"
        },
        {
            "timestamp": 1638826656,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 6:\n\n(3 comments)"
        },
        {
            "timestamp": 1638991011,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 7."
        },
        {
            "timestamp": 1638991011,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 7:\n\n(3 comments)"
        },
        {
            "timestamp": 1638991020,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Uploaded patch set 8: Patch Set 7 was rebased."
        },
        {
            "timestamp": 1639068723,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 8: Code-Review+1"
        },
        {
            "timestamp": 1639152804,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 8: Verified+1 Code-Review+2"
        },
        {
            "timestamp": 1639152808,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 8ec6cb41fa3aac6e4f4c4b25efdbfbfc6f0dd27b by Patrick Williams"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "70c1bec025a372f39492623a687fca0702843911",
            "parents": [
                "424caf6b31fae81095c9cdfbc0eddafa007ca118"
            ],
            "ref": "refs/changes/10/48210/1",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1635198465,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "03f762526ac685d08f5841c38871d962221761df",
            "parents": [
                "d12751402759fd47ae3844edfa7e52ef823780d3"
            ],
            "ref": "refs/changes/10/48210/2",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1635364437,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "designs/power-recovery.md",
                    "line": 81,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "I know this text wasn't added with these UPS changes, but one thing we need to be careful of is PLDs can occur multiple times in a short time-frame.  We will have \"minimum off delays\" in the power off/on sequencing to help avoid thrashing in general, but the scenario I'm concerned about is:\n\n1. System powered on, APR enabled&armed, blackout occurs.\n2. AC returns, BMC comes out of reset, sees APR enabled&armed and that the system used to be powered on before the BMC reset, so it starts to APR based on the policy.\n3. Before the system makes it all the way back up, another blackout occurs.\n4. AC returns, BMC comes out of reset, it should still try to APR again since it was trying to before the 2nd PLD, even though it now looks like the previous state wasn't powered on.\n\nI'm not sure in what all scenarios the \"one-time\" policy will be used, so maybe that couldn't prevent the APR from happening in this double-PLD case, but the general APR design should handle this.  Might be a good test to add in the Testing section below too."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 81,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "I think we're ok here. APR policy has two options in this area, AlwaysOn and Restore. The AlwaysOn is simple, in this scenario, we just keep trying to power on no matter what. The \"Restore\" logic is to just look at the last requested state for the system, and set it again, so there's no validation that power is on. I'll add this test case to the first commit.\n\nThe one-time scenarios are around code update. So it's used for inband to make sure the system powers back on automatically. It's also being talked about being used for side switch (switch firmware flash sides on power on and auto power on during next BMC reboot). You would lose your one-time setting after the first try. It sounds like your requirement here is that we can't clear the one-time until the system has successfully powered on or maybe Host firmware has booted?"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 120,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Good info to add here. I'd also add this requirement:\n- If host firmware is running, notify the host firmware of this utility failure condition\n\n(There are 2 important bits in the UPS status - UPS utility fail, and UPS battery low.  We need to log an error and notify the host for either of those conditions. You have mentioned the 2nd condition below.)"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 120,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "I'd say \"If the UPS battery power becomes low and if host firmware is running,\" ..."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 123,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "I'd say \"Log an error if the UPS battery power becomes low and a power loss to the entire system is imminent\"..."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 123,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 191,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "couple comments:\n\n(nit) \"too\"/\"to\"\n\nTo be accurate, may as well mention the 2 scenarios (UPS utility fail, and UPS battery low) in both cases we'd log an error and notify the host hw.\n\nJust as the boot would be held off if we're in a Brownout, we should also hold off the boot if either UPS uf or UPS bl is on.  I agree we could just overload the 'BrownOut' setting in 'PowerStatus' for all 3 cases, alternatively we could different indications for each (such as 'BrownOut', 'UPSUtilityFail', 'UPSBatteryLow') in case we need to make a distinction in the future.  I don't have a strong opinion on this, whatever makes sense to the community (others on the review) is fine with me.\n\nOne other thing to consider, could be 2 different apps setting the 'PowerStatus' field, so potential race condition concerns.  As the UPS drains and the power supplies start to report a brownout, it could be problematic if for instance the phosphor-psu-monitor app set the field to 'Brownout', but then the UPS bits cleared so the UPS app set the field to 'Good', even though the ps still saw the brownout.  One could argue that would be a bug in the UPS firmware, but in general on BMC, do we allow 2 different apps to set a single DBus property?  Or is that frowned upon, so we would need two \"PowerStatus\" fields, and have phosphor-state-manager logically AND them..."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 191,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "> (nit) \"too\"/\"to\"\n\nFixed\n\n> Just as the boot would be held off if we're in a Brownout, we should also hold off the boot if either UPS uf or UPS bl is on\n\nAdded requirement and note on this.\n\n> I agree we could just overload the 'BrownOut' setting in 'PowerStatus' for all 3 cases\n\nI think this, and your discussion about how two different apps could be looking at 2 different things that feed into this is making me think we may need each app to host it's own property and then state-manger can & them all when it's property is read. Lets discuss a bit offline."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 28,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 28,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "c5b71fd6f9055818f9b107a625780dbe080695db",
            "parents": [
                "435fa9b88c33c71a41ee6d04bb8d61510bfbc3c6"
            ],
            "ref": "refs/changes/10/48210/3",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1635798242,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/power-recovery.md",
                    "line": 170,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Add a UninterruptiblePowerSupply option as well. It will be same behavior (power on not allowed) but it will provide better detail on system status."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 187,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Can we get a dbus interface to represent a UPS?  I don't think we should tie this design exclusively to the phosphor-power implementation (which effectively nobody else uses).\n\nThere are already pretty decent support in Linux off-the-shelf for UPSes using the 'UPower' package.  Ideally we should find a way to interoperate with this.  I gave an output of the dbus interfaces provided by UPower for my desktop, which has a small USB-connected UPS on it.\n\n1. https://upower.freedesktop.org/docs/Device.html\n2. https://gist.github.com/williamspatrick/011941640a3d84753a935197403aa637"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 187,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah, makes sense to me. We'll define a UPS PDI, and then the power app can host it in our implementation and others are free to host wherever they like. Sound good to you Derek? If so, I'll update this doc."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 187,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Yeah per our offline discussion sounds good to me."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 187,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "I created a UPS interface based on the comments above and our current requirements.  https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-dbus-interfaces/+/49368\n\nI read the UPower documentation and some of the code.  The new PDI interface is based on a subset of the UPower Device interface."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 40,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 40,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "93e5c4508af8ba1ce779905d8535784d294cbfe6",
            "parents": [
                "14f5ad57031c33380f46a759f26c9beda5066fa5"
            ],
            "ref": "refs/changes/10/48210/4",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1636145362,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "designs/power-recovery.md",
                    "line": 129,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "After discussion with Derek, there is a nuance I didn't capture here. The UPS must be fully charged before allowing a system to power on. The idea being that if a customer has attached a UPS, they expect it to provide backup support if power loss occurs."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 175,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Add a UninterruptiblePowerSupply"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 219,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Power on is allowed if customer requests, just don't run the APR logic if on UPS."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 40,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 40,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "e8f02c61691b978d78954e9b37b9f219c5b0522f",
            "parents": [
                "2a8fbed8c1a709d4db7b57c3c7c89bfd05c3e338"
            ],
            "ref": "refs/changes/10/48210/5",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1636492621,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 0
        },
        {
            "number": 6,
            "revision": "70ab233e6eae2d356c914218500f3789984be2bf",
            "parents": [
                "64e18508d84a2bc65de163de0e0becf07da86a8e"
            ],
            "ref": "refs/changes/10/48210/6",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1637268705,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "comments": [
                {
                    "file": "designs/power-recovery.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Shouldn't this be configurable?  You might want to notify the host immediately but others might want to defer until the battery goes below N percent?\n\nOr, are you exposing information about your UPS such that the host can create similar Linux battery information like would happen on an ACPI-based system?"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "We'll notify the host both when AC is lost (this condition), and if/when the UPS battery becomes low.  The different types of OS'es our systems support have different policies/implementations based on these 2 notifications - some may choose to start a timer when AC is lost, some may choose to power off immediately, etc.  So the host/partitions decide what shutdown actions to take (ie it's already in place), not the BMC."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I understand.\n\nI can't speak to your other operating systems, and I don't know if you've already defined the firmware interfaces here, but any ACPI-based machine already has a way to expose batteries (and power supplies) through ACPI tables and UPower can already handle those as well.  You might want to look into how that is exposed and see if skiboot can plumb into those same Linux kernel APIs for your PowerKVM machines.\n\nIdeally the flow for all the battery information would be:\n\nBMC-attached-UPS -> UPower on BMC -> (small openbmc glue) -> IPMI/PLDM -> Host Firmware -> Kernel on Host -> UPower on Host --(on low battery)-> systemd.\n\nIf you plug a UPS directly into your host the { kernel -> upower -> systemd } is already done.  Adding this little bit of plumbing in a standard way on the BMC side gives you the same configuration path that any \"standard\" Linux system has for deal with UPS brown/black-out conditions."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 121,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "ok, I'll list this and the below requirement as configurable. Per our discord discussions, we will import the UPower d-bus schema into PDI, but for resource reasons, we will only implement the aspects defined in this design doc (and it will be done via more openbmc glue then we'd like)."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 127,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Can you add some words to clarify the rationale here?"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 127,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Sounds like a good idea.\n\nIf the host chose to shut off, and AC still hasn't came back, we don't want to automatically power the system back on again, only for it to power back off again (prevent thrashing)."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 127,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Got it.  As I mentioned elsewhere, this is in some regards IBM-specific policy.  Hopefully this is configurable or configurable-easily-added-later.  \n\nI believe we configure our systems to turn on immediately or with only a low battery charge (such as 5%) so we can get a DC up and running faster."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 127,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "ok, clarified, and indicated it should be configurable"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 230,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "What does \"Good\" mean here?  The UPower states are: { charging, discharging, empty, fully-charged, pending-charge, pending-discharge, unknown }.  Are you going to wait until the battery is \"fully-charged\" before you start powering on your server?"
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 230,
                    "reviewer": {
                        "name": "Derek Howard",
                        "email": "derekh@us.ibm.com",
                        "username": "derekhoward55"
                    },
                    "message": "Yes we'll wait until the battery is fully-charged (and AC has returned) before we start powering on again, eg to avoid thrashing."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 230,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "I think I was missing some of the tie of these states to the proposed dbus interface.  I forgot there was a separate commit with those that was independent from what Shaun mentioned for UPower."
                },
                {
                    "file": "designs/power-recovery.md",
                    "line": 230,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Added a blurb about this also being configurable. And yep, this property is defined over in https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-dbus-interfaces/+/48692"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 43,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 43,
            "sizeDeletions": 0
        },
        {
            "number": 7,
            "revision": "a67674ca634bcfa6aaad02abb58d94e2797b4f92",
            "parents": [
                "64e18508d84a2bc65de163de0e0becf07da86a8e"
            ],
            "ref": "refs/changes/10/48210/7",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1638991011,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 0
        },
        {
            "number": 8,
            "revision": "7ed09b18b9974068b01c56ac7d49493f7ba93745",
            "parents": [
                "b5cddbb2c96cca6ae055575fa6580f06b9a1a844"
            ],
            "ref": "refs/changes/10/48210/8",
            "uploader": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "createdOn": 1638991020,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 0
        },
        {
            "number": 9,
            "revision": "8ec6cb41fa3aac6e4f4c4b25efdbfbfc6f0dd27b",
            "parents": [
                "b2ac767d8383b857779c483619f7ab258cf54c01"
            ],
            "ref": "refs/changes/10/48210/9",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1639152808,
            "author": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "designs/power-recovery.md",
                    "type": "MODIFIED",
                    "insertions": 46,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 46,
            "sizeDeletions": 0
        }
    ]
}
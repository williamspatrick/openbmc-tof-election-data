{
    "project": "openbmc/openpower-occ-control",
    "branch": "master",
    "id": "I490f182405e11da207b42a0607a532566479bfd9",
    "number": 48806,
    "subject": "Clean up error cases on boot or when app restarted",
    "owner": {
        "name": "Chris Cain",
        "email": "cjcain@us.ibm.com",
        "username": "cjcain"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openpower-occ-control/+/48806",
    "commitMessage": "Clean up error cases on boot or when app restarted\n\n- Detect when no or duplicate masters are found (force reset)\n- Prevent sending commands to OCC when OCC is disabled\n- Detect OCC state changes to SAFE (after 60 sec force reset)\n\nTested on Everest and Rainier hardware\n\nSigned-off-by: Chris Cain <cjcain@us.ibm.com>\nChange-Id: I490f182405e11da207b42a0607a532566479bfd9\n",
    "createdOn": 1636729084,
    "lastUpdated": 1637246086,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1636729084,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1636729098,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1636729139,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/30200/ : FAILURE"
        },
        {
            "timestamp": 1636731436,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1636731448,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1636731571,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/30202/ : SUCCESS"
        },
        {
            "timestamp": 1636732231,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 2:\n\nFix for defect SW539051"
        },
        {
            "timestamp": 1636992696,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1636999569,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1636999580,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1636999676,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1636999702,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/30280/ : SUCCESS"
        },
        {
            "timestamp": 1637083914,
            "reviewer": {
                "name": "Martha Broyles",
                "username": "marthabroyles"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1637095124,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1637102592,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Patch Set 3:\n\n(2 comments)"
        },
        {
            "timestamp": 1637102787,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1637102800,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1637102927,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/30368/ : SUCCESS"
        },
        {
            "timestamp": 1637178110,
            "reviewer": {
                "name": "Sheldon Bailey",
                "email": "baileysh@us.ibm.com",
                "username": "baileysh"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1637190695,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 4: Code-Review+1"
        },
        {
            "timestamp": 1637245122,
            "reviewer": {
                "name": "Edward A. James",
                "email": "eajames@us.ibm.com",
                "username": "eddiejames"
            },
            "message": "Patch Set 4: Code-Review+2"
        },
        {
            "timestamp": 1637246086,
            "reviewer": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "message": "Change has been successfully merged by Chris Cain"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "a03d84684ec54c5b787958ad2eaf114037430c49",
            "parents": [
                "17257673579b66c6e5c2769fc0a1ffd2decc71d2"
            ],
            "ref": "refs/changes/06/48806/1",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1636729084,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 150,
                    "deletions": -43
                },
                {
                    "file": "occ_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "occ_presence.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "occ_status.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -5
                },
                {
                    "file": "occ_status.hpp",
                    "type": "MODIFIED",
                    "insertions": 29,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 246,
            "sizeDeletions": 52
        },
        {
            "number": 2,
            "revision": "e5ff05b15aad25be29c2b4738581d5a5e897277a",
            "parents": [
                "17257673579b66c6e5c2769fc0a1ffd2decc71d2"
            ],
            "ref": "refs/changes/06/48806/2",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1636731436,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 16,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Probably better to remove internal issue references"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 16,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 161,
                    "deletions": -48
                },
                {
                    "file": "occ_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "occ_presence.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "occ_status.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -5
                },
                {
                    "file": "occ_status.hpp",
                    "type": "MODIFIED",
                    "insertions": 29,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 257,
            "sizeDeletions": 57
        },
        {
            "number": 3,
            "revision": "339c29ad01cd5c25089b3166c5128c9a75f17788",
            "parents": [
                "17257673579b66c6e5c2769fc0a1ffd2decc71d2"
            ],
            "ref": "refs/changes/06/48806/3",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1636999569,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "occ_manager.cpp",
                    "line": 191,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "do you need to worry about statusObjects.size() also == 1, so a 1 OCC system?"
                },
                {
                    "file": "occ_manager.cpp",
                    "line": 191,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "It shouldn't matter.\nThis check will just start the 30 second timer (waiting for OCCs to show up).\nIf it was single OCC system, line 198 would be true, and it would stop the timer."
                },
                {
                    "file": "occ_status.hpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Matt Spinler",
                        "email": "spinler@us.ibm.com",
                        "username": "spinler"
                    },
                    "message": "Since I don't see this being deleted anywhere, I don't think it needs to be a unique_ptr?"
                },
                {
                    "file": "occ_status.hpp",
                    "line": 111,
                    "reviewer": {
                        "name": "Chris Cain",
                        "email": "cjcain@us.ibm.com",
                        "username": "cjcain"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 157,
                    "deletions": -48
                },
                {
                    "file": "occ_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "occ_presence.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "occ_status.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -5
                },
                {
                    "file": "occ_status.hpp",
                    "type": "MODIFIED",
                    "insertions": 29,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 253,
            "sizeDeletions": 57
        },
        {
            "number": 4,
            "revision": "a7b74dc31001884243556e4433d0bbfda3c09083",
            "parents": [
                "17257673579b66c6e5c2769fc0a1ffd2decc71d2"
            ],
            "ref": "refs/changes/06/48806/4",
            "uploader": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "createdOn": 1637102787,
            "author": {
                "name": "Chris Cain",
                "email": "cjcain@us.ibm.com",
                "username": "cjcain"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "occ_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 157,
                    "deletions": -48
                },
                {
                    "file": "occ_manager.hpp",
                    "type": "MODIFIED",
                    "insertions": 23,
                    "deletions": -1
                },
                {
                    "file": "occ_presence.cpp",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "occ_status.cpp",
                    "type": "MODIFIED",
                    "insertions": 41,
                    "deletions": -5
                },
                {
                    "file": "occ_status.hpp",
                    "type": "MODIFIED",
                    "insertions": 27,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 251,
            "sizeDeletions": 57
        }
    ]
}
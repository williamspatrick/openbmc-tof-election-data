{
    "project": "openbmc/phosphor-post-code-manager",
    "branch": "master",
    "id": "I1d262f76a4c320eaa878a97512e3832b63f9bb83",
    "number": 39196,
    "subject": "fix single host cannot capture post code issue.",
    "owner": {
        "name": "Kuiying Wang",
        "email": "wangkuiying.wky@alibaba-inc.com",
        "username": "kuiyingw"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-post-code-manager/+/39196",
    "commitMessage": "fix single host cannot capture post code issue.\n\nChange-Id: I1d262f76a4c320eaa878a97512e3832b63f9bb83\nSigned-off-by: Kuiying Wang <kuiying.wang@intel.com>\n",
    "createdOn": 1608618116,
    "lastUpdated": 1610341302,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1608618116,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1608618127,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608618174,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/10197/ : FAILURE"
        },
        {
            "timestamp": 1608627075,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1608627087,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608627113,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/10203/ : FAILURE"
        },
        {
            "timestamp": 1608628466,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1608628478,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608628514,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/10218/ : FAILURE"
        },
        {
            "timestamp": 1608629008,
            "reviewer": {
                "name": "Kumar Thangavel",
                "email": "thangavel.k@hcl.com",
                "username": "HCL-BMC"
            },
            "message": "Patch Set 3: Code-Review+1\n\nLooks good to me."
        },
        {
            "timestamp": 1608644030,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Patch Set 3: Verified+1 Ok-To-Test+1"
        },
        {
            "timestamp": 1608644078,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/10231/ : SUCCESS"
        },
        {
            "timestamp": 1608661993,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3:\n\nThe multi-host-postcode design document says:\n\n> The community follows conventions Host0 for single host and Host1 to N for multi-host.\n\nSo I'm not opposed to this change but I don't think it follows the design."
        },
        {
            "timestamp": 1609730026,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Patch Set 3:\n\n> Patch Set 3:\n> \n> The multi-host-postcode design document says:\n> \n> > The community follows conventions Host0 for single host and Host1 to N for multi-host.\n> \n> So I'm not opposed to this change but I don't think it follows the design.\n\nsee this: https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/35065/10/designs/multi-host-postcode.md"
        },
        {
            "timestamp": 1609801683,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1609809048,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1609809995,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1609893151,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1610149576,
            "reviewer": {
                "name": "Jonathan Doman",
                "email": "jonathan.doman@intel.com",
                "username": "jonathan-doman"
            },
            "message": "Patch Set 3: Code-Review-1\n\n> Patch Set 3:\n> \n> > Patch Set 3:\n> > \n> > The multi-host-postcode design document says:\n> > \n> > > The community follows conventions Host0 for single host and Host1 to N for multi-host.\n> > \n> > So I'm not opposed to this change but I don't think it follows the design.\n> \n> see this: https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/35065/10/designs/multi-host-postcode.md\n\nThe design still says that it will follow the community conventions. I've updated the design doc here to hopefully make everything clear: https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/39455. There is no reason not the follow the standard convention while we have the opportunity here to do it."
        },
        {
            "timestamp": 1610341302,
            "reviewer": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "message": "Abandoned\n\nhttps://gerrit.openbmc-project.xyz/c/openbmc/phosphor-post-code-manager/+/39502"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0eb67b497359b7cf8a90e73bb58e2880b7229905",
            "parents": [
                "fd45f78858304f67a0e80224a99cbe76eed82af0"
            ],
            "ref": "refs/changes/96/39196/1",
            "uploader": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "createdOn": 1608618116,
            "author": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "inc/post_code.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -3
                },
                {
                    "file": "service_files/xyz.openbmc_project.State.Boot.PostCode.service",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 12,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "cd9afda4953950094265a291f5a7aeed4e968022",
            "parents": [
                "fd45f78858304f67a0e80224a99cbe76eed82af0"
            ],
            "ref": "refs/changes/96/39196/2",
            "uploader": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "createdOn": 1608627075,
            "author": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "inc/post_code.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -4
                },
                {
                    "file": "service_files/xyz.openbmc_project.State.Boot.PostCode.service",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -9
                },
                {
                    "file": "src/post_code.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 16
        },
        {
            "number": 3,
            "revision": "f05f6877866506f4d22611a2fc04aa69e7886c18",
            "parents": [
                "fd45f78858304f67a0e80224a99cbe76eed82af0"
            ],
            "ref": "refs/changes/96/39196/3",
            "uploader": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "createdOn": 1608628466,
            "author": {
                "name": "Kuiying Wang",
                "email": "wangkuiying.wky@alibaba-inc.com",
                "username": "kuiyingw"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 0,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "If we want to go with this change, can you add more description and testing steps?"
                },
                {
                    "file": "inc/post_code.hpp",
                    "line": 60,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "The PostCodeDataHolder class seems quite weird and should probably try to get rid of it instead of adding to it. Can we just pass the node id to PostCode constructor, and then calculate the string inside there?"
                },
                {
                    "file": "service_files/xyz.openbmc_project.State.Boot.PostCode.service",
                    "line": 5,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "This is the service file for single host case, correct?\nIt is cleaner to either make --host as optional flag for multi-host, so without it it defaults to single host\nor use \"--host 0\" or \"--host=single\" for single host"
                },
                {
                    "file": "src/main.cpp",
                    "line": 68,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "I might be missing something.\nBut postcodeDataHolderObj->node defaults to 0, removing this should alone should be able to fix the the single host case.\nIn otherwords, if no -h option in the service start, single host is implied, nodeId default of 0 is used throughout"
                },
                {
                    "file": "src/main.cpp",
                    "line": 68,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "The bug is in the D-Bus object name, not in this logic to set the well-known bus name."
                },
                {
                    "file": "src/main.cpp",
                    "line": 68,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "According to design doc, service name here should be PostCodeX X is 1..N for multi-host. For single host it might be good to name it PostCode0 to be more consistent. Even though it was not defined in the multi-host design doc."
                },
                {
                    "file": "src/main.cpp",
                    "line": 68,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "I think we should update the design doc and get everyone to agree. I will push a review to clarify the single-host design."
                },
                {
                    "file": "src/main.cpp",
                    "line": 48,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Aside from how to fix the single host case, range checking for postcodeDataHolderObj->node is a good idea."
                },
                {
                    "file": "src/main.cpp",
                    "line": 72,
                    "reviewer": {
                        "name": "Jonathan Doman",
                        "email": "jonathan.doman@intel.com",
                        "username": "jonathan-doman"
                    },
                    "message": "if you're touching this code, can you rename intfName -> serviceName for clarity?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 10,
                    "deletions": 0
                },
                {
                    "file": "inc/post_code.hpp",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -4
                },
                {
                    "file": "service_files/xyz.openbmc_project.State.Boot.PostCode.service",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                },
                {
                    "file": "src/main.cpp",
                    "type": "MODIFIED",
                    "insertions": 10,
                    "deletions": -8
                },
                {
                    "file": "src/post_code.cpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 18,
            "sizeDeletions": 15
        }
    ]
}
{
    "project": "openbmc/libmctp",
    "branch": "master",
    "topic": "routing",
    "id": "I99a67eee528aff3309c0833099a9ba7f4b9bcb9b",
    "number": 34283,
    "subject": "core: Add dynamic address pool",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@aj.id.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/libmctp/+/34283",
    "commitMessage": "core: Add dynamic address pool\n\nInclude a method to allocate a range of endpoint IDs from the pool.\n\nNo effort is made to implement an endpoint ID recycling scheme - for\nnow, once the pool is exhausted we return an error.\n\nSigned-off-by: Andrew Jeffery <andrew@aj.id.au>\nChange-Id: I99a67eee528aff3309c0833099a9ba7f4b9bcb9b\n",
    "createdOn": 1593619971,
    "lastUpdated": 1611016118,
    "open": true,
    "status": "NEW",
    "comments": [
        {
            "timestamp": 1593619971,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1593619993,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1593619999,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/312/"
        },
        {
            "timestamp": 1593620274,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/312/ : SUCCESS"
        },
        {
            "timestamp": 1594805427,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1603887229,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1604890880,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1605067417,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1605067445,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1605067512,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/7643/ : SUCCESS"
        },
        {
            "timestamp": 1607332962,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1607560892,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1610350576,
            "reviewer": {
                "name": "Richard Marian Thomaiyar",
                "email": "richard.marian.thomaiyar@linux.intel.com",
                "username": "rthomaiy"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1610946942,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2:\n\n(2 comments)"
        },
        {
            "timestamp": 1611016056,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1611016079,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1611016118,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11059/ : SUCCESS"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "11cb464ef4fa429ed6f44af77b986116ee44b65a",
            "parents": [
                "cd87ba18d4dca1b70e5375248c2fd077eb32a9d4"
            ],
            "ref": "refs/changes/83/34283/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1593619971,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "core.c",
                    "line": 837,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "This API requires re-work \ni.e Route_allocate must accept bus & device address when it is allocating with the length (DOWNSTREAM). \nWe need allocation as follows\n1. Allocation to DOWNSTREAM EP\n2. Allocation to DOWNSTREAM Bridge (with single EID only)\n3. Allocation to DOWNSTREAM Bridge (with range)\n4. Allocation to DOWNSTREAM Bridge (only range)\n\nNote: In case of local usage, then len in the param is unnecessary."
                },
                {
                    "file": "core.c",
                    "line": 837,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "See line 841 below. struct mctp_device is a member of struct mctp_route, so the bus and device address are already being passed."
                },
                {
                    "file": "core.c",
                    "line": 837,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Marking resolved based on my reply above."
                },
                {
                    "file": "core.c",
                    "line": 894,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "This must be DOWNSTREAM. Local must be used the bridge ports and not to the downstream devices. \nCorrect me, if this API is not for reserving an EID for a particular device."
                },
                {
                    "file": "core.c",
                    "line": 894,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I need to recall what I was thinking :)"
                },
                {
                    "file": "core.c",
                    "line": 894,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I think this is mitigated by a test at the top:\n\n if (!(route->type == MCTP_ROUTE_TYPE_LOCAL || route->type == MCTP_ROUTE_TYPE_DOWNSTREAM))\n  return -EINVAL;\n\nthen we just remove this assignment"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 86,
                    "deletions": 0
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "tests/test_route.c",
                    "type": "MODIFIED",
                    "insertions": 55,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 147,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "7612ce234bbb7ec050ddce7dc914aae50f26dd81",
            "parents": [
                "276f5d8a30a814f839ef1d01f49d91eedb51d1f8"
            ],
            "ref": "refs/changes/83/34283/2",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1605067417,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "core.c",
                    "line": 946,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "if (mctp->dynamic) should be enough here?"
                },
                {
                    "file": "core.c",
                    "line": 946,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I'm not sure I follow? It's a sanity check that the pool's in a good state. It's not enough that the start EID is non-zero."
                },
                {
                    "file": "core.c",
                    "line": 946,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "what i meant to say is mctp_route_set_dynamic_pool() already verified the range, hence dynamic_pool is valid one. We just need to make sure that we are having dynamic_pool before proceeding."
                },
                {
                    "file": "core.c",
                    "line": 946,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Right, maybe this is a bit pessimistic, I'll just assert it."
                },
                {
                    "file": "core.c",
                    "line": 975,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "you have already mentioned, the free and repurpose of the EID is not in this commit. But using only this header pointer alone won't work right? \nIt's better to create the structure, which will be able to cover it in this patchset, rather than the code, which must change."
                },
                {
                    "file": "core.c",
                    "line": 975,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "This is a valid implementation though. It might not be the most practical, but it's a start. I don't think we should let perfect be the enemy of \"good enough\""
                },
                {
                    "file": "core.c",
                    "line": 975,
                    "reviewer": {
                        "name": "Richard Marian Thomaiyar",
                        "email": "richard.marian.thomaiyar@linux.intel.com",
                        "username": "rthomaiy"
                    },
                    "message": "I normally prefer broken patches and fine with start patch :), but if it is not under review on related commits, then with either TO-DO, which conveys our intention / plan, so that later if someone picks it up, message is conveyed"
                },
                {
                    "file": "core.c",
                    "line": 975,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "There's already an 'XXX' comment (todo) on line 938."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 97,
                    "deletions": 0
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "tests/test_route.c",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 160,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "6da83430f6e4a188e10b9a749b83e6fcaeec49e7",
            "parents": [
                "f475a2564ebf5d226db189da11ff85ff353d703f"
            ],
            "ref": "refs/changes/83/34283/3",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1611016056,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "core.c",
                    "type": "MODIFIED",
                    "insertions": 90,
                    "deletions": 0
                },
                {
                    "file": "libmctp.h",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": 0
                },
                {
                    "file": "tests/test_route.c",
                    "type": "MODIFIED",
                    "insertions": 57,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 153,
            "sizeDeletions": 0
        }
    ]
}
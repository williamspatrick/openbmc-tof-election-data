{
    "project": "openbmc/dbus-sensors",
    "branch": "master",
    "id": "Idf9c2aa916ac741ff047c5baea51a664c101c33d",
    "number": 38788,
    "subject": "Fix ExitAirTempSensor calculation",
    "owner": {
        "name": "Zhikui Ren",
        "email": "zhikui.ren@intel.com",
        "username": "ZhikuiRen"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/dbus-sensors/+/38788",
    "commitMessage": "Fix ExitAirTempSensor calculation\n\nWhen calculating maxRPM, variables tachMaxPercent and tachMinPercent\nare in percentage. Both tachMaxReading and tachMinReading are already\nspecified as percentage in configuration file.\n\nWhen cfm is less than 50% of QMin, exit air temp formula does not\nwork correctly. Make exit air temp not available.\n\nUse steady_clock to ensure time elapsed is non-negative.\n\nIncrease the error print count to 5 during exit air temp computation.\nThis change allows power reading related error messages to be logged\nin addition to fan sensor reading errors during same computation cycle.\n\nThis patch also includes minor clean up that moves powerReading\nto private member.\n\nTested:\nBefore the change, exit air temp reports critical event occasionally on power up.\nExamples:\nExit_Air_Temp sensor crossed a critical high threshold going high. Reading=13938.000000 Threshold=85.000000\nExit_Air_Temp sensor crossed a critical low threshold going low. Reading=-119240.000000 Threshold=0.000000\n\nSame AC cycle test was run with the change, the issue is resolved.\n\nSigned-off-by: Zhikui Ren <zhikui.ren@intel.com>\nChange-Id: Idf9c2aa916ac741ff047c5baea51a664c101c33d\n",
    "createdOn": 1607037478,
    "lastUpdated": 1618511770,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1607037478,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1607037490,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1607037557,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1607037579,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/9059/ : FAILURE"
        },
        {
            "timestamp": 1607038310,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1607038320,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1607038413,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/9060/ : FAILURE"
        },
        {
            "timestamp": 1607038616,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1607038629,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1607038708,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/9061/ : SUCCESS"
        },
        {
            "timestamp": 1608257863,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 3:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1608257863,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Set Ready For Review"
        },
        {
            "timestamp": 1613621338,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Set Work In Progress"
        },
        {
            "timestamp": 1613773842,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1613773854,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1613773869,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 4:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1613774016,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/12711/ : SUCCESS"
        },
        {
            "timestamp": 1613847142,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(7 comments)"
        },
        {
            "timestamp": 1613938958,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1614101569,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 4:\n\n(6 comments)"
        },
        {
            "timestamp": 1614541177,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1614541197,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1614541374,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 5:\n\n(6 comments)\n\nPlease review again"
        },
        {
            "timestamp": 1614541384,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/13134/ : SUCCESS"
        },
        {
            "timestamp": 1615352780,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(2 comments)\n\na couple things I should've caught earlier."
        },
        {
            "timestamp": 1615402452,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1615496305,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1615584043,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1617213836,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 6."
        },
        {
            "timestamp": 1617213859,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617214122,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 6: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14661/ : SUCCESS"
        },
        {
            "timestamp": 1617214413,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 6:\n\n(1 comment)\n\nComments are addressed, please help review again."
        },
        {
            "timestamp": 1617225858,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 6:\n\n(5 comments)"
        },
        {
            "timestamp": 1617385896,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 7."
        },
        {
            "timestamp": 1617385909,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617386166,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 7: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14817/ : SUCCESS"
        },
        {
            "timestamp": 1617386577,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 7:\n\n(5 comments)\n\nReduce the scope of this patch based of the comments. Will use separate patch for the remaining issues if needed after root cause is better identified."
        },
        {
            "timestamp": 1617387883,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 7:\n\n(5 comments)"
        },
        {
            "timestamp": 1617393158,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 8."
        },
        {
            "timestamp": 1617393170,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617393416,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 8: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14819/ : SUCCESS"
        },
        {
            "timestamp": 1617394245,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 8:\n\n(5 comments)"
        },
        {
            "timestamp": 1617395807,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 8:\n\n(3 comments)"
        },
        {
            "timestamp": 1617395912,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 8:\n\n(2 comments)"
        },
        {
            "timestamp": 1617408614,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Uploaded patch set 9."
        },
        {
            "timestamp": 1617408626,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1617408956,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 9: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/14824/ : SUCCESS"
        },
        {
            "timestamp": 1617409337,
            "reviewer": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "message": "Patch Set 9:\n\n(1 comment)"
        },
        {
            "timestamp": 1618511767,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 9: Code-Review+2"
        },
        {
            "timestamp": 1618511770,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 12e3d67e3ba76bc832e2e1e1fc38933b055afd79 by Ed Tanous"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "2a9764d3e41c5143df37576a2b591ba7d9ccf14f",
            "parents": [
                "da27423cdaf0558579fbdcf1eaa2a34ea19cb8de"
            ],
            "ref": "refs/changes/88/38788/1",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1607037478,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -2
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 160,
                    "deletions": -92
                }
            ],
            "sizeInsertions": 166,
            "sizeDeletions": 94
        },
        {
            "number": 2,
            "revision": "5ae016db0a284fd88d3e1acc88b6218d27792636",
            "parents": [
                "da27423cdaf0558579fbdcf1eaa2a34ea19cb8de"
            ],
            "ref": "refs/changes/88/38788/2",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1607038310,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 155,
                    "deletions": -92
                }
            ],
            "sizeInsertions": 161,
            "sizeDeletions": 96
        },
        {
            "number": 3,
            "revision": "e707c80775f07e626a170e2114ecf80f94373ff0",
            "parents": [
                "da27423cdaf0558579fbdcf1eaa2a34ea19cb8de"
            ],
            "ref": "refs/changes/88/38788/3",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1607038616,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 107,
                    "deletions": -44
                }
            ],
            "sizeInsertions": 113,
            "sizeDeletions": 48
        },
        {
            "number": 4,
            "revision": "cc4c84380735223c90277ee4796cd3386f946c51",
            "parents": [
                "8a57ec0915f92194acf867d9fbdda653aacbf27d"
            ],
            "ref": "refs/changes/88/38788/4",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1613773842,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Better commit message needed here.  \"Correct\" is not a good description.  How were they wrong?  How would a user expect the resulting values to be changed after this patch?  Is this an issue with the exit air temp algorithm itself, or is it a problem with other things that happens to manifest as an exit air temp problem?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Will update with more description."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Need a better test, but I'm not sure what to suggest because I'm not quite sure what situation you're actually fixing.  Maybe check the SDR is correct?  Or check redfish?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 13,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 549,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This seems like an odd check.  Wouldn't we want to replace the power readings if they change, regardless of whether or not they already exist?\n\nI'd expect that we want to do both line 551 AND line 556 in both conditions.  Unless I'm really missing something here."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 549,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "This is following the existing pattern for tachRanges. Line 206 -220.\nComment at line 550 explains that 551 includes 556 under the hood.\nThe goal for this patch is to make sure the calculation is correct and bounded.\n\nThat being said, the service is doing more calculation and update than other sensors.\nFor example, with six fans that updating every 500ms, one power supply, one inlet temp \nexit air temp will get recalculated eight times every 500ms.\nAnd I have seen this service stuck in a \"busy\" state with dbus connection timeout.\nI am also working on simplify it in a separate patch."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 631,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This should likely be weak_from_this().  If the sensor gets destroyed while we're doing this operation, we don't need an owning reference to it."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 631,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Good catch, will update"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 631,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 684,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Wasn't mentioned in your commit message?  Not sure why we would want this."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 684,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Will update commit message"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 684,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 801,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Shouldn't we just fix the bug in fan sensor that publishes the bad reading?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 801,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "I guess the wording was not accurate. The question here is:\nwhat should exit air temp be if we have a fan failure, giving us close to zero readings.\nTwo options here:\n1. exit air temp is not available\n2. limit the computation, so it give a high temp, but not extreme like thousands or more degrees.\nOption2 is implemented here because I don't know if there is a clear cut off on fan reading to make exit air n/a.\nBut I can be convinced to switch to option 1."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 856,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Please use:\nalphaDt = std::clamp(alphaDt, 0.0, 1.0)"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 856,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Thanks, will update"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 856,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 914,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can you please put this on line 927, right before we fill this back in, as well as a short comment why we're doing this (I'm 99% I know why, but it's non-trivial and add to see)."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 914,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 123,
                    "deletions": -46
                }
            ],
            "sizeInsertions": 129,
            "sizeDeletions": 50
        },
        {
            "number": 5,
            "revision": "93155e7b9cc6fece86649b33d7bab22974a2ce11",
            "parents": [
                "a0683a889a12bf665595ccdcb349c5f4ab321eea"
            ],
            "ref": "refs/changes/88/38788/5",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1614541177,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 805,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "If we have an invalid value, we need to publish invalid, not simply clamp it to something reasonable.  I really forget how this calculation works, but if we're getting an incorrect fan tach reading, that needs fixed, not this."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 805,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Agreed, fan sensor issue should be fixed to detect and report fan errors correctly.\nBut having a check here is still advantageous, similar to null pointer or divide by zero check even when parameters are not expected to be null or zero.\nIs there particular concern for adding check here?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 805,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Agreed, fan sensor issue should be fixed to detect and report fan errors correctly.\n> But having a check here is still advantageous, similar to null pointer or divide by zero check even when parameters are not expected to be null or zero.\n\nThe difference there is that we can't do a valid calculation in that case.  If something is nullptr, and we deference it, we crash.  If we divide by zero, we crash.  If we produce the mathematically expected result because another sensor gave us bad data, we shouldn't be covering up for it, we should give the \"correct\" result, and expecting fan sensor to hold up its gaurantees.  If we assume that we have to cover up bad sensor values, we'd probably double the size of this file with the number of sanity checks we'd need.\n\n> Is there particular concern for adding check here?\n\nMy concern is that we're covering up an issue, rather than root causing it to the thing that cause the issue in the first place.  Maybe we don't need this code at all if the fan sensor is correct all the time, and therefore we can simplify this code as a result.\n\nIf fan sensors are giving bad values at startup, that should be fixed.  If fan sensors are giving correct data, and cfm sensor is producing the wrong result, then we can consider clamping/fixing things in the algorithm."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 805,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "That is fair. But I don't think reporting 3000+ degrees for exit air temp is the best way to expose an issue.\nThe formula simply does not apply outside of \"normal\" range.  What about:\nif (cfm < qMin) { log cfm out of range message, make exit air temp not available }?\nThat way real issue is not masked and helpful info is provided."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 805,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Done in the latest patch"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 852,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm not following why this can happen;  I suspect we should be clamping sooner.  alphaDT is time duration * alpha.  If time duration is negative, something is really broken in this app, and we shouldn't be clamping it.\n\nIf alpha is negative, that seems reasonable to clamp it, but we should clamp on line 838, not after the negative number has been multiplied through.\n\nSorry, i really should've caught this the first time around."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 852,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "You are right, alpha is not going to be negative, but the time duration could be if system_clock is adjusted.\nUsing steady_clock is another option.  Will that be better?"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 28,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 126,
                    "deletions": -51
                }
            ],
            "sizeInsertions": 132,
            "sizeDeletions": 55
        },
        {
            "number": 6,
            "revision": "7ac07b245b3a599dae74f3fb86a9665a662cba58",
            "parents": [
                "add46820fb3afdc57aa36221120a6b1567c104dc"
            ],
            "ref": "refs/changes/88/38788/6",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1617213836,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 688,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "not mentioned in your commit message?  Probably for another commit?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 688,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Added to the latest commit message"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 693,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This looks wronge, Technically if we calculated something that's > cfmMaxReading, we should clamp to cfmMaxReading, not zero."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 693,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Removed"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 705,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Magic numbers?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 705,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "This was confirmed with thermal engineer, added definition."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 771,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This logic, we definitely don't need the complexity of.  If a sensor is producing values outside of its published range, that sensor needs fixed.  We should not be trying to filter in cfm sensor."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 771,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "That is fair. Removed from this patch while continue working on root causing some defect sightings."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 928,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This looks like it has nothing to do with this commit?  Maybe for another commit?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 928,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "removed"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 29,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 6,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 128,
                    "deletions": -50
                }
            ],
            "sizeInsertions": 134,
            "sizeDeletions": 54
        },
        {
            "number": 7,
            "revision": "6fac6381699fc192547e0cb8f176fac268208bce",
            "parents": [
                "5a3b3f8a743d4a8e2db9991a3808d82d528264a1"
            ],
            "ref": "refs/changes/88/38788/7",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1617385896,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "line": 80,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I suspect this part of the diff isn't needed anymore?\n\nPowerRanges isn't used."
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "line": 80,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "removed PowerRanges\nmove powerReadings from global into private here is a clean up recommended by original author.\nThis change is included in commit message"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 41,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "How was this determined?  Also, this is only used in one place, so please declare where it's used."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 41,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Moved. This is recommended by thermal engineer"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 41,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can your thermal engineer write some docs about how it was chosen then?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 666,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm still not quite understanding this math.  Shouldn't this be < qMin?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 666,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "The thermal model still work beyond the qMin as long as the corresponding coefficients are capped like line 710 and 760 etc. Using 50% of qMin as a failsafe limit is reasonable per thermal engineer."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 666,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> The thermal model still work beyond the qMin as long as the corresponding coefficients are capped like line 710 and 760 etc.\n\nThen why is it called q minimum, if it can operate below q minimum?\n\n> Using 50% of qMin as a failsafe limit is reasonable per thermal engineer.\n\nConsidering everyone (including me) has their own thermal engineers that they report to, we're going to need a better explanation than that documented somewhere."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 674,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Normally, if we can't provide a value, we would return N/A, not 0.  I'm still not quite following what glitch we're trying to solve here, so maybe 0 makes sense?"
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 674,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Setting 0 is not necessary since it returns false next. \nBut, here I am following what is being done for other cases like line 686."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 674,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Oh, good point, so this line can be removed?  Line 686 looks incorrect (I think)."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 787,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "OH, I see the real issue now, and it makes sense why this was confusing.  I suspect this fix isn't needed.\n\nInstead,\nLine 774 should be using std::chrono::steady_clock::now(), which, because the rest of this logic looks right to me, would mean that time can never go backwards, and alphaDT will never go negative."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 787,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Good suggestion"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 32,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -12
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 16
        },
        {
            "number": 8,
            "revision": "d4999c42f7f7bf83b8e1584cdfb78a98b88ab716",
            "parents": [
                "5a3b3f8a743d4a8e2db9991a3808d82d528264a1"
            ],
            "ref": "refs/changes/88/38788/8",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1617393158,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 665,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Lets get this part documented on why this is reasonable (probably in an in-line comment), then this patchset should be good to go."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 665,
                    "reviewer": {
                        "name": "Zhikui Ren",
                        "email": "zhikui.ren@intel.com",
                        "username": "ZhikuiRen"
                    },
                    "message": "Added comments."
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "line": 674,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I think this can still be removed, but I don't care that much, as you're right, 686 does the same thing (although 661 doesn't)."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 34,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 21,
            "sizeDeletions": 12
        },
        {
            "number": 9,
            "revision": "f3cee1c71540c544c3d226c59349ebfcb49883f2",
            "parents": [
                "5a3b3f8a743d4a8e2db9991a3808d82d528264a1"
            ],
            "ref": "refs/changes/88/38788/9",
            "uploader": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "createdOn": 1617408614,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 34,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 12
        },
        {
            "number": 10,
            "revision": "12e3d67e3ba76bc832e2e1e1fc38933b055afd79",
            "parents": [
                "678f53b88861f14da4884f57d8e172a0604a1569"
            ],
            "ref": "refs/changes/88/38788/10",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1618511770,
            "author": {
                "name": "Zhikui Ren",
                "email": "zhikui.ren@intel.com",
                "username": "ZhikuiRen"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 34,
                    "deletions": 0
                },
                {
                    "file": "include/ExitAirTempSensor.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": -4
                },
                {
                    "file": "src/ExitAirTempSensor.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -8
                }
            ],
            "sizeInsertions": 23,
            "sizeDeletions": 12
        }
    ]
}
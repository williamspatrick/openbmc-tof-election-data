{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "topic": "WIP",
    "id": "Ica62c34db0cce24c4c6169fc661edfde49e948d0",
    "number": 34706,
    "subject": "bmcweb handle device or resource busy exception",
    "owner": {
        "name": "Karol Wachowski",
        "email": "karol.wachowski@intel.com",
        "username": "karwachowski"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/34706",
    "commitMessage": "bmcweb handle device or resource busy exception\n\nUse async_method_call_timed() for mount/unmount dbus oprations.\nLong mount/unmount times are supported by VirtualMedia service,\nthis works because of settable timeout property, available for each block\ndevice.\nDefault dbus calls will timeout when mount/unmount timeout is long enough.\n\nGet mount/unmount timeout property and use it for mount/unmount calls.\nAdd handling of device or resource busy exception (EBUSY) that\ncan be thrown by VirtualMedia service during Mount/Unmount dbus operations.\n\nTested: Verified that after mounting non-existing HTTPS resource\n        in proxy mode, VirtualMedia recovers restoring ready state\n        and returns EBUSY during that transition.\n        Verfied that resources can be mounted/unmounted in both legacy\n        and proxy mode.\nSigned-off-by: Karol Wachowski <karol.wachowski@intel.com>\nChange-Id: Ica62c34db0cce24c4c6169fc661edfde49e948d0\n",
    "createdOn": 1594803261,
    "lastUpdated": 1613612271,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1594803261,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1594803274,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1594803280,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/1285/"
        },
        {
            "timestamp": 1594803532,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/1285/ : SUCCESS"
        },
        {
            "timestamp": 1594805839,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1594805849,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1594805855,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/1293/"
        },
        {
            "timestamp": 1594806159,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/1293/ : SUCCESS"
        },
        {
            "timestamp": 1594830823,
            "reviewer": {
                "name": "James Feist",
                "email": "james.feist@linux.intel.com",
                "username": "feistjj"
            },
            "message": "Patch Set 2:\n\n(8 comments)"
        },
        {
            "timestamp": 1594889274,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1594889284,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1594889285,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Patch Set 2:\n\n(8 comments)"
        },
        {
            "timestamp": 1594889291,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/1385/"
        },
        {
            "timestamp": 1594889608,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/1385/ : SUCCESS"
        },
        {
            "timestamp": 1594947394,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1594947489,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(3 comments)"
        },
        {
            "timestamp": 1594967988,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1594967999,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1594968002,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Patch Set 4:\n\n(6 comments)"
        },
        {
            "timestamp": 1594968005,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/1448/"
        },
        {
            "timestamp": 1594968289,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/1448/ : SUCCESS"
        },
        {
            "timestamp": 1595003338,
            "reviewer": {
                "name": "James Feist",
                "email": "james.feist@linux.intel.com",
                "username": "feistjj"
            },
            "message": "Patch Set 4:\n\n(1 comment)\n\n1 small thing"
        },
        {
            "timestamp": 1595086938,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1595229144,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1595229156,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1595229162,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5:\n\nBuild Started https://jenkins.openbmc.org/job/ci-repository/1573/"
        },
        {
            "timestamp": 1595229170,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1595229327,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1595229466,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/1573/ : SUCCESS"
        },
        {
            "timestamp": 1595482109,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(3 comments)"
        },
        {
            "timestamp": 1595493794,
            "reviewer": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1595537492,
            "reviewer": {
                "name": "James Feist",
                "email": "james.feist@linux.intel.com",
                "username": "feistjj"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1595575158,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1604606588,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\nMarking WIP so it falls off the list.  Please remove when you're ready for another review."
        },
        {
            "timestamp": 1604606590,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Topic set to WIP"
        },
        {
            "timestamp": 1613612271,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\nNo progress made.  If this is still being worked, feel free to reopen."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "693619b961163300e0dc2f0fe2f8f122de819b89",
            "parents": [
                "e7808c93f01081ca12e1b4769691b5ae673f9017"
            ],
            "ref": "refs/changes/06/34706/1",
            "uploader": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "createdOn": 1594803261,
            "author": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 132,
                    "deletions": -39
                }
            ],
            "sizeInsertions": 132,
            "sizeDeletions": 39
        },
        {
            "number": 2,
            "revision": "4322efc2903808ce096f3ff6e965649c4115e364",
            "parents": [
                "e7808c93f01081ca12e1b4769691b5ae673f9017"
            ],
            "ref": "refs/changes/06/34706/2",
            "uploader": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "createdOn": 1594805839,
            "author": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 121,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "init your variables."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 121,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 130,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This should really be logging the error and returning MAX_INT or 0.  If this gets hit, the daemon has broken the dbus contract."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 130,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 135,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Simply declare a duration type that uses the correct rep type, instead of casting to the wrong type, then casting again.  Something like\n\nreturn std::chrono::duration_cast<std::chrono::duration<uint64_t, std::ratio<1, 100000>>(std::chrono::seconds(timeout)).count();\n\nWith that said, are you sure you want to be returning a uint here?  int seems like a better choice."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 135,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done with duration type and cast.\nuint64_t is used because sync_method_call_timed() has an uint64_t timeout parameter."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 135,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 837,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "This seems really odd that we're letting a dbus call (which might itself time out) determine what our timeouts should be.\n\nThis whole patch really feels like a bug in the dbus daemon thats being called (to return a response in a timely mannger), not fixed in bmcweb."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 837,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "VirtualMedia deamon can actually block for quite some time in cases when resources are unavailable or just simply when there is huge delay getting them over the network.\nThis was solved by adding settable timeout in the deamon itself.\n\nIssue with that approach is any default dbus call on mount or unmount will timeout under such conditions.\n\nI agree that this seems more like an issue of the service itself, but to be able to use short dbus timeout values we would need to change simple mount/unmount calls to some kind of polling protocol with requests and responses.\nOther solution would be to limit users to have quickly accessible resources which I don't think is feasible."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 837,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "\"VirtualMedia deamon can actually block for quite some time in cases when resources are unavailable or just simply when there is huge delay getting them over the network.\"\n\nSo it's breaking the dbus contract.  That's a bug that should be fixed in the virtual media daemon.  If it needs an incremental or status based api, that seems like what's needed here, not getting bmcweb to set arbitrarily long timeouts.\n\n\"I agree that this seems more like an issue of the service itself, but to be able to use short dbus timeout values we would need to change simple mount/unmount calls to some kind of polling protocol with requests and responses.\"\nOr do the mount/unmount in a separate thread/task, with a timer running that is able to fire a response if it takes too long?  Given the complexities with mounting filesystems, that seems like a good separation to have anyway.\n\n\"Other solution would be to limit users to have quickly accessible resources which I don't think is feasible\"\nYeah, that seems like a non-starter."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 837,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I didn't see these comments responded to."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 837,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "I agree with you that ideally we should have service redesigned. Unfortunately we are in urge of release and we can't afford such costly operation at the moment. \n\nHaving W/A that allows bmcweb to get correct response if service timed out improves current state. As the timeout property is already available in the deamon, we would only need to use it."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 837,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "No problem.  Feel free to come back to this commit when you're ready to spent the required amount of time on it\n\n\"Having W/A that allows bmcweb to get correct response if service timed out improves current state.\"\nIt also means that nobody is going to fix it the right way in the future, and we have inconsistent dbus rules.  I would still like to see it fixed with the \"redesign\" as you call it (although I suspect it's not that severe)."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 840,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "nit: int is small, can just be by copy"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 840,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 848,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "avoid auto here, can't tell by the right size what timeout is"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 848,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 853,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "kind of surprised this doesn't just respond with an ec on error, instead of a bool.. but that's not really part of this review"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "I agree, it feels like it would simplify things here."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 853,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "So go fix it?"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1016,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "same nit as above"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1016,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1024,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "same as above about auto"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1024,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1029,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "neat, didn't know this was a thing"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1029,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Ack"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1075,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "if you use a variable for path you could combine these I think"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1075,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1080,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "path variable might help to make this more clear?"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 1080,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done, This was actually great idea. Function reduce to half of the original one and I feel like it's more readable now."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 132,
                    "deletions": -39
                }
            ],
            "sizeInsertions": 132,
            "sizeDeletions": 39
        },
        {
            "number": 3,
            "revision": "e95f5fb1030fb7308255f5f755cdea35aca6adf7",
            "parents": [
                "e7808c93f01081ca12e1b4769691b5ae673f9017"
            ],
            "ref": "refs/changes/06/34706/3",
            "uploader": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "createdOn": 1594889274,
            "author": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "you've also added a timeout.  Can you add more here on why that was needed?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 10,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "nit: it returns, not throws."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 14,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "mounted*"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "Done"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 107,
                    "deletions": -36
                }
            ],
            "sizeInsertions": 107,
            "sizeDeletions": 36
        },
        {
            "number": 4,
            "revision": "2830c144dbbf96b9a03ced6a89f16b8d5ff5f138",
            "parents": [
                "e7808c93f01081ca12e1b4769691b5ae673f9017"
            ],
            "ref": "refs/changes/06/34706/4",
            "uploader": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "createdOn": 1594967988,
            "author": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 126,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "std::chrono::microseconds ?\n\nSorry I missed this the first time"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 126,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "This was intentionally changed to std::duration type to avoid casting it to microseconds and again to uint64_t.\n\nBut yeah it seems that there is no need to explicitly cast it to uint64_t as std::chrono::microseconds.count() returns matching type."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 126,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "James, I think this is correct, and handles int/uint overflow cases correctly, whereas going std::chrono::microseconds (which on a lot of systems is int64 or int32) then casing to uint64 might have overflow issues.  This is cleaner functionally, even if it looks a little uglier.\n\nlibc++ uses uint64_t on some systems.  This duration cast is still required for other systems."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 126,
                    "reviewer": {
                        "name": "James Feist",
                        "email": "james.feist@linux.intel.com",
                        "username": "feistjj"
                    },
                    "message": "It says at least 55 bits for microseconds? https://en.cppreference.com/w/cpp/chrono/duration so probably always int64t?"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 880,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Can you please document this api in phosphor-dbus-interfaces before merging this?  It looks like this was never done (or I'm just not seeing the virtual media section)\n\nAlso, assuming we don't just fix this in the virtual media daemon, can we avoid the double dbus call and simply pick a reasonable timeout?"
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 880,
                    "reviewer": {
                        "name": "Karol Wachowski",
                        "email": "karol.wachowski@intel.com",
                        "username": "karwachowski"
                    },
                    "message": "It's already there:  - name: Timeout\nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/xyz/openbmc_project/VirtualMedia/MountPoint.interface.yaml\n\nI don't know what reasonable timeout would be. VirtualMedia can be configured to access resources with configurable timeout."
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "line": 880,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I missed it my first time looking for it.  Apologies."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 112,
                    "deletions": -34
                }
            ],
            "sizeInsertions": 112,
            "sizeDeletions": 34
        },
        {
            "number": 5,
            "revision": "5fa2fb4bd766b9c74b9edff4701408a002466b2a",
            "parents": [
                "e7808c93f01081ca12e1b4769691b5ae673f9017"
            ],
            "ref": "refs/changes/06/34706/5",
            "uploader": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "createdOn": 1595229144,
            "author": {
                "name": "Karol Wachowski",
                "email": "karol.wachowski@intel.com",
                "username": "karwachowski"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 25,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/virtual_media.hpp",
                    "type": "MODIFIED",
                    "insertions": 110,
                    "deletions": -34
                }
            ],
            "sizeInsertions": 110,
            "sizeDeletions": 34
        }
    ]
}
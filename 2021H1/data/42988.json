{
    "project": "openbmc/webui-vue",
    "branch": "master",
    "id": "I5219c68b71477adee5f6785c58808eeaa5d35986",
    "number": 42988,
    "subject": "Remove hardcoded chassis in power supplies",
    "owner": {
        "name": "Michal Szopinski",
        "email": "michalx.szopinski@intel.com",
        "username": "mszopinx"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/webui-vue/+/42988",
    "commitMessage": "Remove hardcoded chassis in power supplies\n\nAccording to our conversation on community meeting we want to remove all hardcoded chassis names in request URL. This change corrects the \"Power supplies\" table in \"Hardware Status\" view.\n\nSigned-off-by: MichalX Szopinski <michalx.szopinski@intel.com>\nChange-Id: I5219c68b71477adee5f6785c58808eeaa5d35986\n",
    "createdOn": 1620386654,
    "lastUpdated": 1623239914,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1620386654,
            "reviewer": {
                "name": "Michal Szopinski",
                "email": "michalx.szopinski@intel.com",
                "username": "mszopinx"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1620386688,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1620386756,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/16856/ : SUCCESS"
        },
        {
            "timestamp": 1620632438,
            "reviewer": {
                "name": "Maciej Magdziarz",
                "email": "maciejx.magdziarz@intel.com",
                "username": "mmagdzix"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1620741401,
            "reviewer": {
                "name": "Dixsie Wolmers",
                "email": "dixsiew@gmail.com",
                "username": "dixsie"
            },
            "message": "Removed reviewer Dixsie Wolmers."
        },
        {
            "timestamp": 1620747505,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1620748354,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1:\n\n(1 comment)\n\nSeems like a reasonable direction to me"
        },
        {
            "timestamp": 1620752755,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1620833060,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1620932102,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Removed Code-Review+1 by Derick Montague <derick.montague@ibm.com>\n"
        },
        {
            "timestamp": 1620932128,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1:\n\nI need to look at little close at the Power supplies, which is why I removed my +1"
        },
        {
            "timestamp": 1621012503,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1621017379,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 1: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1621017788,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1: Code-Review+2"
        },
        {
            "timestamp": 1621017809,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1621018929,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1621392831,
            "reviewer": {
                "name": "Snehaben Patel",
                "email": "Snehaben.Patel@ibm.com",
                "username": "sneha787"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1622065968,
            "reviewer": {
                "name": "Jason Bills",
                "email": "jason.m.bills@linux.intel.com",
                "username": "jmbills"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1623237532,
            "reviewer": {
                "name": "Michal Szopinski",
                "email": "michalx.szopinski@intel.com",
                "username": "mszopinx"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1623239914,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Change has been successfully rebased and submitted as dca9b0a5baddfec7ea0ea5e4bdb63c2dd0be27b2 by Derick Montague"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "a894ea127fb402bcb75b2351440a3b20c01bd13b",
            "parents": [
                "15bcc41f748a79201eebd46496256621870a527e"
            ],
            "ref": "refs/changes/88/42988/1",
            "uploader": {
                "name": "Michal Szopinski",
                "email": "michalx.szopinski@intel.com",
                "username": "mszopinx"
            },
            "createdOn": 1620386654,
            "author": {
                "name": "Michal Szopinski",
                "email": "michalx.szopinski@intel.com",
                "username": "mszopinx"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 45,
                    "reviewer": {
                        "name": "Derick Montague",
                        "email": "derick.montague@ibm.com",
                        "username": "derick-montague"
                    },
                    "message": "We are still hardcoding Chassis. We will need to get the odata.id value from Chassis and then get members.\n\n\"Chassis\": {\n\"@odata.id\": \"/redfish/v1/Chassis\"\n},"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 45,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "Hardcoding /redfish/v1/Chassis is okay. It is the Chassis collection defined here: \nhttps://redfish.dmtf.org/schemas/v1/ChassisCollection_v1.xml\n\nHardcoding /redfish/v1/Chassis/{id} is something we should avoid since the id can change.\n\nMaybe I don't understand the comment?"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 45,
                    "reviewer": {
                        "name": "Derick Montague",
                        "email": "derick.montague@ibm.com",
                        "username": "derick-montague"
                    },
                    "message": "So it is expect that the odata.id for has to be Chassis? If that is true, then my comment is incorrect. I thought the expectation was always get and use the odata.id value. If I was incorrect, which is more than plausible. All good.\n\n\"Chassis\": {\n\"@odata.id\": \"/redfish/v1/Chassis\"\n},"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 45,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Gunnar, hardcoding Chassis at this level isn't ok so far as I'm aware, we should be walking the full hypermedia API as intended and as Derick comments.\n\nTechnically /redfish/v1/Chassis is allowed to change, even though it's unlikely we would do that in any context, there's something to be said for following the spec to the letter.  Also, technically we could have a system that has no chassis implementation, which is something that might actually happen.\n\nIn terms of code, this works, but is going to lead to a BUNCH of code when this get moving for everything, and that code is going to be hard to optimize for speed later.  We can generisize the \"get items\" api to something like looks kinda like libredfish that takes a \"redpath\" https://github.com/DMTF/libredfish#redpath which should significantly reduce the code bloat, and make it easier to add server-side filtering once bmcweb supports it in the future."
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 45,
                    "reviewer": {
                        "name": "Jason Bills",
                        "email": "jason.m.bills@linux.intel.com",
                        "username": "jmbills"
                    },
                    "message": "I think we have a couple levels to this issue:\n1. At a broad level, we should follow the Redfish spec to the letter and walk the full hypermedia API.\n2. At a more narrow level, we have a bug on the PowerSupply page because the hardcoded chassis name doesn't match our back-end implementation.\n\nThis patch is targeted at resolving 2 just to get our bug fixed.  Then we can take more time to correctly address 1 at a broad level.\n\nIf fixing 1 is something that could be done quickly to resolve the bug, then I'm okay with it.  Otherwise, it would be nice to get this change in as an incremental step to fix this bug while we work out the right fix for 1.  Thanks!"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 45,
                    "reviewer": {
                        "name": "Michal Szopinski",
                        "email": "michalx.szopinski@intel.com",
                        "username": "mszopinx"
                    },
                    "message": "I agree with Jason, this patch is created to resolve current bug with displaying power supply. After the https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/40326 change we can modify code to use PowerSubsystem."
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 56,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "this is going to spin up the requests one at a time.  I suspect we want to do them all in parallel to reduce the load time, and do the vue equivalent of a join all on the promises."
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 56,
                    "reviewer": {
                        "name": "Derick Montague",
                        "email": "derick.montague@ibm.com",
                        "username": "derick-montague"
                    },
                    "message": "I could be wrong (daily occurrence), but it looks like he is making the calls for each powersupply on line 53 and when all the responses are returned,he is looping through the results and adding them to the suppliesList array that is committed."
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 56,
                    "reviewer": {
                        "name": "Michal Szopinski",
                        "email": "michalx.szopinski@intel.com",
                        "username": "mszopinx"
                    },
                    "message": "That's true."
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 65,
                    "reviewer": {
                        "name": "Derick Montague",
                        "email": "derick.montague@ibm.com",
                        "username": "derick-montague"
                    },
                    "message": "Side note:\nI also noticed that Power is deprecated and the replacement is PowerSubsystem.\n\n/redfish/v1/JsonSchemas/Chassis/Chassis.json\n\n\"Power\": {\n                    \"$ref\": \"http://redfish.dmtf.org/schemas/v1/Power.json#/definitions/Power\",\n                    \"deprecated\": \"This link has been deprecated in favor of the PowerSubsystem link property.\",\n                    \"description\": \"The link to the power properties, or power supplies, power policies, and sensors, for this chassis.\",\n                    \"longDescription\": \"This property shall contain a link to a resource of type Power that represents the power characteristics of this chassis.\",\n                    \"readonly\": true,\n                    \"versionDeprecated\": \"v1_15_0\"\n                },"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 65,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "PowerSubsystem has a lot of advantages, I hope to get to it one day soon.  :) https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/40326"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 65,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> Side note:\n> I also noticed that Power is deprecated and the replacement is PowerSubsystem.\n\nIn the context of this patchset, this is fine.  We don't have an implementation of the new schemas yet, and when we do, we'll have an option flag to select the two.  With that said, if you wanted to implement support for both here and now, you could, but it would be hard to test.\n\n> \n> /redfish/v1/JsonSchemas/Chassis/Chassis.json\n> \n> \"Power\": {\n>                     \"$ref\": \"http://redfish.dmtf.org/schemas/v1/Power.json#/definitions/Power\",\n>                     \"deprecated\": \"This link has been deprecated in favor of the PowerSubsystem link property.\",\n>                     \"description\": \"The link to the power properties, or power supplies, power policies, and sensors, for this chassis.\",\n>                     \"longDescription\": \"This property shall contain a link to a resource of type Power that represents the power characteristics of this chassis.\",\n>                     \"readonly\": true,\n>                     \"versionDeprecated\": \"v1_15_0\"\n>                 },"
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "line": 65,
                    "reviewer": {
                        "name": "Michal Szopinski",
                        "email": "michalx.szopinski@intel.com",
                        "username": "mszopinx"
                    },
                    "message": "Now, with this change I want to remove the hardcoded chassis name, when the PowerSubsystem will be on master then we can submit a change to use new endpoint."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -4
                },
                {
                    "file": "src/views/Health/HardwareStatus/HardwareStatusTablePowerSupplies.vue",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 5
        },
        {
            "number": 2,
            "revision": "dca9b0a5baddfec7ea0ea5e4bdb63c2dd0be27b2",
            "parents": [
                "c2f8f34e19ef7b9987538e8c2624e629b5203c17"
            ],
            "ref": "refs/changes/88/42988/2",
            "uploader": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "createdOn": 1623239914,
            "author": {
                "name": "Michal Szopinski",
                "email": "michalx.szopinski@intel.com",
                "username": "mszopinx"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 12,
                    "deletions": 0
                },
                {
                    "file": "src/store/modules/Health/PowerSupplyStore.js",
                    "type": "MODIFIED",
                    "insertions": 24,
                    "deletions": -4
                },
                {
                    "file": "src/views/Health/HardwareStatus/HardwareStatusTablePowerSupplies.vue",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 5
        }
    ]
}
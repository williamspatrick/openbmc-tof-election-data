{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I6b185ceb56b4a5302805c77d25d696c7cb3771a7",
    "number": 39782,
    "subject": "Dump: Avoid displaying dump entries with InProgess state",
    "owner": {
        "name": "Ravi Teja",
        "email": "raviteja28031990@gmail.com",
        "username": "raviteja-b"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/39782",
    "commitMessage": "Dump: Avoid displaying dump entries with InProgess state\n\nTested By:\nQuering dump entries immediately after dump create request\nGET /redfish/v1/Systems/system/LogServices/Dump/Entries\nGET /redfish/v1/Managers/bmc/LogServices/Dump/Entries\n\nSigned-off-by: Ravi Teja <raviteja28031990@gmail.com>\nChange-Id: I6b185ceb56b4a5302805c77d25d696c7cb3771a7\n",
    "createdOn": 1610962011,
    "lastUpdated": 1623945389,
    "open": false,
    "status": "ABANDONED",
    "comments": [
        {
            "timestamp": 1610962011,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1610962026,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1610962068,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Patch Set 2: Commit message was updated."
        },
        {
            "timestamp": 1610963975,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11035/ : SUCCESS"
        },
        {
            "timestamp": 1610965549,
            "reviewer": {
                "name": "Sunitha Harish",
                "email": "sunithaharish04@gmail.com",
                "username": "sunharis"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1611023443,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 2: Code-Review-1\n\n(2 comments)\n\nHey Ravi, \nI don't think bmcweb should contain logic like this. I think logic like this should go in the dump management code. i.e. the dump manager should not put out dumps of size 0 on D-Bus."
        },
        {
            "timestamp": 1611031274,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1611031351,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1611051235,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1611051840,
            "reviewer": {
                "name": "Dhruvaraj S",
                "email": "dhruvaraj@gmail.com",
                "username": "dhruvibm"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1611057915,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1611057934,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1611058083,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1611058935,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/11103/ : SUCCESS"
        },
        {
            "timestamp": 1611072358,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1611118135,
            "reviewer": {
                "name": "Ratan Gupta",
                "email": "ratankgupta31@gmail.com",
                "username": "ratagupt"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1611118662,
            "reviewer": {
                "name": "Dhruvaraj S",
                "email": "dhruvaraj@gmail.com",
                "username": "dhruvibm"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1611160213,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1611848109,
            "reviewer": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1623945389,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Abandoned\n\n5 months without comment;  I'm assuming the dump service issue was resolved.  Feel free to reopen if this is still an issue."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "e62655f3c137919b96d22457dcf8d8e8744ac703",
            "parents": [
                "19a8815adc2d58d69a15f492266ae0e921816102"
            ],
            "ref": "refs/changes/82/39782/1",
            "uploader": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "createdOn": 1610962011,
            "author": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -26
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 26
        },
        {
            "number": 2,
            "revision": "439cffad84d43dca668a18bd6c3773b5a0dd7d7e",
            "parents": [
                "19a8815adc2d58d69a15f492266ae0e921816102"
            ],
            "ref": "refs/changes/82/39782/2",
            "uploader": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "createdOn": 1610962068,
            "author": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 8,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "Why? Why are their dump entries of size zero? \nShouldn't this change be made in the dump management code?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 8,
                    "reviewer": {
                        "name": "Ravi Teja",
                        "email": "raviteja28031990@gmail.com",
                        "username": "raviteja-b"
                    },
                    "message": "Dump manager creating D-bus entry with 0 bytes immediately then collects dump and updates size of dump once dump creation completes\nwe may not notice this for bmc dump, but we can notice this for system dump as system dump collection takes few mins.\nso its a simple fix to avoid displaying dump with size of zero bytes"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 8,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Why does the dump interface exist at all if the dump hasn't completed yet?"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 8,
                    "reviewer": {
                        "name": "Ravi Teja",
                        "email": "raviteja28031990@gmail.com",
                        "username": "raviteja-b"
                    },
                    "message": "I think Dhruvraj can answer this better, lets wait for his comments"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 8,
                    "reviewer": {
                        "name": "Dhruvaraj S",
                        "email": "dhruvaraj@gmail.com",
                        "username": "dhruvibm"
                    },
                    "message": "The entries get created with InProgress as the status, I think you need to show dumps which has 'Completed' status"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 8,
                    "reviewer": {
                        "name": "Ravi Teja",
                        "email": "raviteja28031990@gmail.com",
                        "username": "raviteja-b"
                    },
                    "message": "ok, modified to check status property to display dump entries"
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 496,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "This is unexpected, if this was to move forward, I think a comment is needed for why."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 31,
                    "deletions": -26
                }
            ],
            "sizeInsertions": 31,
            "sizeDeletions": 26
        },
        {
            "number": 3,
            "revision": "0af10534ae83d6ec0706d803123853a78304940e",
            "parents": [
                "19a8815adc2d58d69a15f492266ae0e921816102"
            ],
            "ref": "refs/changes/82/39782/3",
            "uploader": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "createdOn": 1611057915,
            "author": {
                "name": "Ravi Teja",
                "email": "raviteja28031990@gmail.com",
                "username": "raviteja-b"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I'm still confused why this validation is required at all.  If the dump isn't complete, why is the service publishing an incomplete xyz.openbmc_project.Dump.Entry interface?  That seems like a bug in the service itself, not something we should be filtering here."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Ratan Gupta",
                        "email": "ratankgupta31@gmail.com",
                        "username": "ratagupt"
                    },
                    "message": "Hey Ed, the flow is like as below\n\n=> USER starts the user initiated dump through redfish API\n=> bmcweb starts the task, now it needs some object from the backend service which can be tied up with this task.\n=> backend service creates the Dbus object and sets the state to \"Incomplete\".\n=> on bmcweb either task will be timed out or success/completed(if the dbus object state property changed to \"complete\" ).\n\nDhruv, Can comment more on the same."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Dhruvaraj S",
                        "email": "dhruvaraj@gmail.com",
                        "username": "dhruvibm"
                    },
                    "message": "Yes the incomplete entries are created for redfish implementation  to monitor the progress of the dump creation."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "I understand the flow.  What I don't understand is why the new object exposes a xyz.openbmc_project.Dump.Entry interface before the dump is completed.  What I would expect is.\n\nbmcweb starts the task, now it needs some object from the backend service which can be tied up with this task.\nbackend service creates the Dbus object and sets the state to \"Incomplete\", but without a Dump.Entry interface.\nOn dump complete, the Dump.Entry interface is created."
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "line": 520,
                    "reviewer": {
                        "name": "Ravi Teja",
                        "email": "raviteja28031990@gmail.com",
                        "username": "raviteja-b"
                    },
                    "message": "Dhruv\ncan please clarify Ed question here"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "redfish-core/lib/log_services.hpp",
                    "type": "MODIFIED",
                    "insertions": 54,
                    "deletions": -26
                }
            ],
            "sizeInsertions": 54,
            "sizeDeletions": 26
        }
    ]
}
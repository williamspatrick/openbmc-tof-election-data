{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "I5b189374f08ba506dbed7f8b9b991f2808cc3bc5",
    "number": 45214,
    "subject": "Change default password hash",
    "owner": {
        "name": "Joseph Reynolds",
        "email": "joseph-reynolds@charter.net",
        "username": "joseph-reynolds"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/45214",
    "commitMessage": "Change default password hash\n\nBackground:\nOpenBMC provisions the BMC firmware image with the root account password\nin a form which is no longer acceptable to Linux-PAM version 1.5.1.\n\nSpecifically, [phosphor-defaults.inc][] sets the password hash into\n/etc/shadow as \"\\$1\\$UGMqyqdG\\$FZiylVFmRRfl9Z0Ue8G7e/\", where $1\nindicates the deprecated [MD5 hash algorithm][].\u00a0 Ref: [wikipedia passwd\nentry][].\u00a0 Beginning around PAM version 1.5.1, when you log in, the\n[pam_unix.so module][] authenticates okay but requires the password to\nbe changed.\u00a0 (For example, you'll get a message like \"You are required\nto change your password immediately (administrator enforced).\"\u00a0 This\nbehavior is undesirable for OpenBMC project defaults, and is not\ntolerated by the project's current continuous integration tools.)\n\nThis change is to replace the password hash to keep the same cleartext\npassword but hashed with an acceptable algorithm.\n\nSpecifically, the password hash supplied in phosphor-defaults.inc is\nupdated to use the same password as before but encoded\nwith the SHA-512 algorithm.\u00a0 The hash was generated by the\n`openssl passwd -6 0penBmc` command.\u00a0 This change ought to be\ntransparent and forward and backward compatible.\n\nNote various meta-layers use this same hash string in\nconf/local.conf.sample files.  They are changed to match.\n\nReferences:\n[phosphor-defaults.inc]: https://github.com/openbmc/openbmc/blob/1a977b269ed437bebb9ae7810e3157746ec9174d/meta-phosphor/conf/distro/include/phosphor-defa\nults.inc#L245\n[wikipedia passwd entry]: https://en.wikipedia.org/wiki/Passwd\n[pam_unix.so module]: https://github.com/linux-pam/linux-pam/tree/master/modules/pam_unix\n[MD5 hash algorithm]: https://en.wikipedia.org/wiki/MD5\n\nTested:\nCreated image with new password hash and PAM 1.5.1 and checked that\nlogin works okay and does not require the passwod to be changed.\n\nSigned-off-by: Joseph Reynolds <joseph-reynolds@charter.net>\nChange-Id: I5b189374f08ba506dbed7f8b9b991f2808cc3bc5\n",
    "createdOn": 1627089381,
    "lastUpdated": 1628594069,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1627089381,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1627089451,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627089459,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/5446/"
        },
        {
            "timestamp": 1627089574,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 1:\n\nI updated the only the project default and the IBM meta-layer phosphor-defaults.inc.\nAlthough I found a number of uses of the old password hash (via https://github.com/openbmc/openbmc/search?p=2&q=0penBmc), I wasn't sure if I should update them.  I am not able to test them."
        },
        {
            "timestamp": 1627091203,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/5446/ : SUCCESS"
        },
        {
            "timestamp": 1627092421,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1627257050,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1:\n\n(1 comment)\n\n> Although I found a number of uses of the old password hash (via https://github.com/openbmc/openbmc/search?p=2&q=0penBmc), I wasn't sure if I should update them.\n\nI skimmed through most of these and I think they are poor code.  There isn't a good reason to overwrite EXTRA_USERS_PARAMS in all of the local.conf.sample files, which is what these are doing, so we should probably clean them out.\n\nI would suggest that is done as separate commits.  If you don't want to take that on, let me know and I can probably clean them out."
        },
        {
            "timestamp": 1627325267,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1627325315,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1627325322,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/5475/"
        },
        {
            "timestamp": 1627325661,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n(1 comment)\n\n> I would suggest that is done as separate commits.  If you don't want to take that on, let me know and I can probably clean them out.\n\nThanks for volunteering!  I'll leave the non-IBM conf layers alone."
        },
        {
            "timestamp": 1627326024,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/5475/ : SUCCESS"
        },
        {
            "timestamp": 1627327298,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1627423479,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+1\n\nI think this looks fine.  I'd like to see it held off from merge until we get the cleanups in place so we don't have confusion as to which one is being used."
        },
        {
            "timestamp": 1627917851,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 2: Code-Review+1\n\nHolding off merge until we get cleanup done requested in above comments."
        },
        {
            "timestamp": 1628089604,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 2:\n\n> Holding off merge until we get cleanup done requested in above comments.\n\nThe proposed cleanup is in https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/45614\nwhich should be a pre-requisite for this change."
        },
        {
            "timestamp": 1628594065,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+2"
        },
        {
            "timestamp": 1628594069,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 356f9e1eaf8223f98db58fbe65400d3ad3190f7d by Patrick Williams"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "1815339cd3bf175080155f30bdd790e85b7e89fb",
            "parents": [
                "981a83d3eb8f2facfb6e375dd7cce844de2e33fe"
            ],
            "ref": "refs/changes/14/45214/1",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "createdOn": 1627089381,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "meta-phosphor/conf/distro/include/phosphor-defaults.inc",
                    "line": 249,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Suggest defining a variable with this so it can be reused (or overwritten) elsewhere."
                },
                {
                    "file": "meta-phosphor/conf/distro/include/phosphor-defaults.inc",
                    "line": 249,
                    "reviewer": {
                        "name": "Joseph Reynolds",
                        "email": "joseph-reynolds@charter.net",
                        "username": "joseph-reynolds"
                    },
                    "message": "Good idea.  Will do in next patchset."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 48,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/images/obmc-phosphor-image.bbappend",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -3
                },
                {
                    "file": "meta-phosphor/conf/distro/include/phosphor-defaults.inc",
                    "type": "MODIFIED",
                    "insertions": 1,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 4,
            "sizeDeletions": 4
        },
        {
            "number": 2,
            "revision": "e6d8a5c5113aa03c577799af02937a8c6a040053",
            "parents": [
                "981a83d3eb8f2facfb6e375dd7cce844de2e33fe"
            ],
            "ref": "refs/changes/14/45214/2",
            "uploader": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "createdOn": 1627325267,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/images/obmc-phosphor-image.bbappend",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -5
                },
                {
                    "file": "meta-phosphor/conf/distro/include/phosphor-defaults.inc",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 8,
            "sizeDeletions": 6
        },
        {
            "number": 3,
            "revision": "356f9e1eaf8223f98db58fbe65400d3ad3190f7d",
            "parents": [
                "516363e50000bf4c41a32dbe521ce50727eaded2"
            ],
            "ref": "refs/changes/14/45214/3",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1628594069,
            "author": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 47,
                    "deletions": 0
                },
                {
                    "file": "meta-ibm/recipes-phosphor/images/obmc-phosphor-image.bbappend",
                    "type": "MODIFIED",
                    "insertions": 3,
                    "deletions": -5
                },
                {
                    "file": "meta-phosphor/conf/distro/include/phosphor-defaults.inc",
                    "type": "MODIFIED",
                    "insertions": 5,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 8,
            "sizeDeletions": 6
        }
    ]
}
{
    "project": "openbmc/intel-ipmi-oem",
    "branch": "master",
    "id": "I9ebd20a4f0ba8c11d6f08a54078550172cb382ea",
    "number": 49918,
    "subject": "Make enableUnit and disableUnit files as optional",
    "owner": {
        "name": "Anjali Ray",
        "email": "anjali.ray@intel.com",
        "username": "Anjaliintel-21"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/intel-ipmi-oem/+/49918",
    "commitMessage": "Make enableUnit and disableUnit files as optional\n\nDisable Unit Files has no effect if the service is already masked.\nHere are the logs:\nroot:~# systemctl mask xyz.openbmc_project.PCIe\nCreated symlink /etc/systemd/system/xyz.openbmc_project.PCIe.service ->\n/dev/null.\nroot:~# systemctl disable xyz.openbmc_project.PCIe\nUnit /etc/systemd/system/xyz.openbmc_project.PCIe.service is masked,\nignoring.\nThus disabling after masking is not really required.\n\nAs masking creates a symlink of the unit file in /etc/systemd/system to\n/dev/null and unmasking removes it. Due to symlink being directed to\n/dev/null, it would not be possible to start a masked service at all.\n\nDisabling removes an existing (proper) symlink in /etc/systemd/system/\n<multi-user.target.wants>or<insert-other-relevant-directory>/* to the\nunit file, and enabling it inserts back the symlink in /etc/systemd/\nsystem/<multi-user.target.wants>or<insert-other-relevant-directory>/*.\nIn case of mctpd, the \"enable unit\" created an unnecessary symlink in\n/etc/systemd/system, thus it caused systemd to start mctp service but\nthey are designed to be started by a different service than systemd.\nThus, enabling after unmasking is not required for mctp.\n\nHowever, there is an issue here with the service which has its unit\nfile's symlink defined in /etc/systemd/system directory, then,\nunmasking will remove the symlink altogether. Although no service\ntoday has its symlink in /etc/systemd/system, but to work with such\npossibility we made an optional parameter disableOrEnableUnitFiles i.e.\npass it as an argument for the startOrStopService. Also, the correct\norder needs to be disable the service first and mask it. In the other\nway around - it needs to be unmasked first and enable it.\n\nTested:\nRegression testing has been done and all the functionalities are working\nas intended for all the below tests:\n1) Stop,start,enable and disable functionalities for all the MCTP\n   services and PCIe service.\n2) For disable test, we disable the service, restart the BMC and check\n   is it still disabled or not. Same with AC cycle.\n3) For enable test, we re-enable the service, restart BMC  and check\n   whether it is enabled or not and same with\n   AC cycle.\n\nSigned-off-by: ANJALI RAY <anjali.ray@intel.com>\nChange-Id: I9ebd20a4f0ba8c11d6f08a54078550172cb382ea\n",
    "createdOn": 1640166338,
    "lastUpdated": 1641466383,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1640166338,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1640166363,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1640166632,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/32374/ : SUCCESS"
        },
        {
            "timestamp": 1640168169,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1640168184,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 1:\n\nCode LGTM"
        },
        {
            "timestamp": 1640173835,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1640181415,
            "reviewer": {
                "name": "Jayaprakash Mutyala",
                "email": "mutyalax.jayaprakash@intel.com",
                "username": "jayaprakashmutyala"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1640185166,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1640185709,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1640248596,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 2: Published edit on patch set 1."
        },
        {
            "timestamp": 1640248613,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1640248855,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 3: Commit message was updated."
        },
        {
            "timestamp": 1640248884,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/32408/ : SUCCESS"
        },
        {
            "timestamp": 1640248987,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 4: Commit message was updated."
        },
        {
            "timestamp": 1640844545,
            "reviewer": {
                "name": "AppaRao Puli",
                "email": "apparao.puli@linux.intel.com",
                "username": "apuli1"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1640863302,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1640864238,
            "reviewer": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "message": "Patch Set 4:\n\n(3 comments)"
        },
        {
            "timestamp": 1640864418,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1640930442,
            "reviewer": {
                "name": "Arun P M",
                "email": "arun.p.m@linux.intel.com",
                "username": "arun-pm"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1640941961,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1641032941,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 4:\n\n(4 comments)"
        },
        {
            "timestamp": 1641205965,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1641291611,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1641291622,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1641291622,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: -Ok-To-Test"
        },
        {
            "timestamp": 1641291892,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/34857/ : SUCCESS"
        },
        {
            "timestamp": 1641294332,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1641296968,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1641356727,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Uploaded patch set 6: Commit message was updated."
        },
        {
            "timestamp": 1641439995,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 6:\n\n(2 comments)"
        },
        {
            "timestamp": 1641445133,
            "reviewer": {
                "name": "AppaRao Puli",
                "email": "apparao.puli@linux.intel.com",
                "username": "apuli1"
            },
            "message": "Patch Set 6:\n\n(3 comments)"
        },
        {
            "timestamp": 1641447376,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Patch Set 6:\n\n(3 comments)"
        },
        {
            "timestamp": 1641447709,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Uploaded patch set 7: Commit message was updated."
        },
        {
            "timestamp": 1641465646,
            "reviewer": {
                "name": "AppaRao Puli",
                "email": "apparao.puli@linux.intel.com",
                "username": "apuli1"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1641465795,
            "reviewer": {
                "name": "Arun Lal K M",
                "email": "arun.lal@intel.com",
                "username": "arunlalkm-intel"
            },
            "message": "Patch Set 7: Code-Review+1"
        },
        {
            "timestamp": 1641466140,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Uploaded patch set 8: Commit message was updated."
        },
        {
            "timestamp": 1641466171,
            "reviewer": {
                "name": "Sumanth Bhat",
                "email": "sumanth.bhat@linux.intel.com",
                "username": "sumbhat90"
            },
            "message": "Patch Set 8: Code-Review+1"
        },
        {
            "timestamp": 1641466295,
            "reviewer": {
                "name": "AppaRao Puli",
                "email": "apparao.puli@linux.intel.com",
                "username": "apuli1"
            },
            "message": "Patch Set 8: Code-Review+2"
        },
        {
            "timestamp": 1641466383,
            "reviewer": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "message": "Change has been successfully merged"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ea789a16b8c8df7d3eaa9f2707e8b7940d97c77b",
            "parents": [
                "f23fd543404a948ae436a5cf4092354dcb60a366"
            ],
            "ref": "refs/changes/18/49918/1",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1640166338,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "The commit title should describe the fix, and not the issue. May be something along the lines of \"Make disableUnit files optional\".."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "ok I will edit it"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "Based on the analysis disableUnit files are not required. As after masking, disable will not work. And After unmasking if we are enabling it, services will go to /etc/systemd/system which will be executed by systemd, but mctpd services are launched by PMCI launcher which in turn start entity manager to get all the configuration. So if systemd is running the mctpd services it will fail as entity manager has not yet started. So enableUnit files are also not required.\nPlease add if I missed something. I will update it in the next patch."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Describe the rootcause here - for example: Some services like mctpd are designed to be started by a different service than systemd. Enabling the unit files bypasses this and makes systemd start the service. Thus, this fix is making the enableUnitFiles as optional parameter."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "sure"
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1061,
                    "reviewer": {
                        "name": "Jayaprakash Mutyala",
                        "email": "mutyalax.jayaprakash@intel.com",
                        "username": "jayaprakashmutyala"
                    },
                    "message": "Below is fine.\n`if (startOrStopService)\n\nSame comment for line#1075."
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1061,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "disableUnit files will not work after masking. So I'm planning to remove this part completely in the next patch."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 23,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 21,
                    "deletions": -13
                }
            ],
            "sizeInsertions": 21,
            "sizeDeletions": 13
        },
        {
            "number": 2,
            "revision": "dfaa83dc08a2d9e82931c94f0cbc9330c0f766e7",
            "parents": [
                "f23fd543404a948ae436a5cf4092354dcb60a366"
            ],
            "ref": "refs/changes/18/49918/2",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1640248596,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 0,
            "sizeDeletions": 9
        },
        {
            "number": 3,
            "revision": "a6d9bcdcea13ffd9f75b5343eccb552e2f26aaf6",
            "parents": [
                "f23fd543404a948ae436a5cf4092354dcb60a366"
            ],
            "ref": "refs/changes/18/49918/3",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1640248855,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 30,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 0,
            "sizeDeletions": 9
        },
        {
            "number": 4,
            "revision": "0a8c66f2e0ac1871f95f1ae33fa808382065857c",
            "parents": [
                "f23fd543404a948ae436a5cf4092354dcb60a366"
            ],
            "ref": "refs/changes/18/49918/4",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1640248987,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "AppaRao Puli",
                        "email": "apparao.puli@linux.intel.com",
                        "username": "apuli1"
                    },
                    "message": "Changes are made in generic API( Not specific to mctpd), So you need to make sure it works for all services ( Those which started by systemd services as well). \n\nCurrently its used for enable/disable of  PCIe service along with mctp services. So make sure other one is not broken."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Arun P M",
                        "email": "arun.p.m@linux.intel.com",
                        "username": "arun-pm"
                    },
                    "message": "+1"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 11,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "According to testing results services are running as expected. In the next patch I will keep disableUnit files as an optional parameter to meet future use cases."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Arun P M",
                        "email": "arun.p.m@linux.intel.com",
                        "username": "arun-pm"
                    },
                    "message": "nit: Remove trailing whitespaces."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 15,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "sure"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 28,
                    "reviewer": {
                        "name": "AppaRao Puli",
                        "email": "apparao.puli@linux.intel.com",
                        "username": "apuli1"
                    },
                    "message": "More teste results needed.\n1) mctd service enable & disable functionality.\n2) PCIe service enable &disable functionality.\n3) Disable the service, restart the BMC and check is it still disabled or not. Same with AC cycle.\n4) Re-enable service, restart BMC  and check is is enabled."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 28,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "yes I did testing for all the mctp services i.e. MCTP over PCIe,MCTP over SMBus HSBP,MCTP over SMBus PCIe slot and PCIe service for all the operations i.e. start, stop, disable and enable. I executed the ipmi command for disable then did AC cycle and found that services were stopped. Similarly, I executed the command for enabling the services then Did AC cycle and checked the services. The services were enabled."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 28,
                    "reviewer": {
                        "name": "AppaRao Puli",
                        "email": "apparao.puli@linux.intel.com",
                        "username": "apuli1"
                    },
                    "message": "Thanks for confirming, Please do document same tested section of commit message."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 28,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "Done"
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "AppaRao Puli",
                        "email": "apparao.puli@linux.intel.com",
                        "username": "apuli1"
                    },
                    "message": "I remembered there were some issue if we do only \"MaskUnitFiles\"( May be some services will not stop runtime or reboot BMC might change it back etc..). Can you check is this works for all cases?"
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Disable Unit Files has no effect if the service is already masked. Here are the logs:\nroot:~# systemctl mask xyz.openbmc_project.PCIe\nCreated symlink /etc/systemd/system/xyz.openbmc_project.PCIe.service -> /dev/null.\nroot:~#\nroot:~# systemctl disable xyz.openbmc_project.PCIe\nUnit /etc/systemd/system/xyz.openbmc_project.PCIe.service is masked, ignoring.\nThus disabling after masking is not really required.\n\nThe difference between masking and enabling is as follows:\nMasking creates a symlink of the unit file in /etc/systemd/system to /dev/null and unmasking removes it. Due to symlink being directed to /dev/null, it would not be possible to start a masked service at all.\n\nDisabling removes an existing (proper) symlink in /etc/systemd/system/<multi-user.target.wants>or<insert-other-relevant-directory>/* to the unit file, and enabling it inserts back the symlink in /etc/systemd/system/<multi-user.target.wants>or<insert-other-relevant-directory>/*.\n\nIn case of mctpd, the \"enable unit\" created an unnecessary symlink in /etc/systemd/system, thus it caused systemd to start mctp service.\n\n@Anajli - please capture the details in commit message.\n\nHowever, I see one potential issue here. If a service has its unit file's symlink defined in /etc/systemd/system directory, then, unmasking will remove the symlink altogether. Although no service today has its symlink in /etc/systemd/system, it would be good to not to potentially affect such possibility.\n\nWe could roll back to patchset 1's option of making disable/enable as an optional parameter - i.e. take it as an argument for the startOrStopService. Also, the correct order needs to be disable the service first and mask it. In the other way around - it needs to be unmask first and enable it."
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Arun P M",
                        "email": "arun.p.m@linux.intel.com",
                        "username": "arun-pm"
                    },
                    "message": "@Sumanth Good find. \nIn that case does 'DisableUnitFiles' followed by 'MaskUnitFiles' will solve the issue?"
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Yes it does. Also, disableUnitFiles should be an optional parameter, i.e. should be carried out on passing a disableRequired flag to the function. (and same argument with enable)."
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Arun P M",
                        "email": "arun.p.m@linux.intel.com",
                        "username": "arun-pm"
                    },
                    "message": "I am not sure why we need optional parameter. What is the use case?"
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "If you enable an unit file, systemd starts the service by default. However, not all services (like mctpd) needs to be started by systemd. Thus the enable/disable needs to be optional."
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "Yes. We can roll back to the patchset 1's changes and reverse the order to disable."
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "line": 1063,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 31,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 0,
                    "deletions": -9
                }
            ],
            "sizeInsertions": 0,
            "sizeDeletions": 9
        },
        {
            "number": 5,
            "revision": "2a52a15786768bd179e07f366985377046c94962",
            "parents": [
                "713928b9c25c4639cae02bdc5a82044dfe9af03f"
            ],
            "ref": "refs/changes/18/49918/5",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1641291611,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 30,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "is not required for mctp"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 30,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "ok"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 39,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "unmasked"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 39,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "sure"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 53,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -11
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 11
        },
        {
            "number": 6,
            "revision": "505da57d19b921b0a710f61fd4cd55385c7916f0",
            "parents": [
                "713928b9c25c4639cae02bdc5a82044dfe9af03f"
            ],
            "ref": "refs/changes/18/49918/6",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1641356727,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "NO_CODE_CHANGE",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Make the commit subject line in the following format:\n\nIf applied, this commit will <your subject line here>\n\n(suggestion from here https://cbea.ms/git-commit/) \n\nHere, you can make it as \"Make enableUnit and disableUnit files as optional\""
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "AppaRao Puli",
                        "email": "apparao.puli@linux.intel.com",
                        "username": "apuli1"
                    },
                    "message": "+1"
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 7,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "Sure Thanks for the link"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Sumanth Bhat",
                        "email": "sumanth.bhat@linux.intel.com",
                        "username": "sumbhat90"
                    },
                    "message": "Code LGTM"
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "AppaRao Puli",
                        "email": "apparao.puli@linux.intel.com",
                        "username": "apuli1"
                    },
                    "message": "Address Sumanth comment on commit message, Other code lgtm. "
                },
                {
                    "file": "/PATCHSET_LEVEL",
                    "line": 0,
                    "reviewer": {
                        "name": "Anjali Ray",
                        "email": "anjali.ray@intel.com",
                        "username": "Anjaliintel-21"
                    },
                    "message": "ok"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 53,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -11
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 11
        },
        {
            "number": 7,
            "revision": "9eacf276bf090be067d4f0fd0cde848ebb436298",
            "parents": [
                "713928b9c25c4639cae02bdc5a82044dfe9af03f"
            ],
            "ref": "refs/changes/18/49918/7",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1641447709,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 53,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -11
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 11
        },
        {
            "number": 8,
            "revision": "1fe485cd1154a646fc58b1e9d7c36b173f2c4630",
            "parents": [
                "713928b9c25c4639cae02bdc5a82044dfe9af03f"
            ],
            "ref": "refs/changes/18/49918/8",
            "uploader": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "createdOn": 1641466140,
            "author": {
                "name": "Anjali Ray",
                "email": "anjali.ray@intel.com",
                "username": "Anjaliintel-21"
            },
            "kind": "NO_CODE_CHANGE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 53,
                    "deletions": 0
                },
                {
                    "file": "src/manufacturingcommands.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": -11
                }
            ],
            "sizeInsertions": 19,
            "sizeDeletions": 11
        }
    ]
}
{
    "project": "openbmc/phosphor-power",
    "branch": "master",
    "id": "Ia68b4f986393f0ba0184401deb29b4f5d25a2ed0",
    "number": 48320,
    "subject": "psu-ng: Add code to detect VOUT_OV_FAULT",
    "owner": {
        "name": "B. J. Wyman",
        "email": "bjwyman@gmail.com",
        "username": "bjwyman"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/48320",
    "commitMessage": "psu-ng: Add code to detect VOUT_OV_FAULT\n\nIf the output voltage hits an overvoltage condition, the VOUT_OV_FAULT\nbit (bit 5 of STATUS_WORD low byte) should turn on. The PMBus spec\nindicates that VOUT fault/warning (bit 7 high byte) and VOUT_OV_FAULT\nare associated with status in the STATUS_VOUT command response.\n\nCheck for VOUT_OV_FAULT after check for VIN_UV_FAULT, create error if\nthe fault is indicated.\n\nChange-Id: Ia68b4f986393f0ba0184401deb29b4f5d25a2ed0\nSigned-off-by: Brandon Wyman <bjwyman@gmail.com>\n",
    "createdOn": 1635291206,
    "lastUpdated": 1635781485,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1635291206,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1635291220,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635291277,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/29114/ : FAILURE"
        },
        {
            "timestamp": 1635356897,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1635356911,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635357456,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29195/ : SUCCESS"
        },
        {
            "timestamp": 1635359957,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\nThis change is ready for review."
        },
        {
            "timestamp": 1635446154,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 2:\n\n(5 comments)"
        },
        {
            "timestamp": 1635448624,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1635449097,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Patch Set 2:\n\n(5 comments)"
        },
        {
            "timestamp": 1635462289,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1635462302,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635463021,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29284/ : SUCCESS"
        },
        {
            "timestamp": 1635526068,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1635541924,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1635541939,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635542151,
            "reviewer": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "message": "Uploaded patch set 5: Patch Set 4 was rebased."
        },
        {
            "timestamp": 1635542174,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1635542179,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/29398/ : ABORTED"
        },
        {
            "timestamp": 1635544032,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/29400/ : SUCCESS"
        },
        {
            "timestamp": 1635547978,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635777506,
            "reviewer": {
                "name": "Derek Howard",
                "email": "derekh@us.ibm.com",
                "username": "derekhoward55"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635780994,
            "reviewer": {
                "name": "Matt Spinler",
                "email": "spinler@us.ibm.com",
                "username": "spinler"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635781477,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1635781485,
            "reviewer": {
                "name": "Shawn McCarney",
                "email": "shawnmm@us.ibm.com",
                "username": "smccarney"
            },
            "message": "Change has been successfully merged by Shawn McCarney"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "5b156232926cf4df525e4a3abf6f78d566a037d0",
            "parents": [
                "b821549636d7218ce4c121934f563e51129f569d"
            ],
            "ref": "refs/changes/20/48320/1",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1635291206,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 199,
                    "deletions": -9
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 261,
            "sizeDeletions": 11
        },
        {
            "number": 2,
            "revision": "6555a5d4965e7a5233d6e63bba4b6f9706ffb1c7",
            "parents": [
                "36cec351f8782d775166238ceff030e67dc8013d"
            ],
            "ref": "refs/changes/20/48320/2",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1635356897,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 250,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Was Derek asking for these to be level ERR?"
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "line": 250,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Yes. https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-power/+/48367"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 101,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Need to add new has*Fault() methods?"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 101,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "I just noticed this as I was working on another change."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 231,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Since this block of EXPECT_CALL lines is getting pretty long and is repeated a bunch of times, it might be worth refactoring it into a separate method.\n\nSomething like:\n  void setPMBusExpectations(MockedPMBus& mockPMBus, uint16_t statusWordValue,\n                            uint8_t statusInputValue, ...)\n\nThen the test variations could look like:\n  uint16_t statusWordValue{status_word::INPUT_FAULT_WARN | status_word::VIN_UV_FAULT};\n  uint8_t statusInputValue{0x38}; // pithy comment\n  ...\n  setPmBusExpections(...);\n\nJust a suggestion not a bug.  It might reduce the duplication/boilerplate and let you focus on the actual PMBus values that are different across variations."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 231,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "\ud83e\udd14\nHrm... okay, I will try to do something like that."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 342,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Witty comment: with"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 478,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Need to add STATUS_VOUT?"
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 478,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "\ud83d\ude1e Yeah..."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 598,
                    "reviewer": {
                        "name": "Shawn McCarney",
                        "email": "shawnmm@us.ibm.com",
                        "username": "smccarney"
                    },
                    "message": "Need to add STATUS_VOUT?  Same comment in several other places in this test case."
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "line": 598,
                    "reviewer": {
                        "name": "B. J. Wyman",
                        "email": "bjwyman@gmail.com",
                        "username": "bjwyman"
                    },
                    "message": "Yes sir!"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 199,
                    "deletions": -9
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 261,
            "sizeDeletions": 11
        },
        {
            "number": 3,
            "revision": "16fc7913aa4c5d8537fd261f99d587c13e3f487f",
            "parents": [
                "ef7a2b69ddb2360a3d6d02308d9e36d1f3f8fb8f"
            ],
            "ref": "refs/changes/20/48320/3",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1635462289,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 137,
                    "deletions": -26
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 199,
            "sizeDeletions": 28
        },
        {
            "number": 4,
            "revision": "8062366307a6f8e960be68e92b9310053fe83385",
            "parents": [
                "1d9e5a20b3b9cbb7b49d0a482328781a70e086b8"
            ],
            "ref": "refs/changes/20/48320/4",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1635541924,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 103,
                    "deletions": -11
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 165,
            "sizeDeletions": 13
        },
        {
            "number": 5,
            "revision": "6710ba2cc776dc9e4306807f4f586c22822100b4",
            "parents": [
                "8da35c5199b0e1f0c555ec58e9355ed71f444c49"
            ],
            "ref": "refs/changes/20/48320/5",
            "uploader": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "createdOn": 1635542151,
            "author": {
                "name": "B. J. Wyman",
                "email": "bjwyman@gmail.com",
                "username": "bjwyman"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.cpp",
                    "type": "MODIFIED",
                    "insertions": 19,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/power_supply.hpp",
                    "type": "MODIFIED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/psu_manager.cpp",
                    "type": "MODIFIED",
                    "insertions": 15,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/mock.hpp",
                    "type": "MODIFIED",
                    "insertions": 2,
                    "deletions": 0
                },
                {
                    "file": "phosphor-power-supply/test/power_supply_tests.cpp",
                    "type": "MODIFIED",
                    "insertions": 103,
                    "deletions": -11
                },
                {
                    "file": "pmbus.hpp",
                    "type": "MODIFIED",
                    "insertions": 4,
                    "deletions": -2
                }
            ],
            "sizeInsertions": 165,
            "sizeDeletions": 13
        }
    ]
}
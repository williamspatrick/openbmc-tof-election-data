{
    "project": "openbmc/openbmc",
    "branch": "master",
    "id": "I1066fe5f6ece4454e3555ca97f75bd91d6da1dba",
    "number": 38890,
    "subject": "setup: support any level of machine conf depth",
    "owner": {
        "name": "Maksym Sloyko",
        "email": "maxims@google.com",
        "username": "maksymko"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openbmc/+/38890",
    "commitMessage": "setup: support any level of machine conf depth\n\nModify setup script to support any level of machine conf depth.\nInternally Google uses machines that sit yet another layer deep\nin the repository. Instead of adding yet another level of depth\nto the expansion, look for all configs using `find`, if it's\navailable. If it's not, ball back to the old wildcard expansion.\n\nSigned-off-by: Maksym Sloyko <maxims@google.com>\nChange-Id: I1066fe5f6ece4454e3555ca97f75bd91d6da1dba\n",
    "createdOn": 1607466371,
    "lastUpdated": 1611784840,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1607466371,
            "reviewer": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1607466401,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1607466627,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1607467745,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/1245/"
        },
        {
            "timestamp": 1607469330,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/1245/ : SUCCESS"
        },
        {
            "timestamp": 1607470750,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 1:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1607479719,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 1: Code-Review+1"
        },
        {
            "timestamp": 1607971300,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 1:\n\nAndrew go ahead and merge at your convenience."
        },
        {
            "timestamp": 1608113016,
            "reviewer": {
                "name": "Alexander Amelkin",
                "email": "a.amelkin@yadro.com",
                "username": "AlexanderAmelkin"
            },
            "message": "Patch Set 1: Code-Review-1\n\n(3 comments)"
        },
        {
            "timestamp": 1608147897,
            "reviewer": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1608147926,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608147934,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/1325/"
        },
        {
            "timestamp": 1608148485,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: Code-Review+1"
        },
        {
            "timestamp": 1608148797,
            "reviewer": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "message": "Patch Set 2:\n\n(3 comments)\n\nNOTE: the script does not work in Zsh anymore, see inline comments for details."
        },
        {
            "timestamp": 1608148876,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/1325/ : SUCCESS"
        },
        {
            "timestamp": 1608149887,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2: -Code-Review"
        },
        {
            "timestamp": 1608150004,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n> Patch Set 2:\n> \n> (3 comments)\n> \n> NOTE: the script does not work in Zsh anymore, see inline comments for details.\n\nThat is unfortunate.  I use zsh.\n\nI think you make a good point though that we really don't need to support sh fully since in most cases people are sourcing this file.  We only need to make it so that we get to the point where we recognize \"this is not being sourced\" with sh-only syntax."
        },
        {
            "timestamp": 1608150318,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 2:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1608150818,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1608157944,
            "reviewer": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1608157978,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1608157985,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3:\n\nBuild Started https://jenkins.openbmc.org/job/ci-openbmc/1326/"
        },
        {
            "timestamp": 1608158028,
            "reviewer": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "message": "Patch Set 3:\n\n(1 comment)\n\n> Patch Set 2:\n> \n> (1 comment)"
        },
        {
            "timestamp": 1608159190,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-openbmc/1326/ : SUCCESS"
        },
        {
            "timestamp": 1608160592,
            "reviewer": {
                "name": "Jenkins OpenBMC IBM",
                "email": "geissonator+jenkinsibm@gmail.com",
                "username": "jenkins-openbmc-ibm"
            },
            "message": "Patch Set 3:\n\nBuild Successful \n\nIBM Hardware CI : witherspoon hardware tests passed"
        },
        {
            "timestamp": 1608211018,
            "reviewer": {
                "name": "Alexander Amelkin",
                "email": "a.amelkin@yadro.com",
                "username": "AlexanderAmelkin"
            },
            "message": "Patch Set 3:\n\n> I think you make a good point though that we really don't need to support sh fully since in most cases people are sourcing this file.  We only need to make it so that we get to the point where we recognize \"this is not being sourced\" with sh-only syntax.\n\nYou're both right about sourcing, but that doesn't allow for bashisms anyway, as Debian and Ubuntu both use dash as their default shell and it doesn't support arrays or many other neat features of bash. So it's better to keep the setup script as POSIX-compatible as possible."
        },
        {
            "timestamp": 1608211134,
            "reviewer": {
                "name": "Alexander Amelkin",
                "email": "a.amelkin@yadro.com",
                "username": "AlexanderAmelkin"
            },
            "message": "Patch Set 3: Code-Review+1\n\nLooks nice now"
        },
        {
            "timestamp": 1610732114,
            "reviewer": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "message": "Patch Set 3:\n\nHi, I believe I've addressed all the issues, is this good to go or did I miss something?\n\nNot sure what the process is."
        },
        {
            "timestamp": 1610732480,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 3: Code-Review+1\n\n> Patch Set 3:\n> \n> Hi, I believe I've addressed all the issues, is this good to go or did I miss something?\n> \n> Not sure what the process is.\n\nSometimes just needs a poke. ;)\n\nLGTM.  Thanks for keeping zsh working!"
        },
        {
            "timestamp": 1610733968,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Code-Review+1"
        },
        {
            "timestamp": 1610734124,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 3:\n\n> Patch Set 3:\n> \n> Hi, I believe I've addressed all the issues, is this good to go or did I miss something?\n> \n> Not sure what the process is.\n\nStill good with this Brad? I can pull in."
        },
        {
            "timestamp": 1611784836,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Patch Set 3: Code-Review+2"
        },
        {
            "timestamp": 1611784840,
            "reviewer": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "message": "Change has been successfully rebased and submitted as f197793a823fd9ddbb31a21a465933734e626e24 by Brad Bishop"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "3ce40b8574f7d04b2b69984ef8e840ec58f37424",
            "parents": [
                "f5a72daa5d11cb78f082c2df7ca4a2d62c67a444"
            ],
            "ref": "refs/changes/90/38890/1",
            "uploader": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "createdOn": 1607466371,
            "author": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "setup",
                    "line": 35,
                    "reviewer": {
                        "name": "Alexander Amelkin",
                        "email": "a.amelkin@yadro.com",
                        "username": "AlexanderAmelkin"
                    },
                    "message": "This is not enough to silence the `/usr/bin/which: no find in...` because it goes to stderr.\nNeed to use `> /dev/null 2>&1`."
                },
                {
                    "file": "setup",
                    "line": 35,
                    "reviewer": {
                        "name": "Maksym Sloyko",
                        "email": "maxims@google.com",
                        "username": "maksymko"
                    },
                    "message": "Done"
                },
                {
                    "file": "setup",
                    "line": 36,
                    "reviewer": {
                        "name": "Alexander Amelkin",
                        "email": "a.amelkin@yadro.com",
                        "username": "AlexanderAmelkin"
                    },
                    "message": "This is a bashism, but the script is ran with /bin/sh.\nIt won't work on systems where /bin/sh is not a bash (that is, any Debian or Ubuntu, for instance). There is no need to use an array, a simple space-separated string of values will do just fine."
                },
                {
                    "file": "setup",
                    "line": 36,
                    "reviewer": {
                        "name": "Maksym Sloyko",
                        "email": "maxims@google.com",
                        "username": "maksymko"
                    },
                    "message": "My understanding is that lines 18-21 actually force \"the calling shell\", that is the script is executed by whatever shell is sourcing it. When one tries to execute the script normally, it bails.\n\nThis actually creates a problem (for me, at least), because the fixes you've suggested do not work in Zsh. I personally can live with that: our build tools use Bash anyway and I can always use some other way.\n\nSuggestions?"
                },
                {
                    "file": "setup",
                    "line": 41,
                    "reviewer": {
                        "name": "Alexander Amelkin",
                        "email": "a.amelkin@yadro.com",
                        "username": "AlexanderAmelkin"
                    },
                    "message": "This is a bashism as well. Use just `for cfg in $configs` with `$configs` being a string.\nThat will fail on paths containing spaces, but for other cases will work on any shell."
                },
                {
                    "file": "setup",
                    "line": 41,
                    "reviewer": {
                        "name": "Maksym Sloyko",
                        "email": "maxims@google.com",
                        "username": "maksymko"
                    },
                    "message": "As mentioned above, this does not work in Zsh."
                },
                {
                    "file": "setup",
                    "line": 41,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "@Maksym:\n\nThe \"fix\" for zsh is between line 34 and 35 insert:\n\n# zsh requires wordsplit so that variable expansion behaves like bash\nif [ -n \"$ZSH_NAME\" ]; then\n    setopt local_options shwordsplit\nfi"
                },
                {
                    "file": "setup",
                    "line": 41,
                    "reviewer": {
                        "name": "Maksym Sloyko",
                        "email": "maxims@google.com",
                        "username": "maksymko"
                    },
                    "message": "Thanks, Patrick, I've applied the change you suggested."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "setup",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 8,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "6918ac695286157aca554b0ebfe760b08ffa98c4",
            "parents": [
                "3f877c75b73e6d18a12f1ce2179b358fe7f92f36"
            ],
            "ref": "refs/changes/90/38890/2",
            "uploader": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "createdOn": 1608147897,
            "author": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "setup",
                    "type": "MODIFIED",
                    "insertions": 8,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 8,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "20f0842440feede395064fadfc4c91e6d706578b",
            "parents": [
                "3f877c75b73e6d18a12f1ce2179b358fe7f92f36"
            ],
            "ref": "refs/changes/90/38890/3",
            "uploader": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "createdOn": 1608157944,
            "author": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "setup",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "f197793a823fd9ddbb31a21a465933734e626e24",
            "parents": [
                "49054bcb324c0bdd5916ad360bf500db9d9be508"
            ],
            "ref": "refs/changes/90/38890/4",
            "uploader": {
                "name": "Brad Bishop",
                "email": "bradleyb@fuzziesquirrel.com",
                "username": "bradbishop"
            },
            "createdOn": 1611784840,
            "author": {
                "name": "Maksym Sloyko",
                "email": "maxims@google.com",
                "username": "maksymko"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 16,
                    "deletions": 0
                },
                {
                    "file": "setup",
                    "type": "MODIFIED",
                    "insertions": 13,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 13,
            "sizeDeletions": 1
        }
    ]
}
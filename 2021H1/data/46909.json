{
    "project": "openbmc/openpower-pnor-code-mgmt",
    "branch": "master",
    "id": "Id2e5272048707487ee480f8435da41be56787548",
    "number": 46909,
    "subject": "item_updater_mmc: Add service calls to bios reset",
    "owner": {
        "name": "Isaac Kurth",
        "email": "isaac.kurth@ibm.com",
        "username": "IsaacPK"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/openpower-pnor-code-mgmt/+/46909",
    "commitMessage": "item_updater_mmc: Add service calls to bios reset\n\nAdded calls to pldm-reset-phyp-nvram.service and\npldm-reset-phyp-nvram-cksum.service to item_updater_mmc::reset.\nAlso added a section that deletes files created by the bmcweb app.\n\nTested: Ran the reset method and verified that the new services\nran based on their journalctl output. Verified that the code deleted\nbmcweb app files.\n\nChange-Id: Id2e5272048707487ee480f8435da41be56787548\nSigned-off-by: Isaac Kurth <isaac.kurth@ibm.com>\n",
    "createdOn": 1631723829,
    "lastUpdated": 1635196135,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1631723829,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1631723840,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1631724053,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 1: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/26396/ : SUCCESS"
        },
        {
            "timestamp": 1631909933,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 1:\n\n(2 comments)"
        },
        {
            "timestamp": 1632115522,
            "reviewer": {
                "name": "Sunitha Harish",
                "email": "sunithaharish04@gmail.com",
                "username": "sunharis"
            },
            "message": "Patch Set 1:\n\n(1 comment)\n\nI hope you will be clearing/removing the session and event subscription related data as well, which will be usually persisted at ~/bmcweb_persistent_data.json path"
        },
        {
            "timestamp": 1632155871,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1632156219,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Patch Set 1:\n\n> Patch Set 1:\n> \n> (1 comment)\n> \n> I hope you will be clearing/removing the session and event subscription related data as well, which will be usually persisted at ~/bmcweb_persistent_data.json path\n\nShould I assume that ~ will mean /home/root?"
        },
        {
            "timestamp": 1632202783,
            "reviewer": {
                "name": "Sunitha Harish",
                "email": "sunithaharish04@gmail.com",
                "username": "sunharis"
            },
            "message": "Patch Set 1:\n\n(1 comment)\n\n> Patch Set 1:\n> \n> > Patch Set 1:\n> > \n> > (1 comment)\n> > \n> > I hope you will be clearing/removing the session and event subscription related data as well, which will be usually persisted at ~/bmcweb_persistent_data.json path\n> \n> Should I assume that ~ will mean /home/root?\n\nYes. /home/root"
        },
        {
            "timestamp": 1633552993,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Uploaded patch set 2."
        },
        {
            "timestamp": 1633553001,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633553137,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/27654/ : SUCCESS"
        },
        {
            "timestamp": 1633622118,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Patch Set 2:\n\n(1 comment)"
        },
        {
            "timestamp": 1633719814,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1633719837,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633719866,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/27952/ : FAILURE"
        },
        {
            "timestamp": 1633722896,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1633722908,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1633723028,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Patch Set 4:\n\n(1 comment)"
        },
        {
            "timestamp": 1633723042,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 4: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/27957/ : SUCCESS"
        },
        {
            "timestamp": 1634159138,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 4:\n\n(2 comments)"
        },
        {
            "timestamp": 1634575527,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1634575542,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1634575639,
            "reviewer": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "message": "Patch Set 5:\n\n(2 comments)"
        },
        {
            "timestamp": 1634575675,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 5: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/28458/ : SUCCESS"
        },
        {
            "timestamp": 1634590596,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1634704289,
            "reviewer": {
                "name": "Sunitha Harish",
                "email": "sunithaharish04@gmail.com",
                "username": "sunharis"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1635195943,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Patch Set 5: Code-Review+2"
        },
        {
            "timestamp": 1635196135,
            "reviewer": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "message": "Change has been successfully rebased and submitted as bde5d7d46d58ada1ec6a5068f4a62a495f30ed9c by Adriana Kobylak"
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "0627881986a96aa52fe4853f23fa52f8707d8183",
            "parents": [
                "0ddd4fad455d4001a6b839cd201c31b9326b9bf1"
            ],
            "ref": "refs/changes/09/46909/1",
            "uploader": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "createdOn": 1631723829,
            "author": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Would be good to add some comments on what these changes do. Deleting the bmcweb directory removes the connection to the Hardware Management Console.\nCalling the pldm services resets the partition NVRAM data."
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "Sunitha Harish",
                        "email": "sunithaharish04@gmail.com",
                        "username": "sunharis"
                    },
                    "message": "+1\nIt can be mentioned that - Deleting this directory removes the files/data related to the Hardware Management Console which was managing the CEC prior to the factory reset."
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "Isaac Kurth",
                        "email": "isaac.kurth@ibm.com",
                        "username": "IsaacPK"
                    },
                    "message": "sounds good but what's the CEC? I'm not familiar with that."
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "Sunitha Harish",
                        "email": "sunithaharish04@gmail.com",
                        "username": "sunharis"
                    },
                    "message": "Sorry - i meant the system"
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 70,
                    "reviewer": {
                        "name": "Isaac Kurth",
                        "email": "isaac.kurth@ibm.com",
                        "username": "IsaacPK"
                    },
                    "message": "Added a comment about this to patchset 2.\n\nAlso added code to delete bmcweb_persistent_data.json."
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 107,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Are there any errors if these services don't exist?"
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 107,
                    "reviewer": {
                        "name": "Isaac Kurth",
                        "email": "isaac.kurth@ibm.com",
                        "username": "IsaacPK"
                    },
                    "message": "yes, so I added a try / catch block in patchset 4, which ignores errors from the bus call, in case any of the service files don't exist. Let me know if you think it should look differently."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "type": "MODIFIED",
                    "insertions": 18,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 18,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "f11673af8c518ccabdcf65b71a1845b0a86053a8",
            "parents": [
                "0ddd4fad455d4001a6b839cd201c31b9326b9bf1"
            ],
            "ref": "refs/changes/09/46909/2",
            "uploader": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "createdOn": 1633552993,
            "author": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "type": "MODIFIED",
                    "insertions": 25,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 25,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "2b0cbed422076e902f89325dae20d7c922dfca78",
            "parents": [
                "0ddd4fad455d4001a6b839cd201c31b9326b9bf1"
            ],
            "ref": "refs/changes/09/46909/3",
            "uploader": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "createdOn": 1633719814,
            "author": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 23
        },
        {
            "number": 4,
            "revision": "16b0614f32c07ecd95d9e7dd4c82f238a12bf62f",
            "parents": [
                "0ddd4fad455d4001a6b839cd201c31b9326b9bf1"
            ],
            "ref": "refs/changes/09/46909/4",
            "uploader": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "createdOn": 1633722896,
            "author": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 86,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "No need to specify the number \"6\", just have empty brackets \"[]\"."
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 86,
                    "reviewer": {
                        "name": "Isaac Kurth",
                        "email": "isaac.kurth@ibm.com",
                        "username": "IsaacPK"
                    },
                    "message": "Sounds good, added in patchset 5"
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 94,
                    "reviewer": {
                        "name": "Adriana Kobylak",
                        "email": "anoo@linux.ibm.com",
                        "username": "anoo1"
                    },
                    "message": "Let's use a range-based for loop:\nfor (const auto& service : services)"
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "line": 94,
                    "reviewer": {
                        "name": "Isaac Kurth",
                        "email": "isaac.kurth@ibm.com",
                        "username": "IsaacPK"
                    },
                    "message": "Added in patchset 5"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "type": "MODIFIED",
                    "insertions": 36,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 36,
            "sizeDeletions": 23
        },
        {
            "number": 5,
            "revision": "49dbbc2f73b03a2d69bcb765a76357b2de331fca",
            "parents": [
                "0ddd4fad455d4001a6b839cd201c31b9326b9bf1"
            ],
            "ref": "refs/changes/09/46909/5",
            "uploader": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "createdOn": 1634575527,
            "author": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 23
        },
        {
            "number": 6,
            "revision": "bde5d7d46d58ada1ec6a5068f4a62a495f30ed9c",
            "parents": [
                "6fc7fcd6b12cdf11552468244ea4b61d0c339d11"
            ],
            "ref": "refs/changes/09/46909/6",
            "uploader": {
                "name": "Adriana Kobylak",
                "email": "anoo@linux.ibm.com",
                "username": "anoo1"
            },
            "createdOn": 1635196135,
            "author": {
                "name": "Isaac Kurth",
                "email": "isaac.kurth@ibm.com",
                "username": "IsaacPK"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 18,
                    "deletions": 0
                },
                {
                    "file": "mmc/item_updater_mmc.cpp",
                    "type": "MODIFIED",
                    "insertions": 35,
                    "deletions": -23
                }
            ],
            "sizeInsertions": 35,
            "sizeDeletions": 23
        }
    ]
}
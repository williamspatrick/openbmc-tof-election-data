{
    "project": "openbmc/docs",
    "branch": "master",
    "topic": "debug-trigger",
    "id": "I0dbf8879b0e1ca337535f8878d3775ab5d2c531d",
    "number": 42948,
    "subject": "designs: BMC service failure debug and recovery",
    "owner": {
        "name": "Andrew Jeffery",
        "email": "andrew@aj.id.au",
        "username": "amboar"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/docs/+/42948",
    "commitMessage": "designs: BMC service failure debug and recovery\n\nThe design outlines a mechanism for capturing debug data in the event\nthat some BMC interfaces become unresponsive.\n\nChange-Id: I0dbf8879b0e1ca337535f8878d3775ab5d2c531d\nSigned-off-by: Andrew Jeffery <andrew@aj.id.au>\n",
    "createdOn": 1620272521,
    "lastUpdated": 1622126142,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1620272521,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1620694859,
            "reviewer": {
                "name": "Bruce Mitchell",
                "email": "bruce.mitchell@linux.vnet.ibm.com",
                "username": "BMC-Bruce"
            },
            "message": "Patch Set 1:\n\n(2 comments)\n\nAndrew J.,\n\nOverall well thought out.\nAnd I like it.  Before +1\nI want to reflect on it\nfor a while.\n\n-- \nBruce"
        },
        {
            "timestamp": 1620695579,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 1:\n\n(3 comments)"
        },
        {
            "timestamp": 1620697952,
            "reviewer": {
                "name": "Bruce Mitchell",
                "email": "bruce.mitchell@linux.vnet.ibm.com",
                "username": "BMC-Bruce"
            },
            "message": "Patch Set 1:\n\n(1 comment)"
        },
        {
            "timestamp": 1620703771,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 2: Published edit on patch set 1."
        },
        {
            "timestamp": 1620703806,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3: Published edit on patch set 2."
        },
        {
            "timestamp": 1620741560,
            "reviewer": {
                "name": "Bruce Mitchell",
                "email": "bruce.mitchell@linux.vnet.ibm.com",
                "username": "BMC-Bruce"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1620764274,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 3:\n\n(4 comments)\n\nNothing major from me, looks good."
        },
        {
            "timestamp": 1620788006,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 3:\n\n(4 comments)"
        },
        {
            "timestamp": 1620788288,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 4."
        },
        {
            "timestamp": 1620788516,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Uploaded patch set 5."
        },
        {
            "timestamp": 1620839908,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1620844921,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 5:\n\nThe OpenBMC security working group discussed some aspects of this design today.  Notes are in the minutes for 2021-05-12.  Please take a look, and address comments to the appropriate reviews.\n\nhttps://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI"
        },
        {
            "timestamp": 1620863233,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\n> Patch Set 5:\n> \n> The OpenBMC security working group discussed some aspects of this design today.  Notes are in the minutes for 2021-05-12.  Please take a look, and address comments to the appropriate reviews.\n> \n> https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI\n\nWith respect, no.\n\nIf the security working group wants to have an impact beyond its meetings it needs to do the leg-work. This means engaging with the relevant developers through the usual means, where the usual means in this case are leaving review comments against the relevant sections of patches in Gerrit.\n\nI'm not going to put any more effort into addressing the working group's concerns on the proposal than they're willing to put in to the review process. If it's too much effort to leave appropriate reviews then I can only assume that the problems are not that concerning and therefore don't warrant any action on my part.\n\nThat said, I'm cautious of giving the impression here that I might be trying to avoid addressing security concerns. I want to be clear that it isn't the case, and that the document already discusses some security issues exposed by the proposed feature. Again, if this discussion needs work, then please leave comments indicating what outcomes you're after."
        },
        {
            "timestamp": 1620918929,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 5: Code-Review+1\n\n(1 comment)"
        },
        {
            "timestamp": 1620924627,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 5:\n\n> Patch Set 5:\n> \n> > Patch Set 5:\n> > \n> > The OpenBMC security working group discussed some aspects of this design today.  Notes are in the minutes for 2021-05-12.  Please take a look, and address comments to the appropriate reviews.\n> > \n> > https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI\n> \n> With respect, no.\n> \n> If the security working group wants to have an impact beyond its meetings it needs to do the leg-work. This means engaging with the relevant developers through the usual means, where the usual means in this case are leaving review comments against the relevant sections of patches in Gerrit.\n\n+1\n\n> \n> I'm not going to put any more effort into addressing the working group's concerns on the proposal than they're willing to put in to the review process.\n\nAs it should be.\n\n> If it's too much effort to leave appropriate reviews then I can only assume that the problems are not that concerning and therefore don't warrant any action on my part.\n> \n> That said, I'm cautious of giving the impression here that I might be trying to avoid addressing security concerns. I want to be clear that it isn't the case, and that the document already discusses some security issues exposed by the proposed feature. Again, if this discussion needs work, then please leave comments indicating what outcomes you're after."
        },
        {
            "timestamp": 1620972362,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1621277279,
            "reviewer": {
                "name": "Andrew Geissler",
                "email": "geissonator@yahoo.com",
                "username": "geissonator"
            },
            "message": "Patch Set 5:\n\n(1 comment)"
        },
        {
            "timestamp": 1621842209,
            "reviewer": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "message": "Patch Set 5:\n\nSo we have a couple of +1s here, is there anything holding this up?"
        },
        {
            "timestamp": 1621869516,
            "reviewer": {
                "name": "Bruce Mitchell",
                "email": "bruce.mitchell@linux.vnet.ibm.com",
                "username": "BMC-Bruce"
            },
            "message": "Patch Set 5: Code-Review+1"
        },
        {
            "timestamp": 1621871859,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Patch Set 5: Verified+1 Code-Review+2"
        },
        {
            "timestamp": 1621871863,
            "reviewer": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "message": "Change has been successfully rebased and submitted as 240cb2b6bacb88d501a65fe10fb156231e4de041 by Patrick Williams"
        },
        {
            "timestamp": 1622126142,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 6:\n\n> ...  Please take a look, and address comments to the appropriate reviews.\n> > \n> > https://docs.google.com/document/d/1b7x9BaxsfcukQDqbvZsU2ehMq4xoJRQvLxxsDUWmAOI\n> \n> With respect, no.\n> \n> If the security working group wants to have an impact beyond its meetings it needs to do the leg-work. This means engaging with the relevant developers through the usual means, where the usual means in this case are leaving review comments against the relevant sections of patches in Gerrit.\n> \n> I'm not going to put any more effort into addressing the working group's concerns on the proposal than they're willing to put in to the review process. If it's too much effort to leave appropriate reviews then I can only assume that the problems are not that concerning and therefore don't warrant any action on my part.\n> \n> That said, I'm cautious of giving the impression here that I might be trying to avoid addressing security concerns. I want to be clear that it isn't the case, and that the document already discusses some security issues exposed by the proposed feature. Again, if this discussion needs work, then please leave comments indicating what outcomes you're after.\n\nMy purpose in making this comment was only to introduce the fact that the security WG discussed this review.  That discussion made some observations about underlying features (kexec and sysrq-trigger) but I personally found no compelling security issues.  As always, I encouraged attendees to participate in the gerrit review."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "03e783820f4823f5bccefc1ee78d2a28a51a90c7",
            "parents": [
                "ce0a0c64a11c1918bfc2db70da8ef337f3af6745"
            ],
            "ref": "refs/changes/48/42948/1",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1620272521,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/debug-trigger.md",
                    "line": 108,
                    "reviewer": {
                        "name": "Bruce Mitchell",
                        "email": "bruce.mitchell@linux.vnet.ibm.com",
                        "username": "BMC-Bruce"
                    },
                    "message": "Is the use of eBMC intentional here?\nI see below OpenBMC being used."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 108,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Good catch."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 108,
                    "reviewer": {
                        "name": "Bruce Mitchell",
                        "email": "bruce.mitchell@linux.vnet.ibm.com",
                        "username": "BMC-Bruce"
                    },
                    "message": "Done"
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 166,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "severe"
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 404,
                    "reviewer": {
                        "name": "Bruce Mitchell",
                        "email": "bruce.mitchell@linux.vnet.ibm.com",
                        "username": "BMC-Bruce"
                    },
                    "message": "The AST2600 also has internal an Embedded ARM Cortex M3\n(see here: https://www.aspeedtech.com/server_ast2600/)\n\nIs this a reason to not use the Embedded ARM Cortex M3\nto also assist in monitoring the OpenBMC stack running\non the main Dual-core ARM Cortex A7?\n\nI am thinking of a small stand alone piece of firmware\nfor the Embedded ARM Cortex M3."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 404,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Right, it would be interesting to make use of the M3. I think the question is how we would do this. The background of this proposal is that the host is using some transport that stops responding. If we were to use the M3, it would also need to be exercising the same transport that becomes unresponsive. This might not even be technically possible (e.g. in the case of FSI or LPC), so it's not clear that using the M3 has an advantage over e.g. the hardware watchdog that's pinged by the firmware on the A7."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 404,
                    "reviewer": {
                        "name": "Bruce Mitchell",
                        "email": "bruce.mitchell@linux.vnet.ibm.com",
                        "username": "BMC-Bruce"
                    },
                    "message": "Ack"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/debug-trigger.md",
                    "type": "ADDED",
                    "insertions": 435,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 435,
            "sizeDeletions": 0
        },
        {
            "number": 2,
            "revision": "d1c09c18d5a5ea708d06749e356d9b1f57c45436",
            "parents": [
                "ce0a0c64a11c1918bfc2db70da8ef337f3af6745"
            ],
            "ref": "refs/changes/48/42948/2",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1620703771,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/debug-trigger.md",
                    "type": "ADDED",
                    "insertions": 434,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 434,
            "sizeDeletions": 0
        },
        {
            "number": 3,
            "revision": "462bb7624c237f449a167ec546b05a795e1532d9",
            "parents": [
                "ce0a0c64a11c1918bfc2db70da8ef337f3af6745"
            ],
            "ref": "refs/changes/48/42948/3",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1620703806,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "kdump would help this? Don't we still need a way to trigger the panic?"
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "This design doc feels bigger then just a \"debug-trigger\". I could see us building on this for later failure recovery features. So maybe a more generic doc name? \"bmc-service-failure-recovery\"?"
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 0,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Sure, I'll rename it."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 277,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "BMC boot or host boot?"
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 277,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "I intended that to mean BMC boot. I'll clarify."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Note that I've struggled to get this enabled in OpenBMC (https://gerrit.openbmc-project.xyz/c/openbmc/meta-aspeed/+/37820)"
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 287,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Right, might need some more cajoling. I think we can view it as temporary until we get kdump."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 406,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "My understanding is our design point was the BMC doesn't trust the host and the host doesn't trust the BMC. But that's a best effort type point. I mean, the host does have a \"recovery mechanism 3\" either way."
                },
                {
                    "file": "designs/debug-trigger.md",
                    "line": 406,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Right, but \"recovery mechanism 3\" is out of scope as it's a system / hardware design issue. Everything I've said here is still valid for \"recovery mechanism 3\".\n\nFor example, you might be able to prevent a bare metal cloud provider from reclaiming the box once your lease expires by keeping the BMC in reset."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/debug-trigger.md",
                    "type": "ADDED",
                    "insertions": 434,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 434,
            "sizeDeletions": 0
        },
        {
            "number": 4,
            "revision": "5c8a4cd8f19cc7ea6895da98e93ebb1911cfea13",
            "parents": [
                "ce0a0c64a11c1918bfc2db70da8ef337f3af6745"
            ],
            "ref": "refs/changes/48/42948/4",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1620788288,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "type": "ADDED",
                    "insertions": 435,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 435,
            "sizeDeletions": 0
        },
        {
            "number": 5,
            "revision": "7c162909eeefeebbc78d41f8ea9cebe06c06a372",
            "parents": [
                "ce0a0c64a11c1918bfc2db70da8ef337f3af6745"
            ],
            "ref": "refs/changes/48/42948/5",
            "uploader": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "createdOn": 1620788516,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 118,
                    "reviewer": {
                        "name": "Patrick Williams",
                        "email": "patrick@stwcx.xyz",
                        "username": "williamspatrick"
                    },
                    "message": "Systemd does have a heartbeat mechanism.  We could require our daemons to all implement that."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 118,
                    "reviewer": {
                        "name": "Andrew Jeffery",
                        "email": "andrew@aj.id.au",
                        "username": "amboar"
                    },
                    "message": "Interesting. I wasn't aware of that feature. It's discussed here:\n\nhttp://0pointer.de/blog/projects/watchdog.html\n\nAnyway, I wouldn't say require, but maybe we should advocate for it.\n\nI feel a resilient design might deploy both mechanisms - the fallback being what I'm proposing here, and the active approach of the heartbeat mechanism."
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "line": 118,
                    "reviewer": {
                        "name": "Andrew Geissler",
                        "email": "geissonator@yahoo.com",
                        "username": "geissonator"
                    },
                    "message": "Yeah that is interesting. I'm thinking I may build on this design doc when I get back to https://lore.kernel.org/openbmc/A7171080-B143-42AD-B235-951A06B247A4@gmail.com/T/#t and will definitely look into that systemd feature."
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "type": "ADDED",
                    "insertions": 435,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 435,
            "sizeDeletions": 0
        },
        {
            "number": 6,
            "revision": "240cb2b6bacb88d501a65fe10fb156231e4de041",
            "parents": [
                "d8eb503a0a534b503a78b4cb7dc26e5d080e3b07"
            ],
            "ref": "refs/changes/48/42948/6",
            "uploader": {
                "name": "Patrick Williams",
                "email": "patrick@stwcx.xyz",
                "username": "williamspatrick"
            },
            "createdOn": 1621871863,
            "author": {
                "name": "Andrew Jeffery",
                "email": "andrew@aj.id.au",
                "username": "amboar"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 13,
                    "deletions": 0
                },
                {
                    "file": "designs/bmc-service-failure-debug-and-recovery.md",
                    "type": "ADDED",
                    "insertions": 435,
                    "deletions": 0
                }
            ],
            "sizeInsertions": 435,
            "sizeDeletions": 0
        }
    ]
}
{
    "project": "openbmc/bmcweb",
    "branch": "master",
    "id": "I775fafd86a4e2eef0bf73836d31a78fb320b61c0",
    "number": 41077,
    "subject": "Make missing static files directory non-fatal",
    "owner": {
        "name": "Ed Tanous",
        "email": "ed@tanous.net",
        "username": "edtanous"
    },
    "url": "https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/41077",
    "commitMessage": "Make missing static files directory non-fatal\n\nToday, bmcweb requires the /usr/share/www directory to exist.  In most\ncases where bmcweb was installed with make install, this is fine, but in\ndevelopment scenarios, we'd like to be able to boot.\n\nThis commit moves what used to be a fatal error (the directory not\nexisting) to a warning, to help with a common development issue I've\nseen before.\n\nTested:\nLaunched without a /usr/share/www directory present, and bmcweb launched\nsuccessfully and did not throw an exception.\n\nChange-Id: I775fafd86a4e2eef0bf73836d31a78fb320b61c0\nSigned-off-by: Ed Tanous <edtanous@google.com>\n",
    "createdOn": 1614905111,
    "lastUpdated": 1615833392,
    "open": false,
    "status": "MERGED",
    "comments": [
        {
            "timestamp": 1614905111,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 1."
        },
        {
            "timestamp": 1614905119,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 2: Patch Set 1 was rebased"
        },
        {
            "timestamp": 1614905194,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1614905224,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 2: Verified-1\n\nBuild Failed \n\nhttps://jenkins.openbmc.org/job/ci-repository/13356/ : FAILURE"
        },
        {
            "timestamp": 1614905226,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Uploaded patch set 3."
        },
        {
            "timestamp": 1614905240,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Ok-To-Test+1\n\nUser approved, CI ok to start"
        },
        {
            "timestamp": 1614906175,
            "reviewer": {
                "name": "OpenBMC CI",
                "email": "openbmcbump-ci@yahoo.com",
                "username": "jenkins-openbmc-ci"
            },
            "message": "Patch Set 3: Verified+1\n\nBuild Successful \n\nhttps://jenkins.openbmc.org/job/ci-repository/13357/ : SUCCESS"
        },
        {
            "timestamp": 1614992242,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1614992442,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1615239111,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1615239600,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n(1 comment)"
        },
        {
            "timestamp": 1615240282,
            "reviewer": {
                "name": "Gunnar Mills",
                "email": "gmills@us.ibm.com",
                "username": "gtmills"
            },
            "message": "Patch Set 3: Code-Review+1\n\n(1 comment)\n\nDon't care a ton here, would like a chance for Andrew / Joseph / Brad to weigh in and see if they have any problems with this. If you don't mind, can you hold off on merging for a few days (let's say until 3/12)?"
        },
        {
            "timestamp": 1615241480,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3:\n\n> Patch Set 3: Code-Review+1\n> \n> (1 comment)\n> \n> Don't care a ton here, would like a chance for Andrew / Joseph / Brad to weigh in and see if they have any problems with this. If you don't mind, can you hold off on merging for a few days (let's say until 3/12)?\n\nHappy to."
        },
        {
            "timestamp": 1615314677,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Removed reviewer Derick Montague."
        },
        {
            "timestamp": 1615314698,
            "reviewer": {
                "name": "Derick Montague",
                "email": "derick.montague@ibm.com",
                "username": "derick-montague"
            },
            "message": "Patch Set 3:\n\nI am opting out as this is not my area of expertise. Thanks for including me."
        },
        {
            "timestamp": 1615827084,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Patch Set 3: Code-Review+2\n\n> Patch Set 3: Code-Review+1\n> \n> (1 comment)\n> \n> Don't care a ton here, would like a chance for Andrew / Joseph / Brad to weigh in and see if they have any problems with this. If you don't mind, can you hold off on merging for a few days (let's say until 3/12)?\n\nI gave them a couple days past.  I'm going to merge this, if Andrew/Joseph/Brad want to have a discussion, I'm happy to have it, and if we conclude that this patch needs reverted, I'm happy to push the revert myself."
        },
        {
            "timestamp": 1615827087,
            "reviewer": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "message": "Change has been successfully rebased and submitted as 153fdcfb61669959279e1e32bbdba1e9703c8936 by Ed Tanous"
        },
        {
            "timestamp": 1615833392,
            "reviewer": {
                "name": "Joseph Reynolds",
                "email": "joseph-reynolds@charter.net",
                "username": "joseph-reynolds"
            },
            "message": "Patch Set 4: Code-Review+1\n\nThe concept seems okay and the code looks good."
        }
    ],
    "patchSets": [
        {
            "number": 1,
            "revision": "ff711568b410114b61caed73a1c9c7972ee7ec73",
            "parents": [
                "a178cc007a80b14df8fc70c10d3fbfc71472abfd"
            ],
            "ref": "refs/changes/77/41077/1",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1614905111,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "include/webassets.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 9,
            "sizeDeletions": 1
        },
        {
            "number": 2,
            "revision": "ef6a3593bc079cd15bee6c0a7d26b750da08b7a2",
            "parents": [
                "15124765dad8076bdfae224b5463e0aa3c26b6a7"
            ],
            "ref": "refs/changes/77/41077/2",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1614905119,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "include/webassets.hpp",
                    "type": "MODIFIED",
                    "insertions": 9,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 9,
            "sizeDeletions": 1
        },
        {
            "number": 3,
            "revision": "60ae30ecf5e4ab4e59dbba0cc0f49f345f469e64",
            "parents": [
                "15124765dad8076bdfae224b5463e0aa3c26b6a7"
            ],
            "ref": "refs/changes/77/41077/3",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1614905226,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "REWORK",
            "comments": [
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "But BMCWEB_ENABLE_STATIC_HOSTING has to enabled to hit this code.."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "Yes, but nobody knows how to read documentation, and BMCWEB_ENABLE_STATIC_HOSTING is enabled by default.  This has unfortunately bitten more than one project that attempted to use bmcweb outside of openbmc, hence why I'm trying to solve it."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "If I take a step back and think about this.. The user enabled BMCWEB_ENABLE_STATIC_HOSTING (regardless if enabled by default) and Static Hostings relies on \"/usr/share/www\" but that directory was not there, a fatal error seems like the appropriate thing to happen.\n\nNot sure I care a ton. Possible I get a defect one day for us sweeping this under the rug (the only way you would see you the warning if you had logging enabled)."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Ed Tanous",
                        "email": "ed@tanous.net",
                        "username": "edtanous"
                    },
                    "message": "> If I take a step back and think about this.. The user enabled BMCWEB_ENABLE_STATIC_HOSTING (regardless if enabled by default) and Static Hostings relies on \"/usr/share/www\" but that directory was not there, a fatal error seems like the appropriate thing to happen.\n\nDepends on how you define fatal error.  Yes, the system would fail to host /usr/share/www files, but it shouldn't crash, and shouldn't take down the other interfaces that don't have problems.  Technically a non-existent directory could be valid if the UI was ever removable at somet point.\n\n> \n> Not sure I care a ton. Possible I get a defect one day for us sweeping this under the rug (the only way you would see you the warning if you had logging enabled).\n\nI doubt it, and I wouldn't really call this sweeping it under the rug.  We ignore similar errors in other cases, like the log folders not existing.  The only way a user would see this would be if they bypassed the yocto install process (which I've heard of openbmc users doing to test bmcweb) or they weren't running on OpenBMC (which was the case when this was reported to me the other day).  In terms of OpenBMC, neither would be an external facing defect, or would be closed quickly based on the fact that they're doing things outside the definition of \"normal\"."
                },
                {
                    "file": "/COMMIT_MSG",
                    "line": 9,
                    "reviewer": {
                        "name": "Gunnar Mills",
                        "email": "gmills@us.ibm.com",
                        "username": "gtmills"
                    },
                    "message": "> Yes, the system would fail to host /usr/share/www files, but it shouldn't crash, and shouldn't take down the other interfaces that don't have problems\n\nYeah\n\n> based on the fact that they're doing things outside the definition of \"normal\"\n\nbut can't I make that same argument as for why fatal error is okay here"
                }
            ],
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "include/webassets.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 11,
            "sizeDeletions": 1
        },
        {
            "number": 4,
            "revision": "153fdcfb61669959279e1e32bbdba1e9703c8936",
            "parents": [
                "b614e2bde68db6712228f8533f56f94e41fda624"
            ],
            "ref": "refs/changes/77/41077/4",
            "uploader": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "createdOn": 1615827087,
            "author": {
                "name": "Ed Tanous",
                "email": "ed@tanous.net",
                "username": "edtanous"
            },
            "kind": "TRIVIAL_REBASE",
            "files": [
                {
                    "file": "/COMMIT_MSG",
                    "type": "ADDED",
                    "insertions": 22,
                    "deletions": 0
                },
                {
                    "file": "include/webassets.hpp",
                    "type": "MODIFIED",
                    "insertions": 11,
                    "deletions": -1
                }
            ],
            "sizeInsertions": 11,
            "sizeDeletions": 1
        }
    ]
}